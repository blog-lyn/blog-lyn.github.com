<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />






  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://blog-lyn.github.io/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e1a1e7f61eef21fbacf4a67a19789441";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/15/nodejs-note-10/" itemprop="url">
                  how to learn Node.js -- mongoose validation &unique records in mongodb
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-15T00:49:39+08:00" content="2015-11-15">
              2015-11-15
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Concepts:">Concepts:</h1><h2 id="Unique_value_in_mongodb:_Changing_the_email_type_to_an_object_with_type_rather_than_just_string">Unique value in mongodb: Changing the email type to an object with type rather than just string</h2><h3 id="example:">example:</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var s = <span class="keyword">new</span> Schema(&#123; <span class="string">name:</span> &#123; <span class="string">type:</span> String, <span class="string">unique:</span> <span class="literal">true</span> &#125;&#125;);</span><br><span class="line">Schema.path(<span class="string">'name'</span>).index(&#123; <span class="string">unique:</span> <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="validation">validation</h2><pre><code>SchemaType#<span class="function"><span class="title">validate</span><span class="params">(obj, [errorMsg], [type])</span></span>

Adds <span class="function"><span class="title">validator</span><span class="params">(s)</span></span> <span class="keyword">for</span> this document path.
</code></pre><h3 id="Parameters:">Parameters:</h3><pre><code>- obj &lt;<span class="built_in">RegExp</span>, <span class="built_in">Function</span>, <span class="built_in">Object</span>&gt; validator
- [errorMsg] &lt;<span class="built_in">String</span>&gt; optional error message
- [<span class="keyword">type</span>] &lt;<span class="built_in">String</span>&gt; optional validator <span class="keyword">type</span>
</code></pre><h3 id="Returns:">Returns:</h3><pre><code>&lt;SchemaType&gt; this
Validators always receive the value <span class="keyword">to</span> validate <span class="keyword">as</span> their first argument <span class="keyword">and</span> must <span class="keyword">return</span> <span class="built_in">Boolean</span>. Returning <span class="literal">false</span> means validation failed.

The <span class="keyword">error</span> message argument <span class="keyword">is</span> <span class="keyword">optional</span>. <span class="keyword">If</span> <span class="keyword">not</span> passed, the <span class="keyword">default</span> generic <span class="keyword">error</span> message template will be used.
</code></pre><h3 id="Examples:">Examples:</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make sure every value is equal to "something"</span></span><br><span class="line">function validator (val) &#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="string">'something'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Schema(&#123; <span class="string">name:</span> &#123; <span class="string">type:</span> String, <span class="string">validate:</span> validator &#125;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// with a custom error message</span></span><br><span class="line"></span><br><span class="line">var custom = [validator, <span class="string">'Uh oh, &#123;PATH&#125; does not equal "something".'</span>]</span><br><span class="line"><span class="keyword">new</span> Schema(&#123; <span class="string">name:</span> &#123; <span class="string">type:</span> String, <span class="string">validate:</span> custom &#125;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// adding many validators at a time</span></span><br><span class="line"></span><br><span class="line">var many = [</span><br><span class="line">    &#123; <span class="string">validator:</span> validator, <span class="string">msg:</span> <span class="string">'uh oh'</span> &#125;</span><br><span class="line">  , &#123; <span class="string">validator:</span> anotherValidator, <span class="string">msg:</span> <span class="string">'failed'</span> &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">new</span> Schema(&#123; <span class="string">name:</span> &#123; <span class="string">type:</span> String, <span class="string">validate:</span> many &#125;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or utilizing SchemaType methods directly:</span></span><br><span class="line"></span><br><span class="line">var schema = <span class="keyword">new</span> Schema(&#123; <span class="string">name:</span> <span class="string">'string'</span> &#125;);</span><br><span class="line">schema.path(<span class="string">'name'</span>).validate(validator, <span class="string">'validation of `&#123;PATH&#125;` failed with value `&#123;VALUE&#125;`'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Error_message_templates:">Error message templates:</h3><pre><code>From the examples above, you may have noticed that error messages support baseic templating. There are a few other template keywords besides {PATH}<span class="instruction"> and </span>{VALUE} too.

Validation occurs<span class="function"> pre(</span>'save'<span class="function">)</span><span class="instruction"> or </span>whenever you manually<span class="instruction"> execute </span>document<span class="comment">#validate.</span>
</code></pre><p><strong> Mongoose model instances have an update function, in which you pass on object containing the properties you want the instance to be updated to. This update function on a model does not pass through the validation middleware. </strong></p>
<hr>
<h2 id="How_To_Safely_Store_A_Password">How To Safely Store A Password</h2><h3 id="Use_bcrypt">Use bcrypt</h3><pre><code><span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt. <span class="keyword">Use</span> bcrypt.
</code></pre><h3 id="Why_Not_{MD5,_SHA1,_SHA256,_SHA512,_SHA-3,_etc}?">Why Not {MD5, SHA1, SHA256, SHA512, SHA-3, etc}?</h3><pre><code>These are all general purpose hash functions, designed <span class="built_in">to</span> calculate <span class="operator">a</span> digest <span class="operator">of</span> huge amounts <span class="operator">of</span> data <span class="operator">in</span> <span class="keyword">as</span> <span class="keyword">short</span> <span class="operator">a</span> <span class="built_in">time</span> <span class="keyword">as</span> possible. This means that they are fantastic <span class="keyword">for</span> ensuring <span class="operator">the</span> integrity <span class="operator">of</span> data <span class="operator">and</span> utterly rubbish <span class="keyword">for</span> storing passwords.

A modern server can calculate <span class="operator">the</span> MD5 hash <span class="operator">of</span> about <span class="number">330</span>MB every <span class="keyword">second</span>. If your users have passwords which are lowercase, alphanumeric, <span class="operator">and</span> <span class="number">6</span> <span class="keyword">characters</span> <span class="keyword">long</span>, you can <span class="keyword">try</span> every single possible password <span class="operator">of</span> that size <span class="operator">in</span> around <span class="number">40</span> <span class="built_in">seconds</span>.

And that’s <span class="keyword">without</span> investing anything.

If you’re willing <span class="built_in">to</span> spend about <span class="number">2</span>,<span class="number">000</span> USD <span class="operator">and</span> <span class="operator">a</span> week <span class="operator">or</span> <span class="constant">two</span> picking up CUDA, you can <span class="built_in">put</span> together your own little supercomputer cluster which will let you <span class="keyword">try</span> around <span class="number">700</span>,<span class="number">000</span>,<span class="number">000</span> passwords <span class="operator">a</span> <span class="keyword">second</span>. And that rate you’ll be cracking those passwords <span class="keyword">at</span> <span class="operator">the</span> rate <span class="operator">of</span> more than <span class="constant">one</span> per <span class="keyword">second</span>.
</code></pre><h3 id="Salts_Will_Not_Help_You">Salts Will Not Help You</h3><pre><code>It’s important to note that salts are useless for preventing dictionary attacks or brute force attacks. You can <span class="operator"><span class="keyword">use</span> huge salts <span class="keyword">or</span> many salts <span class="keyword">or</span> hand-harvested, shade-grown, organic Himalayan pink <span class="keyword">salt</span>. It doesn’<span class="keyword">t</span> affect how <span class="keyword">fast</span> an attacker can try a candidate <span class="keyword">password</span>, given the <span class="keyword">hash</span> <span class="keyword">and</span> the <span class="keyword">salt</span> <span class="keyword">from</span> your <span class="keyword">database</span>.

<span class="keyword">Salt</span> <span class="keyword">or</span> <span class="keyword">no</span>, <span class="keyword">if</span> you’re <span class="keyword">using</span> a <span class="keyword">general</span>-purpose <span class="keyword">hash</span> <span class="keyword">function</span> designed <span class="keyword">for</span> speed you’re well <span class="keyword">and</span> truly effed.</span>
</code></pre><h3 id="bcrypt_Solves_These_Problems">bcrypt Solves These Problems</h3><pre><code>How? Basically, <span class="keyword">it</span>’s slow <span class="keyword">as</span> hell. It uses <span class="operator">a</span> variant <span class="operator">of</span> <span class="operator">the</span> Blowfish encryption algorithm’s keying schedule, <span class="operator">and</span> introduces <span class="operator">a</span> work factor, which allows you <span class="built_in">to</span> determine how expensive <span class="operator">the</span> hash <span class="function"><span class="keyword">function</span> <span class="title">will</span> <span class="title">be</span>. <span class="title">Because</span> <span class="title">of</span> <span class="title">this</span>, <span class="title">bcrypt</span> <span class="title">can</span> <span class="title">keep</span> <span class="title">up</span> <span class="title">with</span> <span class="title">Moore</span>’<span class="title">s</span> <span class="title">law</span>. <span class="title">As</span> <span class="title">computers</span> <span class="title">get</span> <span class="title">faster</span> <span class="title">you</span> <span class="title">can</span> <span class="title">increase</span> <span class="title">the</span> <span class="title">work</span> <span class="title">factor</span> <span class="title">and</span> <span class="title">the</span> <span class="title">hash</span> <span class="title">will</span> <span class="title">get</span> <span class="title">slower</span>.</span>

How much slower is bcrypt than, say, MD5? Depends <span class="command"><span class="keyword">on</span> <span class="title">the</span> <span class="title">work</span> <span class="title">factor</span>. ** <span class="title">Using</span> <span class="title">a</span> <span class="title">work</span> <span class="title">factor</span> <span class="title">of</span> <span class="title">12</span>, <span class="title">bcrypt</span> <span class="title">hashes</span> <span class="title">the</span> <span class="title">password</span> <span class="title">yaaa</span> <span class="title">in</span> <span class="title">about</span> <span class="title">0</span><span class="number">.3</span> <span class="title">seconds</span> <span class="title">on</span> <span class="title">my</span> <span class="title">laptop</span>. <span class="title">MD5</span>, <span class="title">on</span> <span class="title">the</span> <span class="title">other</span> <span class="title">hand</span>, <span class="title">takes</span> <span class="title">less</span> <span class="title">than</span> <span class="title">a</span> <span class="title">microsecond</span>.**</span>


* Quote form [How To Safely Store A Password](<span class="keyword">http</span>://codahale.com/how-<span class="built_in">to</span>-safely-store-<span class="operator">a</span>-password/) *
</code></pre><h2 id="Rule_of_Three">Rule of Three</h2><p>As our sign_in and sign_up template is very similar,but we haven’t yet hit the Rule of 3 wall, so we’ll just do a copy/paste + bit of modification</p>
<blockquote>
<p>   Rule of three is a code refactoring rule of thumb to decide when a replicated piece of code should be replaced by a new procedure. It states that the code can be copied once, but that when the same code is used three times, it should be extracted into a new procedure. The rule was introduced by Martin Fowler in Refactoring[1] and attributed to Don Roberts.</p>
<p>   Duplication in programming is a bad practice because it makes the code harder to maintain. However, code refactoring to eliminate duplication also takes time, which might be better spent on other tasks. Triplication has an even higher cost because it makes maintenance harder yet. When the rule encoded in a replicated piece of code changes, whoever maintains the code will have to change it in all places correctly. This process is error-prone and often leads to problems. If the code exists in only one place, then it can be easily changed there. The rule proposes that the cost of maintenance certainly outweighs the cost of refactoring when there are three copies, and may or may not if there are two copies.</p>
<p>   This rule is typically only applied to a small number of lines of code, or even single lines of code[citation needed]. For example, if a program calls a function, and then calls it again when it fails, it is acceptable to have two call sites; however, if it is to be called five times before giving up, all of the calls should be replaced with loop containing a single call.</p>
<p>   As Charles Petzold puts it, “Three or more? Use a for!”</p>
</blockquote>
<h1 id="code_of_sign_in_and_sign_up">code of sign_in and sign_up</h1><p>user.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line">,   validate = <span class="built_in">require</span>(<span class="string">'mongoose-validate'</span>)</span><br><span class="line">,	bcrypt	 = <span class="built_in">require</span>(<span class="string">'bcrypt'</span>)</span><br><span class="line">,	SALT_WORK_FACTOR = <span class="number">10</span> </span><br><span class="line">,	REQUIRED_PASSWORD_LENGTH = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validateStringLength</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> value &amp;&amp; value.length &gt;= REQUIRED_PASSWORD_LENGTH</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dummyEmailValidator</span>(<span class="params">candidate</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span>  <span class="regexp">/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/</span>.test(candidate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = mongoose.Schema(&#123;</span><br><span class="line">	email:&#123;type: <span class="built_in">String</span>, required: <span class="literal">true</span>, unique: <span class="literal">true</span>, validate: [dummyEmailValidator,<span class="string">'is not a valid email address'</span>]&#125;</span><br><span class="line">   ,passwordHash:&#123;type: <span class="built_in">String</span>, required: <span class="literal">true</span>, validate: [validateStringLength,<span class="string">'is too short !(minimum is'</span> + REQUIRED_PASSWORD_LENGTH +<span class="string">'character'</span>]&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">schema.pre(<span class="string">'save'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!self.isModified(<span class="string">'passwordHash'</span>))<span class="keyword">return</span> next() </span><br><span class="line"></span><br><span class="line">	bcrypt.hash(self.passwordHash, SALT_WORK_FACTOR, <span class="function"><span class="keyword">function</span>(<span class="params">err,hash</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">return</span> next(err)</span><br><span class="line"></span><br><span class="line">		self.passwordHash = hash;</span><br><span class="line"></span><br><span class="line">		next()</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">schema.statics.findByEmailAndPassword = <span class="function"><span class="keyword">function</span> <span class="title">findByEmailAndPassword</span>(<span class="params">email, password,cb</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.findOne(&#123;email: email&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err,user</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) <span class="keyword">return</span> cb(err)</span><br><span class="line">		<span class="keyword">if</span> (!user) <span class="keyword">return</span> cb()</span><br><span class="line"></span><br><span class="line">			bcrypt.compare(password, user.passwordHash,<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> cb(err,res ? user:<span class="literal">null</span>)</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// auto disable autoIndex mode in production environment</span></span><br><span class="line"></span><br><span class="line">schema.set(<span class="string">'autoIndex'</span>, App.env !== <span class="string">'production'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Model = mongoose.model(<span class="string">'User'</span>, schema)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Model</span><br></pre></td></tr></table></figure>
<p>userRoutes.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = App.model(<span class="string">'user'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newUser</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> data = &#123;title:<span class="string">'Join the adventure!'</span>&#125;</span><br><span class="line">	</span><br><span class="line">	res.render(<span class="string">'users/new'</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> u = <span class="keyword">new</span> User(&#123;email:req.body.email, passwordHash:req.body.password&#125;); </span><br><span class="line"></span><br><span class="line">	 <span class="built_in">console</span>.log(req.body.email);</span><br><span class="line">	 <span class="built_in">console</span>.log(req.body.password);</span><br><span class="line"></span><br><span class="line">	u.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			res.status(<span class="number">422</span>).send(<span class="string">'Problem:'</span> + err.message);</span><br><span class="line">		</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			res.status(<span class="number">200</span>).send(<span class="string">'welcome to the game'</span>);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.new     = newUser</span><br><span class="line">exports.create  = create</span><br></pre></td></tr></table></figure>
<p>sessionRoutes.js</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">newSession</span>(<span class="title">req</span>,<span class="title">res</span>)&#123;</span></span><br><span class="line">	data =&#123;title:<span class="string">'welcome back!'</span>&#125;</span><br><span class="line">	res.render(<span class="string">'sessions/new'</span>) </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var User = App.model(<span class="string">'user'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="title">req</span>,<span class="title">res</span>)&#123;</span></span><br><span class="line">	User.findByEmailAndPassword(req.body.email,req.body.password,<span class="function"><span class="keyword">function</span>(<span class="title">err</span>,<span class="title">user</span>)&#123;</span></span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			res.status(<span class="number">422</span>).<span class="built_in">send</span>(<span class="string">'problem'</span>,err.message)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(!user)&#123;</span><br><span class="line">			res.status(<span class="number">401</span>).<span class="built_in">send</span>(<span class="string">'That email &amp; password did not match our records'</span>)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			res.status(<span class="number">200</span>).<span class="built_in">send</span>(<span class="string">'Welcome back  !!! '</span>+ user.email )</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.<span class="built_in">new</span>    = newSession</span><br><span class="line">exports.<span class="built_in">create</span> = <span class="built_in">create</span></span><br></pre></td></tr></table></figure>
<p>update our routes.js file </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">var</span> express       =  <span class="function"><span class="title">require</span><span class="params">(<span class="string">"express"</span>)</span></span></span><br><span class="line"><span class="tag">var</span> indexRouter   =  express.<span class="function"><span class="title">Router</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">var</span> homeRoutes    =  App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'homeRoutes'</span>)</span></span>	</span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/'</span>, homeRoutes.home)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> adventuresRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'adventruesRoutes'</span>)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">route</span><span class="params">(<span class="string">'/adventures'</span>)</span></span></span><br><span class="line">	.<span class="function"><span class="title">get</span><span class="params">(adventuresRoutes.index)</span></span></span><br><span class="line">	.<span class="function"><span class="title">post</span><span class="params">(adventuresRoutes.create)</span></span></span><br><span class="line">	.<span class="function"><span class="title">put</span><span class="params">(adventuresRoutes.update)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> lootRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'lootRoutes'</span>)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot'</span>, lootRoutes.index)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot/:id'</span>, lootRoutes.show)</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">var</span> userRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'userRoutes'</span>)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/sign_up'</span>, userRoutes.new)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">post</span><span class="params">(<span class="string">'/sign_up'</span>, userRoutes.create)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// session routes</span></span><br><span class="line"><span class="tag">var</span> sessionRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'sessionRoutes'</span>)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/sign_in'</span>, sessionRoutes.new)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">post</span><span class="params">(<span class="string">'/sign_in'</span>, sessionRoutes.create)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">module<span class="class">.exports</span> = indexRouter</span><br></pre></td></tr></table></figure>
<p>sign_up templates<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> join the web's premiere adventure venue<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/sign_up"</span><span class="value">,</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>Email<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"email"</span><span class="value">,</span> <span class="attribute">name</span>=<span class="value">"email"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>Password<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">name</span>=<span class="value">"password"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Start your adventure!<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>sign_in templates</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Welcome back. login to the web again! <span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/sign_in"</span><span class="value">,</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>Email<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"email"</span><span class="value">,</span> <span class="attribute">name</span>=<span class="value">"email"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">label</span> <span class="attribute">class</span>=<span class="value">"form-group"</span>&gt;</span>Password<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">name</span>=<span class="value">"password"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Contintue your adventure!<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/13/nodejs-note-09/" itemprop="url">
                  How to learn Node.js - Node work with Mongodb
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-13T14:44:51+08:00" content="2015-11-13">
              2015-11-13
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Installation_of_Mongodb">Installation of Mongodb</h1><p>install homebrew first</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Lyn</span>-<span class="constant">Cheung</span>-<span class="constant">MBP</span><span class="symbol">:~</span> <span class="constant">Lyn</span><span class="variable">$ </span>ruby -e <span class="string">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Lyn</span>-<span class="constant">Cheung</span>-<span class="constant">MBP</span><span class="symbol">:~</span> <span class="constant">Lyn</span><span class="variable">$ </span>brew doctor</span><br><span class="line"></span><br><span class="line"><span class="constant">Lyn</span>-<span class="constant">Cheung</span>-<span class="constant">MBP</span><span class="symbol">:~</span> <span class="constant">Lyn</span><span class="variable">$ </span>brew update</span><br><span class="line"></span><br><span class="line"><span class="constant">Lyn</span>-<span class="constant">Cheung</span>-<span class="constant">MBP</span><span class="symbol">:~</span> <span class="constant">Lyn</span><span class="variable">$ </span>brew install mongodb</span><br></pre></td></tr></table></figure>
<h1 id="Start_mongodb">Start mongodb</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-08</span> Lyn$ mongod</span><br></pre></td></tr></table></figure>
<h1 id="Install_mongoose">Install  mongoose</h1><p> edit package.json add mongoose dependenices</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> &#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"node-mongodb"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-session</span>":<span class="value"><span class="string">"2.0.0-alpha.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-parser</span>":<span class="value"><span class="string">"1.4.0"</span></span>,</span><br><span class="line">    "<span class="attribute">express-handlebars</span>":<span class="value"><span class="string">"2.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">mongoose</span>":<span class="value"><span class="string">"4.2.*"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Test_connection_with_Mongodb">Test connection with Mongodb</h1><p>create a test connection file : ./config/database.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span> (<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">connectionString</span>)</span>&#123;</span><br><span class="line">	mongoose.connect(connectionString)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> db= mongoose.connection</span><br><span class="line">	db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error'</span>))</span><br><span class="line">	db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Mongoose connected at:'</span>, connectionString)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = connect</span><br><span class="line"></span><br><span class="line">connect(<span class="string">'mongodb://localhost/nodemongodb_development'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">var</span> mongoose = <span class="built_in">require</span> (<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">connectionString</span>)</span>&#123;</span><br><span class="line">	mongoose.connect(connectionString)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> db= mongoose.connection</span><br><span class="line">	db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error'</span>))</span><br><span class="line">	db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Mongoose connected at:'</span>, connectionString)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> schema = mongoose.Schema(&#123;</span><br><span class="line">		name: <span class="built_in">String</span></span><br><span class="line">	   ,description: <span class="built_in">String</span>  </span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> Model = mongoose.model(<span class="string">'ItemTemplate'</span>, schema)</span><br><span class="line">	<span class="keyword">var</span> itemTemplate = <span class="keyword">new</span> Model(&#123;name: <span class="string">'Oger-slaying knife'</span>, description: <span class="string">'It\'s got +9 against orges!'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	itemTemplate.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'error:'</span>, err.message)</span><br><span class="line"></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'it saved:'</span>, ItemTemplate.name)	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		itemTemplate.name = <span class="string">'Ogre-slaying knife'</span></span><br><span class="line">		itemTemplate.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'problem saving:'</span> err.message)</span><br><span class="line"></span><br><span class="line">			getKnife()</span><br><span class="line"></span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getknife</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		Model.find(&#123;name: <span class="string">'Orger-slaying knife'</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,records</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'Error retrieving knife'</span>, err.message)</span><br><span class="line"></span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">'we got the'</span>, records[<span class="number">0</span>].name, <span class="string">'!'</span>)</span><br><span class="line"></span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = connect</span><br><span class="line"></span><br><span class="line">connect(<span class="string">'mongodb://localhost/nodemongodb_development'</span>)</span><br></pre></td></tr></table></figure>
<p>Run ‘node /config/database.js’  to save instance data to Mongodb</p>
<p>Now,let’s put the connection  function into our previous express app</p>
<p>Clean the database.js code first </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span> (<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">connectionString</span>)</span>&#123;</span><br><span class="line">	mongoose.connect(connectionString)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> db = mongoose.connection</span><br><span class="line">	db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error'</span>))</span><br><span class="line">	db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'Mongoose connected at:'</span>, connectionString)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = connect</span><br></pre></td></tr></table></figure>
<p>create a model file  named itemTemplate.js udner ./model direction</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> mongoose =<span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema =mongoose.Schema(&#123;</span><br><span class="line">	name: <span class="built_in">String</span></span><br><span class="line">	,description: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Model = mongoose.model(<span class="string">'itemTemplate'</span>, schema)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'model is loading'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = Model</span><br></pre></td></tr></table></figure>
<p>Quote our model folder path in application.js and bootstrap our DB </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> env         = process.env.NODE_ENV || <span class="string">'development'</span></span><br><span class="line"><span class="keyword">var</span> packageJson = <span class="keyword">require</span>(<span class="string">'../package.json'</span>)</span><br><span class="line"><span class="keyword">var</span> path        = <span class="keyword">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> express     = <span class="keyword">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"><span class="keyword">var</span> exphbs  	   = <span class="keyword">require</span>(<span class="string">'express-handlebars'</span>); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'loading App in '</span> + env + <span class="string">'node.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span>.App = &#123;</span><br><span class="line"></span><br><span class="line">	app: express()</span><br><span class="line">,   port: process.env.PORT || <span class="number">3000</span></span><br><span class="line">,   version: packageJson.version</span><br><span class="line">,   root: path.join(__dirname, <span class="string">'..'</span>)</span><br><span class="line">,   appPath: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> this.root + <span class="string">'/'</span> + path</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   <span class="keyword">require</span>: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> <span class="keyword">require</span>(this.appPath(path))	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   env: env</span><br><span class="line"></span><br><span class="line">,  start: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!this.started)&#123;</span><br><span class="line"></span><br><span class="line">			this.started = <span class="keyword">true</span></span><br><span class="line">			this.app.listen(this.port)</span><br><span class="line">			console.log( <span class="string">"running App version"</span> + App.version + <span class="string">" on port:"</span> + App.port + <span class="string">" in "</span>  + App.env + <span class="string">" mode"</span> )</span><br><span class="line">		</span><br><span class="line">			&#125;</span><br><span class="line">	  	&#125;</span><br><span class="line">,	model: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> this.<span class="keyword">require</span>(<span class="string">"app/models/"</span> + path)</span><br><span class="line">	&#125;	</span><br><span class="line">,	routes: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> this.<span class="keyword">require</span>(<span class="string">"app/routes/"</span> + path)</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line">App.app.engine(<span class="string">'hbs'</span>, exphbs(&#123;extname:<span class="string">'hbs'</span>, defaultLayout:<span class="string">'main.hbs'</span>&#125;));</span><br><span class="line">App.app.set(<span class="string">'view engine'</span>, <span class="string">'hbs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// bootstrap the  DB</span></span><br><span class="line">App.<span class="keyword">require</span>(<span class="string">'config/database'</span>)(process.env.DATABASE_URL || <span class="string">'mongodb://localhost/nodemongodb_development'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//middlewares</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter =  App.<span class="keyword">require</span>(<span class="string">"./config/routes.js"</span>)</span><br><span class="line">App.app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">	  extended: <span class="keyword">false</span></span><br><span class="line">	&#125;)); </span><br><span class="line">App.app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">App.app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">App.app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">App.app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>( App.appPath(<span class="string">'images'</span>)));</span><br><span class="line"></span><br><span class="line">App.app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br></pre></td></tr></table></figure>
<p>edit our lootroutes.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ItemTemplate =App.model(<span class="string">'itemTemplate'</span>)</span><br><span class="line"></span><br><span class="line">exports.index = <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	ItemTemplate.find(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err, records</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">return</span> res.status(<span class="number">422</span>).send(<span class="string">'problem laoding the records:'</span>, err.message)</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'itemTemplate running'</span>);	</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">var</span> data = &#123;loots: records&#125; </span><br><span class="line">		<span class="built_in">console</span>.log(data);</span><br><span class="line">		res.render(<span class="string">'loot/index'</span>,data)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">exports.show = <span class="function"><span class="keyword">function</span> <span class="title">showLoot</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> id   = req.params.id</span><br><span class="line"></span><br><span class="line">	ItemTemplate.findById(id, <span class="function"><span class="keyword">function</span>(<span class="params">err, loot</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">return</span> res.status(<span class="number">422</span>).send(<span class="string">'Problem loding the loot:'</span>, err.message)</span><br><span class="line">		<span class="keyword">if</span>(!loot) <span class="keyword">return</span> res.status(<span class="number">404</span>).send(<span class="string">'could not find the loot'</span>)	</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'itemTemplate_find_by_id running'</span>);	</span><br><span class="line">		<span class="keyword">var</span> data = &#123;loot: loot&#125;</span><br><span class="line">		res.render(<span class="string">'loot/show'</span>,data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add index.js for loot path </p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Loot Table<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="title">table</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">thead</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">th</span>&gt;</span>Description<span class="tag">&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">tbody</span>&gt;</span></span><br><span class="line">			</span><span class="expression">&#123;&#123;<span class="begin-block">#<span class="keyword">each</span> loots</span>&#125;&#125;</span><span class="xml"></span><br><span class="line"> 			 <span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"> 			 <span class="tag">&lt;<span class="title">td</span>&gt;</span>	<span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/loot/</span></span></span><span class="expression">&#123;&#123;<span class="variable">id</span>&#125;&#125;</span><span class="xml"><span class="tag"><span class="value">"</span>&gt;</span></span><span class="expression">&#123;&#123;<span class="variable">name</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">a</span>&gt;</span> <span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"> 			 												</span><br><span class="line"> 			 <span class="tag">&lt;<span class="title">td</span>&gt;</span>	</span><span class="expression">&#123;&#123;<span class="variable">description</span>&#125;&#125;</span><span class="xml"> <span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">			</span><span class="expression">&#123;&#123;<span class="end-block">/<span class="keyword">each</span></span>&#125;&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>update show.js  for loot path</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><br><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>Check out your loot details<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">h2</span>&gt;</span> </span><span class="expression">&#123;&#123;<span class="variable">loot.name</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span> there is a line on this loot:" </span><span class="expression">&#123;&#123;<span class="variable">loot.description</span>&#125;&#125;</span><span class="xml"> "<span class="tag">&lt;/<span class="title">p</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span> Your loot id is: </span><span class="expression">&#123;&#123;<span class="variable">loot.id</span>&#125;&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>We also need add loot index function into Express router function </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="stylus"><span class="tag">var</span> express       =  <span class="function"><span class="title">require</span><span class="params">(<span class="string">"express"</span>)</span></span></span><br><span class="line"><span class="tag">var</span> indexRouter   =  express.<span class="function"><span class="title">Router</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">var</span> homeRoutes    =  App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'homeRoutes'</span>)</span></span>	</span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/'</span>, homeRoutes.home)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> adventuresRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'adventruesRoutes'</span>)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">route</span><span class="params">(<span class="string">'/adventures'</span>)</span></span></span><br><span class="line">	.<span class="function"><span class="title">get</span><span class="params">(adventuresRoutes.index)</span></span></span><br><span class="line">	.<span class="function"><span class="title">post</span><span class="params">(adventuresRoutes.create)</span></span></span><br><span class="line">	.<span class="function"><span class="title">put</span><span class="params">(adventuresRoutes.update)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> lootRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'lootRoutes'</span>)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot'</span>, lootRoutes.index)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot/:id'</span>, lootRoutes.show)</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">module<span class="class">.exports</span> = indexRouter</span></span><br></pre></td></tr></table></figure>
<p>Here we go !</p>
<p>these code retrive  what we have in Mongodb collection and  show  loots on index page </p>
<p>on /loot/:id path we could catch Mongodb id from the link params and show all loot detail infomation!  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:node-<span class="number">08</span> Lyn$ mongo nodemongodb_development</span><br><span class="line"></span><br><span class="line">MongoDB shell version: <span class="number">3.0</span><span class="number">.7</span></span><br><span class="line">connecting to: nodemongodb_development</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive help, type <span class="string">"help"</span>.</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">	http:<span class="comment">//docs.mongodb.org/</span></span><br><span class="line">Questions? Try the support group</span><br><span class="line">	http:<span class="comment">//groups.google.com/group/mongodb-user</span></span><br><span class="line">Server has startup warnings:</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">13</span>T14:<span class="number">40</span>:<span class="number">20.398</span>+<span class="number">0800</span> I CONTROL  [initandlisten]</span><br><span class="line"><span class="number">2015</span>-<span class="number">11</span>-<span class="number">13</span>T14:<span class="number">40</span>:<span class="number">20.398</span>+<span class="number">0800</span> I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. Number of files is <span class="number">256</span>, should be at least <span class="number">1000</span></span><br><span class="line">&gt; db.itemtemplates.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5645acece25bb56b3cec4c10"</span>), <span class="string">"name"</span> : <span class="string">"Oger-slaying knife"</span>, <span class="string">"description"</span> : <span class="string">"It's got +9 against orges!"</span>, <span class="string">"__v"</span> : <span class="number">0</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5645ada7df30bb723cbd2f3e"</span>), <span class="string">"name"</span> : <span class="string">"Oger-slaying knife"</span>, <span class="string">"description"</span> : <span class="string">"It's got +9 against orges!"</span>, <span class="string">"__v"</span> : <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/10/nodejs-note-08-1/" itemprop="url">
                  How to learn Node.js - express with template engine
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-10T23:17:04+08:00" content="2015-11-10">
              2015-11-10
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="epxress_template:_Jade_vs_Hbs">epxress template: Jade vs Hbs</h1><p>Jade is  something more like python, but I like Hbs as the syntax is easy to  transit from raw html file to template.hbs file</p>
<h1 id="views">views</h1><p>As we choose handlerbars as our template engine, we need use a npm helper express-handlerbars</p>
<p>So, we need to update our  package.json first</p>
<p>we can check the helper version by </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-06</span> Lyn$ npm  show express-handlebars  <span class="operator">version</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>package.json </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"node-slash"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-session</span>":<span class="value"><span class="string">"2.0.0-alpha.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-parser</span>":<span class="value"><span class="string">"1.4.0"</span></span>,</span><br><span class="line">    "<span class="attribute">express-handlebars</span>":<span class="value"><span class="string">"2.0.1"</span></span><br><span class="line"></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>then we need to create views direction </p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/15-11-10/87116763.jpg" alt=""></p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> views </span><br><span class="line"><span class="built_in">cd</span>  views</span><br><span class="line"><span class="built_in">mkdir</span> layout</span><br><span class="line"><span class="built_in">mkdir</span> home</span><br><span class="line"><span class="built_in">mkdir</span> adventures</span><br><span class="line"><span class="built_in">mkdir</span> loot</span><br></pre></td></tr></table></figure>
<p>import  template engine in application.js  by add:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> exphbs  	   = <span class="keyword">require</span>(<span class="string">'express-handlebars'</span>); </span><br><span class="line">App<span class="built_in">.</span>app<span class="built_in">.</span>engine(<span class="string">'hbs'</span>, exphbs(&#123;extname:<span class="string">'hbs'</span>, defaultLayout:<span class="string">'main.hbs'</span>&#125;));</span><br><span class="line">App<span class="built_in">.</span>app<span class="built_in">.</span><span class="built_in">set</span>(<span class="string">'view engine'</span>, <span class="string">'hbs'</span>);</span><br></pre></td></tr></table></figure>
<p>then we need create our layout,</p>
 

 {{{body}}} is placeholder of each content
 
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt; &lt;title&gt;<span class="constant">Node</span> <span class="constant">Slash</span>&lt;<span class="regexp">/title&gt;&lt;/head</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="expansion">&#123;&#123;&#123;body&#125;&#125;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span><br><span class="line">&lt;/html</span>&gt;</span><br></pre></td></tr></table></figure>
<p>then we need to update our homeRoutes.js</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.home = <span class="function"><span class="keyword">function</span> <span class="title">home</span> <span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.render(<span class="string">'home/home'</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>/views/home/home.hbs</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt; Browser Game&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="tag">form</span> action=<span class="string">"/login"</span> method=<span class="string">"POST"</span>&gt;&lt;<span class="tag">label</span> <span class="keyword">for</span>=<span class="string">"username"</span>&gt;Username&lt;/label&gt;</span><br><span class="line">&lt;<span class="tag">input</span> id=<span class="string">"username"</span> type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;</span><br><span class="line">&lt;<span class="tag">button</span> type=<span class="string">"submit"</span>&gt;Start ye adventures!&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="tag">img</span> src=<span class="string">"/images/logo.jpg"</span>&gt;</span><br><span class="line">&lt;<span class="tag">a</span> href=<span class="string">'/adventures'</span>&gt; Go to adventures &lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>That’s it  </p>
<p>if you want to qoute value in the template,</p>
<p>for example: showloot function </p>
<p>edit the lootRoutes.js</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports.show = <span class="function"><span class="keyword">function</span> <span class="title">showLoot</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id   = req.params.id</span><br><span class="line">	<span class="keyword">var</span> data =&#123;id: id&#125;</span><br><span class="line">	res.render(<span class="string">'loot/show'</span>,data)</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  show.hbs template use {{id}} to display the value.
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><br><span class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was </span><span class="expression">&#123;&#123;<span class="variable">id</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/07/nodejs-note-07/" itemprop="url">
                  How to learn Node.js - wirte app code in production mode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-07T17:02:22+08:00" content="2015-11-07">
              2015-11-07
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>write a bacic and pratical server function in a production way.</p>
<p>application.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> env         = process.env.NODE_ENV || <span class="string">'development'</span></span><br><span class="line"><span class="keyword">var</span> packageJson = <span class="built_in">require</span>(<span class="string">'../package.json'</span>)</span><br><span class="line"><span class="keyword">var</span> path        = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> express     = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'loading App in '</span> + env + <span class="string">'node.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">global.App = &#123;</span><br><span class="line"></span><br><span class="line">	app: express()</span><br><span class="line">,   port: process.env.PORT || <span class="number">3000</span></span><br><span class="line">,   version: packageJson.version</span><br><span class="line">,   root: path.join(__dirname, <span class="string">'..'</span>)</span><br><span class="line">,   appPath: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> <span class="keyword">this</span>.root + <span class="string">'/'</span> + path</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   <span class="built_in">require</span>: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="keyword">this</span>.app_path(path))	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   env: env</span><br><span class="line"></span><br><span class="line">,  start: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">this</span>.started)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.started = <span class="literal">true</span></span><br><span class="line">			<span class="keyword">this</span>.app.listen(<span class="keyword">this</span>.port)</span><br><span class="line">			<span class="built_in">console</span>.log( <span class="string">"running App version"</span> + App.version + <span class="string">" on port:"</span> + App.port + <span class="string">" in "</span>  + App.env + <span class="string">" mode"</span> )</span><br><span class="line">		</span><br><span class="line">			&#125;</span><br><span class="line">	  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">require</span><span class="params">(<span class="string">'./config/application'</span>)</span></span></span><br><span class="line">App.<span class="function"><span class="title">start</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-06</span> Lyn$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">index</span>.js</span><br><span class="line">loading App <span class="operator">in</span> developmentnode.</span><br><span class="line">running App version1.<span class="number">0.0</span> on port:<span class="number">3000</span> <span class="operator">in</span> development mode</span><br></pre></td></tr></table></figure>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/15-11-9/73981430.jpg" alt=""></p>
<p>We can put our code in structrue displayed above.</p>
<p>application.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> env         = process.env.NODE_ENV || <span class="string">'development'</span></span><br><span class="line"><span class="keyword">var</span> packageJson = <span class="keyword">require</span>(<span class="string">'../package.json'</span>)</span><br><span class="line"><span class="keyword">var</span> path        = <span class="keyword">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> express     = <span class="keyword">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'loading App in '</span> + env + <span class="string">'node.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span>.App = &#123;</span><br><span class="line"></span><br><span class="line">	app: express()</span><br><span class="line">,   port: process.env.PORT || <span class="number">3000</span></span><br><span class="line">,   version: packageJson.version</span><br><span class="line">,   root: path.join(__dirname, <span class="string">'..'</span>)</span><br><span class="line">,   appPath: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> this.root + <span class="string">'/'</span> + path</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   <span class="keyword">require</span>: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> <span class="keyword">require</span>(this.appPath(path))	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">,   env: env</span><br><span class="line"></span><br><span class="line">,  start: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!this.started)&#123;</span><br><span class="line"></span><br><span class="line">			this.started = <span class="keyword">true</span></span><br><span class="line">			this.app.listen(this.port)</span><br><span class="line">			console.log( <span class="string">"running App version"</span> + App.version + <span class="string">" on port:"</span> + App.port + <span class="string">" in "</span>  + App.env + <span class="string">" mode"</span> )</span><br><span class="line">		</span><br><span class="line">			&#125;</span><br><span class="line">	  	&#125;</span><br><span class="line"></span><br><span class="line">,	routes: <span class="function"><span class="keyword">function</span><span class="params">(path)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> this.<span class="keyword">require</span>(<span class="string">"app/routes/"</span> + path)</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//middlewares</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter =  App.<span class="keyword">require</span>(<span class="string">"./config/routes.js"</span>)</span><br><span class="line">App.app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">	  extended: <span class="keyword">false</span></span><br><span class="line">	&#125;)); </span><br><span class="line">App.app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">App.app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">App.app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">App.app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>( App.appPath(<span class="string">'images'</span>)));</span><br><span class="line"></span><br><span class="line">App.app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br></pre></td></tr></table></figure>
<p>route.js</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="stylus"><span class="tag">var</span> express       =  <span class="function"><span class="title">require</span><span class="params">(<span class="string">"express"</span>)</span></span></span><br><span class="line"><span class="tag">var</span> indexRouter   =  express.<span class="function"><span class="title">Router</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">var</span> homeRoutes    =  App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'homeRoutes'</span>)</span></span>	</span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/'</span>, homeRoutes.home)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> adventuresRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'adventruesRoutes'</span>)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">route</span><span class="params">(<span class="string">'/adventures'</span>)</span></span></span><br><span class="line">	.<span class="function"><span class="title">get</span><span class="params">(adventuresRoutes.index)</span></span></span><br><span class="line">	.<span class="function"><span class="title">post</span><span class="params">(adventuresRoutes.create)</span></span></span><br><span class="line">	.<span class="function"><span class="title">put</span><span class="params">(adventuresRoutes.update)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">var</span> lootRoutes = App.<span class="function"><span class="title">routes</span><span class="params">(<span class="string">'lootRoutes'</span>)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot/:id'</span>, lootRoutes.show)</span></span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">module<span class="class">.exports</span> = indexRouter</span></span><br></pre></td></tr></table></figure>
<p>lootRoutes.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports.show = function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>adventuresRoutes.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">exports.index =function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave " + req.session.username + " ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exports.create = function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.update = function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>homeRoutes.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exports.home = function home (req, res)&#123;</span><br><span class="line">	//console.log("Hi! I was called at: ", req.originalUrl)</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">\"</span>/<span class="attribute">login</span>\" <span class="attribute">method</span>=<span class="value">\"POST\"</span>&gt;</span><span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">\"username\"</span>&gt;</span>Username<span class="tag">&lt;/<span class="title">label</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">\"username\"</span> <span class="attribute">type</span>=<span class="value">\"text\"</span> <span class="attribute">name</span>=<span class="value">\"username\"</span>&gt;</span><span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">\"submit\"</span>&gt;</span>Start ye adventures!<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">\"</span>/<span class="attribute">images</span>/<span class="attribute">logo.jpg</span>\"&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/05/nodejs-note-06/" itemprop="url">
                  How to learn Node.js -- organize your code by using require and exports
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-05T18:19:05+08:00" content="2015-11-05">
              2015-11-05
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Require_and_Exports">Require and  Exports</h1><p>here is a example of exports.function and module.exports</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exports.theAnswerVal = <span class="number">41</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">module</span>.<span class="title">exports</span> =</span> <span class="function"><span class="keyword">function</span> <span class="title">theAnswer</span><span class="params">()</span> &#123;</span> console.<span class="built_in">log</span>(theAnswerVal) &#125;</span><br><span class="line"></span><br><span class="line">exports.theAnswer = <span class="number">43</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handlers= <span class="function"><span class="title">require</span><span class="params">(<span class="string">'./handlers'</span>)</span></span></span><br><span class="line"></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(handlers)</span></span></span><br></pre></td></tr></table></figure>
<p>The result is :[function: theAnswer]</p>
<p>because exports is only a helper to collect exports iterms and trans them to module.exports,</p>
<p>if the module.exports is  defined, then the exports function will be ignored.</p>
<h1 id="Split_codes_into_different_files_by_function-">Split codes  into  different files by function.</h1><p>in order to make our code more clear, we’d better put code into specific files,</p>
<p>for example : we can split our original code into handlers.js routes.js, middleware.js and index.js.</p>
<p>this help us to find related code more easily. </p>
<h2 id="First,_split_handlers_into_handlers-js">First, split handlers into handlers.js</h2><p>handlers.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">exports.home = function home (req, res)&#123;</span><br><span class="line">	//console.log("Hi! I was called at: ", req.originalUrl)</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">\"</span>/<span class="attribute">login</span>\" <span class="attribute">method</span>=<span class="value">\"POST\"</span>&gt;</span><span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">\"username\"</span>&gt;</span>Username<span class="tag">&lt;/<span class="title">label</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">\"username\"</span> <span class="attribute">type</span>=<span class="value">\"text\"</span> <span class="attribute">name</span>=<span class="value">\"username\"</span>&gt;</span><span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">\"submit\"</span>&gt;</span>Start ye adventures!<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">\"</span>/<span class="attribute">images</span>/<span class="attribute">logo.jpg</span>\"&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exports.adventuresIndex =function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave " + req.session.username + " ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exports.createAdventure = function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.updateAdventure = function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.showLoot = function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">exports.login = function login(req, res)&#123;</span><br><span class="line"></span><br><span class="line">	if(req.body.username)&#123;</span><br><span class="line">		console.log(req.body.username);</span><br><span class="line">		req.session.username = req.body.username</span><br><span class="line">	</span><br><span class="line">		res.redirect("/adventures")</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		res.redirect("/")</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> handlers       = <span class="keyword">require</span>(<span class="string">'./handlers.js'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"> </span><br><span class="line"><span class="comment">//console.log(handlers);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (req.session.username)&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		next()</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</span><br><span class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.get(<span class="string">'/'</span>, handlers.home)</span><br><span class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, handlers.login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>)</span><br><span class="line">	 </span><br><span class="line">	.get(handlers.adventuresIndex)</span><br><span class="line">	.post(handlers.createAdventure)</span><br><span class="line">	.put(handlers.updateAdventure)</span><br><span class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, handlers.showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="keyword">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Second,_split_routes_into_routes-js_file">Second, split routes into  routes.js file</h1><p>routes.js</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">var</span> express       = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"express"</span>)</span></span></span><br><span class="line"><span class="tag">var</span> handlers      = <span class="function"><span class="title">require</span><span class="params">(<span class="string">'./handlers.js'</span>)</span></span></span><br><span class="line"><span class="tag">var</span> indexRouter   =  express.<span class="function"><span class="title">Router</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/'</span>, handlers.home)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/read_from_db'</span>, handlers.readFromDB)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">post</span><span class="params">(<span class="string">'/login'</span>, handlers.login)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">all</span><span class="params">(<span class="string">'*'</span>,  handlers.ensureAuthenticated)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">route</span><span class="params">(<span class="string">'/adventures'</span>)</span></span></span><br><span class="line">	 </span><br><span class="line">	.<span class="function"><span class="title">get</span><span class="params">(handlers.adventuresIndex)</span></span></span><br><span class="line">	.<span class="function"><span class="title">post</span><span class="params">(handlers.createAdventure)</span></span></span><br><span class="line">	.<span class="function"><span class="title">put</span><span class="params">(handlers.updateAdventure)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot/:id'</span>, handlers.showLoot)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module<span class="class">.exports</span> = indexRouter</span><br></pre></td></tr></table></figure>
<h1 id="Third,_split_middlewares_into_middlewares-js">Third, split middlewares into middlewares.js</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> module.exports = <span class="function"><span class="keyword">function</span><span class="params">(indexRouter)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">	  extended: <span class="keyword">false</span></span><br><span class="line">	&#125;)); </span><br><span class="line">	app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">	app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">	app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">	 </span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line"></span><br><span class="line">	app.<span class="keyword">use</span>(notFound)</span><br><span class="line">	app.<span class="keyword">use</span>(catchError)</span><br><span class="line">	app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js file </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//var bodyParser     = require('body-parser')</span></span><br><span class="line">	<span class="comment">//var methodOverride = require('method-override')</span></span><br><span class="line">	<span class="comment">//var cookieParser   = require('cookie-parser')</span></span><br><span class="line">	<span class="comment">//var cookieSession  = require('cookie-session') </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"><span class="keyword">var</span> handlers       = <span class="built_in">require</span>(<span class="string">'./handlers.js'</span>)</span><br><span class="line"><span class="keyword">var</span> indexRouter	   = <span class="built_in">require</span>(<span class="string">'./routes.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//middlewares</span></span><br><span class="line"><span class="keyword">var</span> middlewares    = <span class="built_in">require</span>(<span class="string">'./middlewares.js'</span>)</span><br><span class="line">   </span><br><span class="line">    middlewares(indexRouter)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Error">Error</h1><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">throw new <span class="constant">TypeError</span>(<span class="string">'Router.use() requires middleware function but got a '</span> + gettype(fn));</span><br><span class="line">      ^</span><br><span class="line"></span><br><span class="line"><span class="constant">TypeError</span>: <span class="constant">Router</span>.use() requires middleware function but got a undefined</span><br><span class="line">    at <span class="constant">Function</span>.use (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">router</span>/<span class="title">index</span>.<span class="title">js</span>:458:13)</span></span><br><span class="line">    at <span class="constant">EventEmitter</span>.&lt;anonymous&gt; (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:219:21)</span></span><br><span class="line">    at <span class="constant">Array</span>.forEach (native)</span><br><span class="line">    at <span class="constant">EventEmitter</span>.use (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:216:7)</span></span><br><span class="line">    at <span class="class"><span class="keyword">module</span>.<span class="title">exports</span> (/<span class="title">Users</span>/<span class="title">Lyn</span>/<span class="title">src</span>/<span class="title">node</span>/<span class="title">node</span>-05/<span class="title">middlewares</span>.<span class="title">js</span>:45:6)</span></span><br><span class="line">    at <span class="constant">Object</span>.&lt;anonymous&gt; (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/index.<span class="symbol">js:</span><span class="number">37</span>:<span class="number">1</span>)</span><br><span class="line">    at <span class="constant">Module</span>._compile (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:435:26)</span></span><br><span class="line">    at <span class="constant">Object</span>.<span class="constant">Module</span>._extensions..js (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:442:10)</span></span><br><span class="line">    at <span class="constant">Module</span>.load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:356:32)</span></span><br><span class="line">    at <span class="constant">Function</span>.<span class="constant">Module</span>._load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:311:12)</span></span><br></pre></td></tr></table></figure>
<p>if you see this error during your programing,</p>
<p>you could check the the location of the middleware and routes handlers.</p>
<p>handlers must be claimed the handlers function before app.use router function,</p>
<p>and the check routes rules as well,</p>
<p>you can try console.log()  to check the  value of routes object.</p>
<p>it should be looks like this:</p>
<pre><code>
{ [<span class="built_in">Function</span>: router]
  params: {},
  _params: [],
  caseSensitive: <span class="literal">undefined</span>,
  mergeParams: <span class="literal">undefined</span>,
  strict: <span class="literal">undefined</span>,
  stack:
   [ Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/read_from_db\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/login\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^(.*)\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/adventures\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^\/loot\/(?:([^\/]+?))\/?$/i</span>,
       route: [<span class="built_in">Object</span>] } ] }
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/05/nodejs-note-05/" itemprop="url">
                  How to learn Node.js -- usages of express.Router(), middleware, cookieParser, cookieSession, create 404 control and catchError function
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-05T15:54:49+08:00" content="2015-11-05">
              2015-11-05
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Concept_of_Middleware_queue">Concept of Middleware queue</h1><h2 id="Custom_middleware">Custom middleware</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span>(<span class="params">req,res,next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="The_middleware_queue">The middleware queue</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Routes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/'</span>, home)</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>) </span><br><span class="line">	.<span class="keyword">get</span>(adventuresIndex)</span><br><span class="line">	.post(createAdventure)</span><br><span class="line">	.put(updateAdventure)</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/loot/:id'</span>, showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="literal">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br></pre></td></tr></table></figure>
<p> <img src="http://7xnuw0.com1.z0.glb.clouddn.com/15-11-5/52848128.jpg" alt=""></p>
<h1 id="Code">Code</h1><h2 id="dependencies">dependencies</h2><p>  The Package.json file </p>
<pre><code><span class="comment"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-session</span>":<span class="value"><span class="string">"2.0.0-alpha.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-parser</span>":<span class="value"><span class="string">"1.4.0"</span></span><br><span class="line"></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><h2 id="the_index-js_Code">the index.js Code</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">home</span> <span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	<span class="comment">//console.log("Hi! I was called at: ", req.originalUrl)</span></span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;Node Slash&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Browser Game&lt;/h1&gt;&lt;form action=\"/login\" method=\"POST\"&gt;&lt;label for=\"username\"&gt;Username&lt;/label&gt;&lt;input id=\"username\" type=\"text\" name=\"username\"&gt;&lt;button type=\"submit\"&gt;Start ye adventures!&lt;/button&gt;&lt;/form&gt;&lt;img src=\"/images/logo.jpg\"&gt;&lt;a href='/adventures'&gt; Go to adventures &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">adventuresIndex</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Are you brave "</span> + req.session.username + <span class="string">" ?&lt;/h1&gt;&lt;form action='/adventures' method='POST'&gt; &lt;button type='submit'&gt; Yes! i am !&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAdventure</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; So  you are brave!&lt;/h1&gt;&lt;form action='/adventures/?_method=PUT' method='POST'&gt;  &lt;button type='submit'&gt; Cheat &lt;/button&gt;&lt;/form&gt;&lt;form action='/adventures' method='POST'&gt;  &lt;button type='submit'&gt; again !&lt;/button&gt;&lt;p&gt;you have found some &lt;a href='/loot/1'&gt;loot &lt;/a&gt; here&lt;/p&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateAdventure</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;H1&gt;Method override help you to change method from post to put ! &lt;/H1&gt;&lt;p&gt;It's a secret to everybody &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoot</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id = req.params.id</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt; &lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;h1&gt; Ogre-slaying knife&lt;/h1&gt;&lt;p&gt; it has 9 orges,  it was"</span> + id + <span class="string">" &lt;/p&gt; &lt;/body&gt;&lt;/html&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(req.body.username)&#123;</span><br><span class="line">		console.log(req.body.username);</span><br><span class="line">		req.session.username = req.body.username</span><br><span class="line">	</span><br><span class="line">		res.redirect(<span class="string">"/adventures"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (req.session.username)&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		next()</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</span><br><span class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.get(<span class="string">'/'</span>, home)</span><br><span class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>) </span><br><span class="line">	.get(adventuresIndex)</span><br><span class="line">	.post(createAdventure)</span><br><span class="line">	.put(updateAdventure)</span><br><span class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="keyword">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/01/nodejs-note-04/" itemprop="url">
                  How to learn Node.js - 05 express with middleware bodyParser, method-override and static
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-01T13:57:02+08:00" content="2015-11-01">
              2015-11-01
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Middleware">Middleware</h1><p>Middleware is a function with access to the request object (req), the response object (res), and the next middleware in the application’s request-response cycle, commonly denoted by a variable named next.</p>
<p>Middleware can:</p>
<ul>
<li>Execute any code.</li>
<li>Make changes to the request and the response objects.</li>
<li>End the request-response cycle.</li>
<li>Call the next middleware in the stack.</li>
</ul>
<h2 id="method-Overide">method-Overide</h2><p>Lets you use HTTP verbs such as PUT or DELETE in places where the client doesn’t support it.</p>
<p>this middleware help to catch ‘_method= post’  in the form, so that we can return a different response. </p>
<h3 id="methodOverride(getter,_options)">methodOverride(getter, options)</h3><p>middleware is for requests from clients that only natively support simple verbs like GET and POST,but methodOverride Create a new middleware function to override the req.method property(put, delete or path ) with a new value(like: POST). This value will be pulled from the provided getter.</p>
<p>getter - The getter to use to look up the overridden request method for the request. (default: X-HTTP-Method-Override)<br>options.methods - The allowed methods the original request must be in to check for a method override value. (default: [‘POST’])<br>If the found method is supported by node.js core, then req.method will be set to this value, as if it has originally been that value. The previous req.method value will be stored in req.originalMethod.</p>
<h3 id="getter">getter</h3><p>This is the method of getting the override value from the request. If a function is provided, the req is passed as the first argument, the res as the second argument and the method is expected to be returned. If a string is provided, the string is used to look up the method with the following rules:</p>
<p>If the string starts with X-, then it is treated as the name of a header and that header is used for the method override. If the request contains the same header multiple times, the first occurrence is used.<br>All other strings are treated as a key in the URL query string.<br>options.methods</p>
<p>This allows the specification of what methods(s) the request MUST be in in order to check for the method override value. This defaults to only POST methods, which is the only method the override should arrive in. More methods may be specified here, but it may introduce security issues and cause weird behavior when requests travel through caches. This value is an array of methods in upper-case. null can be specified to allow all methods.</p>
<h2 id="bodyParser">bodyParser</h2><p>var bodyParser = require(‘body-parser’)</p>
<p>The bodyParser object exposes various factories to create middlewares. All middlewares will populate the req.body property with the parsed body or provide an error to the callback.</p>
<h2 id="Serving_static_files_in_Express">Serving static files in Express</h2><p>Serving files, such as images, CSS, JavaScript and other static files is accomplished with the help of a built-in middleware in Express - express.static.</p>
<p>Pass the name of the directory, which is to be marked as the location of static assets, to the express.static middleware to start serving the files directly. For example, if you keep your images, CSS, and JavaScript files in a directory named public, you can do this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">use</span>(express.<span class="keyword">static</span>(<span class="string">'public'</span>));</span><br></pre></td></tr></table></figure>
<h1 id="Example_of_middlewares">Example of middlewares</h1><h2 id="installation_of_middlewares">installation of middlewares</h2><p>we will write the function based on the last browser game express app.</p>
<p>create a  new package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>and install the dependencies .</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Example_of_using_bodyParser">Example of using bodyParser</h2><p>then we can add a hidden input and cheat button based on last project.</p>
<p>and we can receive the input by using bodyParser middleware.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line">var bodyParser = require('body-parser')</span><br><span class="line">app.use(methodOverride('_method'))</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">//app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<p>We can check the result of console.log<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-03</span> Lyn$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">index</span>.js</span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3000</span>/</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#123; _method: 'input' &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_of_methodOverride_middleware">Example of methodOverride middleware</h2><p>We can use  methodOverride to make a put request on adventures path.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var bodyParser     = require('body-parser')</span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line">app.use(methodOverride('_method'));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<h2 id="Example_of_express-static_function">Example of  express.static function</h2><p>We will add one server images on index page by using  express.static function.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var bodyParser     = require('body-parser')</span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line">app.use(methodOverride('_method'));</span><br><span class="line">app.use(express.static('images'));</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">'/images/hello.png'</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/31/nodejs-note-03/" itemprop="url">
                  How to learn Node.js - 03 Express route and params handling
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-31T11:49:21+08:00" content="2015-10-31">
              2015-10-31
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ mkdir <span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span></span><br><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ cd <span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span></span><br><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span> Lyn$ npm init</span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, <span class="operator">and</span> tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help json` for definitive documentation on these fields</span><br><span class="line"><span class="operator">and</span> exactly what they do.</span><br><span class="line"></span><br><span class="line">Use `npm install <span class="tag">&lt;pkg&gt;</span> --save` afterwards to install a package <span class="operator">and</span></span><br><span class="line">save it as a dependency <span class="operator">in</span> the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">name: (<span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span>) expressapp</span><br><span class="line"><span class="operator">version</span>: (<span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">description: first express app</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords:</span><br><span class="line">author: lyn</span><br><span class="line">license: (ISC) MIT</span><br><span class="line">About to <span class="operator">write</span> to /Users/Lyn/src/<span class="keyword">node</span><span class="identifier"></span><span class="title">/node-02</span>/package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"expressapp"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"first express app"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this ok? (yes) yes</span><br></pre></td></tr></table></figure>
<p>config package.json</p>
<p>add the dependency</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">connect-busboy</span>": <span class="value"><span class="string">"0.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>Then use NPM to  install all the dependency for us </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:node-<span class="number">02</span> Lyn$ npm install --save</span><br><span class="line">npm WARN package.json expressapp@<span class="number">1.0</span><span class="number">.0</span> No repository field.</span><br><span class="line">npm WARN package.json expressapp@<span class="number">1.0</span><span class="number">.0</span> No README data</span><br><span class="line">connect-busboy@<span class="number">0.0</span><span class="number">.2</span> node_modules/connect-busboy</span><br><span class="line">└── busboy@<span class="number">0.2</span><span class="number">.11</span> (readable-stream@<span class="number">1.1</span><span class="number">.13</span>, dicer@<span class="number">0.2</span><span class="number">.3</span>)</span><br><span class="line"></span><br><span class="line">express@<span class="number">4.13</span><span class="number">.3</span> node_modules/express</span><br><span class="line">├── escape-html@<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">├── merge-descriptors@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── cookie@<span class="number">0.1</span><span class="number">.3</span></span><br><span class="line">├── <span class="built_in">array</span>-flatten@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── cookie-signature@<span class="number">1.0</span><span class="number">.6</span></span><br><span class="line">├── methods@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── vary@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── content-type@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── utils-merge@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── etag@<span class="number">1.7</span><span class="number">.0</span></span><br><span class="line">├── content-disposition@<span class="number">0.5</span><span class="number">.0</span></span><br><span class="line">├── path-to-regexp@<span class="number">0.1</span><span class="number">.7</span></span><br><span class="line">├── fresh@<span class="number">0.3</span><span class="number">.0</span></span><br><span class="line">├── serve-<span class="keyword">static</span>@<span class="number">1.10</span><span class="number">.0</span></span><br><span class="line">├── range-parser@<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">├── parseurl@<span class="number">1.3</span><span class="number">.0</span></span><br><span class="line">├── depd@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── qs@<span class="number">4.0</span><span class="number">.0</span></span><br><span class="line">├── debug@<span class="number">2.2</span><span class="number">.0</span> (ms@<span class="number">0.7</span><span class="number">.1</span>)</span><br><span class="line">├── finalhandler@<span class="number">0.4</span><span class="number">.0</span> (unpipe@<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">├── on-finished@<span class="number">2.3</span><span class="number">.0</span> (ee-first@<span class="number">1.1</span><span class="number">.1</span>)</span><br><span class="line">├── proxy-addr@<span class="number">1.0</span><span class="number">.8</span> (forwarded@<span class="number">0.1</span><span class="number">.0</span>, ipaddr.js@<span class="number">1.0</span><span class="number">.1</span>)</span><br><span class="line">├── send@<span class="number">0.13</span><span class="number">.0</span> (destroy@<span class="number">1.0</span><span class="number">.3</span>, statuses@<span class="number">1.2</span><span class="number">.1</span>, ms@<span class="number">0.7</span><span class="number">.1</span>, mime@<span class="number">1.3</span><span class="number">.4</span>, http-errors@<span class="number">1.3</span><span class="number">.1</span>)</span><br><span class="line">├── accepts@<span class="number">1.2</span><span class="number">.13</span> (negotiator@<span class="number">0.5</span><span class="number">.3</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br><span class="line">└── type-is@<span class="number">1.6</span><span class="number">.9</span> (media-typer@<span class="number">0.3</span><span class="number">.0</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br></pre></td></tr></table></figure>
<p>Now our express framework is installed by NPM and we can create index.js !</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span></span><br><span class="line"><span class="pi"></span><br><span class="line">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	, app    = express()</span><br><span class="line">	, port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<p>we can write a  game by  handle get and post request.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">app.get("/", function(req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get("/adventures", function(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.post("/adventures",function(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<p>in order to  orgnize our code better,</p>
<p>we can seperate  out route and function into  two parts as follow:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/29/nodejs-note-02/" itemprop="url">
                  How to learn Node.js - 02 how to handle Url request
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-29T21:59:25+08:00" content="2015-10-29">
              2015-10-29
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Simple_fuction_to_response_browser_request_based_on_different_url_request">Simple fuction to response browser request based on different url request</h1><p>based on the last server.js fuction </p>
<p>we can add more features to our server :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</span><br><span class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         res.<span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         res.<span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">          res.<span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>here we defined three different route : home page, marketing page, and 404 page.</p>
<p>when we access to different url we will get different response from our urlHandler server.</p>
<h1 id="Usage_of_req-method">Usage of req.method</h1><p>after we can delivery different content to the browsers,  we could try to handle uploads from browsers! </p>
<p>in this function we use req.method fuction to identify get and post medthond and define different response.  </p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">http.</span>createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="transposed_variable">req.</span>url === <span class="string">'/'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/uploads'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">console.</span>log(<span class="transposed_variable">req.</span>method)</span><br><span class="line">         <span class="keyword">if</span> (<span class="transposed_variable">req.</span>method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">                <span class="transposed_variable">console.</span>log(<span class="string">'handling the upload request'</span>)</span><br><span class="line">                <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">                <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'handling it'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;form action="</span>/uploads<span class="string">" method="</span>POST<span class="string">" enctype="</span>multipart/form-data<span class="string">"&gt; &lt;input type="</span>file<span class="string">" name="</span>the_file<span class="string">"&gt;&lt;input type="</span>submit<span class="string">" &gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;'</span>);</span><br><span class="line">             &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="transposed_variable">res.</span>writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">          <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">console.</span>log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>we can see the console log when we refresh and submit uploads page :</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">urlHandler</span>.js</span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</span><br><span class="line">GET</span><br><span class="line">POST</span><br><span class="line">handling the upload request</span><br><span class="line">POST</span><br><span class="line">handling the upload request</span><br></pre></td></tr></table></figure>
<h1 id="catch_the_post_chunk_on_your_server_side">catch the post chunk on your server side</h1><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">http.</span>createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="transposed_variable">req.</span>url === <span class="string">'/'</span>)&#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/uploads'</span>)&#123;</span><br><span class="line">     </span><br><span class="line">     <span class="transposed_variable">console.</span>log(<span class="transposed_variable">req.</span>method)</span><br><span class="line">     <span class="keyword">if</span> (<span class="transposed_variable">req.</span>method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        var upload =<span class="string">''</span></span><br><span class="line">        <span class="transposed_variable">req.</span>on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span><span class="params">(chunk)</span>&#123;</span></span><br><span class="line">            upload += chunk </span><br><span class="line">            <span class="transposed_variable">console.</span>log(<span class="string">"chunk"</span>, chunk)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="transposed_variable">req.</span>on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;</span></span><br><span class="line"></span><br><span class="line">            <span class="transposed_variable">console.</span>log(<span class="string">'handling the upload request is end, the size of upload file is:'</span>, <span class="transposed_variable">upload.</span><span class="built_in">length</span>)</span><br><span class="line">            <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">            <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'upload successfully! \n'</span>);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;form action="</span>/uploads<span class="string">" method="</span>POST<span class="string">" enctype="</span>multipart/form-data<span class="string">"&gt; &lt;input type="</span>file<span class="string">" name="</span>the_file<span class="string">"&gt;&lt;input type="</span>submit<span class="string">" &gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;'</span>);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="transposed_variable">res.</span>writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">      <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">console.</span>log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>console log:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:node Lyn$ node urlHandler.js</span><br><span class="line">Server running at http:<span class="comment">//127.0.0.1:1337/</span></span><br><span class="line">POST</span><br><span class="line">chunk &lt;Buffer <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">57</span> <span class="number">65</span> <span class="number">62</span> <span class="number">4</span>b <span class="number">69</span> <span class="number">74</span> <span class="number">46</span> <span class="number">6f</span> <span class="number">72</span> <span class="number">6</span>d <span class="number">42</span> <span class="number">6f</span> <span class="number">75</span> <span class="number">6</span>e <span class="number">64</span> <span class="number">61</span> <span class="number">72</span> <span class="number">79</span> <span class="number">53</span> <span class="number">43</span> <span class="number">53</span> <span class="number">41</span> <span class="number">6</span>b <span class="number">41</span> <span class="number">69</span> <span class="number">35</span> <span class="number">55</span> <span class="number">46</span> <span class="number">5</span>a <span class="number">55</span> <span class="number">62</span> <span class="number">46</span> <span class="number">4</span>c <span class="number">43</span> <span class="number">0</span>d <span class="number">0</span>a <span class="number">43</span> <span class="number">6f</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">65</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">2</span>d ... &gt;</span><br><span class="line">handling the upload request is end, the size of upload file is: <span class="number">54976</span></span><br></pre></td></tr></table></figure>
<h1 id="Helper_to_simplize_code:_Express">Helper to simplize code: Express</h1><p>Express is a popular minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications.</p>
<h2 id="install_expres">install expres</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>mkdir myserver</span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>cd myserver</span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>npm init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>npm install express --save</span><br></pre></td></tr></table></figure>
<p>it will go through  the follow process:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:node Lyn$ mkdir myserver</span><br><span class="line">Lyn-Cheung-MBP:node Lyn$ cd myserver/</span><br><span class="line">Lyn-Cheung-MBP:myserver Lyn$ npm init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, and tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help json` <span class="keyword">for</span> definitive documentation on these fields</span><br><span class="line">and exactly what they <span class="keyword">do</span>.</span><br><span class="line"></span><br><span class="line">Use `npm install &lt;pkg&gt; --save` afterwards to install a package and</span><br><span class="line">save it as a dependency in the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line"></span><br><span class="line">name: (myserver)</span><br><span class="line">version: (<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">description: my simple server</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords: server</span><br><span class="line">author: lyn</span><br><span class="line">license: (ISC)</span><br><span class="line"></span><br><span class="line">About to write to /Users/Lyn/src/node/myserver/package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"myserver"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"my simple server"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"keywords"</span>: [</span><br><span class="line">    <span class="string">"server"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is <span class="keyword">this</span> ok? (yes) yes</span><br><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:myserver Lyn$ npm install express --save</span><br><span class="line"></span><br><span class="line">npm WARN package.json myserver@<span class="number">1.0</span><span class="number">.0</span> No repository field.</span><br><span class="line">npm WARN package.json myserver@<span class="number">1.0</span><span class="number">.0</span> No README data</span><br><span class="line"></span><br><span class="line">express@<span class="number">4.13</span><span class="number">.3</span> node_modules/express</span><br><span class="line">├── escape-html@<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">├── merge-descriptors@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── <span class="built_in">array</span>-flatten@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── cookie@<span class="number">0.1</span><span class="number">.3</span></span><br><span class="line">├── utils-merge@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── cookie-signature@<span class="number">1.0</span><span class="number">.6</span></span><br><span class="line">├── methods@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── vary@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── path-to-regexp@<span class="number">0.1</span><span class="number">.7</span></span><br><span class="line">├── content-type@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── range-parser@<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">├── content-disposition@<span class="number">0.5</span><span class="number">.0</span></span><br><span class="line">├── etag@<span class="number">1.7</span><span class="number">.0</span></span><br><span class="line">├── fresh@<span class="number">0.3</span><span class="number">.0</span></span><br><span class="line">├── serve-<span class="keyword">static</span>@<span class="number">1.10</span><span class="number">.0</span></span><br><span class="line">├── parseurl@<span class="number">1.3</span><span class="number">.0</span></span><br><span class="line">├── depd@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── qs@<span class="number">4.0</span><span class="number">.0</span></span><br><span class="line">├── debug@<span class="number">2.2</span><span class="number">.0</span> (ms@<span class="number">0.7</span><span class="number">.1</span>)</span><br><span class="line">├── finalhandler@<span class="number">0.4</span><span class="number">.0</span> (unpipe@<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">├── on-finished@<span class="number">2.3</span><span class="number">.0</span> (ee-first@<span class="number">1.1</span><span class="number">.1</span>)</span><br><span class="line">├── proxy-addr@<span class="number">1.0</span><span class="number">.8</span> (forwarded@<span class="number">0.1</span><span class="number">.0</span>, ipaddr.js@<span class="number">1.0</span><span class="number">.1</span>)</span><br><span class="line">├── send@<span class="number">0.13</span><span class="number">.0</span> (destroy@<span class="number">1.0</span><span class="number">.3</span>, statuses@<span class="number">1.2</span><span class="number">.1</span>, ms@<span class="number">0.7</span><span class="number">.1</span>, mime@<span class="number">1.3</span><span class="number">.4</span>, http-errors@<span class="number">1.3</span><span class="number">.1</span>)</span><br><span class="line">├── accepts@<span class="number">1.2</span><span class="number">.13</span> (negotiator@<span class="number">0.5</span><span class="number">.3</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br><span class="line">└── type-is@<span class="number">1.6</span><span class="number">.9</span> (media-typer@<span class="number">0.3</span><span class="number">.0</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br></pre></td></tr></table></figure>
<p>now  the express is installed, </p>
<p>as we need use express middlewares busboy to handle upload file infomations,</p>
<p>so  we also install it here first.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:express Lyn$ npm install connect-busboy</span><br><span class="line">connect-busboy@<span class="number">0.0</span><span class="number">.2</span> node_modules/connect-busboy</span><br><span class="line">└── busboy@<span class="number">0.2</span><span class="number">.11</span> (readable-stream@<span class="number">1.1</span><span class="number">.13</span>, dicer@<span class="number">0.2</span><span class="number">.3</span>)</span><br></pre></td></tr></table></figure>
<p>Alternately, we can also define the dependency of our node app in package.json file in advance.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"myserver"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"my simple server"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">keywords</span>": <span class="value">[</span><br><span class="line">    <span class="string">"server"</span></span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">connect-busboy</span>": <span class="value"><span class="string">"0.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>Then we can go to edit index.js in myserver folder, to rewrite the Url routing function. </p>
<p>Use Express to write  first  helloworld express app.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> *  </span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express    = require('./lib/express');</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">app</span>   = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(bodyParser());</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/"</span>, function(req,res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">    res.end(<span class="string">"Hello World! \n"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.listen(1337);</span><br><span class="line"></span><br><span class="line">console.<span class="literal">log</span>(<span class="string">"Server running as http://127.0.0.1:1337"</span>);</span><br></pre></td></tr></table></figure>
<p>after we save the editing, we can run  express app here.</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:express Lyn$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">index</span>.js</span><br><span class="line">Server running as http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span></span><br></pre></td></tr></table></figure>
<p>Check it out in the browser.</p>
<p>then we can create  uploads function in express and use middlewares busboy to upload files,</p>
<p>fs.createWriteStream function help to create upload on the server files folder(need create path first).</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> express    = require('./lib/express');</span><br><span class="line"><span class="keyword">var</span> busboy     = require('connect-busboy');</span><br><span class="line"><span class="keyword">var</span> fs         = require('fs');</span><br><span class="line">         <span class="keyword">app</span>   = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(busboy());</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/"</span>, function(req,res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">    res.end(<span class="string">"Hello World! \n"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/marketing"</span>, function(req, res)&#123;</span><br><span class="line">    res.send(<span class="string">"this is marketing dept."</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/uploads"</span>, function(req, res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, 'text/html');</span><br><span class="line">    res.end('&lt;html&gt;&lt;head&gt;&lt;title&gt;upload <span class="keyword">program</span> &lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;<span class="keyword">form</span> action=<span class="string">"/uploads"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; &lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"file"</span> name=<span class="string">"the_file"</span>&gt;&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"submit"</span> &gt; &lt;/<span class="keyword">form</span>&gt; &lt;/body&gt; &lt;/html&gt;');</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">post</span>(<span class="string">"/uploads"</span>, function(req, res)&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">var</span> fstream;</span><br><span class="line">    req.pipe(req.busboy);</span><br><span class="line">    req.busboy.<span class="keyword">on</span>('<span class="keyword">file</span>', function (fieldname, <span class="keyword">file</span>, filename) &#123;</span><br><span class="line">        console.<span class="literal">log</span>(<span class="string">"Uploading: "</span> + filename); </span><br><span class="line">        fstream = fs.createWriteStream(__dirname + '/files/' + filename);</span><br><span class="line">        <span class="keyword">file</span>.pipe(fstream);</span><br><span class="line">        fstream.<span class="keyword">on</span>('<span class="keyword">close</span>', function () &#123;</span><br><span class="line">            res.redirect('back');</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.listen(1337);</span><br><span class="line"></span><br><span class="line">console.<span class="literal">log</span>(<span class="string">"Server running as http://127.0.0.1:1337"</span>);</span><br></pre></td></tr></table></figure>
<p>then we can run the express app to upload file to the server </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-<span class="string">MBP:</span>express Lyn$ node index.js</span><br><span class="line">Server running <span class="keyword">as</span> <span class="string">http:</span><span class="comment">//127.0.0.1:1337</span></span><br><span class="line"><span class="string">Uploading:</span> no_image.png</span><br></pre></td></tr></table></figure>
<p>Now we can see the file we submit  in our  express/files folder !</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/28/hellowordnodejs/" itemprop="url">
                  How to learn Node.js - 01 hello world !
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-28T00:40:11+08:00" content="2015-10-28">
              2015-10-28
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Try_Node-js_in_Read-Eval-Print_Loop_mode_first">Try Node.js in Read-Eval-Print Loop mode first</h1><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> Lyn-Cheung-MBP:node Lyn$ node</span><br><span class="line">&gt; <span class="number">50</span>+<span class="number">50</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line">&gt; console</span><br><span class="line">Console &#123;</span><br><span class="line">  <span class="built_in">log</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  info: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  warn: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  <span class="built_in">error</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  dir: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  time: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  timeEnd: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  trace: [<span class="function"><span class="keyword">Function</span>:</span> bound trace],</span><br><span class="line">  assert: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  Console: [<span class="function"><span class="keyword">Function</span>:</span> Console] &#125;</span><br><span class="line">&gt; console.<span class="built_in">log</span>(<span class="string">"hello REPL"</span>)</span><br><span class="line">hello REPL</span><br><span class="line">undefined</span><br><span class="line">&gt; var foo = <span class="string">"toy!"</span></span><br><span class="line">undefined</span><br><span class="line">&gt; foo</span><br><span class="line"><span class="comment">'toy!'</span></span><br><span class="line">&gt;</span><br><span class="line">(^C again <span class="keyword">to</span> quit)</span><br><span class="line">&gt;</span><br><span class="line">Lyn-Cheung-MBP:node Lyn$</span><br></pre></td></tr></table></figure>
<h1 id="Run_Node-js_code_in_files">Run Node.js code in files</h1><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="keyword">server</span>.js</span><br></pre></td></tr></table></figure>
<p>Then enter insert mode to write your code </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</span><br><span class="line">                res.end(<span class="string">'hello world \n'</span>);</span><br><span class="line">&#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>then Save this file in VIM by type “w” </p>
<p>after this, we can run Node.js file in another iTerm terminal(press command + shift + d)</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">hello</span>.js                  </span><br><span class="line"></span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</span><br></pre></td></tr></table></figure>
<p>then you can access to this server in your browser by <a href="http://127.0.0.1:1337/" target="_blank" rel="external">http://127.0.0.1:1337/</a> </p>
<p>req = request<br>res = responde</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> http =<span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line">	, handler =<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">		res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</span><br><span class="line">		res.end(<span class="string">'Hello World\n'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	, sever = http.createServer(handler)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>here is  a clear way  to explain the relation  between http (Node.js moduel), createServer (moduel function) and handler (the parameters of createServer)</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
