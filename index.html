<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://lyn.s76.org/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e1a1e7f61eef21fbacf4a67a19789441";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/10/15/functional_programming/" itemprop="url">
                  函数式编程笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-10-15T14:48:55+08:00" content="2016-10-15">
              2016-10-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/15/functional_programming/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/15/functional_programming/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="环境配置">环境配置</h1><h2 id="package-json">package.json</h2><p>先配置一个package.json文件. 然后运行 <code>npm install</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"test"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"es6"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"main.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">start</span>": <span class="value"><span class="string">"babel-node main.js"</span></span>,</span><br><span class="line">    "<span class="attribute">build</span>": <span class="value"><span class="string">"babel src --out-dir lib"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span>,</span><br><span class="line">  "<span class="attribute">devDependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-cli</span>": <span class="value"><span class="string">"^6.18.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-core</span>": <span class="value"><span class="string">"^6.18.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-es2015-destructuring</span>": <span class="value"><span class="string">"^6.18.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-es2015-modules-commonjs</span>": <span class="value"><span class="string">"^6.18.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-es2015-parameters</span>": <span class="value"><span class="string">"^6.18.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-es2015-spread</span>": <span class="value"><span class="string">"^6.8.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-strict-mode</span>": <span class="value"><span class="string">"^6.18.0"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置Babel">配置Babel</h2><p>在项目目录下新建 .babelrc:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">plugins</span>": <span class="value">[</span><br><span class="line">    <span class="string">"transform-strict-mode"</span>,</span><br><span class="line">    <span class="string">"transform-es2015-modules-commonjs"</span>,</span><br><span class="line">    <span class="string">"transform-es2015-spread"</span>,</span><br><span class="line">    <span class="string">"transform-es2015-destructuring"</span>,</span><br><span class="line">    <span class="string">"transform-es2015-parameters"</span></span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<!--# why Fucntional programming

 1. lessCode = lessBug
-->
<h1 id="使用reduce来实现函数式编程">使用reduce来实现函数式编程</h1><h2 id="Task:读取data文件中的数据转化为对象:">Task:读取data文件中的数据转化为对象:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mark johnson  waffle  iron  <span class="number">80</span>  <span class="number">2</span></span><br><span class="line">mark johnson  blender  <span class="number">200</span>  <span class="number">1</span></span><br><span class="line">mark johnson  knife  <span class="number">10</span>  <span class="number">4</span></span><br><span class="line">nikita Smith  waffle  iron  <span class="number">80</span>  <span class="number">1</span></span><br><span class="line">nikita Smith  knife <span class="number">10</span>  <span class="number">2</span></span><br><span class="line">nikita Smith  pot <span class="number">20</span>  <span class="number">3</span></span><br></pre></td></tr></table></figure>
<ul>
<li>把上面的data文件数据(每行不同属性之间由Tab制表符分割(或者两个空格)),转换成下面的对象格式:</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">mark johnson</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"waffle"</span></span>, "<span class="attribute">price</span>": <span class="value"><span class="string">"iron"</span></span>,"<span class="attribute">quantity</span>": <span class="value"><span class="string">"80"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"blender"</span></span>,"<span class="attribute">price</span>": <span class="value"><span class="string">"200"</span></span>, "<span class="attribute">quantity</span>": <span class="value"><span class="string">"1"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"knife"</span></span>,"<span class="attribute">price</span>": <span class="value"><span class="string">"10"</span></span>,"<span class="attribute">quantity</span>": <span class="value"><span class="string">"4"</span></span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">nikita Smith</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"waffle"</span></span>,"<span class="attribute">price</span>": <span class="value"><span class="string">"iron"</span></span>,"<span class="attribute">quantity</span>": <span class="value"><span class="string">"80"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"knife"</span></span>, "<span class="attribute">price</span>": <span class="value"><span class="string">"10"</span></span>, "<span class="attribute">quantity</span>": <span class="value"><span class="string">"2"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"pot"</span></span>, "<span class="attribute">price</span>": <span class="value"><span class="string">"20"</span></span>,"<span class="attribute">quantity</span>": <span class="value"><span class="string">"3"</span></span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>首先,利用<code>fs.readFileSync</code>读取出文件中的内容</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">'use strict'</span> </span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">var</span> output = fs.readFileSync(<span class="string">'data'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'output: \n'</span>,output);</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>npm start</code> 运行main.js文件:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br><span class="line"></span><br><span class="line">&gt; test@<span class="number">1.0</span><span class="number">.0</span> start /src/node/fnProgramming</span><br><span class="line">&gt; babel-node main.js</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">mark johnson  waffle iron <span class="number">80</span> <span class="number">2</span></span><br><span class="line">mark johnson  blender <span class="number">200</span> <span class="number">1</span></span><br><span class="line">mark johnson  knife <span class="number">10</span> <span class="number">4</span></span><br><span class="line">nikita Smith waffle  iron <span class="number">80</span> <span class="number">1</span></span><br><span class="line">nikita Smith knife  <span class="number">10</span> <span class="number">2</span></span><br><span class="line">nikita Smith pot <span class="number">20</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<ol>
<li>根据换行符<code>\n</code> 进行分割字符串为数组.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">'use strict'</span> </span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">var</span> output = fs.readFileSync(<span class="string">'data'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line">				  .split(<span class="string">'\n'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'output: \n'</span>,output);</span><br></pre></td></tr></table></figure>
<ul>
<li>结果中数组最后一项为空是因为文件是以空行结尾的.可以使用trim()方法过滤掉掉头尾的空格</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">output:</span></span><br><span class="line"> [ <span class="string">'mark johnson  waffle iron 80 2'</span>,</span><br><span class="line">  <span class="string">'mark johnson  blender 200 1'</span>,</span><br><span class="line">  <span class="string">'mark johnson  knife 10 4'</span>,</span><br><span class="line">  <span class="string">'nikita Smith waffle  iron 80 1'</span>,</span><br><span class="line">  <span class="string">'nikita Smith knife  10 2'</span>,</span><br><span class="line">  <span class="string">'nikita Smith pot 20 3  '</span>,</span><br><span class="line">  <span class="string">''</span> ]</span><br></pre></td></tr></table></figure>
<ol>
<li>根据制表符对每行数据进行分割:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">'use strict'</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  output = fs.readFileSync(<span class="string">'data'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line">        .trim()</span><br><span class="line">        .split(<span class="string">'\n'</span>)</span><br><span class="line">        .map(line=&gt;line.split(<span class="string">'\t'</span>)) <span class="comment">//如果你的编辑器把tab制表符转换成两个空格 这里就应该使用2个空格作为分割点      </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'output: \n'</span>,output);</span><br></pre></td></tr></table></figure>
<ul>
<li>输出结果:</li>
</ul>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="atom">output</span>:</span><br><span class="line"> [ [ <span class="string">'mark johnson'</span>, <span class="string">'waffle'</span>, <span class="string">'iron'</span>, <span class="string">'80'</span>, <span class="string">'2'</span> ],</span><br><span class="line">  [ <span class="string">'mark johnson'</span>, <span class="string">'blender'</span>, <span class="string">'200'</span>, <span class="string">'1'</span> ],</span><br><span class="line">  [ <span class="string">'mark johnson'</span>, <span class="string">'knife'</span>, <span class="string">'10'</span>, <span class="string">'4'</span> ],</span><br><span class="line">  [ <span class="string">'nikita Smith'</span>, <span class="string">'waffle'</span>, <span class="string">'iron'</span>, <span class="string">'80'</span>, <span class="string">'1'</span> ],</span><br><span class="line">  [ <span class="string">'nikita Smith'</span>, <span class="string">'knife 10'</span>, <span class="string">'2'</span> ],</span><br><span class="line">  [ <span class="string">'nikita Smith'</span>, <span class="string">'pot 20'</span>, <span class="string">'3'</span> ] ]</span><br></pre></td></tr></table></figure>
<ol>
<li>使用reduce函数解析出每行的属性.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">'use strict'</span> </span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  output = fs.readFileSync(<span class="string">'data'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line">        .trim()</span><br><span class="line">        .split(<span class="string">'\n'</span>)</span><br><span class="line">        .map(line=&gt;line.split(<span class="string">'  '</span>))      </span><br><span class="line">        .reduce((customers,line)=&gt;&#123;</span><br><span class="line">           customers[line[<span class="number">0</span>]]=customers[line[<span class="number">0</span>]]||[] <span class="comment">//当customers为空时,用[]赋值.</span></span><br><span class="line">           customers[line[<span class="number">0</span>]].push(&#123;</span><br><span class="line">             name:line[<span class="number">1</span>],</span><br><span class="line">             price:line[<span class="number">2</span>],</span><br><span class="line">             quantity:line[<span class="number">3</span>],</span><br><span class="line">           &#125;)</span><br><span class="line">           <span class="keyword">return</span> customers</span><br><span class="line">        &#125;,&#123;&#125;) <span class="comment">//这里传入&#123;&#125;空对象作为 reduce的第一个参数也就是customers</span></span><br><span class="line">        </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'output: \n'</span>,<span class="built_in">JSON</span>.stringify(output,<span class="literal">null</span>,<span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>结果:</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  "<span class="attribute">mark johnson</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"waffle"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"iron"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"80"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"blender"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"200"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"1"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"knife"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"10"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"4"</span></span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">nikita Smith</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"waffle"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"iron"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"80"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"knife"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"10"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"2"</span></span><br><span class="line">    </span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">name</span>": <span class="value"><span class="string">"pot"</span></span>,</span><br><span class="line">      "<span class="attribute">price</span>": <span class="value"><span class="string">"20"</span></span>,</span><br><span class="line">      "<span class="attribute">quantity</span>": <span class="value"><span class="string">"3"</span></span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/10/15/docker-notes-01/" itemprop="url">
                  docker 笔记记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-10-15T14:48:55+08:00" content="2016-10-15">
              2016-10-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/15/docker-notes-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/15/docker-notes-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>工作中有一个工程需要运行在centos环境下,然而又不想在centos下进行编码和调试,于是就想还是用docker来映射container的端口到主机下,并且把代码的目录映射到centos的docker container中.这样就可以在本机中写代码和查看结果,并container中运行代码了.</p>
<p>几年前docker刚出来时,玩过几天,但是由于没有做笔记,把内容都忘光了,时隔几年,docker已经在微服务的互联网浪潮中大显光彩.趁此机会复习一下docker的常用命令.<br>于是有了下面的折腾过程:</p>
<p>简单解释的几个名词 :</p>
<ol>
<li>docker 当然指的就是蓝色的小鲸鱼啦  </li>
<li>container 是集装箱的意思 也就是鲸鱼背上的那些集装箱.也就是镜像运行的结果,我们代码运行的环境.</li>
</ol>
<h2 id="下载安装_Docker">下载安装 Docker</h2><p>首先把几年前装的旧版本先删除掉,再去官网下载docker的安装文件.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 清理工作 先查看有哪些machine</span><br><span class="line"></span><br><span class="line">docker-machine <span class="keyword">ls</span> </span><br><span class="line">docker-machine <span class="keyword">rm</span> `docker-machine <span class="keyword">ls</span>`</span><br><span class="line">sudo <span class="keyword">rm</span> /usr/<span class="keyword">local</span>/bin/docker</span><br><span class="line">sudo <span class="keyword">rm</span> /usr/<span class="keyword">local</span>/bin/docker-compose</span><br><span class="line">sudo <span class="keyword">rm</span> /usr/<span class="keyword">local</span>/bin/docker-machine</span><br></pre></td></tr></table></figure>
<p>安装完成后小鲸鱼就会出现在任务栏中了.</p>
<p>windows版本需要windows10才支持docker,且需要打开hyper-V(打开后会与VMware有冲突).</p>
<h3 id="在Settings中增加镜像">在Settings中增加镜像</h3><p>找到Registry mirrors,增加网易docker镜像地址:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//hub.c.163.com</span></span><br></pre></td></tr></table></figure>
<h2 id="编写dockerFile">编写dockerFile</h2><p>内容如下:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Dockerfile</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">FROM</span> centos:latest</span><br><span class="line"><span class="built_in">MAINTAINER</span> Lyn</span><br><span class="line"></span><br><span class="line"><span class="built_in">LABEL</span> <span class="bash">Name=<span class="string">"centos/tailorc"</span></span><br><span class="line"></span></span><br><span class="line"><span class="comment"># 上面是设置docker的镜像来源,下面是升级并安装项目依赖文件,并设置暴露的端口.</span></span><br><span class="line"><span class="comment"># RUN可以有多个 而CMD则指的是container执行后运行的命令.只能有一条,如果有多条那么只会运行最后一条.</span></span><br><span class="line"><span class="built_in">RUN</span> <span class="bash">yum --assumeyes --setopt=tsflags=nodocs update  </span><br><span class="line"></span><span class="built_in">RUN</span> <span class="bash">yum -y  install libevent gtk2 alsa-lib  libXt    </span><br><span class="line"></span><span class="built_in">RUN</span> <span class="bash">yum clean all</span><br><span class="line"></span><span class="built_in">EXPOSE</span> <span class="number">1306</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CMD</span> <span class="bash">[<span class="string">"/bin/bash"</span>]</span></span><br></pre></td></tr></table></figure>
<h2 id="build_docker镜像">build docker镜像</h2><blockquote>
<p>注意:需要先切换到dockerFile的路径下</p>
<p>-f 参数 是指定dockerFile的路径. -t 则是为新建的镜像指定tag name和version</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/Users/</span>Lyn<span class="regexp">/Tailor/</span></span><br><span class="line">docker build -f <span class="string">"/Users/Lyn/Tailor/dockerFile"</span> -t <span class="string">tailor:</span><span class="number">1.0</span> .</span><br></pre></td></tr></table></figure>
<p>build 成功以后可以通过<code>docker images</code>命令来查看系统中所有的docker镜像:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:Tailor Lyn$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tailor              <span class="number">1.0</span>                 <span class="number">74f</span>386530eb3        <span class="number">27</span> minutes ago      <span class="number">510</span> MB</span><br><span class="line">centos              latest              <span class="number">980e0</span>e4c79ec        <span class="number">5</span> weeks ago         <span class="number">196.8</span> MB</span><br></pre></td></tr></table></figure>
<h2 id="run_docker镜像">run docker镜像</h2><p>运行下面这个命令就会启动一个标签叫tailorC的container,并进入到container的终端中(输入exit 会退出terminal并关闭这个container的运行,可以通过<code>docker start &lt;container的name&gt;</code> 来重新启动container,通过<code>docker attach &lt;docker container name&gt;</code> 来进入terminal)</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -v /Users/Lyn/folder:/opt/Tailor -<span class="tag">p</span> <span class="number">1306</span>:<span class="number">1306</span>  --name tailorC  -t -<span class="tag">i</span>  tailor:<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<h3 id="参数解析:">参数解析:</h3><ol>
<li>-v 指的是volume 把本地的目录映射挂载到container的指定目录中 </li>
<li>-p 指的是Port 把host主机的端口的浏览转发到container的指定端口</li>
<li>–name 指的是给container指定别名.</li>
<li>-t 指的是terminal 选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上</li>
<li>-i 则让容器的标准输入保持打开。</li>
</ol>
<p>最后跟着的是镜像的名字<br>也可以在镜像名字后面再跟上默认执行的[CMD]如果有这个参数那么就会覆盖dockerFile中的[CMD]命令</p>
<p>进入container的terminal以后就可以运行想要的运行的命令了.</p>
<h3 id="权限问题">权限问题</h3><p>如果要执行挂载进来的路径中的代码,需要注意两个问题:</p>
<ol>
<li>需要在docker的preference中设置允许挂载这个路径的文件.</li>
<li>在container中可能需要使用 <code>chmod -R 777 &lt;Container中具体路径位置&gt;</code> 命令来修改挂载目录的权限</li>
</ol>
<h3 id="访问container的服务">访问container的服务</h3><p>只要container中的服务启动<br>在本地的浏览器中 访问<code>http://127.0.0.1:1306/</code>就相当于是访问container中的1306端口了. </p>
<h2 id="查看运行的docker_container">查看运行的docker container</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="literal">a</span></span><br></pre></td></tr></table></figure>
<p>运行结果如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line"><span class="number">80</span>ac33b9d175        tailor:<span class="number">1.0</span>          <span class="string">"/bin/bash"</span>         <span class="number">4</span> hours ago         Up <span class="number">2</span> minutes        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">1306</span>-&gt;<span class="number">1306</span>/tcp   tailorC</span><br></pre></td></tr></table></figure>
<h3 id="查看docker的网络配置">查看docker的网络配置</h3><p>当web服务有问题时,我们可以检查docker的网络配置</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Lyn$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line"><span class="number">18</span>ed300147f8        bridge              bridge              <span class="built_in">local</span>               </span><br><span class="line"><span class="number">02</span>d2c77c1549        host                host                <span class="built_in">local</span>               </span><br><span class="line"><span class="number">8</span>b3894017396        <span class="literal">none</span>                <span class="built_in">null</span>                <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<h3 id="查看具体的网络配置:">查看具体的网络配置:</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Lyn$ docker network inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"18ed300147f8ea03e7e94fc4ae289fdd50508c0fb8582520931843d409d9bf0b"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: false,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: null,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"172.17.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: false,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;</span><br><span class="line">            <span class="string">"80ac33b9d175f91416cae336dfd52f4bcce5a0741dbb0c06d4c1c55d44d7d019"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tailorC"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"801d9177f10ac31475a3c1dcd2de46cbe1009c352fe1e12e6eae0888a705fdc5"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.2/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;</span><br><span class="line">            <span class="string">"com.docker.network.bridge.default_bridge"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_icc"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_ip_masquerade"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.host_binding_ipv4"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.name"</span>: <span class="string">"docker0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.driver.mtu"</span>: <span class="string">"1500"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="清理_docker">清理 docker</h2><h3 id="删除指定的镜像">删除指定的镜像</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">docker</span> <span class="tag">rmi</span> <span class="tag">tailor</span><span class="pseudo">:1</span><span class="class">.0</span></span><br></pre></td></tr></table></figure>
<h3 id="移除_dangling_镜像">移除 dangling 镜像</h3><p>dangling 指的也就是在build过程下载和产生的tag为none:none的镜像 </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> images -qf dangling=<span class="built_in">true</span> | xargs docker rmi</span><br></pre></td></tr></table></figure>
<h3 id="移除_dangling_volumes">移除 dangling volumes</h3><p>dangling 指的也就是在build过程下载和产生的tag为none:none的镜像 </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_ins">volume</span> ls -qf dangling=true | xargs -r docker <span class="built_ins">volume</span> rm</span><br></pre></td></tr></table></figure>
<h3 id="删除已经没有运行的containers">删除已经没有运行的containers</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">rm</span> `docker ps -aq`</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">docker <span class="keyword">rm</span> $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line">#windows下 :</span><br><span class="line"><span class="keyword">FOR</span> /f <span class="string">"tokens=*"</span> %i <span class="keyword">IN</span> ('docker ps -a -q') <span class="keyword">DO</span> docker <span class="keyword">rm</span> %<span class="literal">i</span></span><br></pre></td></tr></table></figure>
<h3 id="kill_所有正在运行的_containers">kill 所有正在运行的 containers</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">kill</span> <span class="string">`docker ps -aq`</span></span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/10/02/redux-notes-04/" itemprop="url">
                  redux-note-04 - project structure
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-10-02T11:34:28+08:00" content="2016-10-02">
              2016-10-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/02/redux-notes-04/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/02/redux-notes-04/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="项目布局">项目布局</h1><p>为了方便维护,一般会把actions, components, reducers,Store 拆分成单独的文件,<br>并使用export 和 import 来引用.</p>
<p>参考下面的例子:</p>
<p>在userActions.js中 export setUserName </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">export</span> <span class="tag">function</span> <span class="tag">setUserName</span>(name) &#123;</span><br><span class="line">  <span class="tag">return</span> &#123;</span><br><span class="line">    <span class="attribute">type</span>: <span class="string">'SET_USER_NAME'</span>,</span><br><span class="line">    <span class="attribute">payload</span>: name,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在需要dispatch action的地方直接 import进来使用:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入所有的action </span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> user <span class="keyword">from</span> <span class="string">'./userActions'</span>;</span><br><span class="line"><span class="comment">//dispatch</span></span><br><span class="line">store.dispatch(user.setUserName(<span class="string">'lyn'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//引入具体的action</span></span><br><span class="line"><span class="keyword">import</span> &#123; setUserName &#125; <span class="keyword">from</span> <span class="string">'./userActions'</span></span><br><span class="line">//dispatch</span><br><span class="line">store.dispatch(setUserName(<span class="string">'lyn'</span>));</span><br></pre></td></tr></table></figure>
<p>具体结构如下:</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-10-2/66705304.jpg" alt=""></p>
<p>actions, reudcers 和components 分别放在一个文件夹下.</p>
<h2 id="连接到_Redux">连接到 Redux</h2><p>我们需要做出两个变化，将 <code>App</code> 组件连接到 Redux 并且让它能够 dispatch actions 以及从 Redux store 读取到 state。</p>
<p>首先，我们需要获取从之前安装好的 <a href="http://github.com/reactjs/react-redux" target="_blank" rel="external"><code>react-redux</code></a> 提供的 <code>Provider</code>，并且在渲染之前<strong>将根组件包装进</strong>。</p>
<h3 id="index-js"><code>index.js</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./containers/App'</span></span><br><span class="line"><span class="keyword">import</span> todoApp <span class="keyword">from</span> <span class="string">'./reducers'</span></span><br><span class="line"></span><br><span class="line">let store = createStore(todoApp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Provider</span> <span class="attribute">store</span>=<span class="value">&#123;store&#125;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">App</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">Provider</span>&gt;</span>,</span><br><span class="line">  rootElement</span><br><span class="line">)</span></span><br></pre></td></tr></table></figure>
<p>这使得我们的 store 能为下面的组件所用。（在内部，这个是通过 React 的 <a href="http://facebook.github.io/react/docs/context.html" target="_blank" rel="external">“context” 特性</a>实现。）</p>
<p>接着，我们<strong>想要通过 react-redux 提供的 connect() 方法将包装好的组件连接到Redux</strong>。尽量只做一个顶层的组件，或者 route 处理。从技术上来说你可以将应用中的任何一个组件 <code>connect()</code> 到 Redux store 中，但应该避免这么做，因为这个数据流很难追踪。</p>
<p><strong>任何一个从 connect() 包装好的组件都可以得到一个 dispatch 方法作为组件的 props，以及得到全局 state 中所需的任何内容。</strong> <code>connect()</code> 的唯一参数是 <strong>selector</strong>。此方法可以从 Redux store 接收到全局的 state，然后返回组件中需要的 props。最简单的情况下，可以返回一个初始的 <code>state</code>，但最好先将其进行转化。</p>
<p>我们在index.js 使用<code>Provider</code>方法,把store转换成react的props.在store.js,<br>使用connect方法选择store中,component需要的state形成一个新的store.</p>
<h2 id="index-js-1">index.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//引入components</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'./components/Layout'</span>;</span><br><span class="line"><span class="comment">//引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//react 把components 绑定到指定的dom节点</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line">ReactDom.render(<span class="xml"><span class="tag">&lt;<span class="title">Provider</span> <span class="attribute">store</span>=<span class="value">&#123;store&#125;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">Layout</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">Provider</span>&gt;</span>, app);</span></span><br></pre></td></tr></table></figure>
<h2 id="store-js">store.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  applyMiddleware,</span><br><span class="line">  createStore,</span><br><span class="line">  compose,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入middleware</span></span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> promise <span class="keyword">from</span> <span class="string">'redux-promise-middleware'</span>;</span><br><span class="line"><span class="comment">//引入createStore 需要的reducers</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducers'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> middleware = applyMiddleware(promise(), thunk, logger());</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(reducer, compose(</span><br><span class="line">  middleware,</span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : f =&gt; f</span><br><span class="line">));</span><br><span class="line"><span class="comment">// 不需要devtool的话,就不需要compose.</span></span><br><span class="line"><span class="comment">// export default createStore(reducer, initialState, middleware);</span></span><br></pre></td></tr></table></figure>
<h2 id="components_目录">components 目录</h2><h3 id="Layout-js">Layout.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchUser &#125; <span class="keyword">from</span> <span class="string">'../actions/userActions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPosts &#125; <span class="keyword">from</span> <span class="string">'../actions/postsActions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收整个 Redux store 的 state 作为 props，然后返回一个传入到组件 props 的对象.</span></span><br><span class="line"><span class="comment">//也就是 component里面的this.props</span></span><br><span class="line">@connect((store) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    user: store.user.user,</span><br><span class="line">    userFetched: store.user.fetched,</span><br><span class="line">    post: store.post.posts,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.dispatch(fetchUser());</span><br><span class="line">  &#125;</span><br><span class="line">  fetchPost() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.dispatch(fetchPosts());</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">  	 <span class="comment">//从connect 包装得到的 this.props</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user, post &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (!post.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> welcome &#123;user.name&#125;<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">button</span> <span class="attribute">onClick</span>=<span class="value">&#123;this.fetchPost.bind(this)&#125;</span>&gt;</span> check your posts <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> mappedPosts = post.map(item =&gt; <span class="xml"><span class="tag">&lt;<span class="title">li</span> <span class="attribute">key</span>=<span class="value">&#123;item.id&#125;</span>&gt;</span> &#123;item.text&#125;<span class="tag">&lt;/<span class="title">li</span>&gt;</span>)</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">h1</span>&gt;</span> &#123;user.name&#125;<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ul</span>&gt;</span>&#123;mappedPosts&#125;<span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于_connect">关于 connect</h3><p>如果没有引入修饰符@ (需要引入<code>babel-plugin-transform-decorators-legacy</code>转换为es5 )</p>
<p>那么需要像这样Connect Component:<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let Layout = connect(&#123;</span><br><span class="line">   <span class="built_ins">user</span>: store.<span class="built_ins">user</span>.<span class="built_ins">user</span>,</span><br><span class="line">&#125;)(Layout);</span><br></pre></td></tr></table></figure></p>
<h4 id="connect_function_:">connect function :</h4><ul>
<li><p>函数将被调用两次。第一次是设置参数，第二次是组件与 Redux store 连接：connect(mapStateToProps, mapDispatchToProps, mergeProps)(MyComponent)。</p>
</li>
<li><p>connect 函数不会修改传入的 React 组件，返回的是一个新的已与 Redux store 连接的组件，而且你应该使用这个新组件。</p>
</li>
<li><p>mapStateToProps 函数接收整个 Redux store 的 state 作为 props，然后返回一个传入到组件 props 的对象。该函数被称之为 selector。参考使用 reselect 高效地组合多个 selector ，并对 收集到的数据进行处理。</p>
</li>
<li><p><code>[mapStateToProps(state, [ownProps]): stateProps] (Function)</code>: 如果定义该参数，组件将会监听 Redux store 的变化。任何时候，只要 Redux store 发生改变，mapStateToProps 函数就会被调用。该回调函数必须返回一个纯对象，这个对象会与组件的 props 合并。如果你省略了这个参数，你的组件将不会监听 Redux store。如果指定了该回调函数中的第二个参数 ownProps，则该参数的值为传递到组件的 props，而且只要组件接收到新的 props，mapStateToProps 也会被调用。 </p>
</li>
</ul>
<h2 id="reducers目录">reducers目录</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> post <span class="keyword">from</span> <span class="string">'./postReducer'</span>;</span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">'./userReducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  post,</span><br><span class="line">  user,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="postReducer-js">postReducer.js</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> function reducer(<span class="keyword">state</span> = &#123;</span><br><span class="line">  fetching: false,</span><br><span class="line">  fetched: false,</span><br><span class="line">  posts: [],</span><br><span class="line">  error: null,</span><br><span class="line">&#125;, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case 'FETCH_POSTS_PENDING':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: true,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_POSTS_REJECTED':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123; ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          error: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_POSTS_FULFILLED':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          fetched: true,</span><br><span class="line">          posts: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      return &#123;</span><br><span class="line">        ...<span class="keyword">state</span>,</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="userReducer-js">userReducer.js</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> function reducer(<span class="keyword">state</span> = &#123;</span><br><span class="line">  fetching: false,</span><br><span class="line">  fetched: false,</span><br><span class="line">  <span class="keyword">user</span>: &#123;</span><br><span class="line">    id: null,</span><br><span class="line">    name: null,</span><br><span class="line">    age: null,</span><br><span class="line">  &#125;,</span><br><span class="line">  error: null,</span><br><span class="line">&#125;, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case 'FETCH_USER_PENDING':</span><br><span class="line">      &#123;</span><br><span class="line">        //<span class="keyword">state</span>.name =action.payload;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: true,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_USER_REJECTED':</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        //<span class="keyword">state</span>.name =action.payload;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          error: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_USER_FULFILLED':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          fetched: true,</span><br><span class="line">          <span class="keyword">user</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      return &#123;</span><br><span class="line">        ...<span class="keyword">state</span>,</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="actions目录">actions目录</h2><h3 id="userActions-js">userActions.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'FETCH_USER_FULFILLED'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      name: <span class="string">'lyn'</span>,</span><br><span class="line">      age: <span class="number">35</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setUserName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'SET_USER_NAME'</span>,</span><br><span class="line">    payload: name,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setUserAge</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'SET_USER_AGE'</span>,</span><br><span class="line">    payload: age,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="postActions-js">postActions.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//uasage examples:</span></span><br><span class="line"><span class="comment">// import * as user from './userActions';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// user.setUserName('lyn');</span></span><br><span class="line"><span class="comment">// import &#123; setUserName &#125; from './userActions'</span></span><br><span class="line"><span class="comment">// setUserName('lyn');</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//thunk need return function</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchPosts</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">'FETCH_POSTS_PENDING'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    axios.get(<span class="string">'/api/posts'</span>)</span><br><span class="line">    .then((res) =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'FETCH_POSTS_FULFILLED'</span>,</span><br><span class="line">        payload: res.data.data,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err) =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'FETCH_POSTS_REJECTED'</span>,</span><br><span class="line">        payload: err,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addPost</span>(<span class="params">id, text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'ADD_POST'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      id,</span><br><span class="line">      text,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updatePost</span>(<span class="params">id, text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'UPDATE_POST'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      id,</span><br><span class="line">      text,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deletePost</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'DELETE_POST'</span>,</span><br><span class="line">    payload: id,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/09/29/redux-notes-03/" itemprop="url">
                  redux-notes-03 常用的middleware
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-09-29T21:36:47+08:00" content="2016-09-29">
              2016-09-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/29/redux-notes-03/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/29/redux-notes-03/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Show_me_ur_code">Show me ur code</h1><p> 先看代码,再分别解释各个知识点.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  applyMiddleware,</span><br><span class="line">  createStore,</span><br><span class="line">  compose,</span><br><span class="line">  combineReducers,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> createLogger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> promise <span class="keyword">from</span> <span class="string">'redux-promise-middleware'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义middleware</span></span><br><span class="line"><span class="comment">// const logger = (store)=&gt;(next)=&gt; (action)=&gt;&#123;</span></span><br><span class="line"><span class="comment">// 	console.log('action fired', action);</span></span><br><span class="line"><span class="comment">// 	next(action);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义postreducer</span></span><br><span class="line"><span class="keyword">const</span> postReducer = (state = &#123;</span><br><span class="line">  fetching: <span class="literal">false</span>,</span><br><span class="line">  fetched: <span class="literal">false</span>,</span><br><span class="line">  posts: [],</span><br><span class="line">  error: <span class="literal">null</span>,</span><br><span class="line">&#125;, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_POSTS_PENDING'</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          fetching: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_POSTS_REJECTED'</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; ...state,</span><br><span class="line">          fetching: <span class="literal">false</span>,</span><br><span class="line">          error: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_POSTS_FULFILLED'</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          fetching: <span class="literal">false</span>,</span><br><span class="line">          fetched: <span class="literal">true</span>,</span><br><span class="line">          posts: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义userReducer</span></span><br><span class="line"><span class="keyword">const</span> userReducer = (state = &#123;</span><br><span class="line">  fetching: <span class="literal">false</span>,</span><br><span class="line">  fetched: <span class="literal">false</span>,</span><br><span class="line">  users: &#123;</span><br><span class="line">    id: <span class="literal">null</span>,</span><br><span class="line">    name: <span class="literal">null</span>,</span><br><span class="line">    age: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  error: <span class="literal">null</span>,</span><br><span class="line">&#125;, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_USERS_PENDING'</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//state.name =action.payload;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          fetching: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_USERS_REJECTED'</span>:</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//state.name =action.payload;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          fetching: <span class="literal">false</span>,</span><br><span class="line">          error: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'FETCH_USERS_FULFILLED'</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          fetching: <span class="literal">false</span>,</span><br><span class="line">          fetched: <span class="literal">true</span>,</span><br><span class="line">          users: action.payload.data.data,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用redux的combineReducers组合两个reducer为一个供createStore使用的reducer</span></span><br><span class="line"><span class="keyword">const</span> app = combineReducers(&#123;</span><br><span class="line">  user: userReducer,</span><br><span class="line">  tweets: postReducer,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义middleware,将promise(),thunk,和createLogger()加入到middleware中</span></span><br><span class="line"><span class="keyword">const</span> middleware = applyMiddleware(promise(), thunk, createLogger());</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用compose方法将定义好的middleware和devToolsExtension组合成createStore的middleware参数.</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(app, compose(</span><br><span class="line">  middleware,</span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : f =&gt; f</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">store.subscribe(() =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'store changed'</span>, store.getState());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用axios发起异步请求,axios封装了xhr,redux-promise-middleware会自动为异步调用dispatch三种状态(pending ,fulfilled,rejected).</span></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'FETCH_USERS'</span>,</span><br><span class="line">  payload: axios.get(<span class="string">'/api/users'</span>),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果没有使用redux-promise-middleware,一般使用下面的promise链式调用的方法发起异步请求</span></span><br><span class="line">store.dispatch((dispatch) =&gt; &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">'FETCH_POSTS_PENDING'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  axios.get(<span class="string">'/api/posts'</span>)</span><br><span class="line">    .then((res) =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'FETCH_POSTS_FULFILLED'</span>,</span><br><span class="line">        payload: res.data.data,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err) =&gt; &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'FETCH_POSTS_REJECTED'</span>,</span><br><span class="line">        payload: err,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="redux中的middleware">redux中的middleware</h1><p>middleware的概念和express的middleware是一样的,在dispatch一个action以后,action会先经过所有的middleware的加工处理或者修改,再到达reducers.<br>下面是一个简单的logger middleware.它所实现的功能就是console输出所有经过这个middleware的action.</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const logger = <span class="function"><span class="params">(store)</span>=&gt;</span><span class="function"><span class="params">(next)</span>=&gt;</span> (action)=&gt;&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'action fired'</span>, action);</span><br><span class="line">  	next(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是上面的实例中引入的middleware:</p>
<h2 id="redux-thunk">redux-thunk</h2><p>为什么需要thunk,thunk做了什么?</p>
<p>在默认情况下:</p>
<ol>
<li>createStore() 所创建的 Redux store 没有使用 middleware，所以只支持 同步数据流。</li>
<li>在redux中,触发的action实际上都是一个简单的对象,而不接受action是一个function/promise.</li>
</ol>
<p>当我们引入redux-thunk这个middleware以后,我们就可以dispatch function了.在function中我们可以写异步调用的逻辑,并且再根据不同的状态再diapatch出新的action.</p>
<blockquote>
<p>像 redux-thunk 或 redux-promise 这样支持异步的<code>middleware</code>都包装了<code>store</code>的<code>dispatch()</code> 方法，以此来让你<code>dispatch</code>一些除了 action 以外的其他内容(eg：函数或者<code>Promise</code>)。   </p>
<p>你所使用的任何 middleware 都可以以自己的方式解析你<code>dispatch</code>的任何内容，并继续传递<code>actions</code>给下一个 middleware. 比如，支持 <code>Promise</code> 的 <code>middleware</code> 能够拦截<code>Promise</code>，然后为每个<code>Promise</code> dispatch 特定的<code>action</code>(eg: pending / fulfilled / rejeted)。</p>
</blockquote>
<p>当 middleware 链中的最后一个<code>middleware</code>开始 <code>dispatch action</code> 时，这个<code>action</code>必须是一个普通对象,所以<code>redux-thunk</code>的作用也可以理解为把包含function或者promise的action运行并<code>dispatch</code>成redux可以处理的普通对象.</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>dispatch的对象</span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  <span class="attribute">type</span>: <span class="string">'CHANGE_NAME'</span>,</span><br><span class="line">  <span class="attribute">payload</span>: <span class="string">'LYN'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> dispatch了一个异步调用的箭头函数(thunk middleware 让我们可以dispatch我们定义的函数) </span><br><span class="line">store.dispatch(<span class="function"><span class="params">(dispatch)</span> =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_PENDING'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  axios.get(<span class="string">'/api/posts'</span>)</span><br><span class="line">    .<span class="keyword">then</span>(<span class="function"><span class="params">(res)</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_FULFILLED'</span>,</span><br><span class="line">        <span class="attribute">payload</span>: res.data.data,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">catch</span>(<span class="function"><span class="params">(err)</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_REJECTED'</span>,</span><br><span class="line">        <span class="attribute">payload</span>: err,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>运行的过程:</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在进入redux-thunk之前的action</span></span><br><span class="line">action fired :</span><br><span class="line">(dispatch) &#123;</span><br><span class="line">	  dispatch(&#123;</span><br><span class="line">	    <span class="class"><span class="keyword">type</span>:</span> <span class="symbol">'FETCH_POSTS_PENDIN</span>G'</span><br><span class="line">	  &#125;);</span><br><span class="line">	  _axios2.<span class="keyword">default</span>.get('/api/posts').then(function (res) &#123;</span><br><span class="line">	    dispatch(&#123;</span><br><span class="line">	      <span class="class"><span class="keyword">type</span>:</span> <span class="symbol">'FETCH_POSTS_FULFILLE</span>D',</span><br><span class="line">	   	   ...</span><br><span class="line"><span class="comment">//经过redux-thunk加工后:从上面的function转化为redux可以处理的普通对象</span></span><br><span class="line">action fired:</span><br><span class="line"> <span class="type">Object</span> &#123;<span class="class"><span class="keyword">type</span>:</span> <span class="string">"FETCH_POSTS_PENDING"</span>&#125;<span class="class"><span class="keyword">type</span>:</span> <span class="string">"FETCH_POSTS_PENDING"</span>__proto__: <span class="type">Object</span></span><br></pre></td></tr></table></figure>
<h2 id="axios_和_redux-promise-middleware">axios 和 redux-promise-middleware</h2><p> axios 是一个语法类似于jQuery的ajax方法(封装的http-xhr)</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="regexp">//</span> 如果没有使用redux-promise-middleware,一般使用下面的promise链式调用的方法发起异步请求</span><br><span class="line">store.dispatch(<span class="function"><span class="params">(dispatch)</span> =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_PENDING'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  axios.get(<span class="string">'/api/posts'</span>)</span><br><span class="line">    .<span class="keyword">then</span>(<span class="function"><span class="params">(res)</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_FULFILLED'</span>,</span><br><span class="line">        <span class="attribute">payload</span>: res.data.data,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">catch</span>(<span class="function"><span class="params">(err)</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        <span class="attribute">type</span>: <span class="string">'FETCH_POSTS_REJECTED'</span>,</span><br><span class="line">        <span class="attribute">payload</span>: err,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果有大量的ajax异步请求,那么大量dispatch的action都会是一样的pending,fulfilled或rejected,<br>为了让我们的代码更加简洁,我们可以引入<code>redux-promise-middleware</code>,当action为promise时,他会根据promise的状态自动的dispatch响应的action(pending,fulfilled或rejected)</p>
<p>所以代码就可以简化如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入redux-promise-middleware</span></span><br><span class="line"><span class="keyword">import</span> promise <span class="keyword">from</span> <span class="string">'redux-promise-middleware'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义middleware,将promise(),thunk加入到middleware中</span></span><br><span class="line"><span class="keyword">const</span> middleware = applyMiddleware(promise(), thunk);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(app,middleware);</span><br><span class="line"></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'FETCH_USERS'</span>,</span><br><span class="line">  payload: axios.get(<span class="string">'/api/users'</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="createLogger">createLogger</h2><p>一个很便捷的 middleware，用来打印 action 日志<br>需要注意的是,需要放在apply middleware的最后一个参数.</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-10-1/21740672.jpg" alt=""></p>
<h1 id="devToolsExtension">devToolsExtension</h1><p>一个非常爽的redux调试工具.</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-10-1/97705137.jpg" alt=""></p>
<p>三种使用方法:</p>
<ul>
<li>from <a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd" target="_blank" rel="external">Chrome Web Store</a></li>
<li>or build it with npm i &amp;&amp; npm run build:extension and load the extension’s folder ./build/extension</li>
<li>or run it in dev mode with npm i &amp;&amp; npm start and load the extension’s folder ./dev.</li>
</ul>
<p>我是用的第一种方法:</p>
<ol>
<li>直接安装chrome插件.就会在chrome dev tool上看到redux的选项卡.</li>
<li>用compose方法将定义好的middleware和devToolsExtension组合成createStore的middleware参数.</li>
</ol>
<p>代码如下:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义middleware,将promise(),thunk,和createLogger()加入到middleware中</span></span><br><span class="line"><span class="keyword">const</span> middleware = applyMiddleware(promise(), thunk, createLogger());</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用compose方法将定义好的middleware和devToolsExtension组合成createStore的middleware参数.</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(<span class="keyword">app</span>, compose(</span><br><span class="line">  middleware,</span><br><span class="line">  <span class="keyword">window</span>.devToolsExtension ? <span class="keyword">window</span>.devToolsExtension() : f =&gt; <span class="literal">f</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>github 文档:<a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="external">https://github.com/zalmoxisus/redux-devtools-extension</a></p>
<h1 id="dora-proxy">dora-proxy</h1><p>这个是ali出的一个mock data的利器,封装了常用的几种mock data的库,可以实现api转发,data mock等功能.<br><a href="https://github.com/dora-js/dora-plugin-proxy#规则定义" target="_blank" rel="external">https://github.com/dora-js/dora-plugin-proxy#规则定义</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Learn more on how to config.</span></span><br><span class="line"><span class="comment">// - </span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">'/api/todos'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        success: <span class="literal">true</span>,</span><br><span class="line">        data: [&#123;</span><br><span class="line">          id: <span class="number">1</span>,</span><br><span class="line">          text: <span class="string">'Learn antd'</span>,</span><br><span class="line">          isComplete: <span class="literal">true</span>,</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          id: <span class="number">2</span>,</span><br><span class="line">          text: <span class="string">'Learn ant-tool'</span>,</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          id: <span class="number">3</span>,</span><br><span class="line">          text: <span class="string">'Learn dora'</span>,</span><br><span class="line">        &#125;, ],</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'/api/users'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      success: <span class="literal">true</span>,</span><br><span class="line">      data: [&#123;</span><br><span class="line">        name: <span class="string">'lyn'</span>,</span><br><span class="line">        age: <span class="number">28</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        name: <span class="string">'Lee'</span>,</span><br><span class="line">        age: <span class="number">26</span>,</span><br><span class="line">      &#125;],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'/api/posts'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      success: <span class="literal">true</span>,</span><br><span class="line">      data: [&#123;</span><br><span class="line">      	 id:<span class="number">1</span>,</span><br><span class="line">        text: <span class="string">'helloworld1'</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id:<span class="number">2</span>,</span><br><span class="line">        text: <span class="string">'helloworld2'</span>,</span><br><span class="line">      &#125;],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="ES6相关知识点:">ES6相关知识点:</h1><h2 id="reducer中的-">reducer中的<code>...</code></h2><blockquote>
<p>The … operator (or spread operator) is already supported for arrays in ES6. There is also an ES7 proposal for Object Rest and Spread Properties.</p>
</blockquote>
<p>Spread Operator,即 3 个点 …，配合解构有如下几种不同的使用方法:<br>简单的说就是在处理state时,产生一个新的对象或者数组.而不是修改原有的state.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可用于组装数组:</span></span><br><span class="line"><span class="keyword">const</span> todos = [<span class="string">'Learn dva'</span>];</span><br><span class="line">[...todos, <span class="string">'Learn antd'</span>]; </span><br><span class="line"><span class="comment">// ['Learn dva', 'Learn antd']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//也可用于获取数组的部分项。</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = arr;</span><br><span class="line">rest;  <span class="comment">// rest 等于 ['b', 'c']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//还可收集函数参数为数组。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">directions</span><span class="params">(first, <span class="rest_arg">...rest</span>)</span> </span>&#123;</span><br><span class="line">  console.log(rest);</span><br><span class="line">&#125;</span><br><span class="line">directions(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>);  </span><br><span class="line"><span class="comment">//输出 ['b', 'c'];</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//对于 Object 而言，用于组合成新的 Object 。(ES2017 stage-2 proposal)</span></span><br><span class="line"><span class="keyword">const</span> foo = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> bar = &#123;</span><br><span class="line">  b: <span class="number">3</span>,</span><br><span class="line">  c: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> d = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ret = &#123; ...foo, ...bar, d &#125;;  </span><br><span class="line"><span class="comment">// &#123; a:1, b:3, c:2, d:4 &#125;</span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/09/27/redux-note-02/" itemprop="url">
                  Redux 快速入门 -- 02
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-09-27T21:25:15+08:00" content="2016-09-27">
              2016-09-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/27/redux-note-02/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/27/redux-note-02/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="从Redux开始学习React:">从Redux开始学习React:</h1><p>React的这套机制,之所以那么有特色(也可以说不那么容易被理解),就是因为他所的FLUX单向数据流的概念.</p>
<p>大家都知道React 只是一层简单的view层,那React中的数据交互,ajax应该放到哪里去实现呢?</p>
<p>目前为止,Dan Abramov在flux的理论基础上改进出的Redux公认地是发挥React组件化威力的最佳搭档.<br>Redux 除了和 React 一起用外，还支持其它界面库。</p>
<p>既然react不是必须的,那么不如先把redux单向数据流的概念搞清楚,再来看React,相信会更清晰易懂.</p>
<h1 id="一个简单的Redux实例:">一个简单的Redux实例:</h1><p>在之前配置好的开发目录中的src文件夹下:</p>
<ul>
<li>新建一个index.js文件:</li>
</ul>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  createStore,</span><br><span class="line">&#125; <span class="keyword">from</span> 'redux';</span><br><span class="line"></span><br><span class="line">// 创建一个函数,根据函数的action参数决定如何修改传进来的<span class="keyword">state</span>参数</span><br><span class="line">const reducer = function (<span class="keyword">state</span>, action) &#123;</span><br><span class="line">  if (action.type === 'INC') &#123;</span><br><span class="line">    return <span class="keyword">state</span> + action.payload;</span><br><span class="line">  &#125;</span><br><span class="line">  return <span class="keyword">state</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用redux的createStore来创建一个store,<span class="number">0</span>是<span class="keyword">state</span>初始化的值.</span><br><span class="line">const store = createStore(reducer, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">// 给store绑定一个监听函数,当store dispatch事件时,箭头函数就会去获取store当前的<span class="keyword">state</span>状态.</span><br><span class="line">store.subscribe(() =&gt; &#123;</span><br><span class="line">  console.<span class="keyword">log</span>('store changed', store.getState());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//使用store的dispatch方法 dispatch action对象.</span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: 'INC',</span><br><span class="line">  payload: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: 'INC',</span><br><span class="line">  payload: <span class="number">100</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>修改package.json文件中的entry,指定为我们新建的index.js.</li>
<li>npm的start命令中<code>index=/src/entries/index.html</code> 需要修改成<code>src/index.html</code></li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"entry"</span>: &#123;</span><br><span class="line">   <span class="string">"index"</span>: <span class="string">"./src/index.js"</span></span><br><span class="line"> &#125;,</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"dora -p 8001 --plugins \"</span>webpack,hmr,proxy,livereload?enableJs=<span class="literal">false</span>&amp;injectHost=<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>,browser-history?index=/src/entries/index.html\<span class="string">""</span>,</span><br></pre></td></tr></table></figure>
<ul>
<li>然后在terminal中cd到项目文件夹的路径下 运行<code>npm start</code>命令.(<a href="http://lyn.s76.org/2016/09/26/redux-notes-01/">参考上一篇文章</a>)</li>
<li>在浏览器中访问 <code>http://localhost:8989</code></li>
</ul>
<h1 id="Redux?">Redux?</h1><blockquote>
<p>Redux is a predictable state container for JavaScript apps.</p>
</blockquote>
<p>redux是 JavaScript App 中一个用于可预测state的容器(管理器),为什么是可预测的呢?带着这个问题去找答案.<br>从上面的简单的实例来看,Redux其实很简单, 主要由三个部分组成: Action、Reducer、及 Store.</p>
<h2 id="Redux的三大原则:">Redux的三大原则:</h2><ul>
<li>单一数据源</li>
<li>State 是只读的</li>
<li>使用纯函数(reducer)来执行修改</li>
</ul>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-9-28/87905454.jpg" alt=""></p>
<p>下面我们分别展开解释这几个概念:</p>
<h2 id="单一数据源">单一数据源</h2><ul>
<li>Redux中所有的 state 都以一个对象树的形式储存在一个单一的 store 中。</li>
</ul>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-9-27/4367012.jpg" alt=""></p>
<p>展开其中的post对象,结构如下:</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-9-27/2099696.jpg" alt=""></p>
<h2 id="关于Store:">关于Store:</h2><p>store对象有以下几个方法:</p>
<ul>
<li>store.getState() 可以获取当前的state对象.</li>
<li>store.dispatch(action) 分发action,会立即传到 reducer 来执行。这是触发 state 变化的惟一途径。</li>
<li>store.subscribe(listener) 每当 dispatch action 的时候就会执行listener函数.</li>
<li>store.replaceReducer(nextReducer) store可以替换处理action的reducers函数.</li>
</ul>
<h2 id="State_是只读的">State 是只读的</h2><ul>
<li>惟一改变 state 的办法是触发 action，action是一个描述发生什么的对象。</li>
<li>action对象中必须要有type属性(type的值都是大写的),其他属性都可以自定义.</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(fetchUser())</span><br><span class="line"><span class="comment">//这里是action文件中的一个action</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: <span class="string">'FETCH_USER_FULFILLED'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      name: <span class="string">'lyn'</span>,</span><br><span class="line">      age: <span class="number">35</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-9-27/82500906.jpg" alt=""></p>
<h2 id="使用纯函数来执行修改">使用纯函数来执行修改</h2><ul>
<li>reducers 根据触发的 action 来决定如何改变 state 树.</li>
</ul>
<p>Reducers 必须是纯函数，它接收先前的 state 和 action，并返回新的 state。在一个大的应用中,你可以把它拆成多个小的 reducers，分别独立地操作 state tree 的不同部分.</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-9-27/90881615.jpg" alt=""></p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> function reducer(<span class="keyword">state</span> = &#123;</span><br><span class="line">  fetching: false,</span><br><span class="line">  fetched: false,</span><br><span class="line">  posts: [],</span><br><span class="line">  error: null,</span><br><span class="line">&#125;, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case 'FETCH_POSTS_PENDING':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: true,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_POSTS_REJECTED':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123; ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          error: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    case 'FETCH_POSTS_FULFILLED':</span><br><span class="line">      &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          ...<span class="keyword">state</span>,</span><br><span class="line">          fetching: false,</span><br><span class="line">          fetched: true,</span><br><span class="line">          posts: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      return &#123;</span><br><span class="line">        ...<span class="keyword">state</span>,</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于纯函数">关于纯函数</h3><p>简单的说纯函数就是函数式编程的实现.</p>
<p>函数式编程强调没有”副作用”，意味着相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用；简单理解就是每个函数职责纯粹，所有行为就是返回新的值，没有其他行为(最常见的副作用就是异步操作)，只有采用了纯函数编程,才能保证触发action时reducer总是能返回一个确定的state,由这也就是为什么redux作者说:redux是一个可以预测的state容器.</p>
<p>可以参考下面的一个例子:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不纯的</span></span><br><span class="line"><span class="keyword">var</span> minimum = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span><span class="params">(age)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 纯的 不依赖除了参数以外的变量</span></span><br><span class="line"><span class="keyword">var</span> checkAge = <span class="function"><span class="keyword">function</span><span class="params">(age)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> minimum = <span class="number">21</span>;</span><br><span class="line">  <span class="keyword">return</span> age &gt;= minimum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>关于纯函数,更多的可以参考这里,这里就不展开了:<br><a href="http://www.ruanyifeng.com/blog/2012/04/functional_programming.html" target="_blank" rel="external">函数式编程初探</a> ,<br><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch2.html" target="_blank" rel="external">函数式编程指南</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/09/26/redux-notes-01/" itemprop="url">
                  Redux 快速入门 -- 01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-09-26T21:25:17+08:00" content="2016-09-26">
              2016-09-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/26/redux-notes-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/26/redux-notes-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="配置开发环境">配置开发环境</h1><p>对于新手来说,React和Redux都免不了需要配置各种环境.<br>还好ali的开源项目 <a href="https://ant-tool.github.io/quick-start.html" target="_blank" rel="external">Ant-Tool</a>为大家送上了福利,大大降低了入门的难度.</p>
<h2 id="首先需要确认你的npm版本">首先需要确认你的npm版本</h2><blockquote>
<p>由于atool 依赖了 babel 6，而 babel 6 在npm2 下会有严重的性能问题, 所以npm版本需要&gt;3)</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查确认npm版本</span></span><br><span class="line">npm -v</span><br><span class="line"><span class="number">3.10</span><span class="number">.8</span></span><br><span class="line"><span class="comment">// 安装手脚架工具</span></span><br><span class="line">npm i antd-init -g</span><br><span class="line"><span class="comment">// 检查版本确认安装成功</span></span><br><span class="line">antd-init -v</span><br><span class="line"><span class="number">1.1</span><span class="number">.2</span></span><br><span class="line"><span class="comment">// 在当前目录下创建文件夹并进入这个文件夹</span></span><br><span class="line">mkdir blog &amp;&amp; cd blog</span><br><span class="line"><span class="comment">//运行手脚架工具 任选其一搭建一个sample</span></span><br><span class="line">antd-init</span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line">npm start</span><br><span class="line"><span class="comment">// 在浏览器中打开</span></span><br><span class="line">open http:<span class="comment">//localhost:8989</span></span><br></pre></td></tr></table></figure>
<p>配置package.json中的 entry属性:<br>(这个属性和webpack中配置的entry是同一个东西)</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"entry"</span>: &#123;</span><br><span class="line">    <span class="string">"index"</span>: <span class="string">"./src/index.js"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="遇到的问题:">遇到的问题:</h2><ul>
<li>在升级npm的过程中升级失败</li>
</ul>
<h3 id="原因:">原因:</h3><p>PATH目录下npm文件夹的权限问题</p>
<h3 id="解决办法:">解决办法:</h3><ul>
<li>重新安装node,并根据NPM官方的方法选择其中一种来 修改npm的三个目录的权限问题(lib/node_modules, bin,share)    </li>
<li>只要是不和别人共用同一台电脑,那就可以用下面的方法把npm的文件夹owner修改成自己来解决:</li>
</ul>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/ 获取npm PATH</span><br><span class="line">npm config get prefix</span><br><span class="line">/usr</span><span class="regexp">/local</span><br><span class="line">/</span><span class="regexp">/ 改变文件夹的owner</span><br><span class="line">sudo chown -R $(whoami) $(npm config get prefix)/</span>&#123;<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>,<span class="title">bin</span>,<span class="title">share</span>&#125;</span></span><br><span class="line">/<span class="regexp">/ 设置 npm 源为淘宝镜像</span><br><span class="line">npm config set registry https:/</span><span class="regexp">/registry.npm.taobao.org</span><br><span class="line">/</span><span class="regexp">/ 更新npm到最新版本</span><br><span class="line">npm install npm -g</span><br><span class="line">/</span><span class="regexp">/ 检查更新后的版本</span><br><span class="line">npm -v</span><br><span class="line">3.10.8</span></span><br></pre></td></tr></table></figure>
<h2 id="配置Sublime_Text_3代码检查工具">配置Sublime Text 3代码检查工具</h2><p>打开package control install package(cmd+shift+p),安装下面两个插件:</p>
<ul>
<li>Sublimelinter</li>
<li>Sublimelinter-contrib-eslint</li>
</ul>
<p>可能需要修改Sublimelinter 配置，Preferences-&gt;Package Settings-&gt;SublimeLinter-&gt;Settings-User,</p>
<ul>
<li>debug: true 开启 debug 模式 </li>
<li>paths: 为 ESLint 路径，window 平台下 path：<code>%APPDATA%\\Roaming\\npm</code>，如果该路径已经在系统环境变量中，则可省略，具体可根据实际情况进行相应调整.<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="collection">&#123;</span><br><span class="line">    <span class="string">"user"</span>: <span class="collection">&#123;</span><br><span class="line">        <span class="string">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">"linters"</span>: <span class="collection">&#123;</span><br><span class="line">            <span class="string">"eslint"</span>: <span class="collection">&#123;</span><br><span class="line">                ...</span><br><span class="line">                <span class="string">"excludes"</span>: <span class="collection">[<span class="string">"*.html"</span>]</span></span><br><span class="line">            &#125;</span></span><br><span class="line">        &#125;</span>,</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">"paths"</span>: <span class="collection">&#123;</span><br><span class="line">            ....</span><br><span class="line">            <span class="string">"osx"</span>: <span class="collection">[</span><br><span class="line">                <span class="string">"/usr/local/node/v0.12.7/bin"</span></span><br><span class="line">            ]</span>,</span><br><span class="line">            <span class="string">"windows"</span>: <span class="collection">[</span><br><span class="line">             <span class="string">"C:\\Users\\用户名\\AppData\\Roaming\\npm"</span></span><br><span class="line">            ]</span></span><br><span class="line">        &#125;</span> </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="eslint全局配置文件">eslint全局配置文件</h3><p>如果想要全局使用一个eslint规则去检查代码.<br>那么需要创建.eslintrc.* 文件放在用户目录下,但是推荐的做法还是在每个项目目录下单独配置.<br>配置方法如下:</p>
<ul>
<li>osx:  <code>/Users/用户名</code></li>
<li>win:  <code>C:\Users\用户名</code></li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">&#123;</span><br><span class="line">  <span class="string">"parser"</span>: <span class="string">"babel-eslint"</span>,</span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">"eslint-config-airbnb"</span>,</span><br><span class="line">  <span class="string">"rules"</span>: <span class="collection">&#123;</span><br><span class="line">    //<span class="string">"spaced-comment"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"no-unused-vars"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"no-empty"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"react/wrap-multilines"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"react/no-multi-comp"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"no-constant-condition"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"react/jsx-no-bind"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"react/prop-types"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"arrow-body-style"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"react/prefer-stateless-function"</span>: <span class="collection">[<span class="number">0</span>]</span>,</span><br><span class="line">    <span class="string">"semi"</span>: <span class="collection">[<span class="number">0</span>]</span></span><br><span class="line">  &#125;</span>,</span><br><span class="line">  <span class="string">"ecmaFeatures"</span>: <span class="collection">&#123;</span><br><span class="line">    <span class="string">"experimentalObjectRestSpread"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>还需要全局安装这些package<code>npm install eslint-config-airbnb eslint babel-eslint  -g</code></li>
</ul>
<h2 id="配置格式化工具">配置格式化工具</h2><p>A-tool使用eslint来检查代码风格(基于airbnb推荐的编码风格)<br>可以选择以下两种方式来配置sublime的格式化功能:</p>
<h3 id="使用sublime的build功能来格式化:">使用sublime的build功能来格式化:</h3><ol>
<li>Tools-&gt;Build System-&gt;New Build System…，</li>
<li>在新建的脚本文件中 添加以下代码，保持为eslint.sublime-build到默认位置。</li>
<li>然后运行cmd+b(mac) 或 ctrl+b(win) 即可。</li>
</ol>
<p>mac：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   &#123;</span><br><span class="line">    "<span class="attribute">cmd</span>": <span class="value">[<span class="string">"eslint --fix $file"</span>]</span>,</span><br><span class="line">    "<span class="attribute">shell</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">    "<span class="attribute">path</span>": <span class="value"><span class="string">"/usr/local/bin"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>window：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">cmd</span>": <span class="value">[<span class="string">"eslint"</span>, <span class="string">"--fix"</span>, <span class="string">"$file"</span>]</span>,</span><br><span class="line">    "<span class="attribute">shell</span>": <span class="value"><span class="literal">true</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Tips</strong>：</p>
<ul>
<li>Mac下的”path”可以通过 <code>which node</code>来查看系统中node的路径</li>
</ul>
<h3 id="jsformart">jsformart</h3><p>打开preference&gt;package settings&gt;jsformat&gt;settings user<br>把如下代码粘进去保存即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Documentation: https://github.com/beautify-web/js-beautify</span></span><br><span class="line"><span class="comment">// Example URL: https://github.com/victorporof/Sublime-HTMLPrettify/blob/master/.jsbeautifyrc</span></span><br><span class="line"><span class="comment">// Based on Airbnb's JavaScript Style Guide, URL: https://github.com/airbnb/javascript</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Collapse curly brackets</span></span><br><span class="line">    <span class="string">"brace_style"</span>: <span class="string">"collapse"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Break chained method calls across subsequent lines</span></span><br><span class="line">    <span class="string">"break_chained_methods"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// End output with newline</span></span><br><span class="line">    <span class="string">"end_with_newline"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Evaluate code</span></span><br><span class="line">    <span class="string">"eval_code"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Indentation character</span></span><br><span class="line">    <span class="string">"indent_char"</span>: <span class="string">" "</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initial indentation level</span></span><br><span class="line">    <span class="string">"indent_level"</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Indentation character size</span></span><br><span class="line">    <span class="string">"indent_size"</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Indent with tabs, overrides 'indent_size' and 'indent_char'</span></span><br><span class="line">    <span class="string">"indent_with_tabs"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Enable jslint-stricter mode</span></span><br><span class="line">    <span class="string">"jslint_happy"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Preserve array indentation</span></span><br><span class="line">    <span class="string">"keep_array_indentation"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Preserve function indentation</span></span><br><span class="line">    <span class="string">"keep_function_indentation"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Number of line-breaks to be preserved in one chunk</span></span><br><span class="line">    <span class="string">"max_preserve_newlines"</span>: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Preserve newlines</span></span><br><span class="line">    <span class="string">"preserve_newlines"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a space before an anonymous function's parentheses, i.e. function ()</span></span><br><span class="line">    <span class="string">"space_after_anon_function"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a space before the conditional statement i.e. 'if (true)'</span></span><br><span class="line">    <span class="string">"space_before_conditional"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add padding spaces within empty parentheses i.e. 'f( )'</span></span><br><span class="line">    <span class="string">"space_in_empty_paren"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add padding spaces within parentheses i.e. 'f( a, b )'</span></span><br><span class="line">    <span class="string">"space_in_paren"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Decode printable characters encoded in xNN notation</span></span><br><span class="line">    <span class="string">"unescape_strings"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Wrap lines at next opportunity after N characters</span></span><br><span class="line">    <span class="string">"wrap_line_length"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// <span class="doctag">Note:</span> Remove the comments when adding to the project</span></span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/" itemprop="url">
                  ESXI中实现UPS断电自动关闭GEN8的功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-07-03T16:29:03+08:00" content="2016-07-03">
              2016-07-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="安装ubuntu">安装ubuntu</h1><p>参考: <a href="http://lyn.s76.org/2016/07/02/ubuntu-settings/">http://lyn.s76.org/2016/07/02/ubuntu-settings/</a><br>​    </p>
<h1 id="ESXI中配置APC的USB设备">ESXI中配置APC的USB设备</h1><ol>
<li><p>添加usb控制器<br> <img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/44958482.jpg" alt=""></p>
</li>
<li><p>添加usb设备<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/42030707.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/72111678.jpg" alt=""></p>
</li>
<li><p>开启ESXI的ssh登录  </p>
</li>
<li><p>在esxi的console界面(也就是黄黑色的那个界面)按F2 进入esxi配置界面   </p>
</li>
<li>选择/Select Troubleshooting Options </li>
<li><p>从Troubleshooting Mode Options 菜单, 选择 Enable ESXi Shell,找到:</p>
<pre><code><span class="escape">`E</span>nable ESXi Shell<span class="escape">` </span> 
<span class="escape">`E</span>nable SSH`
</code></pre><p>按Enter键来enable .<br>ps: 更多方式可以参考<a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2030463" target="_blank" rel="external">vm官方的kb</a> :</p>
</li>
</ol>
<h1 id="APC_UPS控件">APC UPS控件</h1><p>ps:我的ups型号是APC的 bk650</p>
<h2 id="安装控件">安装控件</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install apcupsd</span><br></pre></td></tr></table></figure>
<h2 id="配置">配置</h2><p>使用vi 编辑 <code>/etc/apcupsd/apcupsd.conf</code> 文件</p>
<ol>
<li><p>设置name 和usb模式  </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPSNAME <span class="variable">&lt;自定义名称&gt;</span> <span class="comment">#这行定义你的UPS名称</span></span><br><span class="line">UPSCABLE usb <span class="comment">#设置UPS的通讯模式为USB模式</span></span><br><span class="line">UPSTYPE usb <span class="comment">#设置UPS类型为usb型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注释DEVICE /dev/ttyS0</p>
<p>(UPSTYPE usb下面那行)前面加上#号注释掉  </p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># DEVICE /dev/ttyS0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑 /etc/default/apcupsd 中的: </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">ISCONFIGURED=<span class="value"><span class="keyword">yes</span></span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启服务   </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sudo</span> service apcupsd restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试APC组件  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">sudo apcaccess</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果:</span></span><br><span class="line">APC      : <span class="number">001</span>,<span class="number">034</span>,<span class="number">0834</span></span><br><span class="line">DATE     : <span class="number">2016</span>-<span class="number">07</span>-<span class="number">03</span> <span class="number">16</span>:<span class="number">27</span>:<span class="number">22</span> +<span class="number">0800</span></span><br><span class="line">HOSTNAME : <span class="number">1102</span>Server</span><br><span class="line">VERSION  : <span class="number">3.14</span><span class="number">.12</span> (<span class="number">29</span> March <span class="number">2014</span>) debian</span><br><span class="line">UPSNAME  : APC</span><br><span class="line">CABLE    : USB Cable</span><br><span class="line">DRIVER   : USB UPS Driver</span><br><span class="line">UPSMODE  : Stand Alone</span><br><span class="line">STARTTIME: <span class="number">2016</span>-<span class="number">07</span>-<span class="number">03</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">09</span> +<span class="number">0800</span></span><br><span class="line">MODEL    : Back-UPS <span class="number">650</span></span><br><span class="line">STATUS   : ONLINE</span><br><span class="line">LINEV    : <span class="number">226.0</span> Volts</span><br><span class="line">LOADPCT  : <span class="number">30.0</span> Percent</span><br><span class="line">BCHARGE  : <span class="number">100.0</span> Percent</span><br><span class="line">TIMELEFT : <span class="number">23.8</span> Minutes</span><br><span class="line">MBATTCHG : <span class="number">5</span> Percent</span><br><span class="line">MINTIMEL : <span class="number">3</span> Minutes</span><br><span class="line">MAXTIME  : <span class="number">0</span> Seconds</span><br><span class="line">SENSE    : Low</span><br><span class="line">LOTRANS  : <span class="number">165.0</span> Volts</span><br><span class="line">HITRANS  : <span class="number">266.0</span> Volts</span><br><span class="line">ALARMDEL : <span class="number">30</span> Seconds</span><br><span class="line">BATTV    : <span class="number">13.5</span> Volts</span><br><span class="line">LASTXFER : Automatic or <span class="keyword">explicit</span> self test</span><br><span class="line">NUMXFERS : <span class="number">0</span></span><br><span class="line">TONBATT  : <span class="number">0</span> Seconds</span><br><span class="line">CUMONBATT: <span class="number">0</span> Seconds</span><br><span class="line">XOFFBATT : N/A</span><br><span class="line">STATFLAG : <span class="number">0x05000008</span></span><br><span class="line">SERIALNO : <span class="number">3</span>sadsadsa520</span><br><span class="line">BATTDATE : <span class="number">2015</span>-<span class="number">06</span>-<span class="number">15</span></span><br><span class="line">NOMINV   : <span class="number">220</span> Volts</span><br><span class="line">NOMBATTV : <span class="number">12.0</span> Volts</span><br><span class="line">FIRMWARE : <span class="number">822.</span>A3.I USB FW:A3</span><br><span class="line">END APC  : <span class="number">2016</span>-<span class="number">07</span>-<span class="number">03</span> <span class="number">16</span>:<span class="number">28</span>:<span class="number">04</span> +<span class="number">0800</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="修改apc任务脚本">修改apc任务脚本</h2><p> 编辑 <code>/etc/apcupsd/apccontrol</code> 脚本，找到 <code>doshutdown</code> 将下面3行替换为  </p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"UPS <span class="variable">$&#123;2&#125;</span> initiated Shutdown Sequence"</span> | <span class="variable">$&#123;WALL&#125;</span></span><br><span class="line">/usr/bin/ssh root@esxi的ip地址   <span class="string">"/sbin/shutdown.sh &amp;&amp; /sbin/poweroff"</span></span><br><span class="line">;;</span><br></pre></td></tr></table></figure>
<h1 id="配置Ubuntu到ESXI的RSA_SSH">配置Ubuntu到ESXI的RSA SSH</h1><p>为了更安全的免密码登录esxi,还需要配置esxi的rsa秘钥登录:</p>
<h2 id="生成公钥/私钥">生成公钥/私钥</h2><p>使用命令生成RSA秘钥对<br>可以参考:<br><a href="http://lyn.s76.org/2016/07/02/ubuntu-settings/">http://lyn.s76.org/2016/07/02/ubuntu-settings/</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>
<p>注意:</p>
<ul>
<li><p>生成两个 ~/.ssh 文件：id_rsa 和 id_rsa.pub。</p>
</li>
<li><p>对于 ESXi 5.0~6.0，authorized_keys 的位置为：/etc/ssh/keys-<username>/authorized_keys(root用户对应的就是:/etc/ssh/keys-root/authorized_keys)</username></p>
</li>
<li>可以在此文件中存储多个密钥(直接在文件内容后面追加)。</li>
<li>使用下面的命令上传到指定的目录:</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user<span class="variable">@host</span> <span class="string">'mkdir -p .ssh &amp;&amp; cat &gt;&gt; /etc/ssh/keys-root/authorized_keys'</span> &lt; ~<span class="regexp">/.ssh/id</span>_rsa.pub</span><br></pre></td></tr></table></figure>
<h2 id="配置-1">配置</h2><p>ssh到exsi,修改ssh config配置文件:<code>/etc/ssh/sshd_config</code>.</p>
<ul>
<li>要允许授予 root 访问权限，请在 /etc/ssh/sshd_config 文件中将 PermitRootLogin no 更改为 PermitRootLogin yes。</li>
<li>要禁用密码登录，请务必将 ChallengeResponseAuthentication 和 PasswordAuthentication 设置为 no。</li>
<li><p>重新加载服务：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/SSH restart</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>配置好的<code>/etc/ssh/sshd_config</code>文件:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># running from inetd</span></span><br><span class="line"><span class="preprocessor"># Port <span class="number">2200</span></span></span><br><span class="line">Protocol <span class="number">2</span></span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_dsa_key</span><br><span class="line"></span><br><span class="line">UsePrivilegeSeparation no</span><br><span class="line"></span><br><span class="line">SyslogFacility auth</span><br><span class="line">LogLevel info</span><br><span class="line"></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"></span><br><span class="line">PrintMotd yes</span><br><span class="line">PrintLastLog no</span><br><span class="line"></span><br><span class="line">TCPKeepAlive yes</span><br><span class="line"></span><br><span class="line">X11Forwarding no</span><br><span class="line"></span><br><span class="line">Ciphers aes128-ctr,aes192-ctr,aes256-ctr,<span class="number">3</span>des-cbc</span><br><span class="line"></span><br><span class="line">MACs hmac-sha2-<span class="number">256</span>,hmac-sha2-<span class="number">512</span>,hmac-sha1,hmac-sha1-<span class="number">96</span></span><br><span class="line"></span><br><span class="line">UsePAM yes</span><br><span class="line"><span class="preprocessor"># only use PAM challenge-response (keyboard-interactive)</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Banner /etc/issue</span><br><span class="line"></span><br><span class="line">Subsystem sftp /usr/lib/vmware/openssh/bin/sftp-server -f LOCAL5 -l INFO</span><br><span class="line"></span><br><span class="line">AuthorizedKeysFile /etc/ssh/keys-%u/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># hostsRSAAuthentication no</span></span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line">PasswordAuthentication no</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># Timeout value of <span class="number">10</span> mins. The default value of ClientAliveCountMax is <span class="number">3.</span></span></span><br><span class="line"><span class="preprocessor"># Hence, we get a  <span class="number">3</span> * <span class="number">200</span> = <span class="number">600</span> seconds timeout <span class="keyword">if</span> the client has been</span></span><br><span class="line"><span class="preprocessor"># unresponsive.</span></span><br><span class="line">ClientAliveInterval <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># sshd(<span class="number">8</span>) will refuse connection attempts with a probability of “rate/<span class="number">100</span>”</span></span><br><span class="line"><span class="preprocessor"># (<span class="number">30</span>%) <span class="keyword">if</span> there are currently “start” (<span class="number">10</span>) unauthenticated connections.  The</span></span><br><span class="line"><span class="preprocessor"># probability increases linearly and all connection attempts are refused <span class="keyword">if</span> the</span></span><br><span class="line"><span class="preprocessor"># number of unauthenticated connections reaches “full” (<span class="number">100</span>)</span></span><br><span class="line">MaxStartups <span class="number">10</span>:<span class="number">30</span>:<span class="number">200</span></span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/07/02/ubuntu-settings/" itemprop="url">
                  Securing your Ubuntu Server
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-07-02T23:20:19+08:00" content="2016-07-02">
              2016-07-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/02/ubuntu-settings/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/02/ubuntu-settings/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在服务器上部署了linux系统以后,还需要以下操作来确保服务器的安全.</p>
<h1 id="新建一个非root用户">新建一个非root用户</h1><p>使用如下命令新建一个用户 并且把这个用户加到sudo组中</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建用户</span></span><br><span class="line">adduser 你的用户名</span><br><span class="line"><span class="comment">//把用户加入到sudo组</span></span><br><span class="line">adduser 你的用户名 sudo</span><br></pre></td></tr></table></figure>
<h1 id="RSA秘钥登录">RSA秘钥登录</h1><h2 id="生成RSA秘钥对">生成RSA秘钥对</h2><p>mac或者linux用户都可以使用以下命令在/home/你的用户名/.ssh文件夹下创建Rsa秘钥</p>
<ol>
<li><p>使用下面的命令,所有选择都直接按enter使用默认值 就会生成这两个秘钥 <code>id_rsa</code> 和  <code>id_rsa.pub</code> </p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -<span class="tag">b</span> <span class="number">4096</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在服务器上创建.ssh文件夹</p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -<span class="tag">p</span> ~/<span class="class">.ssh</span> &amp;&amp; sudo chmod -R <span class="number">700</span> ~/.ssh/</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后从本地的terminal中使用scp命令上传到服务器上</p>
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -<span class="constant">P </span>服务器的ssh端口号  ~<span class="regexp">/.ssh/id</span>_rsa.pub 服务器上的用户名<span class="variable">@203</span>.<span class="number">0</span>.<span class="number">113.10</span><span class="symbol">:~/</span>.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改文件夹权限 </p>
<p>用下面的命令修改:</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod <span class="number">700</span> -R ~/.ssh &amp;&amp; chmod <span class="number">600</span> ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Tips:</strong> 如果服务器上已有authorized_keys文件:  </p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user<span class="variable">@host</span> <span class="string">'mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</span> &lt; ~<span class="regexp">/.ssh/id</span>_rsa.pub</span><br></pre></td></tr></table></figure>
<ul>
<li>“$ ssh user@host”，表示登录远程主机；  </li>
<li>单引号中的mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys，表示登录后在远程shell上执行的命令：  </li>
<li>“$ mkdir -p .ssh”的作用是，如果用户主目录中的.ssh目录不存在，就创建一个；  </li>
<li>‘cat &gt;&gt; .ssh/authorized_keys’ &lt; ~/.ssh/id_rsa.pub的作用是，将本地的公钥文件~/.ssh/id_rsa.pub，重定向追加到远程文件authorized_keys的末尾。</li>
<li>这一行命令等同于在linux下运行:ssh-copy-id user@host   </li>
</ul>
<h2 id="修改ssh配置文件">修改ssh配置文件</h2><ul>
<li><p>在服务器上用vi修改<code>/etc/ssh/sshd_config</code>文件中的这几行  </p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 修改默认的ssh的<span class="number">22</span>端口到你想要的任意端口 这里修改为<span class="number">38000</span></span></span><br><span class="line">Port <span class="number">38000</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#禁止root用户使用ssh登录</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#禁止用户使用密码登录服务器</span></span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用下面的命令来关闭不需要的ipv4或者ipv6 的ssh访问  </p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'AddressFamily inet'</span> | sudo tee <span class="operator">-a</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启ssh服务生效  </p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sudo</span> service ssh restart</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="ufw_防火墙">ufw 防火墙</h1><h2 id="安装">安装</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install ufw</span><br></pre></td></tr></table></figure>
<h2 id="配置">配置</h2><ul>
<li>设置默认规则  </li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sudo</span> ufw <span class="default"><span class="keyword">default</span> allow outgoing</span></span><br><span class="line"><span class="title">sudo</span> ufw <span class="default"><span class="keyword">default</span> deny incoming</span></span><br></pre></td></tr></table></figure>
<ul>
<li>增加允许的规则  </li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow ssh</span><br><span class="line">sudo ufw allow OpenSSH</span><br><span class="line">sudo ufw allow <span class="number">22</span></span><br><span class="line">sudo ufw allow <span class="number">80</span>/tcp</span><br><span class="line">sudo ufw allow http/tcp</span><br><span class="line">sudo ufw allow <span class="number">1725</span>/udp</span><br></pre></td></tr></table></figure>
<ul>
<li>屏蔽访问</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny <span class="number">111</span></span><br></pre></td></tr></table></figure>
<ul>
<li>高级规则  </li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//允许所有来自该ip的连接</span></span><br><span class="line">sudo ufw allow from <span class="number">123.45</span><span class="number">.67</span><span class="number">.89</span></span><br><span class="line"><span class="comment">//指定访问端口和协议</span></span><br><span class="line">sudo ufw allow from <span class="number">123.45</span><span class="number">.67</span><span class="number">.89</span> to any port <span class="number">22</span> proto tcp</span><br></pre></td></tr></table></figure>
<h2 id="启动ufw">启动ufw</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动防火墙</span></span><br><span class="line">sudo ufw enable</span><br><span class="line"><span class="comment">//关闭防火墙</span></span><br><span class="line">sudo ufw <span class="keyword">disable</span></span><br></pre></td></tr></table></figure>
<h2 id="日志功能">日志功能</h2><p>日志规则可以在<code>/var/logs/ufw</code>文件夹中设置<br>规则如下:</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[UFW <span class="keyword">BLOCK</span>]: This location <span class="keyword">is</span> where the description <span class="keyword">of</span> the logged event will be located. <span class="keyword">In</span> this instance, it blocked a connection.</span><br><span class="line"><span class="keyword">IN</span>: <span class="keyword">If</span> this contains a value, <span class="keyword">then</span> the event was incoming</span><br><span class="line"><span class="keyword">OUT</span>: <span class="keyword">If</span> this contain a value, <span class="keyword">then</span> the event was outgoing</span><br><span class="line">MAC: A combination <span class="keyword">of</span> the destination <span class="keyword">and</span> source MAC addresses</span><br><span class="line">SRC: The IP <span class="keyword">of</span> the packet source</span><br><span class="line">DST: The IP <span class="keyword">of</span> the packet destination</span><br><span class="line">LEN: Packet length</span><br><span class="line">TTL: The packet TTL, <span class="keyword">or</span> <span class="typename">time</span> <span class="keyword">to</span> live. How long it will bounce between routers <span class="keyword">until</span> it expires, <span class="keyword">if</span> no destination <span class="keyword">is</span> found.</span><br><span class="line">PROTO: The packet’s protocal</span><br><span class="line">SPT: The source <span class="keyword">port</span> <span class="keyword">of</span> the <span class="keyword">package</span></span><br><span class="line">DPT: The destination <span class="keyword">port</span> <span class="keyword">of</span> the <span class="keyword">package</span></span><br><span class="line">WINDOW: The size <span class="keyword">of</span> the packet the sender can receive</span><br><span class="line">SYN URGP: Indicated <span class="keyword">if</span> a three-way handshake <span class="keyword">is</span> required. <span class="number">0</span> means it <span class="keyword">is</span> <span class="keyword">not</span>.</span><br></pre></td></tr></table></figure>
<p>开启日志功能</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo ufw logging <span class="function_start"><span class="keyword">on</span></span></span><br></pre></td></tr></table></figure>
<h1 id="Fail2ban">Fail2ban</h1><p>fail2ban 会把恶意尝试ssh登录服务器的主机ip拉进黑名单中</p>
<h2 id="安装-1">安装</h2><ol>
<li><p>更新你的系统    </p>
 <figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> <span class="keyword">update</span> &amp;&amp; apt-<span class="built_in">get</span> upgrade -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 fail2ban    </p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> install fail2ban</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你需要email通知服务还需要安装  </p>
 <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> install sendmail</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置ufw,确保UFW允许ssh访问  </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">enable</span></span><br><span class="line">ufw allow ssh</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="配置-1">配置</h2><ul>
<li>切换目录  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/fail2ban</span><br></pre></td></tr></table></figure>
<ul>
<li>拷贝配置文件  </li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp jail<span class="class">.conf</span> jail<span class="class">.local</span></span><br><span class="line">cp fail2ban<span class="class">.conf</span> fail2ban.local</span><br></pre></td></tr></table></figure>
<ul>
<li>配置  </li>
</ul>
<p>在<code>/etc/fail2ban/jail.local</code>文件中配置  </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># "bantime" is the number of seconds that a host is banned.</span></span><br><span class="line"><span class="setting">bantime  = <span class="value"><span class="number">600</span></span></span></span><br><span class="line"><span class="comment"># A host is banned if it has generated "maxretry" during the last "findtime"</span></span><br><span class="line"><span class="comment"># seconds.</span></span><br><span class="line"><span class="setting">findtime = <span class="value"><span class="number">600</span></span></span></span><br><span class="line"><span class="setting">maxretry = <span class="value"><span class="number">3</span></span></span></span><br><span class="line">	</span><br><span class="line"><span class="comment"># SSH 重试次数</span></span><br><span class="line"><span class="setting">enabled  = <span class="value"><span class="keyword">true</span></span></span></span><br><span class="line"><span class="setting">port     = <span class="value">ssh</span></span></span><br><span class="line"><span class="setting">filter   = <span class="value">sshd</span></span></span><br><span class="line"><span class="setting">logpath  = <span class="value">/var/log/auth.log</span></span></span><br><span class="line"><span class="setting">maxretry = <span class="value"><span class="number">6</span></span></span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/28/3des-of-javascript/" itemprop="url">
                  JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-28T20:39:04+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/3des-of-javascript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/3des-of-javascript/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p> 最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用<a href="https://github.com/brix/crypto-js/tree/develop/src" target="_blank" rel="external">crypto-js库</a>来实现.</p>
<p>由于还是想要更轻便的实现.于是最终采用了下面的实现方法<br>(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;Unicode),位运算符):</p>
<h1 id="3DES_三重数据加密算法">3DES 三重数据加密算法</h1><ul>
<li>引用自维基百科:</li>
</ul>
<blockquote>
<p>三重数据加密算法（Triple Data Encryption Algorithm，缩写为TDEA，Triple DEA），或称3DES（Triple DES），是一种对称密钥加密块密码，相当于是对每个数据块应用三次数据加密标准（DES）算法。由于计算机运算能力的增强，原版DES密码的密钥长度变得容易被暴力破解；3DES即是设计用来提供一种相对简单的方法，即通过增加DES的密钥长度来避免类似的攻击，而不是设计一种全新的块密码算法。</p>
</blockquote>
<h2 id="算法">算法</h2><p>3DES使用“密钥包”，其包含3个DES密钥，K1，K2和K3，均为56位（除去奇偶校验位）。加密算法为：</p>
<ul>
<li>密文 = EK3(DK2(EK1(平文)))</li>
</ul>
<p>也就是说，使用K1为密钥进行DES加密，再用K2为密钥进行DES“解密”，最后以K3进行DES加密。</p>
<p>而解密则为其反过程：</p>
<ul>
<li>平文 = DK1(EK2(DK3(密文)))<br>即以K3解密，以K2“加密”，最后以K1解密。</li>
</ul>
<p>每次加密操作都只处理64位数据，称为一块。</p>
<p>无论是加密还是解密，中间一步都是前后两步的逆。这种做法提高了使用密钥选项2时的算法强度，并在使用密钥选项3时与DES兼容。</p>
<h2 id="密钥选项">密钥选项</h2><p>标准定义了三种密钥选项：</p>
<ul>
<li>密钥选项1：三个密钥是独立的。</li>
<li>密钥选项2：K1和K2是独立的，而K3=K1</li>
<li>密钥选项3：三个密钥均相等，即K1=K2=K3</li>
<li>密钥选项1的强度最高，拥有3 x 56 = 168个独立的密钥位。</li>
</ul>
<p>密钥选项2的安全性稍低，拥有2 x 56 = 112个独立的密钥位。该选项比简单的应用DES两次的强度较高，即使用K1和K2，因为它可以防御中途相遇攻击。</p>
<p>密钥选项3等同与DES，只有56个密钥位。这个选项提供了与DES的兼容性，因为第1和第2次DES操作相互抵消了。该选项不再为国家标准科技协会（NIST）所建议[6]，亦不为ISO/IEC 18033-3所支持。</p>
<h1 id="3Des加密函数">3Des加密函数</h1><ul>
<li><p>内容采用 PKCS5Padding 方式填充，即长度以8 字节切分，不能被8 整除的末尾部分，根据长度不足8 字节的部分，填充“0x01”—“0x08”，如不足1 字节，<br>则填充1 个“0x01”，如不足2 字节，则填充2 个“0x02”，<br>以此类推，如整除，则填充8 个“0x08”；</p>
</li>
<li><p>参数：  </p>
<ol>
<li>key: 8字节字符串作为普通 DES 算法的密钥,或 24 字节字符串作为 3DES.   </li>
<li>message: 加密或解密的信息字符串.  </li>
<li>encrypt: 布尔值参数用来说明信息是加密还是解密.  </li>
<li>mode: 工作模式1:CBC模式，0:ECB模式(默认). </li>
<li>iv: 加密向量.</li>
<li>padding: 可选项, 8字节的输入向量字符串（在 ECB 模式下不使用）. </li>
</ol>
</li>
<li><p>密钥长度不足 24 字节时，右补ASCII 字符“0”；</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">des</span> <span class="params">(key, message, encrypt, mode, iv, padding)</span> </span>&#123;  </span><br><span class="line">  <span class="comment">//declaring this locally speeds things up a bit  </span></span><br><span class="line">  var spfunction1 = <span class="keyword">new</span> Array (<span class="number">0x1010400</span>,<span class="number">0</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x1010004</span>,<span class="number">0x10404</span>,<span class="number">0x4</span>,<span class="number">0x10000</span>,<span class="number">0x400</span>,<span class="number">0x1010400</span>,<span class="number">0x1010404</span>,<span class="number">0x400</span>,<span class="number">0x1000404</span>,<span class="number">0x1010004</span>,<span class="number">0x1000000</span>,<span class="number">0x4</span>,<span class="number">0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0x10400</span>,<span class="number">0x10400</span>,<span class="number">0x1010000</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x10004</span>,<span class="number">0x1000004</span>,<span class="number">0x1000004</span>,<span class="number">0x10004</span>,<span class="number">0</span>,<span class="number">0x404</span>,<span class="number">0x10404</span>,<span class="number">0x1000000</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x4</span>,<span class="number">0x1010000</span>,<span class="number">0x1010400</span>,<span class="number">0x1000000</span>,<span class="number">0x1000000</span>,<span class="number">0x400</span>,<span class="number">0x1010004</span>,<span class="number">0x10000</span>,<span class="number">0x10400</span>,<span class="number">0x1000004</span>,<span class="number">0x400</span>,<span class="number">0x4</span>,<span class="number">0x1000404</span>,<span class="number">0x10404</span>,<span class="number">0x1010404</span>,<span class="number">0x10004</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x1000004</span>,<span class="number">0x404</span>,<span class="number">0x10404</span>,<span class="number">0x1010400</span>,<span class="number">0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0</span>,<span class="number">0x10004</span>,<span class="number">0x10400</span>,<span class="number">0</span>,<span class="number">0x1010004</span>);  </span><br><span class="line">  var spfunction2 = <span class="keyword">new</span> Array (-<span class="number">0x7fef7fe0</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x8000</span>,<span class="number">0x108020</span>,<span class="number">0x100000</span>,<span class="number">0x20</span>,-<span class="number">0x7fefffe0</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7fffffe0</span>,-<span class="number">0x7fef7fe0</span>,-<span class="number">0x7fef8000</span>,-<span class="number">0x80000000</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x100000</span>,<span class="number">0x20</span>,-<span class="number">0x7fefffe0</span>,<span class="number">0x108000</span>,<span class="number">0x100020</span>,-<span class="number">0x7fff7fe0</span>,<span class="number">0</span>,-<span class="number">0x80000000</span>,<span class="number">0x8000</span>,<span class="number">0x108020</span>,-<span class="number">0x7ff00000</span>,<span class="number">0x100020</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0</span>,<span class="number">0x108000</span>,<span class="number">0x8020</span>,-<span class="number">0x7fef8000</span>,-<span class="number">0x7ff00000</span>,<span class="number">0x8020</span>,<span class="number">0</span>,<span class="number">0x108020</span>,-<span class="number">0x7fefffe0</span>,<span class="number">0x100000</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7ff00000</span>,-<span class="number">0x7fef8000</span>,<span class="number">0x8000</span>,-<span class="number">0x7ff00000</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x20</span>,-<span class="number">0x7fef7fe0</span>,<span class="number">0x108020</span>,<span class="number">0x20</span>,<span class="number">0x8000</span>,-<span class="number">0x80000000</span>,<span class="number">0x8020</span>,-<span class="number">0x7fef8000</span>,<span class="number">0x100000</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0x100020</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0x100020</span>,<span class="number">0x108000</span>,<span class="number">0</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x8020</span>,-<span class="number">0x80000000</span>,-<span class="number">0x7fefffe0</span>,-<span class="number">0x7fef7fe0</span>,<span class="number">0x108000</span>);  </span><br><span class="line">  var spfunction3 = <span class="keyword">new</span> Array (<span class="number">0x208</span>,<span class="number">0x8020200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000200</span>,<span class="number">0</span>,<span class="number">0x20208</span>,<span class="number">0x8000200</span>,<span class="number">0x20008</span>,<span class="number">0x8000008</span>,<span class="number">0x8000008</span>,<span class="number">0x20000</span>,<span class="number">0x8020208</span>,<span class="number">0x20008</span>,<span class="number">0x8020000</span>,<span class="number">0x208</span>,<span class="number">0x8000000</span>,<span class="number">0x8</span>,<span class="number">0x8020200</span>,<span class="number">0x200</span>,<span class="number">0x20200</span>,<span class="number">0x8020000</span>,<span class="number">0x8020008</span>,<span class="number">0x20208</span>,<span class="number">0x8000208</span>,<span class="number">0x20200</span>,<span class="number">0x20000</span>,<span class="number">0x8000208</span>,<span class="number">0x8</span>,<span class="number">0x8020208</span>,<span class="number">0x200</span>,<span class="number">0x8000000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000000</span>,<span class="number">0x20008</span>,<span class="number">0x208</span>,<span class="number">0x20000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000200</span>,<span class="number">0</span>,<span class="number">0x200</span>,<span class="number">0x20008</span>,<span class="number">0x8020208</span>,<span class="number">0x8000200</span>,<span class="number">0x8000008</span>,<span class="number">0x200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000208</span>,<span class="number">0x20000</span>,<span class="number">0x8000000</span>,<span class="number">0x8020208</span>,<span class="number">0x8</span>,<span class="number">0x20208</span>,<span class="number">0x20200</span>,<span class="number">0x8000008</span>,<span class="number">0x8020000</span>,<span class="number">0x8000208</span>,<span class="number">0x208</span>,<span class="number">0x8020000</span>,<span class="number">0x20208</span>,<span class="number">0x8</span>,<span class="number">0x8020008</span>,<span class="number">0x20200</span>);  </span><br><span class="line">  var spfunction4 = <span class="keyword">new</span> Array (<span class="number">0x802001</span>,<span class="number">0x2081</span>,<span class="number">0x2081</span>,<span class="number">0x80</span>,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x800001</span>,<span class="number">0x2001</span>,<span class="number">0</span>,<span class="number">0x802000</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x1</span>,<span class="number">0x2000</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0x80</span>,<span class="number">0x800000</span>,<span class="number">0x2001</span>,<span class="number">0x2080</span>,<span class="number">0x800081</span>,<span class="number">0x1</span>,<span class="number">0x2080</span>,<span class="number">0x800080</span>,<span class="number">0x2000</span>,<span class="number">0x802080</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x802000</span>,<span class="number">0x2080</span>,<span class="number">0x800080</span>,<span class="number">0x800081</span>,<span class="number">0x1</span>,<span class="number">0x802001</span>,<span class="number">0x2081</span>,<span class="number">0x2081</span>,<span class="number">0x80</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0x1</span>,<span class="number">0x2000</span>,<span class="number">0x800001</span>,<span class="number">0x2001</span>,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x2001</span>,<span class="number">0x2080</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0x80</span>,<span class="number">0x800000</span>,<span class="number">0x2000</span>,<span class="number">0x802080</span>);  </span><br><span class="line">  var spfunction5 = <span class="keyword">new</span> Array (<span class="number">0x100</span>,<span class="number">0x2080100</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x80000</span>,<span class="number">0x100</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x40080100</span>,<span class="number">0x80000</span>,<span class="number">0x2000100</span>,<span class="number">0x40080100</span>,<span class="number">0x42000100</span>,<span class="number">0x42080000</span>,<span class="number">0x80100</span>,<span class="number">0x40000000</span>,<span class="number">0x2000000</span>,<span class="number">0x40080000</span>,<span class="number">0x40080000</span>,<span class="number">0</span>,<span class="number">0x40000100</span>,<span class="number">0x42080100</span>,<span class="number">0x42080100</span>,<span class="number">0x2000100</span>,<span class="number">0x42080000</span>,<span class="number">0x40000100</span>,<span class="number">0</span>,<span class="number">0x42000000</span>,<span class="number">0x2080100</span>,<span class="number">0x2000000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x80000</span>,<span class="number">0x42000100</span>,<span class="number">0x100</span>,<span class="number">0x2000000</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x40080100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000000</span>,<span class="number">0x42080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40080100</span>,<span class="number">0x100</span>,<span class="number">0x2000000</span>,<span class="number">0x42080000</span>,<span class="number">0x42080100</span>,<span class="number">0x80100</span>,<span class="number">0x42000000</span>,<span class="number">0x42080100</span>,<span class="number">0x2080000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000100</span>,<span class="number">0x80000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40000100</span>);  </span><br><span class="line">  var spfunction6 = <span class="keyword">new</span> Array (<span class="number">0x20000010</span>,<span class="number">0x20400000</span>,<span class="number">0x4000</span>,<span class="number">0x20404010</span>,<span class="number">0x20400000</span>,<span class="number">0x10</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x404010</span>,<span class="number">0x400000</span>,<span class="number">0x20000010</span>,<span class="number">0x400010</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010</span>,<span class="number">0</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0x4000</span>,<span class="number">0x404000</span>,<span class="number">0x20004010</span>,<span class="number">0x10</span>,<span class="number">0x20400010</span>,<span class="number">0x20400010</span>,<span class="number">0</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0x4010</span>,<span class="number">0x404000</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x20004000</span>,<span class="number">0x10</span>,<span class="number">0x20400010</span>,<span class="number">0x404000</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x4010</span>,<span class="number">0x20000010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010</span>,<span class="number">0x20000010</span>,<span class="number">0x20404010</span>,<span class="number">0x404000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>,<span class="number">0x20400010</span>,<span class="number">0x10</span>,<span class="number">0x4000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x4000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>);  </span><br><span class="line">  var spfunction7 = <span class="keyword">new</span> Array (<span class="number">0x200000</span>,<span class="number">0x4200002</span>,<span class="number">0x4000802</span>,<span class="number">0</span>,<span class="number">0x800</span>,<span class="number">0x4000802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x4200802</span>,<span class="number">0x200000</span>,<span class="number">0</span>,<span class="number">0x4000002</span>,<span class="number">0x2</span>,<span class="number">0x4000000</span>,<span class="number">0x4200002</span>,<span class="number">0x802</span>,<span class="number">0x4000800</span>,<span class="number">0x200802</span>,<span class="number">0x200002</span>,<span class="number">0x4000800</span>,<span class="number">0x4000002</span>,<span class="number">0x4200000</span>,<span class="number">0x4200800</span>,<span class="number">0x200002</span>,<span class="number">0x4200000</span>,<span class="number">0x800</span>,<span class="number">0x802</span>,<span class="number">0x4200802</span>,<span class="number">0x200800</span>,<span class="number">0x2</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x200000</span>,<span class="number">0x4000802</span>,<span class="number">0x4000802</span>,<span class="number">0x4200002</span>,<span class="number">0x4200002</span>,<span class="number">0x2</span>,<span class="number">0x200002</span>,<span class="number">0x4000000</span>,<span class="number">0x4000800</span>,<span class="number">0x200000</span>,<span class="number">0x4200800</span>,<span class="number">0x802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x802</span>,<span class="number">0x4000002</span>,<span class="number">0x4200802</span>,<span class="number">0x4200000</span>,<span class="number">0x200800</span>,<span class="number">0</span>,<span class="number">0x2</span>,<span class="number">0x4200802</span>,<span class="number">0</span>,<span class="number">0x200802</span>,<span class="number">0x4200000</span>,<span class="number">0x800</span>,<span class="number">0x4000002</span>,<span class="number">0x4000800</span>,<span class="number">0x800</span>,<span class="number">0x200002</span>);  </span><br><span class="line">  var spfunction8 = <span class="keyword">new</span> Array (<span class="number">0x10001040</span>,<span class="number">0x1000</span>,<span class="number">0x40000</span>,<span class="number">0x10041040</span>,<span class="number">0x10000000</span>,<span class="number">0x10001040</span>,<span class="number">0x40</span>,<span class="number">0x10000000</span>,<span class="number">0x40040</span>,<span class="number">0x10040000</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x10041000</span>,<span class="number">0x41040</span>,<span class="number">0x1000</span>,<span class="number">0x40</span>,<span class="number">0x10040000</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x1040</span>,<span class="number">0x41000</span>,<span class="number">0x40040</span>,<span class="number">0x10040040</span>,<span class="number">0x10041000</span>,<span class="number">0x1040</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x10040040</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x10041000</span>,<span class="number">0x1000</span>,<span class="number">0x40</span>,<span class="number">0x10040040</span>,<span class="number">0x1000</span>,<span class="number">0x41040</span>,<span class="number">0x10001000</span>,<span class="number">0x40</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10040040</span>,<span class="number">0x10000000</span>,<span class="number">0x40000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x40040</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10001000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x41000</span>,<span class="number">0x1040</span>,<span class="number">0x1040</span>,<span class="number">0x40040</span>,<span class="number">0x10000000</span>,<span class="number">0x10041000</span>);  </span><br><span class="line"> </span><br><span class="line">  <span class="comment">//create the 16 or 48 subkeys we will need  </span></span><br><span class="line">  var keys = des_createKeys (key);  </span><br><span class="line">  var m=<span class="number">0</span>, i, j, temp, temp2, right1, right2, left, right, looping;  </span><br><span class="line">  var cbcleft, cbcleft2, cbcright, cbcright2  </span><br><span class="line">  var endloop, loopinc;  </span><br><span class="line">  var len = message.length;  </span><br><span class="line">  var chunk = <span class="number">0</span>;  </span><br><span class="line">  <span class="comment">//set up the loops for single and triple des  </span></span><br><span class="line">  var iterations = keys.length == <span class="number">32</span> ? <span class="number">3</span> : <span class="number">9</span>; <span class="comment">//single or triple des  </span></span><br><span class="line">  <span class="keyword">if</span> (iterations == <span class="number">3</span>) &#123;  </span><br><span class="line">    looping = encrypt ? <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>) : <span class="keyword">new</span> Array (<span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span> &#123;  </span><br><span class="line">    looping = encrypt ? <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>, <span class="number">62</span>, <span class="number">30</span>, -<span class="number">2</span>, <span class="number">64</span>, <span class="number">96</span>, <span class="number">2</span>) : <span class="keyword">new</span> Array (<span class="number">94</span>, <span class="number">62</span>, -<span class="number">2</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">2</span>, <span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//pad the message depending on the padding parameter  </span></span><br><span class="line">  <span class="keyword">if</span> (padding == <span class="number">2</span>)   </span><br><span class="line">    message += <span class="string">"        "</span>; <span class="comment">//pad the message with spaces  </span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (padding == <span class="number">1</span>) &#123;  </span><br><span class="line">    temp = <span class="number">8</span>-(len%<span class="number">8</span>); message += String.fromCharCode (temp,temp,temp,temp,temp,temp,temp,temp);   </span><br><span class="line">      <span class="keyword">if</span> (temp==<span class="number">8</span>)   </span><br><span class="line">        len+=<span class="number">8</span>;  </span><br><span class="line">  &#125; <span class="comment">//PKCS7 padding 这里其实只是PKCS5 padding, PKCS5规定采用8位补全，而PKCS7则不确定位数  </span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (!padding)   </span><br><span class="line">    message += <span class="string">"\0\0\0\0\0\0\0\0"</span>; <span class="comment">//pad the message out with null bytes  </span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//store the result here  </span></span><br><span class="line">  result = <span class="string">""</span>;  </span><br><span class="line">  tempresult = <span class="string">""</span>;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123; <span class="comment">//CBC mode  </span></span><br><span class="line">    cbcleft = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++);  </span><br><span class="line">    cbcright = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++);  </span><br><span class="line">    m=<span class="number">0</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//loop through each 64 bit chunk of the message  </span></span><br><span class="line">  <span class="keyword">while</span> (m &lt; len) &#123;  </span><br><span class="line">    left = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++);  </span><br><span class="line">    right = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//for Cipher Block Chaining mode, xor the message with the previous result  </span></span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123;<span class="keyword">if</span> (encrypt) &#123;left ^= cbcleft; right ^= cbcright;&#125; <span class="keyword">else</span> &#123;cbcleft2 = cbcleft; cbcright2 = cbcright; cbcleft = left; cbcright = right;&#125;&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//first each 64 but chunk of the message must be permuted according to IP  </span></span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0x0000ffff</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">    left = ((left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">31</span>));   </span><br><span class="line">    right = ((right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">31</span>));   </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//do this either 1 or 3 times for each chunk of the message  </span></span><br><span class="line">    <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;iterations; j+=<span class="number">3</span>) &#123;  </span><br><span class="line">      endloop = looping[j+<span class="number">1</span>];  </span><br><span class="line">      loopinc = looping[j+<span class="number">2</span>];  </span><br><span class="line">      <span class="comment">//now go through and perform the encryption or decryption    </span></span><br><span class="line">      <span class="keyword">for</span> (i=looping[j]; i!=endloop; i+=loopinc) &#123; <span class="comment">//for efficiency  </span></span><br><span class="line">        right1 = right ^ keys[i];   </span><br><span class="line">        right2 = ((right &gt;&gt;&gt; <span class="number">4</span>) | (right &lt;&lt; <span class="number">28</span>)) ^ keys[i+<span class="number">1</span>];  </span><br><span class="line">        <span class="comment">//the result is attained by passing these bytes through the S selection functions  </span></span><br><span class="line">        temp = left;  </span><br><span class="line">        left = right;  </span><br><span class="line">        right = temp ^ (spfunction2[(right1 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x3f</span>] | spfunction4[(right1 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction6[(right1 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x3f</span>] | spfunction8[right1 &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction1[(right2 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x3f</span>] | spfunction3[(right2 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction5[(right2 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x3f</span>] | spfunction7[right2 &amp; <span class="number">0x3f</span>]);  </span><br><span class="line">      &#125;  </span><br><span class="line">      temp = left; left = right; right = temp; <span class="comment">//unreverse left and right  </span></span><br><span class="line">    &#125; <span class="comment">//for either 1 or 3 iterations  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//move then each one bit to the right  </span></span><br><span class="line">    left = ((left &gt;&gt;&gt; <span class="number">1</span>) | (left &lt;&lt; <span class="number">31</span>));   </span><br><span class="line">    right = ((right &gt;&gt;&gt; <span class="number">1</span>) | (right &lt;&lt; <span class="number">31</span>));   </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//now perform IP-1, which is IP in the opposite direction  </span></span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0x0000ffff</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//for Cipher Block Chaining mode, xor the message with the previous result  </span></span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123;<span class="keyword">if</span> (encrypt) &#123;cbcleft = left; cbcright = right;&#125; <span class="keyword">else</span> &#123;left ^= cbcleft2; right ^= cbcright2;&#125;&#125;  </span><br><span class="line">    tempresult += String.fromCharCode ((left&gt;&gt;&gt;<span class="number">24</span>), ((left&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xff</span>), ((left&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0xff</span>), (left &amp; <span class="number">0xff</span>), (right&gt;&gt;&gt;<span class="number">24</span>), ((right&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xff</span>), ((right&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0xff</span>), (right &amp; <span class="number">0xff</span>));  </span><br><span class="line">  </span><br><span class="line">    chunk += <span class="number">8</span>;  </span><br><span class="line">    <span class="keyword">if</span> (chunk == <span class="number">512</span>) &#123;result += tempresult; tempresult = <span class="string">""</span>; chunk = <span class="number">0</span>;&#125;  </span><br><span class="line">  &#125; <span class="comment">//for every 8 characters, or 64 bits in the message  </span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//return the result as an array  </span></span><br><span class="line">  <span class="keyword">return</span> result + tempresult;  </span><br><span class="line">&#125; <span class="comment">//end of des  </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//des_createKeys  </span></span><br><span class="line"><span class="comment">//this takes as input a 64 bit key (even though only 56 bits are used)  </span></span><br><span class="line"><span class="comment">//as an array of 2 integers, and returns 16 48 bit keys  </span></span><br><span class="line"><span class="function">function <span class="title">des_createKeys</span> <span class="params">(key)</span> </span>&#123;  </span><br><span class="line">  <span class="comment">//declaring this locally speeds things up a bit  </span></span><br><span class="line">  pc2bytes0  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x20000000</span>,<span class="number">0x20000004</span>,<span class="number">0x10000</span>,<span class="number">0x10004</span>,<span class="number">0x20010000</span>,<span class="number">0x20010004</span>,<span class="number">0x200</span>,<span class="number">0x204</span>,<span class="number">0x20000200</span>,<span class="number">0x20000204</span>,<span class="number">0x10200</span>,<span class="number">0x10204</span>,<span class="number">0x20010200</span>,<span class="number">0x20010204</span>);  </span><br><span class="line">  pc2bytes1  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1</span>,<span class="number">0x100000</span>,<span class="number">0x100001</span>,<span class="number">0x4000000</span>,<span class="number">0x4000001</span>,<span class="number">0x4100000</span>,<span class="number">0x4100001</span>,<span class="number">0x100</span>,<span class="number">0x101</span>,<span class="number">0x100100</span>,<span class="number">0x100101</span>,<span class="number">0x4000100</span>,<span class="number">0x4000101</span>,<span class="number">0x4100100</span>,<span class="number">0x4100101</span>);  </span><br><span class="line">  pc2bytes2  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x8</span>,<span class="number">0x800</span>,<span class="number">0x808</span>,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>,<span class="number">0</span>,<span class="number">0x8</span>,<span class="number">0x800</span>,<span class="number">0x808</span>,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>);  </span><br><span class="line">  pc2bytes3  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x200000</span>,<span class="number">0x8000000</span>,<span class="number">0x8200000</span>,<span class="number">0x2000</span>,<span class="number">0x202000</span>,<span class="number">0x8002000</span>,<span class="number">0x8202000</span>,<span class="number">0x20000</span>,<span class="number">0x220000</span>,<span class="number">0x8020000</span>,<span class="number">0x8220000</span>,<span class="number">0x22000</span>,<span class="number">0x222000</span>,<span class="number">0x8022000</span>,<span class="number">0x8222000</span>);  </span><br><span class="line">  pc2bytes4  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x10</span>,<span class="number">0x40010</span>,<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x10</span>,<span class="number">0x40010</span>,<span class="number">0x1000</span>,<span class="number">0x41000</span>,<span class="number">0x1010</span>,<span class="number">0x41010</span>,<span class="number">0x1000</span>,<span class="number">0x41000</span>,<span class="number">0x1010</span>,<span class="number">0x41010</span>);  </span><br><span class="line">  pc2bytes5  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x400</span>,<span class="number">0x20</span>,<span class="number">0x420</span>,<span class="number">0</span>,<span class="number">0x400</span>,<span class="number">0x20</span>,<span class="number">0x420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>);  </span><br><span class="line">  pc2bytes6  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0x2</span>,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0x2</span>,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>);  </span><br><span class="line">  pc2bytes7  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000</span>,<span class="number">0x800</span>,<span class="number">0x10800</span>,<span class="number">0x20000000</span>,<span class="number">0x20010000</span>,<span class="number">0x20000800</span>,<span class="number">0x20010800</span>,<span class="number">0x20000</span>,<span class="number">0x30000</span>,<span class="number">0x20800</span>,<span class="number">0x30800</span>,<span class="number">0x20020000</span>,<span class="number">0x20030000</span>,<span class="number">0x20020800</span>,<span class="number">0x20030800</span>);  </span><br><span class="line">  pc2bytes8  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x2</span>,<span class="number">0x40002</span>,<span class="number">0x2</span>,<span class="number">0x40002</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>);  </span><br><span class="line">  pc2bytes9  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x8</span>,<span class="number">0x10000008</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x8</span>,<span class="number">0x10000008</span>,<span class="number">0x400</span>,<span class="number">0x10000400</span>,<span class="number">0x408</span>,<span class="number">0x10000408</span>,<span class="number">0x400</span>,<span class="number">0x10000400</span>,<span class="number">0x408</span>,<span class="number">0x10000408</span>);  </span><br><span class="line">  pc2bytes10 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x20</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x2000</span>,<span class="number">0x2020</span>,<span class="number">0x2000</span>,<span class="number">0x2020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>);  </span><br><span class="line">  pc2bytes11 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1000000</span>,<span class="number">0x200</span>,<span class="number">0x1000200</span>,<span class="number">0x200000</span>,<span class="number">0x1200000</span>,<span class="number">0x200200</span>,<span class="number">0x1200200</span>,<span class="number">0x4000000</span>,<span class="number">0x5000000</span>,<span class="number">0x4000200</span>,<span class="number">0x5000200</span>,<span class="number">0x4200000</span>,<span class="number">0x5200000</span>,<span class="number">0x4200200</span>,<span class="number">0x5200200</span>);  </span><br><span class="line">  pc2bytes12 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1000</span>,<span class="number">0x8000000</span>,<span class="number">0x8001000</span>,<span class="number">0x80000</span>,<span class="number">0x81000</span>,<span class="number">0x8080000</span>,<span class="number">0x8081000</span>,<span class="number">0x10</span>,<span class="number">0x1010</span>,<span class="number">0x8000010</span>,<span class="number">0x8001010</span>,<span class="number">0x80010</span>,<span class="number">0x81010</span>,<span class="number">0x8080010</span>,<span class="number">0x8081010</span>);  </span><br><span class="line">  pc2bytes13 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x100</span>,<span class="number">0x104</span>,<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x100</span>,<span class="number">0x104</span>,<span class="number">0x1</span>,<span class="number">0x5</span>,<span class="number">0x101</span>,<span class="number">0x105</span>,<span class="number">0x1</span>,<span class="number">0x5</span>,<span class="number">0x101</span>,<span class="number">0x105</span>);  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//how many iterations (1 for des, 3 for triple des)  </span></span><br><span class="line">  var iterations = key.length &gt; <span class="number">8</span> ? <span class="number">3</span> : <span class="number">1</span>;   </span><br><span class="line">  <span class="comment">//stores the return keys  </span></span><br><span class="line">  var keys = <span class="keyword">new</span> Array (<span class="number">32</span> * iterations);  </span><br><span class="line">  <span class="comment">//now define the left shifts which need to be done  </span></span><br><span class="line">  var shifts = <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);  </span><br><span class="line">  <span class="comment">//other variables  </span></span><br><span class="line">  var lefttemp, righttemp, m=<span class="number">0</span>, n=<span class="number">0</span>, temp;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (var j=<span class="number">0</span>; j&lt;iterations; j++) &#123; <span class="comment">//either 1 or 3 iterations  </span></span><br><span class="line">    left = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++);  </span><br><span class="line">    right = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++);  </span><br><span class="line">  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0x0000ffff</span>; left ^= temp; right ^= (temp &lt;&lt; -<span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">2</span>) ^ right) &amp; <span class="number">0x33333333</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0x0000ffff</span>; left ^= temp; right ^= (temp &lt;&lt; -<span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//the right side needs to be shifted and to get the last four bits of the left side  </span></span><br><span class="line">    temp = (left &lt;&lt; <span class="number">8</span>) | ((right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0x000000f0</span>);  </span><br><span class="line">    <span class="comment">//left needs to be put upside down  </span></span><br><span class="line">    left = (right &lt;&lt; <span class="number">24</span>) | ((right &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xff0000</span>) | ((right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff00</span>) | ((right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf0</span>);  </span><br><span class="line">    right = temp;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//now go through and perform these shifts on the left and right keys  </span></span><br><span class="line">    <span class="keyword">for</span> (var i=<span class="number">0</span>; i &lt; shifts.length; i++) &#123;  </span><br><span class="line">      <span class="comment">//shift the keys either one or two bits to the left  </span></span><br><span class="line">      <span class="keyword">if</span> (shifts[i]) &#123;left = (left &lt;&lt; <span class="number">2</span>) | (left &gt;&gt;&gt; <span class="number">26</span>); right = (right &lt;&lt; <span class="number">2</span>) | (right &gt;&gt;&gt; <span class="number">26</span>);&#125;  </span><br><span class="line">      <span class="keyword">else</span> &#123;left = (left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">27</span>); right = (right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">27</span>);&#125;  </span><br><span class="line">      left &amp;= -<span class="number">0xf</span>; right &amp;= -<span class="number">0xf</span>;  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">//now apply PC-2, in such a way that E is easier when encrypting or decrypting  </span></span><br><span class="line">      <span class="comment">//this conversion will look like PC-2 except only the last 6 bits of each byte are used  </span></span><br><span class="line">      <span class="comment">//rather than 48 consecutive bits and the order of lines will be according to   </span></span><br><span class="line">      <span class="comment">//how the S selection functions will be applied: S2, S4, S6, S8, S1, S3, S5, S7  </span></span><br><span class="line">      lefttemp = pc2bytes0[left &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes1[(left &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes2[(left &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0xf</span>] | pc2bytes3[(left &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes4[(left &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xf</span>] | pc2bytes5[(left &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes6[(left &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>];  </span><br><span class="line">      righttemp = pc2bytes7[right &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes8[(right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes9[(right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0xf</span>] | pc2bytes10[(right &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes11[(right &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xf</span>] | pc2bytes12[(right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes13[(right &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>];  </span><br><span class="line">      temp = ((righttemp &gt;&gt;&gt; <span class="number">16</span>) ^ lefttemp) &amp; <span class="number">0x0000ffff</span>;   </span><br><span class="line">      keys[n++] = lefttemp ^ temp; keys[n++] = righttemp ^ (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125; <span class="comment">//for each iterations  </span></span><br><span class="line">  <span class="comment">//return the keys we've created  </span></span><br><span class="line">  <span class="keyword">return</span> keys;  </span><br><span class="line">&#125; <span class="comment">//end of des_createKeys</span></span><br></pre></td></tr></table></figure>
<h1 id="调用3des加密和解密">调用3des加密和解密</h1><p>由于对加密的结果有以下要求:</p>
<ul>
<li>密钥长度不足 24 字节时，应当右补ASCII 字符“0”；</li>
<li>返回结果使用ASCII 形式的十六进制编码表示，采用大写“ABCDEF”，如加密结果为8 字节二进制字符串：0x0123456789ABCDEF，则Authenticator 为16 字节ASCII 字符串：”0123456789ABCDEF” 。</li>
<li>用hex的加密结果作为解密字符串时,函数应该将十六进制的字符串转换为ASCII码的字符串</li>
</ul>
<p>所以又重新封装了des加密函数. 加密出来的结果因为变量类型是字符串所以实际上是ACSII码,所以看起就像乱码一样,需求需要把ASCII码转换成16进制Hex.所以在解密的时候则需要把16进制的hex先转换回ASCII码在进行解密.</p>
<p>参考如下:</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function encode3des(key, message) &#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </span><br><span class="line">            key+=<span class="string">"0"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">var</span> _temp=des(key, message, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> string2Hex(_temp);</span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line">function decode3des (key, message) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </span><br><span class="line">            key+=<span class="string">"0"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    message =hex2ASCII(message);</span><br><span class="line">    <span class="keyword">return</span>  des(key, message, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function hex2ASCII(str) &#123; </span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = '';</span><br><span class="line">    <span class="keyword">while</span> (str.length &gt;= <span class="number">2</span>) &#123; </span><br><span class="line">       <span class="literal">result</span> += <span class="type">String</span>.fromCharCode(parseInt(str.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">        str = str.substring(<span class="number">2</span>, str.length);</span><br><span class="line">    &#125;</span><br><span class="line">    message =<span class="literal">result</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">&#125; </span><br><span class="line">function string2Hex(s) &#123;  </span><br><span class="line">  <span class="keyword">var</span> r = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">var</span> hexes = new <span class="type">Array</span> (<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>,<span class="string">"5"</span>,<span class="string">"6"</span>,<span class="string">"7"</span>,<span class="string">"8"</span>,<span class="string">"9"</span>,<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>,<span class="string">"E"</span>,<span class="string">"F"</span>);  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;s.length; i++) &#123;r += hexes [s.charCodeAt(i) &gt;&gt; <span class="number">4</span>] + hexes [s.charCodeAt(i) &amp; <span class="number">0xf</span>];&#125;  </span><br><span class="line">  <span class="keyword">return</span> r;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里还有一种将Unicode转为hex的方法,但是要注意这里如果转化出来是02 那么它是会当做2写进字符串的,所以要做一下判断,给他补零补齐两位.</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function string2Hex (s) &#123;</span><br><span class="line">    <span class="keyword">var</span> hex, i;</span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;s.length; i++) &#123;</span><br><span class="line">        hex = s.codePointAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span>(hex.length&lt;<span class="number">2</span>)&#123;</span><br><span class="line">           hex='<span class="number">0</span>'+hex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="literal">result</span> += (hex).slice(-<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>.toUpperCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/26/linux-network-cmd/" itemprop="url">
                  Linux网络抓包命令以及dns查询命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-26T19:38:23+08:00" content="2016-06-26">
              2016-06-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/26/linux-network-cmd/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/26/linux-network-cmd/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="tcpdump">tcpdump</h1><p>因为需要远程抓取一台设备的network记录. 所以需要想办法:</p>
<ol>
<li>把mbp做个wifi共享热点,让被抓包的设备连接到热点上来.</li>
<li>再把有线网卡的mac地址伪装成被抓包的设备,方便我们接入被抓包设备的网段.</li>
</ol>
<p>这样做以后:</p>
<ol>
<li>mbp就成了远程的设备的网关,所有流量就会经过mbp的有线网卡.</li>
<li>而且由于远程设备的代码中都是http协议的而不是https的.所以所有的流量都可以说是透明的. </li>
</ol>
<p>于是就可以抓包下来进行分析了.</p>
<p>这时候就需要用到tcpdump命令了,先使用tcpdump命令把所有的包储存成在本地的cap文件,然后再把这个cap文件丢到wireshark里面进行分析.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump -XvvennSs <span class="number">0</span> -w  <span class="built_in">log</span>.cap  host <span class="number">10.100</span><span class="number">.100</span><span class="number">.100</span></span><br></pre></td></tr></table></figure>
<p>ps: 感谢小毅提供的帮助~</p>
<h1 id="dns_查询_dig">dns 查询 dig</h1><p>在科学上网的过程中,dig命令是非常有帮助的一个命令,能帮你分析dns解析的过程.</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dscacheutil -flushcache  <span class="comment">//mac os中清理dns缓存的命令</span></span><br></pre></td></tr></table></figure>
<p>先用<code>man dig</code> 查询dig的manual(手册) </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">       dig - DNS lookup utility</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       dig [@server] [-b address] [-c class] [-f filename] [-k filename] [-m] [-p port#] [-q name] [-t type] [-x addr]</span><br><span class="line">           [-y [hmac:]name:key] [-4] [-6] [name] [type] [class] [queryopt...]</span><br><span class="line"></span><br><span class="line">       dig [-h]</span><br><span class="line"></span><br><span class="line">       dig [global-queryopt...] [query...]</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       dig (domain information groper) is a flexible tool for interrogating DNS name servers. It performs DNS lookups and displays</span><br><span class="line">       the answers that are returned from the name server(s) that were queried. Most DNS administrators <span class="operator"><span class="keyword">use</span> dig <span class="keyword">to</span> troubleshoot</span><br><span class="line">       DNS problems because <span class="keyword">of</span> its flexibility, ease <span class="keyword">of</span> <span class="keyword">use</span> <span class="keyword">and</span> clarity <span class="keyword">of</span> <span class="keyword">output</span>. Other lookup tools tend <span class="keyword">to</span> have <span class="keyword">less</span></span><br><span class="line">       functionality <span class="keyword">than</span> dig.</span><br><span class="line"></span><br><span class="line">       Although dig <span class="keyword">is</span> normally used <span class="keyword">with</span> command-line arguments, it also has a batch <span class="keyword">mode</span> <span class="keyword">of</span> operation <span class="keyword">for</span> reading lookup</span><br><span class="line">       requests <span class="keyword">from</span> a <span class="keyword">file</span>. A brief summary <span class="keyword">of</span> its command-line arguments <span class="keyword">and</span> options <span class="keyword">is</span> printed <span class="keyword">when</span> the -h <span class="keyword">option</span> <span class="keyword">is</span> given.</span><br><span class="line">       Unlike earlier <span class="keyword">versions</span>, the BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig allows multiple lookups <span class="keyword">to</span> be issued <span class="keyword">from</span> the command line.</span><br><span class="line"></span><br><span class="line">       Unless it <span class="keyword">is</span> told <span class="keyword">to</span> <span class="keyword">query</span> a specific <span class="keyword">name</span> <span class="keyword">server</span>, dig will try <span class="keyword">each</span> <span class="keyword">of</span> the servers listed <span class="keyword">in</span> /etc/resolv.conf.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">When</span> <span class="keyword">no</span> command line arguments <span class="keyword">or</span> options <span class="keyword">are</span> given, dig will perform an NS <span class="keyword">query</span> <span class="keyword">for</span> <span class="string">"."</span> (the root).</span><br><span class="line"></span><br><span class="line">       It <span class="keyword">is</span> possible <span class="keyword">to</span> <span class="keyword">set</span> per-<span class="keyword">user</span> <span class="keyword">defaults</span> <span class="keyword">for</span> dig via $&#123;HOME&#125;/.digrc. This <span class="keyword">file</span> <span class="keyword">is</span> <span class="keyword">read</span> <span class="keyword">and</span> <span class="keyword">any</span> options <span class="keyword">in</span> it <span class="keyword">are</span> applied</span><br><span class="line">       <span class="keyword">before</span> the command line arguments.</span><br><span class="line"></span><br><span class="line">       The <span class="keyword">IN</span> <span class="keyword">and</span> CH <span class="keyword">class</span> <span class="keyword">names</span> overlap <span class="keyword">with</span> the <span class="keyword">IN</span> <span class="keyword">and</span> CH top <span class="keyword">level</span> domains <span class="keyword">names</span>. Either <span class="keyword">use</span> the -<span class="keyword">t</span> <span class="keyword">and</span> -<span class="keyword">c</span> options <span class="keyword">to</span> specify</span><br><span class="line">       the <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span>, <span class="keyword">use</span> the -q the specify the <span class="keyword">domain</span> <span class="keyword">name</span>, <span class="keyword">or</span> <span class="keyword">use</span> <span class="string">"IN."</span> <span class="keyword">and</span> <span class="string">"CH."</span> <span class="keyword">when</span> looking up these top <span class="keyword">level</span> domains.</span><br><span class="line"></span><br><span class="line">SIMPLE <span class="keyword">USAGE</span></span><br><span class="line">       A typical invocation <span class="keyword">of</span> dig looks <span class="keyword">like</span>:</span><br><span class="line"></span><br><span class="line">            dig @<span class="keyword">server</span> <span class="keyword">name</span> <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">where</span>:</span><br><span class="line"></span><br><span class="line">       <span class="keyword">server</span></span><br><span class="line">           <span class="keyword">is</span> the <span class="keyword">name</span> <span class="keyword">or</span> IP address <span class="keyword">of</span> the <span class="keyword">name</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">query</span>. This can be an IPv4 address <span class="keyword">in</span> dotted-<span class="built_in">decimal</span> notation <span class="keyword">or</span> an</span><br><span class="line">           IPv6 address <span class="keyword">in</span> colon-<span class="keyword">delimited</span> notation. <span class="keyword">When</span> the supplied <span class="keyword">server</span> argument <span class="keyword">is</span> a hostname, dig resolves that <span class="keyword">name</span></span><br><span class="line">           <span class="keyword">before</span> querying that <span class="keyword">name</span> <span class="keyword">server</span>. <span class="keyword">If</span> <span class="keyword">no</span> <span class="keyword">server</span> argument <span class="keyword">is</span> provided, dig consults /etc/resolv.conf <span class="keyword">and</span> queries the <span class="keyword">name</span></span><br><span class="line">           servers listed there. The reply <span class="keyword">from</span> the <span class="keyword">name</span> <span class="keyword">server</span> that responds <span class="keyword">is</span> displayed.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">name</span></span><br><span class="line">           <span class="keyword">is</span> the <span class="keyword">name</span> <span class="keyword">of</span> the <span class="keyword">resource</span> <span class="built_in">record</span> that <span class="keyword">is</span> <span class="keyword">to</span> be looked up.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">type</span></span><br><span class="line">           indicates what <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">query</span> <span class="keyword">is</span> <span class="keyword">required</span> <span class="comment">-- ANY, A, MX, SIG, etc.  type can be any valid query type. If no type</span></span><br><span class="line">           argument <span class="keyword">is</span> supplied, dig will perform a lookup <span class="keyword">for</span> an A <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">       The -b <span class="keyword">option</span> <span class="keyword">sets</span> the <span class="keyword">source</span> IP address <span class="keyword">of</span> the <span class="keyword">query</span> <span class="keyword">to</span> address. This must be a valid address <span class="keyword">on</span> one <span class="keyword">of</span> the host<span class="string">'s network</span><br><span class="line">       interfaces or "0.0.0.0" or "::". An optional port may be specified by appending "#&lt;port&gt;"</span><br><span class="line"></span><br><span class="line">       The default query class (IN for internet) is overridden by the -c option.  class is any valid class, such as HS for Hesiod</span><br><span class="line">       records or CH for Chaosnet records.</span><br><span class="line"></span><br><span class="line">       The -f option makes dig operate in batch mode by reading a list of lookup requests to process from the file filename. The</span><br><span class="line">       file contains a number of queries, one per line. Each entry in the file should be organized in the same way they would be</span><br><span class="line">       presented as queries to dig using the command-line interface.</span><br><span class="line"></span><br><span class="line">       The -m option enables memory usage debugging.</span><br><span class="line"></span><br><span class="line">       If a non-standard port number is to be queried, the -p option is used.  port# is the port number that dig will send its</span><br><span class="line">       queries instead of the standard DNS port number 53. This option would be used to test a name server that has been</span><br><span class="line">       configured to listen for queries on a non-standard port number.</span><br><span class="line"></span><br><span class="line">       The -4 option forces dig to only use IPv4 query transport. The -6 option forces dig to only use IPv6 query transport.</span><br><span class="line"></span><br><span class="line">       The -t option sets the query type to type. It can be any valid query type which is supported in BIND 9. The default query</span><br><span class="line">       type is "A", unless the -x option is supplied to indicate a reverse lookup. A zone transfer can be requested by specifying</span><br><span class="line">       a type of AXFR. When an incremental zone transfer (IXFR) is required, type is set to ixfr=N. The incremental zone transfer</span><br><span class="line">       will contain the changes made to the zone since the serial number in the zone'</span>s SOA <span class="built_in">record</span> was <span class="keyword">N</span>.</span><br><span class="line"></span><br><span class="line">       The -q <span class="keyword">option</span> <span class="keyword">sets</span> the <span class="keyword">query</span> <span class="keyword">name</span> <span class="keyword">to</span> <span class="keyword">name</span>. This useful <span class="keyword">do</span> distinguish the <span class="keyword">name</span> <span class="keyword">from</span> other arguments.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Reverse</span> lookups <span class="comment">-- mapping addresses to names -- are simplified by the -x option.  addr is an IPv4 address in</span></span><br><span class="line">       dotted-<span class="built_in">decimal</span> notation, <span class="keyword">or</span> a colon-<span class="keyword">delimited</span> IPv6 address. <span class="keyword">When</span> this <span class="keyword">option</span> <span class="keyword">is</span> used, there <span class="keyword">is</span> <span class="keyword">no</span> need <span class="keyword">to</span> provide the <span class="keyword">name</span>,</span><br><span class="line">       <span class="keyword">class</span> <span class="keyword">and</span> <span class="keyword">type</span> arguments.  dig automatically performs a lookup <span class="keyword">for</span> a <span class="keyword">name</span> <span class="keyword">like</span> <span class="number">11.12</span><span class="number">.13</span><span class="number">.10</span>.<span class="keyword">in</span>-addr.arpa <span class="keyword">and</span> <span class="keyword">sets</span> the <span class="keyword">query</span></span><br><span class="line">       <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span> <span class="keyword">to</span> PTR <span class="keyword">and</span> <span class="keyword">IN</span> respectively. <span class="keyword">By</span> <span class="keyword">default</span>, IPv6 addresses <span class="keyword">are</span> looked up <span class="keyword">using</span> nibble <span class="keyword">format</span> <span class="keyword">under</span> the IP6.ARPA</span><br><span class="line">       <span class="keyword">domain</span>. <span class="keyword">To</span> <span class="keyword">use</span> the older RFC1886 method <span class="keyword">using</span> the IP6.<span class="built_in">INT</span> <span class="keyword">domain</span> specify the -<span class="keyword">i</span> <span class="keyword">option</span>. <span class="built_in">Bit</span> <span class="keyword">string</span> labels (RFC2874) <span class="keyword">are</span> <span class="keyword">now</span></span><br><span class="line">       experimental <span class="keyword">and</span> <span class="keyword">are</span> <span class="keyword">not</span> attempted.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">To</span> <span class="keyword">sign</span> the DNS queries sent <span class="keyword">by</span> dig <span class="keyword">and</span> their responses <span class="keyword">using</span> <span class="keyword">transaction</span> signatures (TSIG), specify a TSIG <span class="keyword">key</span> <span class="keyword">file</span> <span class="keyword">using</span></span><br><span class="line">       the -<span class="keyword">k</span> <span class="keyword">option</span>. You can also specify the TSIG <span class="keyword">key</span> itself <span class="keyword">on</span> the command line <span class="keyword">using</span> the -y <span class="keyword">option</span>;</span> hmac is the type of the</span><br><span class="line">       TSIG, default HMAC-MD5, name is the name of the TSIG key and key is the actual key. The key is a base-64 encoded string,</span><br><span class="line">       typically generated by dnssec-keygen(8). Caution should be taken when using the -y option on multi-user systems as the key</span><br><span class="line">       can be visible in the output from ps(1) or in the shell's history file. When using TSIG authentication with dig, the name</span><br><span class="line">       server that is queried needs to know the key and algorithm that is being used. In BIND, this is done by providing</span><br><span class="line">       appropriate key and server statements in named.conf.</span><br><span class="line"></span><br><span class="line">Mac OS X NOTICE</span><br><span class="line">       The dig command does not <span class="operator"><span class="keyword">use</span> the host <span class="keyword">name</span> <span class="keyword">and</span> address resolution <span class="keyword">or</span> the DNS <span class="keyword">query</span> routing mechanisms used <span class="keyword">by</span> other</span><br><span class="line">       processes running <span class="keyword">on</span> Mac OS X.  The results <span class="keyword">of</span> <span class="keyword">name</span> <span class="keyword">or</span> address queries printed <span class="keyword">by</span> dig may differ <span class="keyword">from</span> those <span class="keyword">found</span> <span class="keyword">by</span> other</span><br><span class="line">       processes that <span class="keyword">use</span> the Mac OS X <span class="keyword">native</span> <span class="keyword">name</span> <span class="keyword">and</span> address resolution mechanisms.  The results <span class="keyword">of</span> DNS queries may also differ</span><br><span class="line">       <span class="keyword">from</span> queries that <span class="keyword">use</span> the Mac OS X DNS routing <span class="keyword">library</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">QUERY</span> OPTIONS</span><br><span class="line">       dig provides a <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">query</span> options which affect the way <span class="keyword">in</span> which lookups <span class="keyword">are</span> made <span class="keyword">and</span> the results displayed. <span class="keyword">Some</span> <span class="keyword">of</span></span><br><span class="line">       these <span class="keyword">set</span> <span class="keyword">or</span> <span class="keyword">reset</span> flag bits <span class="keyword">in</span> the <span class="keyword">query</span> header, <span class="keyword">some</span> determine which sections <span class="keyword">of</span> the answer <span class="keyword">get</span> printed, <span class="keyword">and</span> others</span><br><span class="line">       determine the <span class="keyword">timeout</span> <span class="keyword">and</span> retry strategies.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Each</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">is</span> <span class="keyword">identified</span> <span class="keyword">by</span> a keyword preceded <span class="keyword">by</span> a plus <span class="keyword">sign</span> (+). <span class="keyword">Some</span> keywords <span class="keyword">set</span> <span class="keyword">or</span> <span class="keyword">reset</span> an <span class="keyword">option</span>. These may</span><br><span class="line">       be preceded <span class="keyword">by</span> the <span class="keyword">string</span> <span class="keyword">no</span> <span class="keyword">to</span> negate the meaning <span class="keyword">of</span> that keyword. Other keywords assign <span class="keyword">values</span> <span class="keyword">to</span> options <span class="keyword">like</span> the</span><br><span class="line">       <span class="keyword">timeout</span> <span class="built_in">interval</span>. They have the <span class="keyword">form</span> +keyword=<span class="keyword">value</span>. The <span class="keyword">query</span> options <span class="keyword">are</span>:</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]tcp</span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] TCP <span class="keyword">when</span> querying <span class="keyword">name</span> servers. The <span class="keyword">default</span> behavior <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">use</span> UDP unless an AXFR <span class="keyword">or</span> IXFR <span class="keyword">query</span> <span class="keyword">is</span></span><br><span class="line">           requested, <span class="keyword">in</span> which <span class="keyword">case</span> a TCP <span class="keyword">connection</span> <span class="keyword">is</span> used.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]vc</span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] TCP <span class="keyword">when</span> querying <span class="keyword">name</span> servers. This alternate syntax <span class="keyword">to</span> +[<span class="keyword">no</span>]tcp <span class="keyword">is</span> provided <span class="keyword">for</span> backwards</span><br><span class="line">           <span class="keyword">compatibility</span>. The <span class="string">"vc"</span> stands <span class="keyword">for</span> <span class="string">"virtual circuit"</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">ignore</span></span><br><span class="line">           <span class="keyword">Ignore</span> truncation <span class="keyword">in</span> UDP responses instead <span class="keyword">of</span> retrying <span class="keyword">with</span> TCP. <span class="keyword">By</span> <span class="keyword">default</span>, TCP retries <span class="keyword">are</span> performed.</span><br><span class="line"></span><br><span class="line">       +<span class="keyword">domain</span>=somename</span><br><span class="line">           <span class="keyword">Set</span> the <span class="keyword">search</span> <span class="keyword">list</span> <span class="keyword">to</span> contain the single <span class="keyword">domain</span> somename, <span class="keyword">as</span> <span class="keyword">if</span> specified <span class="keyword">in</span> a <span class="keyword">domain</span> directive <span class="keyword">in</span> /etc/resolv.conf,</span><br><span class="line">           <span class="keyword">and</span> <span class="keyword">enable</span> <span class="keyword">search</span> <span class="keyword">list</span> processing <span class="keyword">as</span> <span class="keyword">if</span> the +<span class="keyword">search</span> <span class="keyword">option</span> were given.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">search</span></span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] the <span class="keyword">search</span> <span class="keyword">list</span> defined <span class="keyword">by</span> the searchlist <span class="keyword">or</span> <span class="keyword">domain</span> directive <span class="keyword">in</span> resolv.conf (<span class="keyword">if</span> <span class="keyword">any</span>). The <span class="keyword">search</span> <span class="keyword">list</span></span><br><span class="line">           <span class="keyword">is</span> <span class="keyword">not</span> used <span class="keyword">by</span> <span class="keyword">default</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]showsearch</span><br><span class="line">           Perform [<span class="keyword">do</span> <span class="keyword">not</span> perform] a <span class="keyword">search</span> showing intermediate results.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]defname</span><br><span class="line">           Deprecated, treated <span class="keyword">as</span> a <span class="keyword">synonym</span> <span class="keyword">for</span> +[<span class="keyword">no</span>]<span class="keyword">search</span></span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]aaonly</span><br><span class="line">           <span class="keyword">Sets</span> the <span class="string">"aa"</span> flag <span class="keyword">in</span> the <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]aaflag</span><br><span class="line">           A <span class="keyword">synonym</span> <span class="keyword">for</span> +[<span class="keyword">no</span>]aaonly.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]adflag</span><br><span class="line">           <span class="keyword">Set</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">set</span>] the AD (authentic <span class="keyword">data</span>) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This requests the <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">return</span> whether all <span class="keyword">of</span> the answer</span><br><span class="line">           <span class="keyword">and</span> authority sections have all been validated <span class="keyword">as</span> secure according <span class="keyword">to</span> the <span class="keyword">security</span> <span class="keyword">policy</span> <span class="keyword">of</span> the <span class="keyword">server</span>. AD=<span class="number">1</span> indicates</span><br><span class="line">           that all <span class="keyword">records</span> have been validated <span class="keyword">as</span> secure <span class="keyword">and</span> the answer <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">from</span> a OPT-<span class="keyword">OUT</span> <span class="keyword">range</span>. AD=<span class="number">0</span> indicate that <span class="keyword">some</span> part</span><br><span class="line">           <span class="keyword">of</span> the answer was insecure <span class="keyword">or</span> <span class="keyword">not</span> validated.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cdflag</span><br><span class="line">           <span class="keyword">Set</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">set</span>] the CD (checking disabled) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This requests the <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">not</span> perform DNSSEC <span class="keyword">validation</span></span><br><span class="line">           <span class="keyword">of</span> responses.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cl</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the <span class="keyword">CLASS</span> <span class="keyword">when</span> printing the <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]ttlid</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the TTL <span class="keyword">when</span> printing the <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]recurse</span><br><span class="line">           Toggle the setting <span class="keyword">of</span> the RD (recursion desired) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This <span class="built_in">bit</span> <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">by</span> <span class="keyword">default</span>, which means dig normally</span><br><span class="line">           sends <span class="keyword">recursive</span> queries. Recursion <span class="keyword">is</span> automatically disabled <span class="keyword">when</span> the +nssearch <span class="keyword">or</span> +<span class="keyword">trace</span> <span class="keyword">query</span> options <span class="keyword">are</span> used.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]nssearch</span><br><span class="line">           <span class="keyword">When</span> this <span class="keyword">option</span> <span class="keyword">is</span> <span class="keyword">set</span>, dig attempts <span class="keyword">to</span> find the authoritative <span class="keyword">name</span> servers <span class="keyword">for</span> the zone containing the <span class="keyword">name</span> being</span><br><span class="line">           looked up <span class="keyword">and</span> display the SOA <span class="built_in">record</span> that <span class="keyword">each</span> <span class="keyword">name</span> <span class="keyword">server</span> has <span class="keyword">for</span> the zone.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">trace</span></span><br><span class="line">           Toggle tracing <span class="keyword">of</span> the delegation <span class="keyword">path</span> <span class="keyword">from</span> the root <span class="keyword">name</span> servers <span class="keyword">for</span> the <span class="keyword">name</span> being looked up. Tracing <span class="keyword">is</span> disabled <span class="keyword">by</span></span><br><span class="line">           <span class="keyword">default</span>. <span class="keyword">When</span> tracing <span class="keyword">is</span> enabled, dig makes iterative queries <span class="keyword">to</span> resolve the <span class="keyword">name</span> being looked up. It will follow</span><br><span class="line">           referrals <span class="keyword">from</span> the root servers, showing the answer <span class="keyword">from</span> <span class="keyword">each</span> <span class="keyword">server</span> that was used <span class="keyword">to</span> resolve the lookup.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cmd</span><br><span class="line">           Toggles the printing <span class="keyword">of</span> the <span class="keyword">initial</span> <span class="keyword">comment</span> <span class="keyword">in</span> the <span class="keyword">output</span> identifying the <span class="keyword">version</span> <span class="keyword">of</span> dig <span class="keyword">and</span> the <span class="keyword">query</span> options that</span><br><span class="line">           have been applied. This <span class="keyword">comment</span> <span class="keyword">is</span> printed <span class="keyword">by</span> <span class="keyword">default</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">short</span></span><br><span class="line">           Provide a terse answer. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print the answer <span class="keyword">in</span> a verbose <span class="keyword">form</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]identify</span><br><span class="line">           <span class="keyword">Show</span> [<span class="keyword">or</span> <span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">show</span>] the IP address <span class="keyword">and</span> port <span class="built_in">number</span> that supplied the answer <span class="keyword">when</span> the +<span class="keyword">short</span> <span class="keyword">option</span> <span class="keyword">is</span> enabled. <span class="keyword">If</span></span><br><span class="line">           <span class="keyword">short</span> <span class="keyword">form</span> answers <span class="keyword">are</span> requested, the <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">to</span> <span class="keyword">show</span> the <span class="keyword">source</span> address <span class="keyword">and</span> port <span class="built_in">number</span> <span class="keyword">of</span> the <span class="keyword">server</span> that</span><br><span class="line">           provided the answer.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]comments</span><br><span class="line">           Toggle the display <span class="keyword">of</span> <span class="keyword">comment</span> <span class="keyword">lines</span> <span class="keyword">in</span> the <span class="keyword">output</span>. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print comments.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]stats</span><br><span class="line">           This <span class="keyword">query</span> <span class="keyword">option</span> toggles the printing <span class="keyword">of</span> <span class="keyword">statistics</span>: <span class="keyword">when</span> the <span class="keyword">query</span> was made, the <span class="keyword">size</span> <span class="keyword">of</span> the reply <span class="keyword">and</span> so <span class="keyword">on</span>. The</span><br><span class="line">           <span class="keyword">default</span> behavior <span class="keyword">is</span> <span class="keyword">to</span> print the <span class="keyword">query</span> <span class="keyword">statistics</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]qr</span><br><span class="line">           Print [<span class="keyword">do</span> <span class="keyword">not</span> print] the <span class="keyword">query</span> <span class="keyword">as</span> it <span class="keyword">is</span> sent. <span class="keyword">By</span> <span class="keyword">default</span>, the <span class="keyword">query</span> <span class="keyword">is</span> <span class="keyword">not</span> printed.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]question</span><br><span class="line">           Print [<span class="keyword">do</span> <span class="keyword">not</span> print] the question <span class="keyword">section</span> <span class="keyword">of</span> a <span class="keyword">query</span> <span class="keyword">when</span> an answer <span class="keyword">is</span> returned. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print the question</span><br><span class="line">           <span class="keyword">section</span> <span class="keyword">as</span> a <span class="keyword">comment</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]answer</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the answer <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]authority</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the authority <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]additional</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the additional <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]all</span><br><span class="line">           <span class="keyword">Set</span> <span class="keyword">or</span> <span class="keyword">clear</span> all display flags.</span><br><span class="line"></span><br><span class="line">       +<span class="keyword">time</span>=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="keyword">timeout</span> <span class="keyword">for</span> a <span class="keyword">query</span> <span class="keyword">to</span> <span class="keyword">T</span> seconds. The <span class="keyword">default</span> <span class="keyword">timeout</span> <span class="keyword">is</span> <span class="number">5</span> seconds. An attempt <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">T</span> <span class="keyword">to</span> <span class="keyword">less</span> <span class="keyword">than</span> <span class="number">1</span> will</span><br><span class="line">           <span class="keyword">result</span> <span class="keyword">in</span> a <span class="keyword">query</span> <span class="keyword">timeout</span> <span class="keyword">of</span> <span class="number">1</span> <span class="keyword">second</span> being applied.</span><br><span class="line"></span><br><span class="line">       +tries=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="built_in">number</span> <span class="keyword">of</span> times <span class="keyword">to</span> try UDP queries <span class="keyword">to</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">T</span> instead <span class="keyword">of</span> the <span class="keyword">default</span>, <span class="number">3.</span> <span class="keyword">If</span> <span class="keyword">T</span> <span class="keyword">is</span> <span class="keyword">less</span> <span class="keyword">than</span> <span class="keyword">or</span> equal <span class="keyword">to</span></span><br><span class="line">           zero, the <span class="built_in">number</span> <span class="keyword">of</span> tries <span class="keyword">is</span> silently rounded up <span class="keyword">to</span> <span class="number">1.</span></span><br><span class="line"></span><br><span class="line">       +retry=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="built_in">number</span> <span class="keyword">of</span> times <span class="keyword">to</span> retry UDP queries <span class="keyword">to</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">T</span> instead <span class="keyword">of</span> the <span class="keyword">default</span>, <span class="number">2.</span> Unlike +tries, this does <span class="keyword">not</span></span><br><span class="line">           <span class="keyword">include</span> the <span class="keyword">initial</span> <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +ndots=<span class="keyword">D</span></span><br><span class="line">           <span class="keyword">Set</span> the <span class="built_in">number</span> <span class="keyword">of</span> dots that have <span class="keyword">to</span> appear <span class="keyword">in</span> <span class="keyword">name</span> <span class="keyword">to</span> <span class="keyword">D</span> <span class="keyword">for</span> it <span class="keyword">to</span> be considered <span class="keyword">absolute</span>. The <span class="keyword">default</span> <span class="keyword">value</span> <span class="keyword">is</span> that</span><br><span class="line">           defined <span class="keyword">using</span> the ndots <span class="keyword">statement</span> <span class="keyword">in</span> /etc/resolv.conf, <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">if</span> <span class="keyword">no</span> ndots <span class="keyword">statement</span> <span class="keyword">is</span> <span class="keyword">present</span>. <span class="keyword">Names</span> <span class="keyword">with</span> fewer dots <span class="keyword">are</span></span><br><span class="line">           interpreted <span class="keyword">as</span> <span class="keyword">relative</span> <span class="keyword">names</span> <span class="keyword">and</span> will be searched <span class="keyword">for</span> <span class="keyword">in</span> the domains listed <span class="keyword">in</span> the <span class="keyword">search</span> <span class="keyword">or</span> <span class="keyword">domain</span> directive <span class="keyword">in</span></span><br><span class="line">           /etc/resolv.conf.</span><br><span class="line"></span><br><span class="line">       +bufsize=B</span><br><span class="line">           <span class="keyword">Set</span> the UDP message buffer <span class="keyword">size</span> advertised <span class="keyword">using</span> EDNS0 <span class="keyword">to</span> B <span class="keyword">bytes</span>. The maximum <span class="keyword">and</span> <span class="keyword">minimum</span> <span class="keyword">sizes</span> <span class="keyword">of</span> this buffer <span class="keyword">are</span></span><br><span class="line">           <span class="number">65535</span> <span class="keyword">and</span> <span class="number">0</span> respectively. <span class="keyword">Values</span> outside this <span class="keyword">range</span> <span class="keyword">are</span> rounded up <span class="keyword">or</span> down appropriately. <span class="keyword">Values</span> other <span class="keyword">than</span> zero will</span><br><span class="line">           cause a EDNS <span class="keyword">query</span> <span class="keyword">to</span> be sent.</span><br><span class="line"></span><br><span class="line">       +edns=#</span><br><span class="line">           Specify the EDNS <span class="keyword">version</span> <span class="keyword">to</span> <span class="keyword">query</span> <span class="keyword">with</span>. Valid <span class="keyword">values</span> <span class="keyword">are</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">255.</span> Setting the EDNS <span class="keyword">version</span> will cause a EDNS <span class="keyword">query</span> <span class="keyword">to</span></span><br><span class="line">           be sent.  +noedns clears the remembered EDNS <span class="keyword">version</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]multiline</span><br><span class="line">           Print <span class="keyword">records</span> <span class="keyword">like</span> the SOA <span class="keyword">records</span> <span class="keyword">in</span> a verbose multi-line <span class="keyword">format</span> <span class="keyword">with</span> human-readable comments. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print</span><br><span class="line">           <span class="keyword">each</span> <span class="built_in">record</span> <span class="keyword">on</span> a single line, <span class="keyword">to</span> facilitate machine parsing <span class="keyword">of</span> the dig <span class="keyword">output</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]onesoa</span><br><span class="line">           Print <span class="keyword">only</span> one (<span class="keyword">starting</span>) SOA <span class="built_in">record</span> <span class="keyword">when</span> performing an AXFR. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print <span class="keyword">both</span> the <span class="keyword">starting</span> <span class="keyword">and</span> ending SOA</span><br><span class="line">           <span class="keyword">records</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]fail</span><br><span class="line">           <span class="keyword">Do</span> <span class="keyword">not</span> try the <span class="keyword">next</span> <span class="keyword">server</span> <span class="keyword">if</span> you receive a SERVFAIL. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> try the <span class="keyword">next</span> <span class="keyword">server</span> which <span class="keyword">is</span> the <span class="keyword">reverse</span> <span class="keyword">of</span></span><br><span class="line">           <span class="keyword">normal</span> stub resolver behavior.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]besteffort</span><br><span class="line">           Attempt <span class="keyword">to</span> display the <span class="keyword">contents</span> <span class="keyword">of</span> messages which <span class="keyword">are</span> malformed. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> display malformed answers.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]dnssec</span><br><span class="line">           Requests DNSSEC <span class="keyword">records</span> be sent <span class="keyword">by</span> setting the DNSSEC OK <span class="built_in">bit</span> (<span class="keyword">DO</span>) <span class="keyword">in</span> the OPT <span class="built_in">record</span> <span class="keyword">in</span> the additional <span class="keyword">section</span> <span class="keyword">of</span> the</span><br><span class="line">           <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]sigchase</span><br><span class="line">           Chase DNSSEC signature chains. Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +trusted-<span class="keyword">key</span>=####</span><br><span class="line">           Specifies a <span class="keyword">file</span> containing trusted <span class="keyword">keys</span> <span class="keyword">to</span> be used <span class="keyword">with</span> +sigchase. <span class="keyword">Each</span> DNSKEY <span class="built_in">record</span> must be <span class="keyword">on</span> its own line.</span><br><span class="line"></span><br><span class="line">           <span class="keyword">If</span> <span class="keyword">not</span> specified, dig will look <span class="keyword">for</span> /etc/trusted-<span class="keyword">key</span>.<span class="keyword">key</span> <span class="keyword">then</span> trusted-<span class="keyword">key</span>.<span class="keyword">key</span> <span class="keyword">in</span> the <span class="keyword">current</span> <span class="keyword">directory</span>.</span><br><span class="line"></span><br><span class="line">           Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]topdown</span><br><span class="line">           <span class="keyword">When</span> chasing DNSSEC signature chains perform a top-down <span class="keyword">validation</span>. Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]nsid</span><br><span class="line">           <span class="keyword">Include</span> an EDNS <span class="keyword">name</span> <span class="keyword">server</span> <span class="keyword">ID</span> request <span class="keyword">when</span> sending a <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">MULTIPLE QUERIES</span><br><span class="line">       The BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig supports specifying multiple queries <span class="keyword">on</span> the command line (<span class="keyword">in</span> addition <span class="keyword">to</span> supporting the -<span class="keyword">f</span></span><br><span class="line">       batch <span class="keyword">file</span> <span class="keyword">option</span>). <span class="keyword">Each</span> <span class="keyword">of</span> those queries can be supplied <span class="keyword">with</span> its own <span class="keyword">set</span> <span class="keyword">of</span> flags, options <span class="keyword">and</span> <span class="keyword">query</span> options.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">In</span> this <span class="keyword">case</span>, <span class="keyword">each</span> <span class="keyword">query</span> argument represent an individual <span class="keyword">query</span> <span class="keyword">in</span> the command-line syntax described above. <span class="keyword">Each</span> consists</span><br><span class="line">       <span class="keyword">of</span> <span class="keyword">any</span> <span class="keyword">of</span> the standard options <span class="keyword">and</span> flags, the <span class="keyword">name</span> <span class="keyword">to</span> be looked up, an optional <span class="keyword">query</span> <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span> <span class="keyword">and</span> <span class="keyword">any</span> <span class="keyword">query</span> options</span><br><span class="line">       that should be applied <span class="keyword">to</span> that <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       A <span class="keyword">global</span> <span class="keyword">set</span> <span class="keyword">of</span> <span class="keyword">query</span> options, which should be applied <span class="keyword">to</span> all queries, can also be supplied. These <span class="keyword">global</span> <span class="keyword">query</span> options</span><br><span class="line">       must precede the <span class="keyword">first</span> tuple <span class="keyword">of</span> <span class="keyword">name</span>, <span class="keyword">class</span>, <span class="keyword">type</span>, options, flags, <span class="keyword">and</span> <span class="keyword">query</span> options supplied <span class="keyword">on</span> the command line. <span class="keyword">Any</span></span><br><span class="line">       <span class="keyword">global</span> <span class="keyword">query</span> options (<span class="keyword">except</span> the +[<span class="keyword">no</span>]cmd <span class="keyword">option</span>) can be overridden <span class="keyword">by</span> a <span class="keyword">query</span>-specific <span class="keyword">set</span> <span class="keyword">of</span> <span class="keyword">query</span> options. <span class="keyword">For</span> example:</span><br><span class="line"></span><br><span class="line">           dig +qr www.isc.org <span class="keyword">any</span> -x <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> isc.org ns +noqr</span><br><span class="line"></span><br><span class="line">       shows how dig could be used <span class="keyword">from</span> the command line <span class="keyword">to</span> make three lookups: an <span class="keyword">ANY</span> <span class="keyword">query</span> <span class="keyword">for</span> www.isc.org, a <span class="keyword">reverse</span> lookup <span class="keyword">of</span></span><br><span class="line">       <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">and</span> a <span class="keyword">query</span> <span class="keyword">for</span> the NS <span class="keyword">records</span> <span class="keyword">of</span> isc.org. A <span class="keyword">global</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">of</span> +qr <span class="keyword">is</span> applied, so that dig shows the <span class="keyword">initial</span></span><br><span class="line">       <span class="keyword">query</span> it made <span class="keyword">for</span> <span class="keyword">each</span> lookup. The <span class="keyword">final</span> <span class="keyword">query</span> has a <span class="keyword">local</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">of</span> +noqr which means that dig will <span class="keyword">not</span> print the</span><br><span class="line">       <span class="keyword">initial</span> <span class="keyword">query</span> <span class="keyword">when</span> it looks up the NS <span class="keyword">records</span> <span class="keyword">for</span> isc.org.</span><br><span class="line"></span><br><span class="line">IDN SUPPORT</span><br><span class="line">       <span class="keyword">If</span> dig has been built <span class="keyword">with</span> IDN (internationalized <span class="keyword">domain</span> <span class="keyword">name</span>) support, it can <span class="keyword">accept</span> <span class="keyword">and</span> display non-<span class="keyword">ASCII</span> <span class="keyword">domain</span> <span class="keyword">names</span>.</span><br><span class="line">       dig appropriately converts <span class="built_in">character</span> <span class="keyword">encoding</span> <span class="keyword">of</span> <span class="keyword">domain</span> <span class="keyword">name</span> <span class="keyword">before</span> sending a request <span class="keyword">to</span> DNS <span class="keyword">server</span> <span class="keyword">or</span> displaying a reply</span><br><span class="line">       <span class="keyword">from</span> the <span class="keyword">server</span>. <span class="keyword">If</span> you<span class="string">'d like to turn off the IDN support for some reason, defines the IDN_DISABLE environment variable.</span><br><span class="line">       The IDN support is disabled if the variable is set when dig runs.</span><br><span class="line"></span><br><span class="line">FILES</span><br><span class="line">       /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">       $&#123;HOME&#125;/.digrc</span><br><span class="line"></span><br><span class="line">SEE ALSO</span><br><span class="line">       host(1), named(8), dnssec-keygen(8), RFC1035.</span><br><span class="line"></span><br><span class="line">BUGS</span><br><span class="line">       There are probably too many query options.</span><br><span class="line"></span><br><span class="line">COPYRIGHT</span><br><span class="line">       Copyright (C) 2004-2010 Internet Systems Consortium, Inc. ("ISC")</span><br><span class="line">       Copyright (C) 2000-2003 Internet Software Consortium.</span></span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+short">dig +short</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +<span class="keyword">short</span>  googlevideo.com</span><br><span class="line"><span class="number">172.217</span><span class="number">.25</span><span class="number">.228</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+nocmd">dig +nocmd</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +nocmd @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> www.google.com</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">51997</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">900</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">274</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">49</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_-q">dig -q</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig -q  www.google.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; -q www.google.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">31256</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">839</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">0</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">33</span>:<span class="number">50</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+tcp">dig +tcp</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="cpp">Lyn-Cheung-MBP:~ Lyn$ dig +tcp www.google.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; +tcp www.google.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">41777</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">744</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">5</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">35</span>:<span class="number">25</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+trace">dig +trace</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +trace @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> gooogle.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; +trace @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> gooogle.com</span><br><span class="line">; (<span class="number">1</span> server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	a.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	b.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	c.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	d.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	e.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	f.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	g.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	h.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	i.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	j.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	k.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	l.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	m.root-servers.net.</span><br><span class="line">;; Received <span class="number">228</span> bytes from <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>) in <span class="number">4778</span> ms</span></span><br><span class="line"></span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	a.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	b.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	c.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	d.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	e.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	f.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	g.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	h.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	i.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	j.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	k.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	l.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	m.gtld-servers.net.</span><br><span class="line">;; Received <span class="number">489</span> bytes from <span class="number">198.97</span><span class="number">.190</span><span class="number">.53</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">198.97</span><span class="number">.190</span><span class="number">.53</span>) in <span class="number">932</span> ms</span></span><br><span class="line"></span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns2.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns1.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns3.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns4.google.com.</span><br><span class="line">;; Received <span class="number">172</span> bytes from <span class="number">192.31</span><span class="number">.80</span><span class="number">.30</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.31</span><span class="number">.80</span><span class="number">.30</span>) in <span class="number">1347</span> ms</span></span><br><span class="line"></span><br><span class="line">gooogle.com.		<span class="number">300</span>	IN	A	<span class="number">216.58</span><span class="number">.203</span><span class="number">.36</span></span><br><span class="line">;; Received <span class="number">45</span> bytes from <span class="number">216.239</span><span class="number">.38</span><span class="number">.10</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">216.239</span><span class="number">.38</span><span class="number">.10</span>) in <span class="number">217</span> ms</span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">53</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
