<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />






  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://blog-lyn.github.io/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e1a1e7f61eef21fbacf4a67a19789441";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/05/nodejs-note-06/" itemprop="url">
                  how to learn Node.js -- organize your code by using require and exports
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-05T18:19:05+08:00" content="2015-11-05">
              2015-11-05
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Require_and_Exports">Require and  Exports</h1><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exports.theAnswerVal = <span class="number">41</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">module</span>.<span class="title">exports</span> =</span> <span class="function"><span class="keyword">function</span> <span class="title">theAnswer</span><span class="params">()</span> &#123;</span> console.<span class="built_in">log</span>(theAnswerVal) &#125;</span><br><span class="line"></span><br><span class="line">exports.theAnswer = <span class="number">43</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handlers= <span class="function"><span class="title">require</span><span class="params">(<span class="string">'./handlers'</span>)</span></span></span><br><span class="line"></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(handlers)</span></span></span><br></pre></td></tr></table></figure>
<p>The result is :[function: theAnswer]</p>
<p>because exports is only a helper to collect exports iterms and trans them to module.exports,</p>
<p>if the module.exports is  defined, then the exports function will be ignored.</p>
<h1 id="Split_codes_into_different_files">Split codes into  different  files</h1><h2 id="first_split_handlers_into_handlers-js">first split handlers into handlers.js</h2><p>handlers.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">exports.home = function home (req, res)&#123;</span><br><span class="line">	//console.log("Hi! I was called at: ", req.originalUrl)</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">\"</span>/<span class="attribute">login</span>\" <span class="attribute">method</span>=<span class="value">\"POST\"</span>&gt;</span><span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">\"username\"</span>&gt;</span>Username<span class="tag">&lt;/<span class="title">label</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">\"username\"</span> <span class="attribute">type</span>=<span class="value">\"text\"</span> <span class="attribute">name</span>=<span class="value">\"username\"</span>&gt;</span><span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">\"submit\"</span>&gt;</span>Start ye adventures!<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">\"</span>/<span class="attribute">images</span>/<span class="attribute">logo.jpg</span>\"&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exports.adventuresIndex =function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave " + req.session.username + " ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exports.createAdventure = function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.updateAdventure = function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.showLoot = function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">exports.login = function login(req, res)&#123;</span><br><span class="line"></span><br><span class="line">	if(req.body.username)&#123;</span><br><span class="line">		console.log(req.body.username);</span><br><span class="line">		req.session.username = req.body.username</span><br><span class="line">	</span><br><span class="line">		res.redirect("/adventures")</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		res.redirect("/")</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> handlers       = <span class="keyword">require</span>(<span class="string">'./handlers.js'</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"> </span><br><span class="line"><span class="comment">//console.log(handlers);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (req.session.username)&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		next()</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</span><br><span class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.get(<span class="string">'/'</span>, handlers.home)</span><br><span class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, handlers.login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>)</span><br><span class="line">	 </span><br><span class="line">	.get(handlers.adventuresIndex)</span><br><span class="line">	.post(handlers.createAdventure)</span><br><span class="line">	.put(handlers.updateAdventure)</span><br><span class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, handlers.showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="keyword">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Second,_split_routes_into_routes-js_file">Second, split routes into  routes.js file</h1><p>routes.js</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">var</span> express       = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"express"</span>)</span></span></span><br><span class="line"><span class="tag">var</span> handlers      = <span class="function"><span class="title">require</span><span class="params">(<span class="string">'./handlers.js'</span>)</span></span></span><br><span class="line"><span class="tag">var</span> indexRouter   =  express.<span class="function"><span class="title">Router</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/'</span>, handlers.home)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/read_from_db'</span>, handlers.readFromDB)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">post</span><span class="params">(<span class="string">'/login'</span>, handlers.login)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">all</span><span class="params">(<span class="string">'*'</span>,  handlers.ensureAuthenticated)</span></span></span><br><span class="line">indexRouter.<span class="function"><span class="title">route</span><span class="params">(<span class="string">'/adventures'</span>)</span></span></span><br><span class="line">	 </span><br><span class="line">	.<span class="function"><span class="title">get</span><span class="params">(handlers.adventuresIndex)</span></span></span><br><span class="line">	.<span class="function"><span class="title">post</span><span class="params">(handlers.createAdventure)</span></span></span><br><span class="line">	.<span class="function"><span class="title">put</span><span class="params">(handlers.updateAdventure)</span></span></span><br><span class="line"></span><br><span class="line">indexRouter.<span class="function"><span class="title">get</span><span class="params">(<span class="string">'/loot/:id'</span>, handlers.showLoot)</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module<span class="class">.exports</span> = indexRouter</span><br></pre></td></tr></table></figure>
<h1 id="Third,_split_middlewares_into_middlewares-js">Third, split middlewares into middlewares.js</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> module.exports = <span class="function"><span class="keyword">function</span><span class="params">(indexRouter)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">	  extended: <span class="keyword">false</span></span><br><span class="line">	&#125;)); </span><br><span class="line">	app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">	app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">	app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">	 </span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">	app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line"></span><br><span class="line">	app.<span class="keyword">use</span>(notFound)</span><br><span class="line">	app.<span class="keyword">use</span>(catchError)</span><br><span class="line">	app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js file </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//var bodyParser     = require('body-parser')</span></span><br><span class="line">	<span class="comment">//var methodOverride = require('method-override')</span></span><br><span class="line">	<span class="comment">//var cookieParser   = require('cookie-parser')</span></span><br><span class="line">	<span class="comment">//var cookieSession  = require('cookie-session') </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"><span class="keyword">var</span> handlers       = <span class="built_in">require</span>(<span class="string">'./handlers.js'</span>)</span><br><span class="line"><span class="keyword">var</span> indexRouter	   = <span class="built_in">require</span>(<span class="string">'./routes.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//middlewares</span></span><br><span class="line"><span class="keyword">var</span> middlewares    = <span class="built_in">require</span>(<span class="string">'./middlewares.js'</span>)</span><br><span class="line">   </span><br><span class="line">    middlewares(indexRouter)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Error">Error</h1><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">throw new <span class="constant">TypeError</span>(<span class="string">'Router.use() requires middleware function but got a '</span> + gettype(fn));</span><br><span class="line">      ^</span><br><span class="line"></span><br><span class="line"><span class="constant">TypeError</span>: <span class="constant">Router</span>.use() requires middleware function but got a undefined</span><br><span class="line">    at <span class="constant">Function</span>.use (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">router</span>/<span class="title">index</span>.<span class="title">js</span>:458:13)</span></span><br><span class="line">    at <span class="constant">EventEmitter</span>.&lt;anonymous&gt; (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:219:21)</span></span><br><span class="line">    at <span class="constant">Array</span>.forEach (native)</span><br><span class="line">    at <span class="constant">EventEmitter</span>.use (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:216:7)</span></span><br><span class="line">    at <span class="class"><span class="keyword">module</span>.<span class="title">exports</span> (/<span class="title">Users</span>/<span class="title">Lyn</span>/<span class="title">src</span>/<span class="title">node</span>/<span class="title">node</span>-05/<span class="title">middlewares</span>.<span class="title">js</span>:45:6)</span></span><br><span class="line">    at <span class="constant">Object</span>.&lt;anonymous&gt; (<span class="regexp">/Users/</span><span class="constant">Lyn</span>/src/node/node-<span class="number">05</span>/index.<span class="symbol">js:</span><span class="number">37</span>:<span class="number">1</span>)</span><br><span class="line">    at <span class="constant">Module</span>._compile (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:435:26)</span></span><br><span class="line">    at <span class="constant">Object</span>.<span class="constant">Module</span>._extensions..js (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:442:10)</span></span><br><span class="line">    at <span class="constant">Module</span>.load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:356:32)</span></span><br><span class="line">    at <span class="constant">Function</span>.<span class="constant">Module</span>._load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:311:12)</span></span><br></pre></td></tr></table></figure>
<p>if you see this error during your programing,</p>
<p>you could check the the location of the middleware and routes handlers.</p>
<p>handlers must be claimed the handlers function before app.use router function,</p>
<p>and the check routes rules as well,</p>
<p>you can try console.log()  to check the  value of routes object.</p>
<p>it should be looks like this:</p>
<pre><code>
{ [<span class="built_in">Function</span>: router]
  params: {},
  _params: [],
  caseSensitive: <span class="literal">undefined</span>,
  mergeParams: <span class="literal">undefined</span>,
  strict: <span class="literal">undefined</span>,
  stack:
   [ Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/read_from_db\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/login\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^(.*)\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/adventures\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^\/loot\/(?:([^\/]+?))\/?$/i</span>,
       route: [<span class="built_in">Object</span>] } ] }
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/05/nodejs-note-05/" itemprop="url">
                  How to learn Node.js -- usages of express.Router(), middleware, cookieParser, cookieSession, create 404 control and catchError function
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-05T15:54:49+08:00" content="2015-11-05">
              2015-11-05
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Concept_of_Middleware_queue">Concept of Middleware queue</h1><h2 id="Custom_middleware">Custom middleware</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span>(<span class="params">req,res,next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="The_middleware_queue">The middleware queue</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Routes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/'</span>, home)</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>) </span><br><span class="line">	.<span class="keyword">get</span>(adventuresIndex)</span><br><span class="line">	.post(createAdventure)</span><br><span class="line">	.put(updateAdventure)</span><br><span class="line">indexRouter.<span class="keyword">get</span>(<span class="string">'/loot/:id'</span>, showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="literal">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br></pre></td></tr></table></figure>
<p> <img src="http://7xnuw0.com1.z0.glb.clouddn.com/15-11-5/52848128.jpg" alt=""></p>
<h1 id="Code">Code</h1><h2 id="dependencies">dependencies</h2><p>  The Package.json file </p>
<pre><code><span class="comment"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-session</span>":<span class="value"><span class="string">"2.0.0-alpha.1"</span></span>,</span><br><span class="line">    "<span class="attribute">cookie-parser</span>":<span class="value"><span class="string">"1.4.0"</span></span><br><span class="line"></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><h2 id="the_index-js_Code">the index.js Code</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">home</span> <span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	<span class="comment">//console.log("Hi! I was called at: ", req.originalUrl)</span></span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;Node Slash&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Browser Game&lt;/h1&gt;&lt;form action=\"/login\" method=\"POST\"&gt;&lt;label for=\"username\"&gt;Username&lt;/label&gt;&lt;input id=\"username\" type=\"text\" name=\"username\"&gt;&lt;button type=\"submit\"&gt;Start ye adventures!&lt;/button&gt;&lt;/form&gt;&lt;img src=\"/images/logo.jpg\"&gt;&lt;a href='/adventures'&gt; Go to adventures &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">adventuresIndex</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Are you brave "</span> + req.session.username + <span class="string">" ?&lt;/h1&gt;&lt;form action='/adventures' method='POST'&gt; &lt;button type='submit'&gt; Yes! i am !&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAdventure</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; So  you are brave!&lt;/h1&gt;&lt;form action='/adventures/?_method=PUT' method='POST'&gt;  &lt;button type='submit'&gt; Cheat &lt;/button&gt;&lt;/form&gt;&lt;form action='/adventures' method='POST'&gt;  &lt;button type='submit'&gt; again !&lt;/button&gt;&lt;p&gt;you have found some &lt;a href='/loot/1'&gt;loot &lt;/a&gt; here&lt;/p&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateAdventure</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;H1&gt;Method override help you to change method from post to put ! &lt;/H1&gt;&lt;p&gt;It's a secret to everybody &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoot</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id = req.params.id</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="string">"&lt;html&gt; &lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;h1&gt; Ogre-slaying knife&lt;/h1&gt;&lt;p&gt; it has 9 orges,  it was"</span> + id + <span class="string">" &lt;/p&gt; &lt;/body&gt;&lt;/html&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(req.body.username)&#123;</span><br><span class="line">		console.log(req.body.username);</span><br><span class="line">		req.session.username = req.body.username</span><br><span class="line">	</span><br><span class="line">		res.redirect(<span class="string">"/adventures"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Middlewares</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</span><br><span class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</span><br><span class="line">     </span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (req.session.username)&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		next()</span><br><span class="line">	&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">		console.log(req.session.username)</span><br><span class="line">		res.redirect(<span class="string">"/"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</span><br><span class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</span><br><span class="line">	next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</span><br><span class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</span><br><span class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</span><br><span class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Routes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> indexRouter  = express.Router()</span><br><span class="line">indexRouter.get(<span class="string">'/'</span>, home)</span><br><span class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</span><br><span class="line">indexRouter.post(<span class="string">'/login'</span>, login)</span><br><span class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</span><br><span class="line">indexRouter.route(<span class="string">'/adventures'</span>) </span><br><span class="line">	.get(adventuresIndex)</span><br><span class="line">	.post(createAdventure)</span><br><span class="line">	.put(updateAdventure)</span><br><span class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></span><br><span class="line">  extended: <span class="keyword">false</span></span><br><span class="line">&#125;)); </span><br><span class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(cookieParser())</span><br><span class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</span><br><span class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</span><br><span class="line">app.<span class="keyword">use</span>(notFound)</span><br><span class="line">app.<span class="keyword">use</span>(catchError)</span><br><span class="line">app.<span class="keyword">use</span>(showErroPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/11/01/nodejs-note-04/" itemprop="url">
                  how to learn node - 05 express with middleware bodyParser, method-override and static
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-11-01T13:57:02+08:00" content="2015-11-01">
              2015-11-01
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Middleware">Middleware</h1><p>Middleware is a function with access to the request object (req), the response object (res), and the next middleware in the application’s request-response cycle, commonly denoted by a variable named next.</p>
<p>Middleware can:</p>
<ul>
<li>Execute any code.</li>
<li>Make changes to the request and the response objects.</li>
<li>End the request-response cycle.</li>
<li>Call the next middleware in the stack.</li>
</ul>
<h2 id="method-Overide">method-Overide</h2><p>Lets you use HTTP verbs such as PUT or DELETE in places where the client doesn’t support it.</p>
<p>this middleware help to catch ‘_method= post’  in the form, so that we can return a different response. </p>
<h3 id="methodOverride(getter,_options)">methodOverride(getter, options)</h3><p>middleware is for requests from clients that only natively support simple verbs like GET and POST,but methodOverride Create a new middleware function to override the req.method property(put, delete or path ) with a new value(like: POST). This value will be pulled from the provided getter.</p>
<p>getter - The getter to use to look up the overridden request method for the request. (default: X-HTTP-Method-Override)<br>options.methods - The allowed methods the original request must be in to check for a method override value. (default: [‘POST’])<br>If the found method is supported by node.js core, then req.method will be set to this value, as if it has originally been that value. The previous req.method value will be stored in req.originalMethod.</p>
<h3 id="getter">getter</h3><p>This is the method of getting the override value from the request. If a function is provided, the req is passed as the first argument, the res as the second argument and the method is expected to be returned. If a string is provided, the string is used to look up the method with the following rules:</p>
<p>If the string starts with X-, then it is treated as the name of a header and that header is used for the method override. If the request contains the same header multiple times, the first occurrence is used.<br>All other strings are treated as a key in the URL query string.<br>options.methods</p>
<p>This allows the specification of what methods(s) the request MUST be in in order to check for the method override value. This defaults to only POST methods, which is the only method the override should arrive in. More methods may be specified here, but it may introduce security issues and cause weird behavior when requests travel through caches. This value is an array of methods in upper-case. null can be specified to allow all methods.</p>
<h2 id="bodyParser">bodyParser</h2><p>var bodyParser = require(‘body-parser’)</p>
<p>The bodyParser object exposes various factories to create middlewares. All middlewares will populate the req.body property with the parsed body or provide an error to the callback.</p>
<h2 id="Serving_static_files_in_Express">Serving static files in Express</h2><p>Serving files, such as images, CSS, JavaScript and other static files is accomplished with the help of a built-in middleware in Express - express.static.</p>
<p>Pass the name of the directory, which is to be marked as the location of static assets, to the express.static middleware to start serving the files directly. For example, if you keep your images, CSS, and JavaScript files in a directory named public, you can do this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">use</span>(express.<span class="keyword">static</span>(<span class="string">'public'</span>));</span><br></pre></td></tr></table></figure>
<h1 id="Example_of_middlewares">Example of middlewares</h1><h2 id="installation_of_middlewares">installation of middlewares</h2><p>we will write the function based on the last browser game express app.</p>
<p>create a  new package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">method-override</span>": <span class="value"><span class="string">"2.3.5"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span>,</span><br><span class="line">    "<span class="attribute">body-parser</span>":<span class="value"><span class="string">"1.14.1"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>and install the dependencies .</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Example_of_using_bodyParser">Example of using bodyParser</h2><p>then we can add a hidden input and cheat button based on last project.</p>
<p>and we can receive the input by using bodyParser middleware.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line">var bodyParser = require('body-parser')</span><br><span class="line">app.use(methodOverride('_method'))</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">//app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<p>We can check the result of console.log<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-03</span> Lyn$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">index</span>.js</span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3000</span>/</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#123; _method: 'input' &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Example_of_methodOverride_middleware">Example of methodOverride middleware</h2><p>We can use  methodOverride to make a put request on adventures path.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var bodyParser     = require('body-parser')</span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line">app.use(methodOverride('_method'));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<h2 id="Example_of_express-static_function">Example of  express.static function</h2><p>We will add one server images on index page by using  express.static function.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">var bodyParser     = require('body-parser')</span><br><span class="line">var methodOverride = require('method-override')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</span><br><span class="line">  extended: true</span><br><span class="line">&#125;)); </span><br><span class="line">app.use(methodOverride('_method'));</span><br><span class="line">app.use(express.static('images'));</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.put("/adventures", updateAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">'/images/hello.png'</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	console.log(req.body);</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures/?_method=PUT'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>" );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="title">H1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/31/nodejs-note-03/" itemprop="url">
                  how to learn Node.js - 03 Express route and params handling
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-31T11:49:21+08:00" content="2015-10-31">
              2015-10-31
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ mkdir <span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span></span><br><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ cd <span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span></span><br><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span> Lyn$ npm init</span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, <span class="operator">and</span> tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help json` for definitive documentation on these fields</span><br><span class="line"><span class="operator">and</span> exactly what they do.</span><br><span class="line"></span><br><span class="line">Use `npm install <span class="tag">&lt;pkg&gt;</span> --save` afterwards to install a package <span class="operator">and</span></span><br><span class="line">save it as a dependency <span class="operator">in</span> the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">name: (<span class="keyword">node</span><span class="identifier"></span><span class="title">-02</span>) expressapp</span><br><span class="line"><span class="operator">version</span>: (<span class="number">1.0</span>.<span class="number">0</span>)</span><br><span class="line">description: first express app</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords:</span><br><span class="line">author: lyn</span><br><span class="line">license: (ISC) MIT</span><br><span class="line">About to <span class="operator">write</span> to /Users/Lyn/src/<span class="keyword">node</span><span class="identifier"></span><span class="title">/node-02</span>/package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"expressapp"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"first express app"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this ok? (yes) yes</span><br></pre></td></tr></table></figure>
<p>config package.json</p>
<p>add the dependency</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"expressapp"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"first express app"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"MIT"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">connect-busboy</span>": <span class="value"><span class="string">"0.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>Then use NPM to  install all the dependency for us </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:node-<span class="number">02</span> Lyn$ npm install --save</span><br><span class="line">npm WARN package.json expressapp@<span class="number">1.0</span><span class="number">.0</span> No repository field.</span><br><span class="line">npm WARN package.json expressapp@<span class="number">1.0</span><span class="number">.0</span> No README data</span><br><span class="line">connect-busboy@<span class="number">0.0</span><span class="number">.2</span> node_modules/connect-busboy</span><br><span class="line">└── busboy@<span class="number">0.2</span><span class="number">.11</span> (readable-stream@<span class="number">1.1</span><span class="number">.13</span>, dicer@<span class="number">0.2</span><span class="number">.3</span>)</span><br><span class="line"></span><br><span class="line">express@<span class="number">4.13</span><span class="number">.3</span> node_modules/express</span><br><span class="line">├── escape-html@<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">├── merge-descriptors@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── cookie@<span class="number">0.1</span><span class="number">.3</span></span><br><span class="line">├── <span class="built_in">array</span>-flatten@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── cookie-signature@<span class="number">1.0</span><span class="number">.6</span></span><br><span class="line">├── methods@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── vary@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── content-type@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── utils-merge@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── etag@<span class="number">1.7</span><span class="number">.0</span></span><br><span class="line">├── content-disposition@<span class="number">0.5</span><span class="number">.0</span></span><br><span class="line">├── path-to-regexp@<span class="number">0.1</span><span class="number">.7</span></span><br><span class="line">├── fresh@<span class="number">0.3</span><span class="number">.0</span></span><br><span class="line">├── serve-<span class="keyword">static</span>@<span class="number">1.10</span><span class="number">.0</span></span><br><span class="line">├── range-parser@<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">├── parseurl@<span class="number">1.3</span><span class="number">.0</span></span><br><span class="line">├── depd@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── qs@<span class="number">4.0</span><span class="number">.0</span></span><br><span class="line">├── debug@<span class="number">2.2</span><span class="number">.0</span> (ms@<span class="number">0.7</span><span class="number">.1</span>)</span><br><span class="line">├── finalhandler@<span class="number">0.4</span><span class="number">.0</span> (unpipe@<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">├── on-finished@<span class="number">2.3</span><span class="number">.0</span> (ee-first@<span class="number">1.1</span><span class="number">.1</span>)</span><br><span class="line">├── proxy-addr@<span class="number">1.0</span><span class="number">.8</span> (forwarded@<span class="number">0.1</span><span class="number">.0</span>, ipaddr.js@<span class="number">1.0</span><span class="number">.1</span>)</span><br><span class="line">├── send@<span class="number">0.13</span><span class="number">.0</span> (destroy@<span class="number">1.0</span><span class="number">.3</span>, statuses@<span class="number">1.2</span><span class="number">.1</span>, ms@<span class="number">0.7</span><span class="number">.1</span>, mime@<span class="number">1.3</span><span class="number">.4</span>, http-errors@<span class="number">1.3</span><span class="number">.1</span>)</span><br><span class="line">├── accepts@<span class="number">1.2</span><span class="number">.13</span> (negotiator@<span class="number">0.5</span><span class="number">.3</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br><span class="line">└── type-is@<span class="number">1.6</span><span class="number">.9</span> (media-typer@<span class="number">0.3</span><span class="number">.0</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br></pre></td></tr></table></figure>
<p>Now our express framework is installed by NPM and we can create index.js !</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span></span><br><span class="line"><span class="pi"></span><br><span class="line">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</span><br><span class="line">	, app    = express()</span><br><span class="line">	, port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>
<p>we can write a  game by  handle get and post request.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">app.get("/", function(req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get("/adventures", function(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.post("/adventures",function(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>
<p>in order to  orgnize our code better,</p>
<p>we can seperate  out route and function into  two parts as follow:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">var  express = require("express")</span><br><span class="line">	  app    = express() </span><br><span class="line">	  port   = process.env['port'] || 3000</span><br><span class="line"></span><br><span class="line">app.get("/", home)</span><br><span class="line">app.get("/adventures", adventuresIndex)</span><br><span class="line">app.post("/adventures", createAdventure)</span><br><span class="line">app.get("/loot/:id", showLoot)</span><br><span class="line"></span><br><span class="line">function home (req, res)&#123;</span><br><span class="line">	res.setHeader("Conetent-Type", 'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function adventuresIndex(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function createAdventure(req, res)&#123;</span><br><span class="line">	res.setHeader("Content-Type",'text/html');</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span><span class="tag">&lt;<span class="title">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">'/adventures'</span> <span class="attribute">method</span>=<span class="value">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span>=<span class="value">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="title">button</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="title">a</span>&gt;</span> here<span class="tag">&lt;/<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">form</span>&gt;</span><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showLoot(req, res)&#123;</span><br><span class="line">	var id = req.params.id</span><br><span class="line">	res.setHeader("Content-Type", 'text/html')</span><br><span class="line">	res.send("<span class="tag">&lt;<span class="title">html</span>&gt;</span> <span class="tag">&lt;<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span> <span class="tag">&lt;<span class="title">body</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="title">p</span>&gt;</span> <span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span>")</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"></span><br><span class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/29/nodejs-note-02/" itemprop="url">
                  how to learn Node.js - 02 how to handle Url request
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-29T21:59:25+08:00" content="2015-10-29">
              2015-10-29
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Simple_fuction_to_response_browser_request_based_on_different_url_request">Simple fuction to response browser request based on different url request</h1><p>based on the last server.js fuction </p>
<p>we can add more features to our server :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</span><br><span class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         res.<span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         res.<span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">          res.<span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>here we defined three different route : home page, marketing page, and 404 page.</p>
<p>when we access to different url we will get different response from our urlHandler server.</p>
<h1 id="Usage_of_req-method">Usage of req.method</h1><p>after we can delivery different content to the browsers,  we could try to handle uploads from browsers! </p>
<p>in this function we use req.method fuction to identify get and post medthond and define different response.  </p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">http.</span>createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="transposed_variable">req.</span>url === <span class="string">'/'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/uploads'</span>)&#123;</span><br><span class="line">         <span class="transposed_variable">console.</span>log(<span class="transposed_variable">req.</span>method)</span><br><span class="line">         <span class="keyword">if</span> (<span class="transposed_variable">req.</span>method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">                <span class="transposed_variable">console.</span>log(<span class="string">'handling the upload request'</span>)</span><br><span class="line">                <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">                <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'handling it'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125;);</span><br><span class="line">         <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;form action="</span>/uploads<span class="string">" method="</span>POST<span class="string">" enctype="</span>multipart/form-data<span class="string">"&gt; &lt;input type="</span>file<span class="string">" name="</span>the_file<span class="string">"&gt;&lt;input type="</span>submit<span class="string">" &gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;'</span>);</span><br><span class="line">             &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="transposed_variable">res.</span>writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">          <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">console.</span>log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>we can see the console log when we refresh and submit uploads page :</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">urlHandler</span>.js</span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</span><br><span class="line">GET</span><br><span class="line">POST</span><br><span class="line">handling the upload request</span><br><span class="line">POST</span><br><span class="line">handling the upload request</span><br></pre></td></tr></table></figure>
<h1 id="catch_the_post_chunk_on_your_server_side">catch the post chunk on your server side</h1><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">http.</span>createServer(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="transposed_variable">req.</span>url === <span class="string">'/'</span>)&#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello world \n'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/marketing'</span>)&#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'hello marketing! \n'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="transposed_variable">req.</span>url === <span class="string">'/uploads'</span>)&#123;</span><br><span class="line">     </span><br><span class="line">     <span class="transposed_variable">console.</span>log(<span class="transposed_variable">req.</span>method)</span><br><span class="line">     <span class="keyword">if</span> (<span class="transposed_variable">req.</span>method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        var upload =<span class="string">''</span></span><br><span class="line">        <span class="transposed_variable">req.</span>on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span><span class="params">(chunk)</span>&#123;</span></span><br><span class="line">            upload += chunk </span><br><span class="line">            <span class="transposed_variable">console.</span>log(<span class="string">"chunk"</span>, chunk)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="transposed_variable">req.</span>on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;</span></span><br><span class="line"></span><br><span class="line">            <span class="transposed_variable">console.</span>log(<span class="string">'handling the upload request is end, the size of upload file is:'</span>, <span class="transposed_variable">upload.</span><span class="built_in">length</span>)</span><br><span class="line">            <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">            <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'upload successfully! \n'</span>);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="transposed_variable">res.</span>writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span> &#125;);</span><br><span class="line">     <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;form action="</span>/uploads<span class="string">" method="</span>POST<span class="string">" enctype="</span>multipart/form-data<span class="string">"&gt; &lt;input type="</span>file<span class="string">" name="</span>the_file<span class="string">"&gt;&lt;input type="</span>submit<span class="string">" &gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;'</span>);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="transposed_variable">res.</span>writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">      <span class="transposed_variable">res.</span><span class="keyword">end</span>(<span class="string">'page not found \n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">console.</span>log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>console log:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:node Lyn$ node urlHandler.js</span><br><span class="line">Server running at http:<span class="comment">//127.0.0.1:1337/</span></span><br><span class="line">POST</span><br><span class="line">chunk &lt;Buffer <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">2</span>d <span class="number">57</span> <span class="number">65</span> <span class="number">62</span> <span class="number">4</span>b <span class="number">69</span> <span class="number">74</span> <span class="number">46</span> <span class="number">6f</span> <span class="number">72</span> <span class="number">6</span>d <span class="number">42</span> <span class="number">6f</span> <span class="number">75</span> <span class="number">6</span>e <span class="number">64</span> <span class="number">61</span> <span class="number">72</span> <span class="number">79</span> <span class="number">53</span> <span class="number">43</span> <span class="number">53</span> <span class="number">41</span> <span class="number">6</span>b <span class="number">41</span> <span class="number">69</span> <span class="number">35</span> <span class="number">55</span> <span class="number">46</span> <span class="number">5</span>a <span class="number">55</span> <span class="number">62</span> <span class="number">46</span> <span class="number">4</span>c <span class="number">43</span> <span class="number">0</span>d <span class="number">0</span>a <span class="number">43</span> <span class="number">6f</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">65</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">2</span>d ... &gt;</span><br><span class="line">handling the upload request is end, the size of upload file is: <span class="number">54976</span></span><br></pre></td></tr></table></figure>
<h1 id="Helper_to_simplize_code:_Express">Helper to simplize code: Express</h1><p>Express is a popular minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications.</p>
<h2 id="install_expres">install expres</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>mkdir myserver</span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>cd myserver</span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>npm init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$ </span>npm install express --save</span><br></pre></td></tr></table></figure>
<p>it will go through  the follow process:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:node Lyn$ mkdir myserver</span><br><span class="line">Lyn-Cheung-MBP:node Lyn$ cd myserver/</span><br><span class="line">Lyn-Cheung-MBP:myserver Lyn$ npm init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, and tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help json` <span class="keyword">for</span> definitive documentation on these fields</span><br><span class="line">and exactly what they <span class="keyword">do</span>.</span><br><span class="line"></span><br><span class="line">Use `npm install &lt;pkg&gt; --save` afterwards to install a package and</span><br><span class="line">save it as a dependency in the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line"></span><br><span class="line">name: (myserver)</span><br><span class="line">version: (<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">description: my simple server</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords: server</span><br><span class="line">author: lyn</span><br><span class="line">license: (ISC)</span><br><span class="line"></span><br><span class="line">About to write to /Users/Lyn/src/node/myserver/package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"myserver"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"my simple server"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"keywords"</span>: [</span><br><span class="line">    <span class="string">"server"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is <span class="keyword">this</span> ok? (yes) yes</span><br><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:myserver Lyn$ npm install express --save</span><br><span class="line"></span><br><span class="line">npm WARN package.json myserver@<span class="number">1.0</span><span class="number">.0</span> No repository field.</span><br><span class="line">npm WARN package.json myserver@<span class="number">1.0</span><span class="number">.0</span> No README data</span><br><span class="line"></span><br><span class="line">express@<span class="number">4.13</span><span class="number">.3</span> node_modules/express</span><br><span class="line">├── escape-html@<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">├── merge-descriptors@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── <span class="built_in">array</span>-flatten@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── cookie@<span class="number">0.1</span><span class="number">.3</span></span><br><span class="line">├── utils-merge@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">├── cookie-signature@<span class="number">1.0</span><span class="number">.6</span></span><br><span class="line">├── methods@<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">├── vary@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── path-to-regexp@<span class="number">0.1</span><span class="number">.7</span></span><br><span class="line">├── content-type@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── range-parser@<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">├── content-disposition@<span class="number">0.5</span><span class="number">.0</span></span><br><span class="line">├── etag@<span class="number">1.7</span><span class="number">.0</span></span><br><span class="line">├── fresh@<span class="number">0.3</span><span class="number">.0</span></span><br><span class="line">├── serve-<span class="keyword">static</span>@<span class="number">1.10</span><span class="number">.0</span></span><br><span class="line">├── parseurl@<span class="number">1.3</span><span class="number">.0</span></span><br><span class="line">├── depd@<span class="number">1.0</span><span class="number">.1</span></span><br><span class="line">├── qs@<span class="number">4.0</span><span class="number">.0</span></span><br><span class="line">├── debug@<span class="number">2.2</span><span class="number">.0</span> (ms@<span class="number">0.7</span><span class="number">.1</span>)</span><br><span class="line">├── finalhandler@<span class="number">0.4</span><span class="number">.0</span> (unpipe@<span class="number">1.0</span><span class="number">.0</span>)</span><br><span class="line">├── on-finished@<span class="number">2.3</span><span class="number">.0</span> (ee-first@<span class="number">1.1</span><span class="number">.1</span>)</span><br><span class="line">├── proxy-addr@<span class="number">1.0</span><span class="number">.8</span> (forwarded@<span class="number">0.1</span><span class="number">.0</span>, ipaddr.js@<span class="number">1.0</span><span class="number">.1</span>)</span><br><span class="line">├── send@<span class="number">0.13</span><span class="number">.0</span> (destroy@<span class="number">1.0</span><span class="number">.3</span>, statuses@<span class="number">1.2</span><span class="number">.1</span>, ms@<span class="number">0.7</span><span class="number">.1</span>, mime@<span class="number">1.3</span><span class="number">.4</span>, http-errors@<span class="number">1.3</span><span class="number">.1</span>)</span><br><span class="line">├── accepts@<span class="number">1.2</span><span class="number">.13</span> (negotiator@<span class="number">0.5</span><span class="number">.3</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br><span class="line">└── type-is@<span class="number">1.6</span><span class="number">.9</span> (media-typer@<span class="number">0.3</span><span class="number">.0</span>, mime-types@<span class="number">2.1</span><span class="number">.7</span>)</span><br></pre></td></tr></table></figure>
<p>now  the express is installed, </p>
<p>as we need use express middlewares busboy to handle upload file infomations,</p>
<p>so  we also install it here first.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:express Lyn$ npm install connect-busboy</span><br><span class="line">connect-busboy@<span class="number">0.0</span><span class="number">.2</span> node_modules/connect-busboy</span><br><span class="line">└── busboy@<span class="number">0.2</span><span class="number">.11</span> (readable-stream@<span class="number">1.1</span><span class="number">.13</span>, dicer@<span class="number">0.2</span><span class="number">.3</span>)</span><br></pre></td></tr></table></figure>
<p>Alternately, we can also define the dependency of our node app in package.json file in advance.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"myserver"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"my simple server"</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">keywords</span>": <span class="value">[</span><br><span class="line">    <span class="string">"server"</span></span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"lyn"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">connect-busboy</span>": <span class="value"><span class="string">"0.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.13.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>Then we can go to edit index.js in myserver folder, to rewrite the Url routing function. </p>
<p>Use Express to write  first  helloworld express app.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span><br><span class="line"> * express</span><br><span class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</span><br><span class="line"> * Copyright(c) 2013 Roman Shtylman</span><br><span class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</span><br><span class="line"> * MIT Licensed</span><br><span class="line"> *  </span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express    = require('./lib/express');</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">app</span>   = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(bodyParser());</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/"</span>, function(req,res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">    res.end(<span class="string">"Hello World! \n"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.listen(1337);</span><br><span class="line"></span><br><span class="line">console.<span class="literal">log</span>(<span class="string">"Server running as http://127.0.0.1:1337"</span>);</span><br></pre></td></tr></table></figure>
<p>after we save the editing, we can run  express app here.</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lyn-Cheung-MBP:express Lyn$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">index</span>.js</span><br><span class="line">Server running as http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span></span><br></pre></td></tr></table></figure>
<p>Check it out in the browser.</p>
<p>then we can create  uploads function in express and use middlewares busboy to upload files,</p>
<p>fs.createWriteStream function help to create upload on the server files folder(need create path first).</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> express    = require('./lib/express');</span><br><span class="line"><span class="keyword">var</span> busboy     = require('connect-busboy');</span><br><span class="line"><span class="keyword">var</span> fs         = require('fs');</span><br><span class="line">         <span class="keyword">app</span>   = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(busboy());</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/"</span>, function(req,res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">    res.end(<span class="string">"Hello World! \n"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/marketing"</span>, function(req, res)&#123;</span><br><span class="line">    res.send(<span class="string">"this is marketing dept."</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="literal">get</span>(<span class="string">"/uploads"</span>, function(req, res)&#123;</span><br><span class="line">    res.setHeader(<span class="string">"Content-Type"</span>, 'text/html');</span><br><span class="line">    res.end('&lt;html&gt;&lt;head&gt;&lt;title&gt;upload <span class="keyword">program</span> &lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;<span class="keyword">form</span> action=<span class="string">"/uploads"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; &lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"file"</span> name=<span class="string">"the_file"</span>&gt;&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"submit"</span> &gt; &lt;/<span class="keyword">form</span>&gt; &lt;/body&gt; &lt;/html&gt;');</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.<span class="keyword">post</span>(<span class="string">"/uploads"</span>, function(req, res)&#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">var</span> fstream;</span><br><span class="line">    req.pipe(req.busboy);</span><br><span class="line">    req.busboy.<span class="keyword">on</span>('<span class="keyword">file</span>', function (fieldname, <span class="keyword">file</span>, filename) &#123;</span><br><span class="line">        console.<span class="literal">log</span>(<span class="string">"Uploading: "</span> + filename); </span><br><span class="line">        fstream = fs.createWriteStream(__dirname + '/files/' + filename);</span><br><span class="line">        <span class="keyword">file</span>.pipe(fstream);</span><br><span class="line">        fstream.<span class="keyword">on</span>('<span class="keyword">close</span>', function () &#123;</span><br><span class="line">            res.redirect('back');</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span>.listen(1337);</span><br><span class="line"></span><br><span class="line">console.<span class="literal">log</span>(<span class="string">"Server running as http://127.0.0.1:1337"</span>);</span><br></pre></td></tr></table></figure>
<p>then we can run the express app to upload file to the server </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-<span class="string">MBP:</span>express Lyn$ node index.js</span><br><span class="line">Server running <span class="keyword">as</span> <span class="string">http:</span><span class="comment">//127.0.0.1:1337</span></span><br><span class="line"><span class="string">Uploading:</span> no_image.png</span><br></pre></td></tr></table></figure>
<p>Now we can see the file we submit  in our  express/files folder !</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/28/hellowordnodejs/" itemprop="url">
                  How to learn Node.js - 01 hello world !
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-28T00:40:11+08:00" content="2015-10-28">
              2015-10-28
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Try_Node-js_in_Read-Eval-Print_Loop_mode_first">Try Node.js in Read-Eval-Print Loop mode first</h1><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> Lyn-Cheung-MBP:node Lyn$ node</span><br><span class="line">&gt; <span class="number">50</span>+<span class="number">50</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line">&gt; console</span><br><span class="line">Console &#123;</span><br><span class="line">  <span class="built_in">log</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  info: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  warn: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  <span class="built_in">error</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  dir: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  time: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  timeEnd: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  trace: [<span class="function"><span class="keyword">Function</span>:</span> bound trace],</span><br><span class="line">  assert: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</span><br><span class="line">  Console: [<span class="function"><span class="keyword">Function</span>:</span> Console] &#125;</span><br><span class="line">&gt; console.<span class="built_in">log</span>(<span class="string">"hello REPL"</span>)</span><br><span class="line">hello REPL</span><br><span class="line">undefined</span><br><span class="line">&gt; var foo = <span class="string">"toy!"</span></span><br><span class="line">undefined</span><br><span class="line">&gt; foo</span><br><span class="line"><span class="comment">'toy!'</span></span><br><span class="line">&gt;</span><br><span class="line">(^C again <span class="keyword">to</span> quit)</span><br><span class="line">&gt;</span><br><span class="line">Lyn-Cheung-MBP:node Lyn$</span><br></pre></td></tr></table></figure>
<h1 id="Run_Node-js_code_in_files">Run Node.js code in files</h1><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="keyword">server</span>.js</span><br></pre></td></tr></table></figure>
<p>Then enter insert mode to write your code </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</span><br><span class="line">                res.end(<span class="string">'hello world \n'</span>);</span><br><span class="line">&#125;).listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>then Save this file in VIM by type “w” </p>
<p>after this, we can run Node.js file in another iTerm terminal(press command + shift + d)</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="identifier"> </span><span class="title">Lyn</span>$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">hello</span>.js                  </span><br><span class="line"></span><br><span class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</span><br></pre></td></tr></table></figure>
<p>then you can access to this server in your browser by <a href="http://127.0.0.1:1337/" target="_blank" rel="external">http://127.0.0.1:1337/</a> </p>
<p>req = request<br>res = responde</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> http =<span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line">	, handler =<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">		res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</span><br><span class="line">		res.end(<span class="string">'Hello World\n'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	, sever = http.createServer(handler)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<p>here is  a clear way  to explain the relation  between http (Node.js moduel), createServer (moduel function) and handler (the parameters of createServer)</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/26/vagrant_gfw_errors/" itemprop="url">
                  How to modify puphpet file to avoid vagrant up errors
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-10-26T16:46:25+08:00" content="2015-10-26">
              2015-10-26
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Error_code_when_run_vagrant_up:">Error code when run vagrant up:</h1><p>recently when I want to use vagrant to build PHP environment on my Mac,<br>I got three Errors :</p>
<ol>
<li><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">error:</span> <span class="regexp">/Stage[main]/</span><span class="string">Supervisord:</span>:Pip<span class="regexp">/Exec[install_setuptools]/</span><span class="string">returns:</span> change from notrun to <span class="number">0</span> <span class="string">failed:</span> Command exceeded timeout</span><br><span class="line"><span class="string">Warning:</span> <span class="regexp">/Stage[main]/</span><span class="string">Supervisord:</span>:Reload/Exec[supervisorctl_update]: Skipping because of failed dependencies</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: While executing gem ... (Gem::RemoteFetcher::FetchError) ==&gt; <span class="keyword">default</span>: SSL_connect SYSCALL returned=<span class="number">5</span> errno=<span class="number">0</span> <span class="keyword">state</span>=<span class="literal">unknown</span> <span class="keyword">state</span> (https://rubygems.<span class="keyword">global</span>.ssl.fastly.net/<span class="keyword">quick</span>/Marshal.<span class="number">4.8</span>/deep_merge-<span class="number">1.0</span>.<span class="number">1</span>.gemspec.rz)</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: <span class="string">"false"</span> <span class="keyword">is</span> <span class="keyword">not</span> a <span class="type">boolean</span>. It looks <span class="keyword">to</span> be a String <span class="keyword">at</span> /tmp/vagrant-puppet/modules-b7f682531389374ec63e7be34e57b9e6/nginx/manifests/resource/location.pp:<span class="number">198</span> <span class="function_start"><span class="keyword">on</span></span> node <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>After investgating,I found the  root cause of the first two is  the same. The network between Mac and the ruby/pip servers is blocked by China GFW(as I am using Chinatelecom broadband).</p>
<p>Therefore, I have to introduce China domestic ruby and pip sources to puphprt configuraions as followed:</p>
<h1 id="Walkaround:">Walkaround:</h1><p>##Replce config.yaml nginx config </p>
<p>the syntax should be :</p>
<p>internal: off or internal :”false”</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">locations:</span><br><span class="line">                nxvl_6x40k3ysb0yt:</span><br><span class="line">                    location: /</span><br><span class="line">                    autoindex: <span class="string">'off'</span></span><br><span class="line">                    internal: off</span><br><span class="line">                    try_files:</span><br><span class="line">                        - <span class="variable">$uri</span></span><br><span class="line">                        - <span class="variable">$uri</span>/</span><br><span class="line">                        - /index.php<span class="variable">$is</span>_args<span class="variable">$args</span></span><br><span class="line">                    fastcgi: <span class="string">''</span></span><br><span class="line">                    fastcgi_index: <span class="string">''</span></span><br><span class="line">                    fastcgi_split_path: <span class="string">''</span></span><br><span class="line">                nxvl_6punkjmd4tp3:</span><br><span class="line">                    location: <span class="string">'~ \.php$'</span></span><br><span class="line">                    autoindex: <span class="string">'off'</span></span><br><span class="line">                    internal: off</span><br><span class="line">                    try_files:</span><br><span class="line">                        - <span class="variable">$uri</span></span><br><span class="line">                        - <span class="variable">$uri</span>/</span><br><span class="line">                        - /index.php<span class="variable">$is</span>_args<span class="variable">$args</span></span><br><span class="line">                    fastcgi: <span class="string">'127.0.0.1:9000'</span></span><br><span class="line">                    fastcgi_index: index.php</span><br><span class="line">                    fastcgi_split_path: <span class="string">'^(.+\.php)(/.*)$'</span></span><br><span class="line">                    fast_cgi_params_extra:</span><br><span class="line">                        - <span class="string">'SCRIPT_FILENAME $request_filename'</span></span><br><span class="line">                        - <span class="string">'APP_ENV dev'</span></span><br></pre></td></tr></table></figure>
<h2 id="Replace_gem_sources_in_initial-setup-sh">Replace gem sources in initial-setup.sh</h2><p>gem sources –remove <a href="https://rubygems.org/" target="_blank" rel="external">https://rubygems.org/</a><br>gem sources -a <a href="http://ruby.taobao.org/" target="_blank" rel="external">http://ruby.taobao.org/</a></p>
<h2 id="Add_douban_pypi_source_in_puphpet/manifests/python/pip-pp">Add douban pypi source in  puphpet/manifests/python/pip.pp</h2><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class puphpet::python::pip &#123;</span><br><span class="line"></span><br><span class="line">  Exec &#123; path =&gt; [ <span class="string">'/usr/bin/'</span>, <span class="string">'/usr/local/bin'</span>, <span class="string">'/bin'</span>, <span class="string">'/usr/local/sbin'</span>, <span class="string">'/usr/sbin'</span>, <span class="string">'/sbin'</span> ] &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$url</span> = <span class="string">'https://bootstrap.pypa.io/ez_setup.py'</span></span><br><span class="line">  <span class="variable">$download</span>_location = <span class="string">'/.puphpet-stuff/ez_setup.py'</span></span><br><span class="line"></span><br><span class="line">  exec &#123; <span class="string">"Download and install ez_setup"</span>:</span><br><span class="line">    creates =&gt; <span class="variable">$download</span>_location,</span><br><span class="line">    command =&gt; <span class="string">"wget $&#123;url&#125; -O $&#123;download_location&#125; &amp;&amp; \</span><br><span class="line">                python $&#123;download_location&#125;"</span>,</span><br><span class="line">    timeout =&gt; <span class="number">30</span>,</span><br><span class="line">    path    =&gt; <span class="string">'/usr/bin'</span></span><br><span class="line">  &#125;</span><br><span class="line">  -&gt; exec &#123; <span class="string">'easy_install pip -i http://pypi.douban.com/simple '</span>:</span><br><span class="line">    unless =&gt; <span class="string">'which pip'</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if $::osfamily == <span class="string">'RedHat'</span> &#123;</span><br><span class="line">    exec &#123; <span class="string">'rhel pip_provider_name_fix'</span>:</span><br><span class="line">      command   =&gt; <span class="string">'alternatives --install /usr/bin/pip-python pip-python /usr/bin/pip 1'</span>,</span><br><span class="line">      subscribe =&gt; Exec[<span class="string">'easy_install pip'</span>],</span><br><span class="line">      unless    =&gt; <span class="string">'which pip-python'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hope these help :D</p>
<p>if there is any mistake,please contact me to update! </p>
<p>thank you</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/03/05/hello-world/" itemprop="url">
                  My first blog post launched with my new blog
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-03-05T16:46:25+08:00" content="2015-03-05">
              2015-03-05
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Finally I launched my personal blog after years of delay.</p>
<h1 id="why?">why?</h1><p>Sereral years ago when I was opreating some websites in compus,</p>
<p>I was thinking to launch my personal blog someday in the future,</p>
<p>however after the social websites developing  these years, my most time was comsumed on Weibo.com(Chinese twiter) and Weixin.</p>
<p>but after time as the social network in China is no longer as popular as it used to be(as be regulated heavily by Gov) and I think a place can be used to recording my ideas as part of my knowledge bases is realy useful.</p>
<p>Now, here we go, a wholly new blog, afetr I compared hexo, ghost blog, Jekyll, I finanly chose ghost blog to launch my blog. because nodejs now is really hot in github. secondly, Ghost blog  can be edited on smartphone. I spend some time to rewrite theme files. I will keep adding new features on this current version.</p>
<p>meanwhile I chose to host ghostblog on my VPS to keep updating my server opreating skills.</p>
<h1 id="Wishes_for_the_future">Wishes for the future</h1><p>I hope this blog would become a dual-lingual blog.</p>
<p>so that I could get in touch with people around the world. </p>
<p>hope I could have a  nice time here and  write and update my posts as much as possible. </p>
<p>Looking forward that I could meet some friends who share mutral intrests and values. </p>
<p>any good advise is highly welcomed, please feel free to contact me :D</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
