<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://lyn.s76.org/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e1a1e7f61eef21fbacf4a67a19789441";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/11/react-js-01/" itemprop="url">
                  react.js-Notes-01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-11T22:08:32+08:00" content="2016-05-11">
              2016-05-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/11/react-js-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/11/react-js-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="config_before_development">config before development</h1><h2 id="npm">npm</h2><p>use command to initialize your package.json file </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init <span class="operator">-f</span></span><br></pre></td></tr></table></figure>
<p>my npm package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"Test"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">dev</span>": <span class="value"><span class="string">"webpack-dev-server --content-base src  --inline --hot"</span></span>,</span><br><span class="line">    "<span class="attribute">lint</span>": <span class="value"><span class="string">"eslint js"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-plugin-add-module-exports</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-react-html-attrs</span>": <span class="value"><span class="string">"^2.0.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-class-properties</span>": <span class="value"><span class="string">"^6.3.13"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-decorators-legacy</span>": <span class="value"><span class="string">"^1.3.4"</span></span>,</span><br><span class="line">    "<span class="attribute">react</span>": <span class="value"><span class="string">"^15.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">react-dom</span>": <span class="value"><span class="string">"^15.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack</span>": <span class="value"><span class="string">"^1.13.0"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">devDependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-core</span>": <span class="value"><span class="string">"^6.7.7"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-eslint</span>": <span class="value"><span class="string">"^6.0.4"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-loader</span>": <span class="value"><span class="string">"^6.2.4"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-es2015</span>": <span class="value"><span class="string">"^6.6.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-react</span>": <span class="value"><span class="string">"^6.5.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-stage-0</span>": <span class="value"><span class="string">"^6.5.0"</span></span>,</span><br><span class="line">    "<span class="attribute">eslint</span>": <span class="value"><span class="string">"^2.9.0"</span></span>,</span><br><span class="line">    "<span class="attribute">eslint-plugin-react</span>": <span class="value"><span class="string">"^5.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack-dev-server</span>": <span class="value"><span class="string">"^1.14.1"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>after you edit your package.json file, you can run npm install to install all the dependencies automatically</p>
<h2 id="webpack">webpack</h2><p>after all the packages is  installled.</p>
<p>we can config webpack by create webpack.config.js file under your project path.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debug   = process.env.NODE_ENV !==<span class="string">"production"</span>;</span><br><span class="line"><span class="keyword">var</span> webpack =<span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports=</span>&#123;</span><br><span class="line">	context: __dirname+<span class="string">"/src"</span>,</span><br><span class="line">	devtool: debug ? <span class="string">"inline-sourcemap"</span> : <span class="literal">null</span>,</span><br><span class="line">	entry:<span class="string">"./js/scripts.js"</span>,</span><br><span class="line">	output:&#123;</span><br><span class="line">		path: __dirname +<span class="string">"/src"</span>,</span><br><span class="line">		filename:<span class="string">"scripts.min.js"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	devServer:&#123;</span><br><span class="line">		inline:<span class="literal">true</span>,</span><br><span class="line">		port:<span class="number">1336</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="module"><span class="keyword">module</span>:</span>&#123;</span><br><span class="line">		loaders:[</span><br><span class="line">		&#123;</span><br><span class="line">			test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">			exclude:<span class="regexp">/node_modules|bower_components/</span>,</span><br><span class="line">			loader:<span class="string">'babel-loader'</span>,</span><br><span class="line">			query:&#123;</span><br><span class="line">				presets:[<span class="string">'es2015'</span>,<span class="string">'react'</span>,<span class="string">'stage-0'</span>],</span><br><span class="line">				plugins:[<span class="string">'react-html-attrs'</span>,<span class="string">'transform-class-properties'</span>, <span class="string">'transform-decorators-legacy'</span>]</span><br><span class="line">			&#125;</span><br><span class="line">		 &#125;,</span><br><span class="line">	    ]</span><br><span class="line">	&#125;,</span><br><span class="line">	plugins: debug ? []:[</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.DedupePlugin(),</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123; mangle:<span class="literal">false</span>, sourcemap:<span class="literal">false</span>&#125;),</span><br><span class="line">	],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="eslint">eslint</h2><p>as jshint doesnot support react.js very well,<br>I replace jshint with eslint.<br>you can also install eslint sublime plugin to help you check your code in Sublime.</p>
<p>install eslint locally in your project folder (you must have package.json file there):</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> eslint</span><br></pre></td></tr></table></figure>
<p>Init eslint config if you don’t have any. Run in your code folder:</p>
<!--if eslint is installed locally-->
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./node_modules/.bin/eslint <span class="comment">--init</span></span><br></pre></td></tr></table></figure>
<p>To install via Package Control, do the following:</p>
<ol>
<li><p>Within Sublime Text, bring up the Command Palette and type install. Among the commands you should see Package Control: Install Package. If that command is not highlighted, use the keyboard or mouse to select it. There will be a pause of a few seconds while Package Control fetches the list of available plugins.</p>
</li>
<li><p>When the plugin list appears, type eslint. Among the entries you should see SublimeLinter-contrib-eslint. If that entry is not highlighted, use the keyboard or mouse to select it.</p>
</li>
</ol>
<p>my .eslintrc config file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">env</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">browser</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">        "<span class="attribute">node</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">        "<span class="attribute">es6</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">extends</span>": <span class="value"><span class="string">"eslint:recommended"</span></span>,</span><br><span class="line">    "<span class="attribute">parser</span>": <span class="value"><span class="string">"babel-eslint"</span></span>,</span><br><span class="line">    "<span class="attribute">ecmaFeatures</span>": <span class="value">&#123;</span><br><span class="line">       "<span class="attribute">jsx</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">rules</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">semi</span>": <span class="value">[<span class="number">2</span>, <span class="string">"always"</span>]</span><br><span class="line">    </span>&#125;</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        <span class="string">"react"</span></span><br><span class="line">    ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="your_first_react-js_component">your first react.js component</h1><h2 id="Folder_Structure">Folder Structure</h2><p> Lyn-Cheung-MBP:01 Lyn$ find . -print | sed -e ‘s;[^/]*/;|<strong><strong>;g;s;</strong></strong>|; `|;g’</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|<span class="string">____package.json</span><br><span class="line"></span>|____src</span><br><span class="line">|<span class="string"> </span>|<span class="string">____index.html</span><br><span class="line"></span>|<span class="string"> </span>|____js</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|____components</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Footer.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|____Header</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Title.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Header.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Layout.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____scripts.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____scripts.min.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string">____scripts.min.js</span><br><span class="line"></span>|<span class="string">____webpack.config.js</span></span><br></pre></td></tr></table></figure>
<h2 id="Code_files">Code files</h2><p>index.html is very simple:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span>Some page <span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"app"</span>&gt;</span> <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">script</span>  <span class="attribute">src</span>=<span class="value">"./scripts.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>scripts.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"./components/Layout"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app =<span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="title">Layout</span>/&gt;</span>, app);</span></span><br></pre></td></tr></table></figure>
<p>Layout.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Header</span> from <span class="string">"./Header"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Footer</span> from <span class="string">"./Footer"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line"> 	 constructor()&#123;</span><br><span class="line"> 	 	<span class="keyword">super</span>();</span><br><span class="line"> 	 	<span class="keyword">this</span>.state=&#123;</span><br><span class="line"> 	 		title:<span class="string">"Welcome"</span>,</span><br><span class="line"> 	 	&#125;</span><br><span class="line"> 	 &#125;</span><br><span class="line"> 	 changeTitle(title)&#123;</span><br><span class="line"> 	 	<span class="keyword">this</span>.setState(&#123;title&#125;);</span><br><span class="line"> 	 &#125;</span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;<span class="type">Header</span> changeTitle=&#123;<span class="keyword">this</span>.changeTitle.bind(<span class="keyword">this</span>)&#125; title=&#123;<span class="keyword">this</span>.state.title&#125; /&gt;</span><br><span class="line">				&lt;<span class="type">Footer</span> /&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Header.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Title</span> from <span class="string">"./Header/Title"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	 handleChange(e)&#123;</span><br><span class="line">	 	const title =e.target.value;</span><br><span class="line">	 	<span class="keyword">this</span>.props.changeTitle(title);</span><br><span class="line">	 &#125;</span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;<span class="type">Title</span>  title=&#123;<span class="keyword">this</span>.props.title&#125; /&gt;</span><br><span class="line">				&lt;input value=&#123;<span class="keyword">this</span>.props.title&#125;  onChange=&#123;<span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>)&#125;  /&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Title.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	 </span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;h1&gt; &#123;<span class="keyword">this</span>.props.title&#125;&lt;/h1&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Footer.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Footer</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;footer&gt; <span class="type">This</span> is <span class="type">Footer</span> &lt;/footer&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Run_your_react-js_on_your_local_sever">Run your react.js on your local sever</h2><p>simply use these commands:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br><span class="line"></span><br><span class="line">npm <span class="command">run</span> dev</span><br></pre></td></tr></table></figure>
<p>then you can visit your first react.js project on your browser by:<br><a href="http://127.0.0.1:1336/" target="_blank" rel="external">http://127.0.0.1:1336/</a> </p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/04/22/css/" itemprop="url">
                  css权重优先级问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-22T11:58:01+08:00" content="2016-04-22">
              2016-04-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/22/css/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/22/css/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>CSS的选择器是有权重的，当不同选择器的样式设置有冲突时，会采用权重高的选择器设置样式。<br>权重（即优先级）的规则如下，权重越高，优先级越高：<br>  同一个元素可以使用多个规则来指定它的同一样式（比如字体颜色），每个规则都有自己的选择器。显然最终只有一个规则起作用（不可能一个字既是红色又是绿色），那么该规则的特殊性最高，特殊性即css优先级。<br> 很多人仅仅知道选择器优先级：ID&gt;class&gt;元素选择器，而不知道ID的优先级为什么大于class的优先级。</p>
<h1 id="那么css优先级到底是怎么计算的呢？">那么css优先级到底是怎么计算的呢？</h1><p>选择器的特殊性值表述为4个部分，用0,0,0,0表示：<br> 行间样式，加1,0,0,0.<br> ID选择器的特殊性值，加0,1,0,0。<br> 类选择器、属性选择器或伪类，加0,0,1,0。<br> 元素和伪元素，加0,0,0,1。<br> 通配选择器*对特殊性没有贡献，即0,0,0,0。</p>
<p> 最后比较特殊的一个标志!important（权重），它没有特殊性值，但它的优先级是最高的，为了方便记忆，可以认为它的特殊性值为1,0,0,0,0。<br> 选择器特殊性值是从左向右排序的，特殊性值1,0,0,0大于以0开头的所有特殊性值，即便它是0,99,99,99，优先级依然比1,0,0,0要低。</p>
<p>  很多人都知道a标签有四种状态：链接访问前、链接访问后、鼠标滑过、激活，分别对应四种伪类:link、:visited、:hover、:active，并且这四个伪类如果对同一个元素设置同一个属性，那它们的声明顺序还有一定要求，一般大家都遵循“爱恨原则LVHA”（LoVe HAte），为什么是这个顺序？不能是其它顺序吗？<br>  根据css优先级计算规则，伪类的特殊性值是0,0,1,0，4个伪类的特殊性值相同，那么后面声明的规则优先级高。当鼠标滑过a链接时，满足:link和:hover两个伪类，要改变a标签的颜色，就必须将:hover伪类在:link伪类后面声明；同理，当鼠标点击激活a链接时，同时满足:link、:hover、:active三种状态，要显示a标签激活时的样式（:active），必须将:active声明放到:link和:hover之后。因此得出LVHA这个顺序。这个顺序能不能变？可以，但也只有:link和:visited可以交换位置，因为一个链接要么访问过要么没访问过，不可能同时满足，也就不存在覆盖的问题。</p>
<h1 id="简单的理解方式:">简单的理解方式:</h1><p>标签选择器、伪类及伪对象：优先积分1<br>类选择器、属性选择器：优先积分10<br>ID选择器：优先积分100<br>其他选择器（通配符等）：0<br>根据以上优先积分，统计样式表中出现的每个选择器的个数，再相加，最终得出的分数就是某个选择器的优先级别。</p>
<p>例如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">p</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="tag">p</span><span class="class">.myColor</span> = <span class="number">1</span>+<span class="number">10</span> = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="class">.myColor</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="id">#myColor</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure></p>
<p>再次说明：!important关键字 &gt; style属性 &gt; 以上选择器</p>
<blockquote>
<p>前面提到!important属性，!important是用来使IE6和IE7、IE8、火狐(Firefox)、google等浏览器做兼容的，但IE6不能执行!important。当 !important 规则被应用在一个样式声明中时,该样式声明会覆盖CSS中任何其他的声明, 无论它处在声明列表中的哪个位置. 尽管如此, !important规则还是与优先级毫无关系.使用 !important不是一个好习惯，因为它改变了你样式表本来的级联规则，从而难以调试。</p>
</blockquote>
<h1 id="在使用!important时需要注意：">在使用!important时需要注意：</h1><p>Never 永远不要在全站范围的 css 上使用 !important<br>Only 只在需要覆盖全站或外部 css（例如引用的 ExtJs 或者YUI ）的特定页面中使用  !important<br>Never 永远不要在你的插件中使用 !important<br>Always 要优化考虑使用样式规则的优先级来解决问题而不是 !important<br>什么时候应该使用：</p>
<h2 id="A)_一种情况">A) 一种情况</h2><p>  你的网站上有一个设定了全站样式的CSS文件，同时你（或是你同事）写了一些效果通常都是很差的行内样式（行内样式的优先级是最高的）。在这种情况下，你就可以在你全局的CSS文件中写一些!important的样式来覆盖掉那些直接写在元素上的行内样式。</p>
<h2 id="B)_另一种情况">B) 另一种情况</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="id">#someElement</span> <span class="tag">p</span> <span class="rules">&#123;  </span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> blue</span></span>;  </span><br><span class="line">&#125;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">p</span><span class="class">.awesome</span> <span class="rules">&#123;  </span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> red</span></span>;  </span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>  在外层有 #someElement 的情况下，你怎样能使 awesome 的段落变成红色呢？这种情况下，如果不使用!important，第一条规则永远比第二条的优先级更高。</p>
<h2 id="怎样覆盖掉_!important：">怎样覆盖掉 !important：</h2><p>很简单，你只需要再加一条!important 的CSS语句，将其应用到更高优先级的选择器（在原有基础上添加额外的标签、class或id选择器）上；或是保持选择器一样，但添加的位置需要在原有声明的后面（优先级相同的情况下，后边定义的会覆盖前边定义的）。<br>[html] view plain copy print?</p>
<p>#test.a{<br>  color: red !important;     <!--尽管这条声明在前，但是仍会覆盖下边的样式--><br>}<br>a{<br>  color: green !important;<br>}<br>或：<br>[html] view plain copy print?<br>a{<br>  color: green !important;<br>}<br>a{<br>  color: red !important;     <!--同样的选择器，后边的声明会覆盖前边的--><br>}  </p>
<h1 id="link:">link:</h1><p><a href="http://blog.csdn.net/lzgs_4/article/details/43446303" target="_blank" rel="external">http://blog.csdn.net/lzgs_4/article/details/43446303</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/04/17/css-media/" itemprop="url">
                  Responsive Web Design
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-17T22:52:20+08:00" content="2016-04-17">
              2016-04-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/17/css-media/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/17/css-media/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="允许网页宽度自动调整">允许网页宽度自动调整</h1><p>“自适应网页设计” 到底是怎么做到的？ </p>
<p>首先，在网页代码的头部，加入一行viewport元标签。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>width 控制Viewport的宽度,可以指定一个值或者设备的宽度,如device-width为设备的宽度(单位为设备缩放比例1:1的像素),上面代码里设置的宽度是取设备宽度;</p>
<p> initial-scale 原始缩放比例（initial-scale=1）为1.0，即网页初始大小占屏幕面积的100%, 对应的值是一个浮点值,页面呈现大小等于设置原始的宽度乘以initial-scale的值;</p>
<p> maximum-scale 最大缩放,即允许用户缩放的最大比例,也是乘积关系.一般设置为1:1的比例不会让用户缩放的;</p>
<p> minimum-scale 最小缩放,如上;</p>
<p> user-scalable 用户是否可以手动缩放,一般值设为no,不允许用户缩放;</p>
</blockquote>
<p>这段代码的大意是让viewport的物理宽度等于设备的分辨率,不允许用户缩放.原始缩放比例（initial-scale=1）为1.0，即网页初始大小占屏幕面积的100%,所有主流浏览器都支持这个设置，包括IE9。</p>
<h2 id="meta_viewport标签动态改变的方法">meta viewport标签动态改变的方法</h2><h3 id="第一种方法:">第一种方法:</h3><p>可以使用document.write来动态输出meta viewport标签，例如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.<span class="command">write</span>('&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width,initial-scale=1"</span>&gt;')</span><br></pre></td></tr></table></figure>
<h3 id="第二种方法:">第二种方法:</h3><p>通过setAttribute来改变</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">id</span>=<span class="value">"testViewport"</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width = 380"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> mvp = <span class="built_in">document</span>.getElementById(<span class="string">'testViewport'</span>);</span><br><span class="line">mvp.setAttribute(<span class="string">'content'</span>,<span class="string">'width=480'</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="CSS_@Media查询">CSS @Media查询</h1><p>引用MDN的描述:</p>
<blockquote>
<p> 媒体查询 包含了一个媒体类型和至少一个使用如宽度、高度和颜色等媒体属性来限制样式表范围的表达式。CSS3加入的媒体查询使得无需修改内容便可以使样式应用于某些特定的设备范围。<br>媒体查询包含了一个媒体类型 和如CSS3规范中描述的包含一个或多个表达式的媒体属性，这些媒体属性会被解析成真或假。如果媒体查询中的媒体类型与文档要展示的设备相符则查询结果为真，并且媒体查询中的所有表达式为真。</p>
<h2 id="在stylesheet_Link_选择加载制定的CSS">在stylesheet Link 选择加载制定的CSS</h2></blockquote>
<p>“自适应网页设计”的核心，就是CSS3引入的Media Query模块。<br>它的意思就是，自动探测屏幕宽度，然后加载相应的CSS文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- link元素中的CSS媒体查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"(max-width: 800px)"</span> <span class="attribute">href</span>=<span class="value">"example.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的代码意思是，如果屏幕宽度不超过800像素（max-width: 800px），就加载example.css文件。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text/css"</span> media=<span class="string">"screen and (min-width: 400px) and (max-device-width: 600px)"</span> href=<span class="string">"smallScreen.css"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>如果屏幕宽度在400像素到600像素之间，则加载smallScreen.css文件。<br>除了用html标签加载CSS文件，还可以在现有CSS文件中使用@import来实现加载。<br>但是并不推荐这样做.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="constant">@import</span> url(<span class="string">"tinyScreen.css"</span>) screen <span class="literal">and</span> (<span class="built_in">max</span>-device-width: <span class="number">400</span>px)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>当媒体查询为真时，相关的样式表或样式规则就会按照正常的级联规则被应用。即使媒体查询返回假， <link> 标签上带有媒体查询的样式表 仍将被下载 （只不过不会被应用）。</p>
<h2 id="在CSS文件内使用@media规则加载不同的CSS">在CSS文件内使用@media规则加载不同的CSS</h2><p>同一个CSS文件中，也可以根据不同的屏幕分辨率，选择应用不同的CSS规则。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="at_rule">@<span class="keyword">media</span> screen and (max-device-width: <span class="number">400px</span>) </span>&#123;</span><br><span class="line">　　　　<span class="class">.column</span> <span class="rules">&#123;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">float</span>:<span class="value"> none</span></span>;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">width</span>:<span class="value">auto</span></span>;</span><br><span class="line">　　　　&#125;</span></span><br><span class="line">　　　　<span class="id">#sidebar</span> <span class="rules">&#123;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">display</span>:<span class="value">none</span></span>;</span><br><span class="line">　　　　&#125;</span></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码意思是，如果屏幕宽度小于400像素，<br>则column块取消浮动（float:none）、宽度自动调节（width:auto），sidebar块不显示（display:none）。</p>
<h2 id="媒体属性">媒体属性</h2><p><em>引用自 MDN</em></p>
<h3 id="媒体查询所有可用的查询方法以及属性">媒体查询所有可用的查询方法以及属性</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">media_query: [[only |<span class="string"> not]? &lt;media_type&gt; [ and &lt;expression&gt; ]*]</span><br><span class="line">  </span>|<span class="string"> &lt;expression&gt; [ and &lt;expression&gt; ]*</span><br><span class="line">expression: ( &lt;media_feature&gt; [: &lt;value&gt;]? )</span><br><span class="line"></span><br><span class="line">&lt;!-- 在不使用 not 或 only 操作符的情况下，媒体类型(media type)是可选的，如果没有设置则默认为 all 。 --&gt;</span><br><span class="line"></span><br><span class="line">media_type: all </span>|<span class="string"> aural </span>|<span class="string"> braille </span>|<span class="string"> handheld </span>|<span class="string"> print </span>|</span><br><span class="line">  projection |<span class="string"> screen </span>|<span class="string"> tty </span>|<span class="string"> tv </span>|<span class="string"> embossed</span><br><span class="line"></span><br><span class="line">media_feature: width </span>|<span class="string"> min-width </span>|<span class="string"> max-width</span><br><span class="line">  </span>|<span class="string"> height </span>|<span class="string"> min-height </span>|<span class="string"> max-height</span><br><span class="line">  </span>|<span class="string"> device-width </span>|<span class="string"> min-device-width </span>|<span class="string"> max-device-width</span><br><span class="line">  </span>|<span class="string"> device-height </span>|<span class="string"> min-device-height </span>|<span class="string"> max-device-height</span><br><span class="line">  </span>|<span class="string"> aspect-ratio </span>|<span class="string"> min-aspect-ratio </span>|<span class="string"> max-aspect-ratio</span><br><span class="line">  </span>|<span class="string"> device-aspect-ratio </span>|<span class="string"> min-device-aspect-ratio </span>|<span class="string"> max-device-aspect-ratio</span><br><span class="line">  </span>|<span class="string"> color </span>|<span class="string"> min-color </span>|<span class="string"> max-color</span><br><span class="line">  </span>|<span class="string"> color-index </span>|<span class="string"> min-color-index </span>|<span class="string"> max-color-index</span><br><span class="line">  </span>|<span class="string"> monochrome </span>|<span class="string"> min-monochrome </span>|<span class="string"> max-monochrome</span><br><span class="line">  </span>|<span class="string"> resolution </span>|<span class="string"> min-resolution </span>|<span class="string"> max-resolution</span><br><span class="line">  </span>|<span class="string"> scan </span>|<span class="string"> grid</span></span><br></pre></td></tr></table></figure>
<p>大多数媒体属性带有“min-”和“max-”前缀，用于表达“小于等于”和“大于等于”。这避免了使用与HTML和XML冲突的“&lt;”和“&gt;”字符。如果你未向媒体属性指定一个值，并且该特性的实际值不为零，则该表达式被解析为真。</p>
<p>注意：如果浏览器运行的设备上没有该属性值，包含这个属性值的表达式一般返回假。例如，在语音合成器上查询屏幕长宽比总是返回假。</p>
<h3 id="颜色（color）">颜色（color）</h3><p>指定输出设备每个像素单元的比特值。如果设备不支持输出颜色，则该值为0。\</p>
<p>值： <color><br>媒体： visual<br>是否接受 min/max 前缀：是</color></p>
<p>注意：如果每个颜色单元具有不同数量的比特值，则使用最小的。例如，如果显示器为蓝色和红色提供5比特，而为绿色提供6比特，则认为每个颜色单元有5比特。如果设备使用索引颜色，则使用颜色表中颜色单元的最小比特数。</p>
<h4 id="示例">示例</h4><p>向所有能显示颜色的设备应用样式表：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@media</span> <span class="function">all <span class="title">and</span> <span class="params">(color)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>向每个颜色单元至少有4个比特的设备应用样式表：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> all <span class="literal">and</span> (<span class="built_in">min</span>-color: <span class="number">4</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h3 id="颜色索引（color-index）">颜色索引（color-index）</h3><p>指定了输出设备中颜色查询表中的条目数量。</p>
<p>值：<integer><br>媒体： visual<br>是否接受 min/max 前缀：是</integer></p>
<h4 id="示例-1">示例</h4><p>向所有使用索引颜色的设备应用样式表，你可以这么做：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@media</span> all <span class="keyword">and</span> (color-<span class="keyword">index</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>向所有使用至少256个索引颜色的设备应用样式表：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"all and (min-color-index: 256)"</span> <span class="attribute">href</span>=<span class="value">"http://foo.bar.com/stylesheet.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="宽高比（aspect-ratio）">宽高比（aspect-ratio）</h3><p>描述了输出设备目标显示区域的宽高比。该值包含两个以“/”分隔的正整数。代表了水平像素数（第一个值）与垂直像素数（第二个值）的比例。</p>
<p>值：<ratio><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</ratio></p>
<h4 id="示例-2">示例</h4><p>下面为显示区域宽高至少为一比一的设备选择了一个特殊的样式表。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-aspect-ratio: <span class="number">1</span>/<span class="number">1</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>这指定了宽高比或者1：1或者更大。换句话说，可视区域或者是正方形或者是宽屏。</p>
<h3 id="设备宽高比（device-aspect-ratio）">设备宽高比（device-aspect-ratio）</h3><p>描述了输出设备的宽高比。该值包含两个以“/”分隔的正整数。代表了水平像素数（第一个值）与垂直像素数（第二个值）的比例。</p>
<p>值：<ratio><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</ratio></p>
<h4 id="示例-3">示例</h4><p>下面为宽屏设备选择了一个特殊的样式表。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> screen and (<span class="attribute">device-aspect-ratio</span>: <span class="number">16</span>/<span class="number">9</span>), screen and (<span class="attribute">device-aspect-ratio</span>: <span class="number">16</span>/<span class="number">10</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>宽高比或者16：9或者16：10。</p>
<h3 id="设备高度（device-height）">设备高度（device-height）</h3><p>描述了输出设备的高度（整个屏幕或页的高度，而不是仅仅像文档窗口一样的渲染区域）。</p>
<p>值：<length><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<h4 id="示例-4">示例</h4><p>向显示在最大宽度800px的屏幕上的文档应用样式表，你可以这样做：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"screen and (max-device-width: 799px)"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="设备宽度（device-width）">设备宽度（device-width）</h3><p>描述了输出设备的宽度（整个屏幕或页的高度，而不是仅仅像文档窗口一样的渲染区域）。</p>
<p>值：<length><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<h3 id="网格（grid）">网格（grid）</h3><p>判断输出设备是网格设备还是位图设备。如果设备是基于网格的（例如电传打字机终端或只能显示一种字形的电话），该值为1，否则为0。</p>
<p>值：<integer><br>媒体：all<br>是否接受 min/max 前缀： 否</integer></p>
<h4 id="示例-5">示例</h4><p>向一个15字符宽度或更窄的手持设备应用样式：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> handheld <span class="literal">and</span> (grid) <span class="literal">and</span> (<span class="built_in">max</span>-width: <span class="number">15</span>em) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>注意：“em” 在网格设备中有不同的意义；一个“em”的实际宽度不得而知，假设1em相当于一个网格单元的宽高。</p>
<h3 id="高度（height）">高度（height）</h3><p>height 媒体属性描述了输出设备渲染区域（如可视区域的高度或打印机纸盒的高度）的高度。</p>
<p>值：<length><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<p>注意：用户调整窗口大小后，火狐浏览器会根据使用了width和height属性的媒体查询来切换合适的样式表。</p>
<h3 id="方向（orientation）">方向（orientation）</h3><p>指定了设备处于横屏（宽度大于宽度）模式还是竖屏（高度大于宽度）模式。</p>
<p>值：landscape | portrait<br>媒体：visual<br>是否接受 min/max 前缀：否</p>
<h4 id="示例-6">示例</h4><p>向竖屏设备应用样式表：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> all and (<span class="attribute">orientation</span>: portrait) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h3 id="分辨率（resolution）">分辨率（resolution）</h3><p>指定输出设备的分辨率（像素密度）。分辨率可以用每英寸（dpi）或每厘米（dpcm）的点数来表示。</p>
<p>值： <resolution><br>媒体： bitmap<br>是否接受 min/max 前缀：是</resolution></p>
<h4 id="示例-7">示例</h4><p>为每英寸至多300点的打印机应用样式：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> print <span class="literal">and</span> (<span class="built_in">min</span>-resolution: <span class="number">300</span>dpi) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>替换老旧的 (min-device-pixel-ratio: 2) 语法：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-resolution: <span class="number">2</span>dppx) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="扫描（scan）">扫描（scan）</h3><p>描述了电视输出设备的扫描过程。</p>
<p>值： progressive | interlace<br>媒体：tv<br>是否接受 min/max 前缀：否</p>
<p>示例</p>
<p>向以顺序方式扫描的电视机上应用样式表：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> tv and (<span class="attribute">scan</span>: progressive) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="宽度（width）">宽度（width）</h3><p>width 媒体属性描述了输出设备渲染区域（如可视区域的宽度或打印机纸盒的宽度）的宽度。</p>
<p>值： <length><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<p>注意：用户调整窗口大小后，火狐浏览器会根据使用了width和height属性的媒体查询来切换合适的样式表。<br>示例</p>
<p>如果你想向最小宽度20em的手持设备或屏幕应用样式表，你可以使用这样的查询：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> handheld <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">20</span>em), screen <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">20</span>em) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>这个媒体查询将向最小宽度8.5英寸的打印机应用样式表：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"print and (min-width: 8.5in)"</span></span><br><span class="line">    <span class="attribute">href</span>=<span class="value">"http://foo.com/mystyle.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个查询适用于宽度在500px和800px之间的屏幕：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">500</span>px) <span class="literal">and</span> (<span class="built_in">max</span>-width: <span class="number">800</span>px) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h2 id="更多的例子">更多的例子</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (max-width: <span class="number">1000px</span>) and (min-width: <span class="number">700px</span>) </span>&#123;</span><br><span class="line">    <span class="tag">ul</span> <span class="tag">li</span> <span class="tag">a</span><span class="pseudo">:before</span> <span class="rules">&#123;</span><br><span class="line">        <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">"Email: "</span></span></span>;</span><br><span class="line">        <span class="rule"><span class="attribute">font-style</span>:<span class="value"> italic</span></span>;</span><br><span class="line">        <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666666</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的这段代码的意思是:当屏幕的宽度是在700到1000之间的时候,我们会在Email连接之前用Css 添加一个Email的文字以及设置斜体和颜色.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* For mobile phones: */</span></span><br><span class="line"><span class="attr_selector">[class*="col-"]</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> only screen and (min-width: <span class="number">768px</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* For desktop: */</span></span><br><span class="line">    <span class="class">.col-1</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">8.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-2</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">16.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-3</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">25%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-4</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">33.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-5</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">41.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-6</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">50%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-7</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">58.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-8</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">66.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-9</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">75%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-10</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">83.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-11</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">91.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-12</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的这段代码的意思是: 默认情况下是为手机做的宽度适配(即所有的宽度都是100%),当只有屏幕的宽度大于768像素的时候,才会单独给各个col设置宽度的值. </p>
<h1 id="当页面为自适应页面时,实现图片自适应的奇妙的解决方法:">当页面为自适应页面时,实现图片自适应的奇妙的解决方法:</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML: --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"image-container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"xxx.png"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- CSS: --&gt;</span></span><br><span class="line">p.image-container &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 0;</span><br><span class="line">  padding-bottom: 60%;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p.image-container img &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="思路:">思路:</h2><p><em>原作者: zihua-li</em></p>
<blockquote>
<p>需求:在保持 item 元素宽高比恒定（如高是宽的 1.618 倍）的情况下，使得 item 元素可以和父元素同比缩放。 </p>
</blockquote>
<p>我们知道，如果当 item 元素是图片，同时需要保持的宽高比恰好为图片本身的宽高比时，<br>可以设置 item 的 height 为 auto 即可轻松实现这个需求。<br>然而当 item 元素不是图片或者要保持的宽高比和图片本身的宽高比不同时，这个需求显得很难直接用 CSS 实现。<br>为此我放弃 CSS，直接用 JavaScript 绑定 window 的 onresize 事件来动态获取每个 item 的宽度，从而计算并设置其高度。<br>我一直在使用这个解决方案，直到今天调整样式时，突然想到这个需求竟然是可以只使用 CSS 解决的。<br>首先需要知道，一个元素的 padding，如果值是一个百分比，那这个百分比是相对于其父元素的宽度而言的，即使对于 padding-bottom 和 padding-top 也是如此。<br>另外，在计算 Overflow 时，是将元素的内容区域（即 width / height 对应的区域）和 Padding 区域一起计算的。换句话说，即使将元素的 overflow 设置为 hidden，“溢出”到 Padding 区域的内容也会照常显示。<br>综上两条所述，我们可以使用 padding-bottom 来代替 height 来实现高度与宽度成比例的效果。因为 item 元素的宽度是其父元素宽度的 21%，所以我们将 padding-bottom 设置为它的 1.618 倍，即 33.98%。同时将其 height 设置为 0 以使元素的“高度”等于 padding-bottom 的值，从而实现需要的效果。<br>最后 item 元素的 CSS 样式为：</p>
<p>.item {<br>  float: left;<br>  margin: 10px 5%;<br>  padding-bottom: 33.98%;<br>  width: 21%;<br>  height: 0;<br>}<br>页面效果见 <a href="http://jsfiddle.net/luin/25BbH/7/，拖动窗口调整页面宽度，item" target="_blank" rel="external">http://jsfiddle.net/luin/25BbH/7/，拖动窗口调整页面宽度，item</a> 元素始终保持恒定的宽高比。</p>
<h1 id="兼容情况:">兼容情况:</h1><h2 id="@media_screen_属性的浏览器支持情况">@media screen 属性的浏览器支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-17/99373677.jpg" alt=""></p>
<h2 id="@media_width_属性浏览器的支持情况">@media width 属性浏览器的支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-17/7417540.jpg" alt=""></p>
<h2 id="@Media_Queries支持情况">@Media Queries支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-18/50675002.jpg" alt=""></p>
<h1 id="Ref:">Ref:</h1><p><a href="http://www.ruanyifeng.com/blog/2012/05/responsive_web_design.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/05/responsive_web_design.html</a> -阮一峰<br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media#Examples" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/CSS/@media#Examples</a> -MDN<br><a href="http://zihua.li/2013/12/keep-height-relevant-to-width-using-css/" target="_blank" rel="external">http://zihua.li/2013/12/keep-height-relevant-to-width-using-css/</a> -zihuali</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/04/10/js-single-thread-concepts/" itemprop="url">
                  JavaScript的单线程运行机制笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-10T23:17:24+08:00" content="2016-04-10">
              2016-04-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/10/js-single-thread-concepts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/10/js-single-thread-concepts/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="javascript_是单线程运行的么?">javascript 是单线程运行的么?</h1><p>JavaScript引擎是单线程运行的,浏览器无论在什么时候都只且只有一个线程在运行JavaScript程序。 </p>
<blockquote>
<p>为什么JavaScript不能有多个线程呢？这样能提高效率啊！</p>
<p>JavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</p>
<p>所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。</p>
<p>为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。</p>
</blockquote>
<h2 id="代码验证：js是单线程运行的">代码验证：js是单线程运行的</h2><p>下面的代码，当while执行时候，setTimeout永远不会执行。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isEnd = <span class="literal">true</span>;</span><br><span class="line">     <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">         isEnd = <span class="literal">false</span>;<span class="comment">//1s后，改变isEnd的值</span></span><br><span class="line">     &#125;, <span class="number">1000</span>);</span><br><span class="line">     <span class="comment">//这个while永远的占用了js线程，所以setTimeout里面的函数永远不会执行</span></span><br><span class="line">     <span class="keyword">while</span> (isEnd);</span><br><span class="line">     <span class="comment">//alert也永远不会弹出</span></span><br><span class="line">     alert(<span class="string">'end'</span>);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'开始运行js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func01</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'function 1 正在运行'</span>);</span><br><span class="line">	<span class="keyword">return</span> func02();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func02</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'function 2 正在运行'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'mainJs 开始运行'</span>);</span><br><span class="line">	  func01();</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'mainJs 运行结束'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'js运行结束'</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">开始运行js</span><br><span class="line">mainJs 开始运行</span><br><span class="line"><span class="function"><span class="keyword">function</span></span> <span class="number">1</span> 正在运行</span><br><span class="line"><span class="function"><span class="keyword">function</span></span> <span class="number">2</span> 正在运行</span><br><span class="line">mainJs 运行结束</span><br><span class="line">js运行结束</span><br></pre></td></tr></table></figure>
<h1 id="执行栈的队列">执行栈的队列</h1><blockquote>
<p>单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。<br>如果排队是因为计算量大，CPU忙不过来，倒也算了，但是很多时候CPU是闲着的，因为IO设备（输入输出设备）很慢（比如Ajax操作从网络读取数据），不得不等着结果出来，再往下执行。</p>
<p>JavaScript语言的设计者意识到，这时主线程完全可以不管IO设备，挂起处于等待中的任务，先运行排在后面的任务。等到IO设备返回了结果，再回过头，把挂起的任务继续执行下去。</p>
<p>于是，所有任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）。同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入”任务队列”（task queue）的任务，只有”任务队列”通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。<br>具体来说，异步执行的运行机制如下。（同步执行也是如此，因为它可以被视为没有异步任务的异步执行。）</p>
</blockquote>
<p>Ps：</p>
<ol>
<li>执行栈队列是fist in  last out 的数据结构。</li>
<li>回调函数队列是firtst in first out 的数据结构。</li>
</ol>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-10/32375570.jpg" alt=""></p>
<p>运行时的流程图应该是这样：</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-11/59788839.jpg" alt=""></p>
<blockquote>
<ol>
<li>所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。</li>
<li>主线程之外，还存在一个”任务队列”（task queue）。只要异步任务有了运行结果，就在”任务队列”之中放置一个事件。</li>
<li>一旦”执行栈”中的所有同步任务执行完毕，系统就会读取”任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</li>
<li>主线程不断重复上面的第三步。</li>
</ol>
</blockquote>
<p>Ps: Promise，mutation，observer的回调函数属于特殊的任务会在当前的eventLoop末尾执行，而普通任务则是在下一次获取任务队列后运行。</p>
<h2 id="验证回调函数会进入回调函数队列等待执行栈空闲后再调用：">验证回调函数会进入回调函数队列等待执行栈空闲后再调用：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'01 开始运行js'</span>);</span><br><span class="line"></span><br><span class="line">setTimeout( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'02 , 我从eventloop 中被加到了回调函数队列等待运行 等待stack空闲了以后才会调用我'</span>);</span><br><span class="line">&#125;,<span class="number">5000</span> );</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'03, 这个写在setTimeout 后面'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'现在stack 队列里是空的, 因为没有定义返回值所以会返回 undefined  '</span>);</span><br></pre></td></tr></table></figure>
<h2 id="运行结果：">运行结果：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span> 开始运行js</span><br><span class="line"><span class="number">03</span>, 这个写在setTimeout 后面</span><br><span class="line">现在<span class="built_in">stack</span> 队列里是空的, 因为没有定义返回值所以会返回 undefined </span><br><span class="line">undefined</span><br><span class="line"><span class="number">02</span> , 我从eventloop 中被加到了回调函数队列等待运行 等待<span class="built_in">stack</span>空闲了以后才会调用我</span><br></pre></td></tr></table></figure>
<h1 id="回调函数队列与事件循环机制:">回调函数队列与事件循环机制:</h1><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-10/97771921.jpg" alt=""></p>
<blockquote>
<p>浏览器的内核是多线程的，它们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：JavaScript引擎线程，GUI渲染线程，浏览器事件触发线程（图中的WebAPIs）。 </p>
<p>JavaScript引擎是基于事件驱动单线程执行的，JavaScript引擎一直等待着任务队列中任务的到来，然后加以处理，浏览器无论什么时候都只有一个JavaScript线程在运行JavaScript程序。 </p>
<p>GUI渲染线程负责渲染浏览器界面，当界面需要重绘（Repaint）或由于某种操作引发回流(Reflow)时,该线程就会执行。但需要注意，GUI渲染线程与JavaScript引擎是互斥的，当JavaScript引擎执行时GUI线程会被挂起，GUI更新会被保存在一个队列中等到JavaScript引擎空闲时立即被执行。<br>事件触发线程，当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JavaScript引擎的处理。这些事件可来自JavaScript引擎当前执行的代码块如setTimeout、也可来自浏览器内核的其他线程如鼠标点击、Ajax异步请求等，但由于JavaScript的单线程关系所有这些事件都得排队等待JavaScript引擎处理（当线程中没有执行任何同步代码的前提下才会执行异步代码）。 </p>
</blockquote>
<h1 id="用for循环堵塞执行栈来测试事件被添加到eventLoop的时机">用for循环堵塞执行栈来测试事件被添加到eventLoop的时机</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'1 js 开始运行'</span>); </span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">&#125;, <span class="number">10</span>);  </span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;  <span class="built_in">console</span>.time(<span class="string">'loopCost'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i ++) &#123;  </span><br><span class="line">    sum += i;  </span><br><span class="line">&#125;   </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'for 循环结果：'</span>,sum);  </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'loopCost'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="运行结果：-1">运行结果：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> js 开始运行</span><br><span class="line"><span class="number">4950</span></span><br><span class="line">loopCost: <span class="number">0.298</span>ms</span><br><span class="line"></span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<p>因为b和c的等待时间是0，所以第一时间被加入到回调事件的队尾等待主函数空闲时再进行调用.<br>而a事件则需要等待10ms以后才被加入回调事件队列的队尾等待调用.</p>
<h1 id="增加for循环运行时间">增加for循环运行时间</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'1 js 开始运行'</span>); </span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">&#125;, <span class="number">10</span>);  </span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;  <span class="built_in">console</span>.time(<span class="string">'loopCost'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i ++) &#123;  </span><br><span class="line">    sum += i;  </span><br><span class="line">&#125;   </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'for 循环结果：'</span>,sum);  </span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'loopCost'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="运行结果：-2">运行结果：</h2><p>当for循环的运行时间超过10ms的情况下,当for 循环完成的时候, a的回调函数会比c的回调函数先触发,然后被加入回调函数等待队列里,等待事件循环取出执行。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> js 开始运行</span><br><span class="line"><span class="keyword">for</span> 循环结果： <span class="number">49995000</span></span><br><span class="line">loopCost: <span class="number">13.285ms</span></span><br><span class="line"> <span class="tag">b</span></span><br><span class="line"> <span class="tag">a</span></span><br><span class="line"> c</span><br></pre></td></tr></table></figure>
<h1 id="浏览器异步请求数量的验证">浏览器异步请求数量的验证</h1><p>通过上面的验证,我们得知js是单线程运行的,那浏览器的辅助线程对js的异步请求有限制么?<br>最大支持同时发起多少个请求呢?</p>
<p>通过查找资料可以得知:</p>
<blockquote>
<p>浏览器与同一服务器的连接数最大值有限制，即Chrome和Firefox为6，IE为12。<br>在Firefox的“about:config”页面下找到如下图的配置项（network.http.max-persistent-connections-per-server）</p>
</blockquote>
<p>但还是通过代码来验证最靠谱:.<br>下面我们来进行验证:</p>
<h2 id="代码验证:">代码验证:</h2><h3 id="HTML以及Ajax_请求页面:">HTML以及Ajax 请求页面:</h3><p>html页面在点击事件触发时会同时发起20个AJAX异步请求.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"requestNum"</span>&gt;</span>请求数：<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"requestNum"</span> <span class="attribute">value</span>=<span class="value">"20"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">"startRequest()"</span>&gt;</span>开始请求<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="built_in">window</span>.XMLHttpRequest();</span><br><span class="line">    <span class="comment">//console.log(config.url);</span></span><br><span class="line">    xhr.open(<span class="string">"GET"</span>, config.url, <span class="literal">true</span> );</span><br><span class="line">    xhr.send(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> num = ~~requestNum.value;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; num; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">        ajax(&#123;</span><br><span class="line">            url: <span class="string">"http://127.0.0.1:1337/?="</span> + i</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Node-js_服务器端的代码">Node.js 服务器端的代码</h3><p>这里我们创建了一个Http 服务器,在接收到请求以后设置一个timeout,在一秒以后才结束返回请求.<br>并且会在接收到请求的同时,记录下时间.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="keyword">var</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第 次接收到请求 时间是 ：'</span>,startTime);</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">        <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>,</span><br><span class="line">        <span class="string">'charset'</span>: <span class="string">'utf8'</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.end(<span class="built_in">String</span>(+<span class="keyword">new</span> <span class="built_in">Date</span>));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">   </span><br><span class="line">&#125;).listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="运行结果:">运行结果:</h3><p>监控发起的网络请求时间:</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-17/48064341.jpg" alt=""></p>
<p>服务器端的log日志:<br>我们可以看得出来在同一时间节点,请求都是6个为一组接收到的.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/?=<span class="number">0</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">1</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">2</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">3</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">4</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">5</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">05</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">6</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">7</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">8</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">9</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">10</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">11</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">06</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">12</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">13</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">14</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">15</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">16</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">17</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">07</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">18</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">08</span> GMT+<span class="number">0800</span> (CST)</span><br><span class="line">/?=<span class="number">19</span></span><br><span class="line">这次接收到请求 时间是 ： Sun Apr <span class="number">17</span> <span class="number">2016</span> <span class="number">22</span>:<span class="number">29</span>:<span class="number">08</span> GMT+<span class="number">0800</span> (CST)</span><br></pre></td></tr></table></figure></p>
<p>参考链接：<br><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2014/10/event-loop.html</a> －阮一峰</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/03/14/nodeJs-iOnic-Config/" itemprop="url">
                  iOnic Cordova Mac下的开发环境部署
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-03-14T13:53:17+08:00" content="2016-03-14">
              2016-03-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/14/nodeJs-iOnic-Config/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/14/nodeJs-iOnic-Config/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Install_Node-js">Install Node.js</h1><blockquote>
<p>@author: Lyn </p>
</blockquote>
<h2 id="安装Mac软件安装管理器：HomeBrew">安装Mac软件安装管理器：HomeBrew</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby <span class="operator">-e</span> <span class="string">"<span class="variable">$(curl -fsSL -k https://raw.githubusercontent.com/Homebrew/install/master/install7)</span>"</span></span><br></pre></td></tr></table></figure>
<h2 id="安装Node-js版本管理器_NVM">安装Node.js版本管理器 NVM</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install nvm</span><br></pre></td></tr></table></figure>
<h2 id="使用NVM安装Node-js">使用NVM安装Node.js</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install <span class="keyword">node</span><span class="identifier"> </span><span class="title">&amp;&amp; nvm</span> alias default <span class="keyword">node</span><span class="identifier"></span><span class="title"></span></span><br></pre></td></tr></table></figure>
<h2 id="检查Node-js是否安装成功">检查Node.js是否安装成功</h2><p>在终端输入下面的命令检查Node和NPM的版本，安装成功的话会返回版本号：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">v4<span class="number">.2</span><span class="number">.1</span></span><br><span class="line">npm -v</span><br><span class="line"><span class="number">2.14</span><span class="number">.7</span></span><br></pre></td></tr></table></figure>
<h1 id="Install_Xcode">Install Xcode</h1><blockquote>
<p>（iOS SDK）Apple 开发者网站可以下载Xcode 或者AppStore安装 </p>
</blockquote>
<h1 id="Install_Cordova,_Ionic">Install Cordova, Ionic</h1><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> npm install cordova ionic ios-sim -g</span><br></pre></td></tr></table></figure>
<h1 id="Install_JAVA">Install JAVA</h1><p>Java SE Development  Kit</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.oracle.com/technetwork</span><span class="regexp">/java/javase</span><span class="regexp">/downloads/jdk</span>7-downloads-<span class="number">1880260</span>.html</span><br></pre></td></tr></table></figure>
<h1 id="Install_Android_sdk">Install Android sdk</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install <span class="keyword">android-sdk</span></span><br></pre></td></tr></table></figure>
<h2 id="Android_Studio_(选装)">Android Studio (选装)</h2><blockquote>
<p><a href="https://developer.android.com/sdk/index.html" target="_blank" rel="external">https://developer.android.com/sdk/index.html</a></p>
</blockquote>
<h1 id="Install_Git">Install Git</h1><p> 终端安装Git 如果安装过，请跳过。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install git</span><br></pre></td></tr></table></figure>
<p>如果是想更新Git版本：</p>
<p>先安装：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install git</span><br></pre></td></tr></table></figure>
<p>然后新建一个目录，把原来的移动到这个目录去<br>命令如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cd /usr/bin</span><br><span class="line">sudo mkdir old-git-<span class="number">1.7</span><span class="number">.5</span><span class="number">.4</span></span><br><span class="line">sudo mv git* old-git-<span class="number">1.7</span><span class="number">.5</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>
<h1 id="Install_Apache_Ant">Install Apache Ant</h1><blockquote>
<p>还是使用 brew</p>
</blockquote>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>install ant</span><br></pre></td></tr></table></figure>
<h1 id="Add_Android_sdk_in_your_path">Add Android sdk in your path</h1><blockquote>
<p>在终端打开和编辑: “.bash_profile” - 添加以下变量:</p>
</blockquote>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=$(/usr/libexec/java_home)</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:<span class="variable">$PATH</span></span><br><span class="line">export PATH=/usr/local/bin:<span class="variable">$PATH</span></span><br><span class="line">export JAVA_HOME=<span class="string">"/usr/libexec/java_home -v '1.7*'"</span></span><br><span class="line">export ANDROID_HOME=/usr/local/opt/android-sdk</span><br></pre></td></tr></table></figure>
<p>如果还安装了Android Studio，还需要添加这一行： </p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export <span class="constant">PATH=</span><span class="variable">$&#123;</span><span class="constant">PATH&#125;</span><span class="symbol">:/Applications/Android</span>\ <span class="constant">Studio.</span>app/sdk/platform-<span class="symbol">tools:</span>/<span class="constant">Applications/Android\</span> <span class="constant">Studio.</span>app/sdk/tools</span><br></pre></td></tr></table></figure>
<h1 id="Restart_Ur_Mac">Restart Ur Mac</h1><p>或者使用这个命令重新加载环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>检查环境变量：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH </span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.7.0_79.jdk/</span>Contents<span class="regexp">/Home/</span><span class="string">bin:</span><span class="regexp">/usr/</span>local<span class="regexp">/bin:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.7.0_79.jdk/</span>Contents<span class="regexp">/Home/</span><span class="string">bin:</span><span class="regexp">/usr/</span>local<span class="regexp">/bin:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.7.0_79.jdk/</span>Contents<span class="regexp">/Home/</span><span class="string">bin:</span><span class="regexp">/usr/</span>local<span class="regexp">/bin:/</span>usr<span class="regexp">/bin:/</span><span class="string">bin:</span><span class="regexp">/usr/</span><span class="string">sbin:</span><span class="regexp">/sbin:/</span>Development<span class="regexp">/android-sdk/</span>platform-<span class="string">tools:</span><span class="regexp">/Development/</span>android-sdk<span class="regexp">/tools:/</span>Development<span class="regexp">/android-sdk/</span><span class="string">tools:</span><span class="regexp">/Development/</span>android-sdk<span class="regexp">/tools:/</span>Development<span class="regexp">/android-sdk/</span><span class="string">tools:</span><span class="regexp">/Development/</span>android-sdk<span class="regexp">/tools:/</span>Development<span class="regexp">/android-sdk/</span>tools</span><br></pre></td></tr></table></figure>
<h1 id="建立一个新的项目">建立一个新的项目</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ionic <span class="built_in">start</span> oneApp</span><br><span class="line">$ cd oneApp</span><br><span class="line">$ ionic <span class="built_in">platform</span> <span class="built_in">add</span> ios</span><br><span class="line">$ ionic <span class="built_in">platform</span> <span class="built_in">add</span> android</span><br></pre></td></tr></table></figure>
<p>编译这个空项目：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">ionic</span> <span class="keyword">build </span>ios</span><br></pre></td></tr></table></figure>
<p>启动模拟器来显示新建的项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic <span class="built_in">emulate</span> ios</span><br></pre></td></tr></table></figure>
<p>如果遇到文件权限的问题，修改文件权限：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod -R <span class="number">777</span> ~/.yourfile</span><br></pre></td></tr></table></figure>
<h1 id="其他的Cordova的命令：">其他的Cordova的命令：</h1><h2 id="Create_New_Project">Create New Project</h2> <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cordova create hello com.example.hello <span class="string">"HelloWorld"</span></span><br><span class="line"><span class="variable">$ </span>cd hello</span><br><span class="line"><span class="variable">$ </span>cordova platform add ios</span><br><span class="line"><span class="variable">$ </span>cordova prepare</span><br></pre></td></tr></table></figure>
<h2 id="Deploy_the_app">Deploy the app</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cordova build</span><br></pre></td></tr></table></figure>
<h2 id="部署App到iOS设备:">部署App到iOS设备:</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cordova <span class="command">run</span> ios <span class="comment">--device</span></span><br></pre></td></tr></table></figure>
<h2 id="部署App到iOS_xCode模拟器">部署App到iOS xCode模拟器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cordova <span class="built_in">emulate</span> ios</span><br></pre></td></tr></table></figure>
<h2 id="查看所有可以用的模拟器列表">查看所有可以用的模拟器列表</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova <span class="command">run</span> ios <span class="comment">--list</span></span><br></pre></td></tr></table></figure>
<h2 id="使用指定的手机模拟器">使用指定的手机模拟器</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cordova <span class="command">run</span> ios <span class="comment">--target=target_name  </span></span><br><span class="line">cordova <span class="command">run</span> ios <span class="comment">--target="iPhone-6") //指定使用iPhone6作为模拟器</span></span><br></pre></td></tr></table></figure>
<h1 id="参考链接">参考链接</h1><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/ionicframework.com/getting</span>-started/</span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/cordova.apache.org/docs</span><span class="regexp">/en/latest</span><span class="regexp">/guide/platforms</span><span class="regexp">/android/index</span>.html</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/03/10/nodejs-gulp-01/" itemprop="url">
                  Node.js gulp notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-03-10T21:43:06+08:00" content="2016-03-10">
              2016-03-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/10/nodejs-gulp-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/10/nodejs-gulp-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Your_first_gulp_file">Your first  gulp file</h1><p>new gulpfile.js  in your PWD </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp =  <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'hello world!'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="install_Gulp">install  Gulp</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// <span class="operator"><span class="keyword">install</span> gulp  gloablly</span><br><span class="line">sudo npm <span class="keyword">install</span> -<span class="keyword">g</span> gulp</span><br><span class="line"></span><br><span class="line">// <span class="keyword">then</span> chang <span class="keyword">to</span> your pwd</span><br><span class="line">npm <span class="keyword">install</span> <span class="comment">--save-dev gulp</span></span><br><span class="line"></span><br><span class="line">// run gulp  <span class="keyword">in</span> your pwd </span><br><span class="line">gulp</span><br><span class="line">[<span class="number">21</span>:<span class="number">41</span>:<span class="number">05</span>] <span class="keyword">Using</span> gulpfile ~/src/node/casher/gulpfile.js</span><br><span class="line">[<span class="number">21</span>:<span class="number">41</span>:<span class="number">05</span>] <span class="keyword">Starting</span> <span class="string">'default'</span>...</span><br><span class="line">hello world!</span><br><span class="line">[<span class="number">21</span>:<span class="number">41</span>:<span class="number">05</span>] Finished <span class="string">'default'</span> <span class="keyword">after</span> <span class="number">90</span> μs</span></span><br></pre></td></tr></table></figure>
<h1 id="install_plugins_form_http://gulpjs-com/plugins/">install  plugins  form <a href="http://gulpjs.com/plugins/" target="_blank" rel="external">http://gulpjs.com/plugins/</a></h1><p>minify the Js file size  is  the most common things, when we are using  gulp</p>
<h2 id="Installation">Installation</h2><p>Install package with NPM and add it to your development dependencies:<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --<span class="built_in">save</span>-<span class="built_in">dev</span> gulp-uglify</span><br></pre></td></tr></table></figure></p>
<h2 id="Usage">Usage</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"> </span><br><span class="line">gulp.task(<span class="string">'compress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'lib/*.js'</span>)</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>));</span><br><span class="line">&#125;);check the Api https:<span class="comment">//www.npmjs.com/package/gulp-uglify/</span></span><br></pre></td></tr></table></figure>
<h2 id="running_in_our_PWD">running in our PWD</h2><p>gulpfile.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp =  <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);	</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	 gulp.src(<span class="string">'src/*.js'</span>)</span><br><span class="line">	  .pipe(uglify())</span><br><span class="line">	  .pipe(gulp.dest(<span class="string">'dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>run our  code </p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="atom">gulp</span> <span class="atom">scripts</span></span><br><span class="line"></span><br><span class="line">[<span class="number">22</span>:<span class="number">14</span>:<span class="number">54</span>] <span class="name">Using</span> <span class="atom">gulpfile</span> ~/<span class="atom">src</span>/<span class="atom">node</span>/<span class="atom">casher</span>/<span class="atom">gulpfile</span>.<span class="atom">js</span></span><br><span class="line">[<span class="number">22</span>:<span class="number">14</span>:<span class="number">54</span>] <span class="name">Starting</span> <span class="string">'scripts'</span>...</span><br><span class="line">[<span class="number">22</span>:<span class="number">14</span>:<span class="number">54</span>] <span class="name">Finished</span> <span class="string">'scripts'</span> <span class="atom">after</span> <span class="number">8.18</span> <span class="atom">ms</span></span><br></pre></td></tr></table></figure>
<p>I copy gulpfile.js  to src folder</p>
<p>and in ./dest/ folder it trim all the blank  and turn all the codes into one line.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp=<span class="built_in">require</span>(<span class="string">"gulp"</span>),uglify=<span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);gulp.task(<span class="string">"scripts"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;gulp.src(<span class="string">"src/*.js"</span>).pipe(uglify()).pipe(gulp.dest(<span class="string">"dist"</span>))&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="gulp-concat:_Concat_your_js_file">gulp-concat: Concat your js file</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-concat --save-dev</span><br><span class="line"></span><br><span class="line">gulp-concat@<span class="number">2.6</span><span class="number">.0</span> node_modules/gulp-concat</span><br><span class="line">├── concat-with-sourcemaps@<span class="number">1.0</span><span class="number">.4</span> (source-<span class="built_in">map</span>@<span class="number">0.5</span><span class="number">.3</span>)</span><br><span class="line">├── through2@<span class="number">0.6</span><span class="number">.5</span> (xtend@<span class="number">4.0</span><span class="number">.1</span>, readable-stream@<span class="number">1.0</span><span class="number">.33</span>)</span><br><span class="line">└── gulp-util@<span class="number">3.0</span><span class="number">.7</span> (<span class="built_in">array</span>-differ@<span class="number">1.0</span><span class="number">.0</span>, <span class="built_in">array</span>-uniq@<span class="number">1.0</span><span class="number">.2</span>, beeper@<span class="number">1.1</span><span class="number">.0</span>, object-assign@<span class="number">3.0</span><span class="number">.0</span>, lodash._reevaluate@<span class="number">3.0</span><span class="number">.0</span>, lodash._reinterpolate@<span class="number">3.0</span><span class="number">.0</span>, lodash._reescape@<span class="number">3.0</span><span class="number">.0</span>, replace-ext@<span class="number">0.0</span><span class="number">.1</span>, minimist@<span class="number">1.2</span><span class="number">.0</span>, multipipe@<span class="number">0.1</span><span class="number">.2</span>, has-gulplog@<span class="number">0.1</span><span class="number">.0</span>, fancy-<span class="built_in">log</span>@<span class="number">1.2</span><span class="number">.0</span>, vinyl@<span class="number">0.5</span><span class="number">.3</span>, gulplog@<span class="number">1.0</span><span class="number">.0</span>, through2@<span class="number">2.0</span><span class="number">.1</span>, lodash.<span class="keyword">template</span>@<span class="number">3.6</span><span class="number">.2</span>, chalk@<span class="number">1.1</span><span class="number">.1</span>, dateformat@<span class="number">1.0</span><span class="number">.12</span>)</span><br></pre></td></tr></table></figure>
<p>gulpfile.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//config file</span></span><br><span class="line"><span class="keyword">var</span> gulp =  <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);	</span><br><span class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	 gulp.src(<span class="string">'src/*.js'</span>)</span><br><span class="line">	  .pipe(concat(<span class="string">'all.min.js'</span>))</span><br><span class="line">	  .pipe(uglify())</span><br><span class="line">	  .pipe(gulp.dest(<span class="string">'dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Running results: &gt; all.min.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFirstFunction</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">"first"</span>&#125;<span class="function"><span class="keyword">function</span> <span class="title">mySecondFunction</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">"Second"</span>&#125;<span class="keyword">var</span> gulp=<span class="built_in">require</span>(<span class="string">"gulp"</span>),uglify=<span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);gulp.task(<span class="string">"scripts"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;gulp.src(<span class="string">"src/*.js"</span>).pipe(uglify()).pipe(gulp.dest(<span class="string">"dist"</span>))&#125;);</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/02/27/trans-note-02/" itemprop="url">
                  七个对我最好的职业建议－Nicholas C. Zakas（自译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-27T13:23:29+08:00" content="2016-02-27">
              2016-02-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/27/trans-note-02/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/27/trans-note-02/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="关于原作者">关于原作者</h1><p>Nicholas C. Zakas（尼古拉斯·泽卡斯），世界Web技术专家，现为雅虎公司界面呈现架构师，负责My Yahoo！和雅虎首页等大访问量站点的设计。尼古拉斯拥有丰富的Web开发和界面设计经验，曾经参与许多大公司的Web解决方案开发。他还是High Performance JavaScript一书的作者，并与他人合作撰写了Professional Ajax和Even Faster Web Sites。尼古拉斯拥有梅里马克学院计算机科学学士学位和埃迪柯特学院的MBA学位。他的Twitter别名是@slicknet。</p>
<p>The best career advice I’ve received － Posted at October 15, 2013 by Nicholas C. Zakas<br>Tags: Advice Career Mentoring</p>
<p>我最近有一段和我的同事有一段有趣的讨论.我们列举我们过去的工作，以及我们奇葩的性格可能对我们产生了负面的影响. 而事实是，我刚从学校毕业的时候很混蛋（有些人会说我现在依然很混蛋）。我曾经是傲慢而犀利喜欢讽刺的一个人，总的来说就是很无礼。我觉得我知道我是什么样的人而且还为此很是得意。<br>I recently had an interesting discussion with a colleague. We were recounting our job histories and how our, shall we say colorful personalities, could have negatively impacted us long term. The truth is, I was kind of an asshole coming out of college (some would argue I’m still kind of an asshole, but that’s beside the point). I was arrogant and bitingly sarcastic, a generally irreverent character. I thought I knew it all and was quite proud of myself for it.</p>
<p>我有一个告诉更有经验的工程师他们做事的方法不对的爱好，尽管大部分的时候都是对的，我并没有一个性格让我以很高效的方式去做到它。在一次特别令人愉快的对话中，一个高级工程师跟我说；“如果你在不闭嘴，我就把你揍出翔来”。我一笑而过，因为我知道他不敢这样，但是一年之后我才知道这不是一个玩笑，他是真的想揍死我！<br>I had a habit of telling more experienced engineers that they were doing things wrong, and despite being right most of the time, I didn’t have the personality to make it effective. During one particularly engaging conversation, one of the senior engineers stopped and said, in these exact words, “I’m going to f<em>*</em>en beat the shit out of you if you don’t shut up.” I laughed it off because I knew he wouldn’t dare, and only years later did I realize the relevance of that statement: it was actually what he wanted to do.</p>
<p>自从那以后<br>Since that time I’ve grown up a lot, learned to watch what I say, and treat people with respect regardless of defining characteristics. The sarcasm stays in check while in a professional environment; I let it out to play when I’m with good friends. This self-control, along with a lot of other invaluable lessons, came to me not of my own accord, but through the careful guidance of the mentors I’ve had along the way. If not for them, who knows if my interpersonal relationships would have short-circuited my career.</p>
<p>The truth is that I have been incredibly blessed in my career because of the people I’ve come into contact with. My managers along the way molded a really rough-around-the-edges character into someone I’m proud to be. More than that, because of their influence, I’m not just a good programmer – I’m a good teammate and a good person. So impactful were these people on my life that I frequently recount their advice to the colleagues that I now mentor.</p>
<p>I also find their advice to be universally applicable, so I’d like to share the things I was told that helped me along the way. Of course, some of these are paraphrased since my memory for exact phrases isn’t all that great, but I believe I’ve captured the important parts correctly.</p>
<p>Don’t be a short-order cook</p>
<p>My very first job lasted 8 months because the company shut down. As I was talking with my manager about what I would do next, he gave me this advice:</p>
<p>Nicholas, you’re worth more than your code. Whatever your next gig is, make sure that you’re not a short-order cook. Don’t accept a job where you’re told exactly what to build and how to build it. You need to work somewhere that appreciates your insights into the product as well as your ability to build it.</p>
<p>This is something I’ve kept in mind throughout my career. Simply being an implementer isn’t good enough – you need to be involved in the process that leads up to implementation. Good engineers don’t just follow orders, they give feedback to and work with product owners to make the product better. Fortunately, I’ve chosen my jobs wisely and never ended up in a situation where people didn’t respect or value my insights.</p>
<p>Self-promote</p>
<p>My second manager at Yahoo pulled me aside one day to give me some advice. He had been watching my work and felt like I was hiding a bit:</p>
<p>You do great work. I mean really great work. I like how your code looks and that it rarely breaks. The problem is that others don’t see it. In order for you to get credit for the work you’re doing, you have to let people know. You need to do a bit of self-promotion to get noticed.</p>
<p>It took me a little while to digest what he was saying, but I finally figured it out. If you do good work, but no one knows that you did good work, then it doesn’t really help you. Your manager can back you up but can’t make your case for you. People within the organization need to understand your value, and the best way to do that is to tell people what you did.</p>
<p>This is advice I give to many of my colleagues now. Self-promoting doesn’t mean, “look at me, I’m awesome.” It means letting people know when you’ve hit major milestones, or when you’ve learned something new. It means showing people the work that you’re proud of. It means celebrating your accomplishments and the accomplishments of others. It means being visible within the organization. The engineer who sits quietly in a corner and just codes away is always a bit mysterious – don’t be like that. A quick email to say, “hey, I finished the new email layout. Let me know what you think” goes a long way.</p>
<p>It’s about people</p>
<p>I was very title-driven earlier in my career. I always wanted to know what I had to do to be promoted. During my first one-on-one with my new manager on the Yahoo homepage, I asked what it would take for me to get promoted. His words still ring in my ears:</p>
<p>At a certain point, you stop being judged on your technical knowledge and start being judged on the way you interact with people.</p>
<p>I’m not sure I’ve ever received a better insight into the software engineering profession since that time. He was exactly right. At that point, no one was questioning my technical ability. I was known as a guy who wrote good, high-quality code that rarely had bugs. What I lacked was leadership skill.</p>
<p>Since that time, I’ve seen countless engineers get stuck at one level in their career. Smart people, good code, but the inability to work effectively with others keeps them where they are. Anytime someone feels stuck in their software engineering career, I recount this advice and it has always been right on the money.</p>
<p>None of this matters</p>
<p>I went through a period at Yahoo where I was frustrated. Maybe frustrated isn’t the right word, more like angry. I had angry outbursts and was arguing with people constantly. Things were going wrong and I didn’t like that. During one particularly rough day, I asked one of my mentors how he managed to stay calm when so many things were going wrong. His response:</p>
<p>It’s easy. You see, none of this matters. So some crappy code got checked in, so the site went down. So what? Work can’t be your whole life. These aren’t real problems, they’re work problems. What really matters is what happens outside of work. I go home and my wife is waiting for me. That’s pretty nice.</p>
<p>I had moved to California from Massachusetts and had a hard time making friends. Work was my life, it was what kept me sane, so when it wasn’t going that meant my life wasn’t going well. This conversation made me realize I had to have something else going on in my life, something I could go back to and forget about the troubles I had at work.</p>
<p>He was right, once I shifted my mindset and recategorized the annoying things at work as “work things,” I was able to think more clearly. I was able to calm down at work and have much more pleasant interactions with people.</p>
<p>Authority, your way</p>
<p>When I was first promoted to principal engineer at Yahoo, I sat down with my director to better understand what the role entailed. I knew I had to be more of a leader, but I was having trouble being authoritative. I asked for help. Here’s what he said:</p>
<p>I can’t tell you how to be authoritative, that’s something you need to figure out on your own. Different people have different styles. What you need to do is find a style that you can live with, that makes you comfortable. I can’t tell you what that is, but you do need to find it for this position.</p>
<p>I spent a lot of time that year observing people of authority and how they interacted with others. I took note as to how they walked, how they talked, how they dealt with problem situations. I tried different styles before I finally came across one that worked for me. My style is uniquely me and anyone learning to be in a position of authority has to go through the same growing pains. My advantage was that my mentor clued me about the process up front.</p>
<p>Moving from “how?” to “what?”</p>
<p>During a conversation with my manager at Yahoo, I asked what the expectations were with my new position. He answered:</p>
<p>To this point in your career, you’ve answered the question, “how?” As in, we tell you what needs to be done and you figure out how to do it. At this point, though, you need to answer the question, “what?” I’m expecting you to come and tell me what needs to be done.</p>
<p>This is the part where I see a lot of engineers get tripped up, and I would have as well if not for this piece of advice. Switching from “how?” to “what?” is very hard and takes time to develop. It also takes a bit of maturity to be left to your own desires as to what you focus on. After all, if you can spend your time on anything you want, you are also solely responsible for what you produce.</p>
<p>At Box, we call this “running open loop,” meaning that you do your job with minimal oversight and yet still are making a significant positive impact on the engineering organization and the company as a whole. This is the step where many engineers fail to make the leap, and I still give this advice to anyone who is trying to get to the next level.</p>
<p>Act like you’re in charge</p>
<p>I had just sat through a meeting where I had nothing to say. During my one-on-one with my director, I mentioned that I was just in a meeting where I had no idea why I was there and had nothing to contribute. He said:</p>
<p>Don’t ever do that again. If you’re in a meeting, it’s because you are there to participate. If you’re not sure why you’re there, stop and ask. If you’re not needed, leave. You’re in a leadership position, act like it. Don’t go quietly into a room. Just act like you’re in charge and people will believe it.</p>
<p>In that piece of advice, my mentor had reminded me of a lesson I learned while acting in high school: no one knows when you’re acting. If you’re nervous but act like you’re not, then people won’t know that you’re nervous. The same with leadership. The old phrase fake it til you make it comes to mind. From that point on, I never sat quietly in a meeting. I made sure I only went to meetings that needed me to participate and then I would participate.</p>
<p>Let them win</p>
<p>I went through a particular period where there were a lot of arguments on the team. I prided myself on ending those arguments with authority. I had a “my ruling is final” mentality, and my manager noticed that and gave me this piece of advice:</p>
<p>I see a lot of arguing going on, and I see you pushing through to win a lot. I know that most of the time you are right, but every once in a while let them win. Pick the things that really matter to you and push for those but let the other things go. There’s no need to win every argument.</p>
<p>This was one piece of advice I resisted initially. I was right nearly all of the time, why would I ever let someone else win? However, as I had grown to trust his instincts, I gave it a shot. The result: there were less arguments. People didn’t feel like they had to get one over on me, and in turn, I became better at identifying things I really didn’t care that much about. I stuck to my guns on important issues and let the others ones get resolved by the other party. The intensity of all conversations dropped considerably.</p>
<p>Conclusion</p>
<p>Looking back at the brash guy I was when I graduated college, my career could have ended up very different. I was seen as a malcontent, a smart but hard-to-deal-with guy who people dealt with because they had to. If it weren’t for the mentors I had along the way, as well as some humbling failures early in my career, my interpersonal skills (or lack thereof) could have very well done me in. These days, I regularly seek out those who are more experienced than me and ask for advice. I may no longer make big, glaring mistakes, but I also don’t want to wait for one to happen to seek out the experienced insights of someone I trust.</p>
<p>The nearly five years I was at Yahoo were some of the most transformative in my career. I got to work on interesting problems at a large scale, but moreso I was blessed with a series of wonderful managers and other mentors within my organization. I credit those conversations with turning me into a person that I’m proud of today, both at work and outside in “real life.”</p>
<p>If I can leave you with one overriding piece of career advice, it would be this: identify someone at your work that is smarter than you in some way (technically, organizationally, etc.) and attach yourself to them. See if you can regularly have lunch or coffee and pick their brain for the vast amount of knowledge it has. Your career, and maybe even your life, could end up drastically better by doing so.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/02/23/trans-note-01/" itemprop="url">
                  采访1Password背后的开发故事（自译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-23T11:58:17+08:00" content="2016-02-23">
              2016-02-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/23/trans-note-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/23/trans-note-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Behind_the_App:_The_Story_of_1Password">Behind the App: The Story of 1Password</h1><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-2-22/42337210.jpg" alt=""></p>
<p>你的网络生活安全的保障不是一件可以开玩笑的事情，但是还是有很多人为了省事在不同的网站使用相同的密码。毫无疑问这是一种不好的习惯，而且安全而复杂的密码一定是一个你难以记住的密码。这也就是为什么你需要一个密码管理工具去管理你的网络密码，比如说使用：1Password。</p>
<blockquote>
<p>Securing your online life is no joke, but many people still use the same password across different sites for the sake of convenience. Of course, that’s bad practice and the most secure password is one that you can’t remember. Which is why you need a tool to manager your online security like 1Password.</p>
</blockquote>
<p>这个App会为你的网络账号生成随机的复杂且唯一的密码，他会是你最喜欢的密码管家，最近他们最近和收费版本一同推出了带来新功能而且和IOS8兼容的免费增值版本的App</p>
<p>The app generates random, complex, and unique passwords for all of your logins and then manages them for you. It’s one of your favorite password managers, and they recently adopted a freemium model to coincide with new features and integration with iOS 8.</p>
<p>这个APP是怎么开发出来的呢？就像很多软件一样，它最开始就是一个没有计划成为消费品的供内部使用的软件，我们与1Password的团队取得了联系去探究App背后的故事。</p>
<p>How did this security tool come about? Like a lot of software, it started as an internal tool without any real plan to become a consumer product. We caught up with the 1password team at AgileBits to learn more about the story behind the app.</p>
<h2 id="这个App的灵感是从哪里来的？">这个App的灵感是从哪里来的？</h2><p>你们是为了解决一个过去遇到的问题？还是从什么其他地方获得的灵感？</p>
<p>就像很多我们喜欢的产品，我们最初是为了解决一个问题，我们的共同发起人：Dave Teare 和 Roustem Karimov 早在2005年就开始讨论这个产品的想法了，因为他们被各种需要密码的服务和为了记忆各种登录所需要的密码搞得头疼。他们想要一种能为保护不同的账号生成不同的唯一的密码的工具。并且能帮他们记住各种登录密码并在需要登录的时候帮助他们自动登录，这样他们就不会在浪费时间在各种密码登录界面了。</p>
<blockquote>
<p>Where did the idea for the app come from? Were you trying to solve a problem you’d experienced, or did the inspiration come from somewhere else?<br>Like many of our favorite products, we set out to solve a problem. Dave Teare and Roustem Karimov, our co-founders, were kicking around product ideas back in 2005 but started getting annoyed at how many services they had to sign into and all the passwords they needed to remember. They wanted a tool that would create unique passwords to protect all their accounts, and also remember those passwords and log them in automatically so they could spend less time typing into login forms and more time on what they wanted to do.</p>
</blockquote>
<h2 id="当你们有了这个灵感以后，你们的下一步是什么？">当你们有了这个灵感以后，你们的下一步是什么？</h2><p>最有趣的部分就是，原本那是没有下一步的， 我们设想那只是一个三个月的项目，Dave和Roustem当时只是自己使用这个最后成为1Password的工具，直到他们开始向他们在该领域的朋友们展示这个项目并且成功震惊了他们，直到这时他们才意识到他们创造了一个真的很特别的东西！</p>
<p>After you came up with the idea, what was the next step?<br>The funny part of this story is that, originally, there was no next step. It was supposed to be a three-month project, and Dave and Roustem were just using what eventually became 1Password on their own, internally. It wasn’t until they started showing it to friends in the field and blew their minds that they realized they had created something truly special.</p>
<h2 id="你们怎么确定在哪个平台开发这个软件作_而忽略哪些平台或者暂时不开发哪些平台？">你们怎么确定在哪个平台开发这个软件作 而忽略哪些平台或者暂时不开发哪些平台？</h2><p>在那个时候，Dave和 Roustem 两个人都离开了上班族的世界和接触Mac，所以那是难以置信的偶然。当时苹果刚推出了OS X 和 IPOD， 社区的发展极为迅速，两位创始人正在折腾新的项目，刚好就知道了OSX和Cocoa，所以这也很好理解他们在Mac上开发了测试版的1Password，看下效果如何。</p>
<p>Behind the App: The Story of 1Password<br>How did you choose which platforms to target and which to ignore or wait on?<br>Right around this time, Dave and Roustem had both just left the corporate world and discovered the Mac, so it was incredibly serendipitous. Apple was on a roll with OS X and the iPod, and the community was taking off like a rocket ship. Dave and Roustem were tinkering with new projects, getting to know OS X and Cocoa, so it just made sense to try the initial beta version of 1Password on the Mac and see where it went.</p>
<h2 id="什么是你们曾遇到的最大的障碍？你们是怎么克服它的？">什么是你们曾遇到的最大的障碍？你们是怎么克服它的？</h2><p>我不会说我们遇到了相当多的苦难，但是探索和理解安全软件的背景与更深层次的细节都是1Password不可或缺的基础。它储存了人们的密码，信用卡，大量的个人信息，我们必须知道我们的安全入口，我们必须谨慎的对待我们用户的隐私和担忧，这是一种我们不能轻松承担的特俗的责任。</p>
<p>What was your biggest roadblock and how did you overcome it?<br>I wouldn’t say it was so much of a roadblock, but exploring and understanding the context and deeper details of making a security product was an essential element to getting 1Password right. It stores people’s passwords, credit cards, and utmost personal info—we have to know our security chops, we have to be mindful of our customers’ privacy and concerns. It is a uniquely personal responsibility that we do not—cannot—take lightly.</p>
<h2 id="产品上线的时候是什么样的状况？">产品上线的时候是什么样的状况？</h2><p>发布以后让我们大吃一惊，真的。我们以为我们只是创建了一个只有书呆子才会在意的内部的工具。但是我们很快知道我们击中了用户的痛点，一些科技网站发现了它，开始写相关的文章，然后开始制作一些如何使用的教程，当人们开始与其他人讨论你们的作品时，我觉得那是世界上最棒的一种感觉之一。</p>
<p>另一个很棒的地方就是，用户开始来与我们交流，有一些人会有建议，有一些会抱怨，很多人的表扬和感谢。但归根结底就是：人们很在乎1password，他们希望能成为它的一部分从而使它变的更好用。这也是世界上最棒的一种感觉之一。</p>
<p>What was launch like for you?<br>Launch blew us away. It really did. We thought we were building an internal tool that mostly nerds would care about, but we quickly learned we struck a nerve. A few tech sites found out about it (“1Passwd” back in those days), started writing about it, then made “how to do this and that” tutorials. When people start telling other people about this thing you made… that’s one of the best feelings in the world.<br>Another great part of the launch was users coming to talk to us. Some had suggestions, some complaints, plenty of praise and thanks, but it all boils down to the same thing: people care so much about 1Password that they want to be a part of it and make it even better. Again, best feeling in the world.</p>
<h2 id="你们是怎么有效的处理用户的建议和批评的？">你们是怎么有效的处理用户的建议和批评的？</h2><p>我们的合伙人和Ceo建立了一种很棒的企业文化：他们着迷与在各种社交平台上的各种人与人之间的互动，无论是批评还是一般的回馈。我们拥有完善的支持无论什么语言什么国家。而且我们使用协作服务比如Cerberus, Google Drive 积极的与我们的用户交流，并总结反馈的信息。我们使用Jira和basecamp来管理bug报告，讨论和决定改进和增加哪些功能。</p>
<p>How do you handle user requests and criticisms effectively?<br>our co-founders and CEO built a great culture obsessed with human-to-human interaction for all our social media, criticism, and general feedback. We have a thorough support staff that spans continents and languages, and we use collaborative services like Cerberus, Google Drive, and Respond.ly to talk with our customers and organize feedback. For actual bug reporting, discussion, and deciding what to improve and build, we use Jira and Basecamp.</p>
<h2 id="现在你们怎么分配你们的时间在开发新的功能和维护已有的那些功能？">现在你们怎么分配你们的时间在开发新的功能和维护已有的那些功能？</h2><p>在所有的在开发列表上的工作任务和所有我们从用户那里获取的想法之间，一定没有什么区别。因为当决定什么时候去开发还是什么时候去改进，是真的很复杂的步骤。如果有功能不正常的时候并且我们从很多的顾客那里获知的时候，这件事就会变成我们的首要任务，因为没有我们的顾客我们就什么都不是。<br>我们的也有一个令人惊喜和感激的测试版程序，那些用户拥有很大的发言权在什么会添加到1password，包括程序的修复和新的功能。比如说我们的mac程序，就有2万5000名客户参加测试。有的时候外部的因素也会影响到我们的计划，包括操作系统的更新计划。从产品推出的第一天起我们的用户期待看到我们推出新的升级，我们尽我们所能去满足我们的用户，但是有时候那也会导致我们会商量是不是把一些新的东西增加到免费升级的小版本中去。</p>
<p>Now, how do you split time between developing new features and managing existing ones?<br>Between all the tasks already on our list and all the ideas we get from our customers, there is absolutely no shortage of places to take 1Password. As for deciding when it’s time to build and when to improve, that’s a fairly complicated dance. If something isn’t working right and we hear from a lot of customers, it gets top priority; we’d be nothing without our customers.</p>
<p>We also have (and are grateful for!) a surprisingly active beta program. Those customers have a huge voice in what we add to 1Password, including both fixes and new features. Our Mac program, for example, includes over 25,000 customers.<br>Sometimes external elements can factor into our plans as well, including OS release schedules. It’s no secret that our customers love to see our updates ready by day one, and we try our best to hit that. But sometimes that leads to discussions over whether we need to push Feature Y to a free X.1 update.</p>
<h2 id="你们会给那些想做类似的项目的人什么建议么？">你们会给那些想做类似的项目的人什么建议么？</h2><p>解决一个个人的问题，那种影响着你和你亲近的朋友们的问题。找到那件事会让你晚上也很兴奋，或者你总是发现你在和你的朋友抱怨相同的事情，但却没有好好思考过这些东西。正视那个问题，看看是不是它已经有了一个解决方案，然后想想你能不能有一个更好的解决方案。这是最好的方式去确定你可以把这件事做到最好并且保持做事的激情无论遇到在这其中遇到好的时期或者坏的，但这两种时期肯定都会出现。</p>
<p>What advice would you give to others that want to take on a similar project?<br>Solve a personal problem, something that affects you or your closest friends. Find that thing that keeps you up at night, or that you always catch yourself complaining about with friends but might not give a second thought. Look at that problem, see if it might already have a solution, then think about how you can solve it better. It’s the best way to make sure you can do great work and stay passionate through both the good days and the bad, and there will be both.</p>
<h2 id="原文链接">原文链接</h2><p><a href="http://lifehacker.com/behind-the-app-the-story-of-1password-1643425238" target="_blank" rel="external">http://lifehacker.com/behind-the-app-the-story-of-1password-1643425238</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/02/22/nodejs-note-24/" itemprop="url">
                  Building restfull API by using restify - 02
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-22T21:45:57+08:00" content="2016-02-22">
              2016-02-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/22/nodejs-note-24/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/22/nodejs-note-24/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  restify = <span class="built_in">require</span>(<span class="string">'restify'</span>);</span><br><span class="line"><span class="keyword">var</span>  bunyan = <span class="built_in">require</span>(<span class="string">'bunyan'</span>); </span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	name:<span class="string">"Toodoo API"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  server = restify.createServer(options);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'middleware 1 here!'</span> );</span><br><span class="line">	next();</span><br><span class="line">	<span class="comment">// next(new Error('something awful happened!'));</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'middleware 2 here!'</span> );</span><br><span class="line">	next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'after'</span>, restify.auditLogger(&#123;</span><br><span class="line">	log: bunyan.createLogger(&#123;</span><br><span class="line">		name:<span class="string">'audit'</span>,</span><br><span class="line">		stream: process.stdout</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.on('after', function ()&#123;</span></span><br><span class="line"><span class="comment">//	console.log('after', arguments);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./routes'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  restify = <span class="built_in">require</span>(<span class="string">'restify'</span>);</span><br><span class="line"><span class="keyword">var</span>  bunyan = <span class="built_in">require</span>(<span class="string">'bunyan'</span>); </span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	name:<span class="string">"Toodoo API"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  server = restify.createServer(options);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'middleware 1 here!'</span>, req.body);</span><br><span class="line">	next();</span><br><span class="line">	<span class="comment">// next(new Error('something awful happened!'));</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.use(restify.bodyParser(&#123;</span><br><span class="line">	maxBodySize: <span class="number">10</span>*<span class="number">1024</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">server.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'middleware 2 here!'</span>, req.body);</span><br><span class="line">	next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'after'</span>, restify.auditLogger(&#123;</span><br><span class="line">	log: bunyan.createLogger(&#123;</span><br><span class="line">		name:<span class="string">'audit'</span>,</span><br><span class="line">		stream: process.stdout</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.on('after', function ()&#123;</span></span><br><span class="line"><span class="comment">//	console.log('after', arguments);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./routes'</span>);</span><br><span class="line"><span class="comment">// test with data</span></span><br><span class="line"><span class="comment">// curl -i -X PUT localhost:8080/lists/mylist --data '&#123;"hey":"there"&#125;' -H 'content-type: application/json'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192</span>:<span class="number">02</span> Lyn$ node .</span><br><span class="line"> API server listening on &#123;<span class="string">"address"</span>:<span class="string">"::"</span>,<span class="string">"family"</span>:<span class="string">"IPv6"</span>,<span class="string">"port"</span>:<span class="number">8080</span>&#125;</span><br><span class="line">middleware <span class="number">1</span> here! undefined</span><br><span class="line">middleware <span class="number">2</span> here! &#123; hey: <span class="string">'there'</span> &#125;</span><br><span class="line">body : &#123; hey: <span class="string">'there'</span> &#125;</span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"audit"</span>,<span class="string">"hostname"</span>:<span class="string">"Lyn-Cheung-MBP.local"</span>,<span class="string">"pid"</span>:<span class="number">45195</span>,<span class="string">"audit"</span>:true,<span class="string">"level"</span>:<span class="number">30</span>,<span class="string">"remoteAddress"</span>:<span class="string">"::ffff:127.0.0.1"</span>,<span class="string">"remotePort"</span>:<span class="number">55210</span>,<span class="string">"req_id"</span>:<span class="string">"6185400f-ad38-4578-bec7-2b1618a6ccf6"</span>,<span class="string">"req"</span>:&#123;<span class="string">"query"</span>:<span class="string">""</span>,<span class="string">"method"</span>:<span class="string">"PUT"</span>,<span class="string">"url"</span>:<span class="string">"/lists/mylist"</span>,<span class="string">"headers"</span>:&#123;<span class="string">"host"</span>:<span class="string">"localhost:8080"</span>,<span class="string">"user-agent"</span>:<span class="string">"curl/7.43.0"</span>,<span class="string">"accept"</span>:<span class="string">"*/*"</span>,<span class="string">"content-type"</span>:<span class="string">"application/json"</span>,<span class="string">"content-length"</span>:<span class="string">"15"</span>&#125;,<span class="string">"httpVersion"</span>:<span class="string">"1.1"</span>,<span class="string">"trailers"</span>:&#123;&#125;,<span class="string">"version"</span>:<span class="string">"*"</span>,<span class="string">"timers"</span>:&#123;<span class="string">"handler-0"</span>:<span class="number">449</span>,<span class="string">"readBody"</span>:<span class="number">2179</span>,<span class="string">"parseBody"</span>:<span class="number">242</span>,<span class="string">"handler-1"</span>:<span class="number">1494</span>,<span class="string">"createList"</span>:<span class="number">4112</span>&#125;&#125;,<span class="string">"res"</span>:&#123;<span class="string">"statusCode"</span>:<span class="number">200</span>,<span class="string">"headers"</span>:&#123;<span class="string">"content-type"</span>:<span class="string">"application/json"</span>,<span class="string">"content-length"</span>:<span class="number">15</span>&#125;,<span class="string">"trailer"</span>:false&#125;,<span class="string">"latency"</span>:<span class="number">12</span>,<span class="string">"_audit"</span>:true,<span class="string">"msg"</span>:<span class="string">"handled: 200"</span>,<span class="string">"time"</span>:<span class="string">"2016-02-22T15:00:33.154Z"</span>,<span class="string">"v"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<p>create.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports= <span class="function"><span class="keyword">function</span> <span class="title">createList</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> body = req.body;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'body :'</span>,body);</span><br><span class="line">	res.send(&#123;hey:<span class="string">'there'</span>&#125;);</span><br><span class="line">	next();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="validating_the_data">validating the data</h2><h3 id="Joi">Joi</h3><p>joi allows you to create <em>blueprints</em> or <em>schemas</em> for JavaScript objects (an object that stores information) to ensure <em>validation</em> of key information.</p>
<h4 id="Example">Example</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Joi = <span class="built_in">require</span>(<span class="string">'joi'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = Joi.object().keys(&#123;</span><br><span class="line">    username: Joi.string().alphanum().min(<span class="number">3</span>).max(<span class="number">30</span>).required(),</span><br><span class="line">    password: Joi.string().regex(<span class="regexp">/^[a-zA-Z0-9]&#123;3,30&#125;$/</span>),</span><br><span class="line">    access_token: [Joi.string(), Joi.number()],</span><br><span class="line">    birthyear: Joi.number().integer().min(<span class="number">1900</span>).max(<span class="number">2013</span>),</span><br><span class="line">    email: Joi.string().email()</span><br><span class="line">&#125;).with(<span class="string">'username'</span>, <span class="string">'birthyear'</span>).without(<span class="string">'password'</span>, <span class="string">'access_token'</span>);</span><br><span class="line"></span><br><span class="line">Joi.validate(&#123; username: <span class="string">'abc'</span>, birthyear: <span class="number">1994</span> &#125;, schema, <span class="function"><span class="keyword">function</span> (<span class="params">err, value</span>) </span>&#123; &#125;);  <span class="comment">// err === null -&gt; valid</span></span><br></pre></td></tr></table></figure>
<p>The above schema defines the following constraints:</p>
<ul>
<li><code>username</code><ul>
<li>a required string</li>
<li>must contain only alphanumeric characters</li>
<li>at least 3 characters long but no more than 30</li>
<li>must be accompanied by <code>birthyear</code></li>
</ul>
</li>
<li><code>password</code><ul>
<li>an optional string</li>
<li>must satisfy the custom regex</li>
<li>cannot appear together with <code>access_token</code></li>
</ul>
</li>
<li><code>access_token</code><ul>
<li>an optional, unconstrained string or number</li>
</ul>
</li>
<li><code>birthyear</code><ul>
<li>an integer between 1900 and 2013</li>
</ul>
</li>
<li><code>email</code><ul>
<li>a valid email address string</li>
</ul>
</li>
</ul>
<h4 id="Usage">Usage</h4><p>Usage is a two steps process. First, a schema is constructed using the provided types and constraints:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">    a: Joi.string()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Note that <strong>joi</strong> schema objects are immutable which means every additional rule added (e.g. <code>.min(5)</code>) will return a<br>new schema object.</p>
<p>Then the value is validated against the schema:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Joi.validate(&#123; a: <span class="string">'a string'</span> &#125;, schema, <span class="function"><span class="keyword">function</span> (<span class="params">err, value</span>) </span>&#123; &#125;);</span><br></pre></td></tr></table></figure>
<p>If the value is valid, <code>null</code> is returned, otherwise an <code>Error</code> object.</p>
<p>The schema can be a plain JavaScript object where every key is assigned a <strong>joi</strong> type, or it can be a <strong>joi</strong> type directly:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = Joi.string().min(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>If the schema is a <strong>joi</strong> type, the <code>schema.validate(value, callback)</code> can be called directly on the type. When passing a non-type schema object,<br>the module converts it internally to an object() type equivalent to:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = Joi.object().keys(&#123;</span><br><span class="line">    a: Joi.string()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>When validating a schema:</p>
<ul>
<li>Keys are optional by default.</li>
<li>Strings are utf-8 encoded by default.</li>
<li>Rules are defined in an additive fashion and evaluated in order after whitelist and blacklist checks.</li>
</ul>
<p>npm install joi —save</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> server = <span class="keyword">require</span>(<span class="string">'./server'</span>);</span><br><span class="line"><span class="built_in">var</span> resources = <span class="keyword">require</span>(<span class="string">'./resources'</span>);</span><br><span class="line"><span class="built_in">var</span> validating =  <span class="keyword">require</span>(<span class="string">'./middleware/validating'</span>);</span><br><span class="line"><span class="built_in">var</span> schemas = <span class="keyword">require</span>(<span class="string">'./schemas'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//	server.get(urlPattern, function(req, res)&#123;</span></span><br><span class="line"><span class="comment">//		res.send(obj);</span></span><br><span class="line"><span class="comment">//	&#125;);</span></span><br><span class="line"></span><br><span class="line">server<span class="built_in">.</span>get(<span class="string">'/lists'</span>,resources<span class="built_in">.</span>lists<span class="built_in">.</span><span class="built_in">list</span>);</span><br><span class="line">server<span class="built_in">.</span>put(<span class="string">'/lists/:list'</span>,validating(schemas<span class="built_in">.</span><span class="built_in">list</span>),resources<span class="built_in">.</span>lists<span class="built_in">.</span>create);</span><br><span class="line">server<span class="built_in">.</span>del(<span class="string">'/lists/:list'</span>,resources<span class="built_in">.</span>lists<span class="built_in">.</span>del);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Items</span></span><br><span class="line"></span><br><span class="line">server<span class="built_in">.</span>get(<span class="string">'/lists/:list/items'</span>, resources<span class="built_in">.</span>items<span class="built_in">.</span><span class="built_in">list</span>);</span><br><span class="line">server<span class="built_in">.</span>post(<span class="string">'lists/:list/items'</span>,validating(schemas<span class="built_in">.</span>item),resources<span class="built_in">.</span>items<span class="built_in">.</span>create);</span><br><span class="line">server<span class="built_in">.</span>del(<span class="string">'/lists/:list/items/:item'</span>,resources<span class="built_in">.</span>items<span class="built_in">.</span>del);</span><br><span class="line"><span class="string">``</span><span class="string">` </span><br><span class="line">./middleware/validating.js</span></span><br></pre></td></tr></table></figure>
<p>var Joi = require(‘joi’);</p>
<p>module.exports =  function validating(schema){</p>
<pre><code><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(req,res,next)</span></span>{

    Joi.validate(req.body, schema,<span class="function"><span class="keyword">function</span><span class="params">(err, doc)</span></span>{
        <span class="keyword">if</span> (err){
            err.statusCode = <span class="number">400</span>;
            <span class="built_in">next</span>(err);
        }
        <span class="keyword">else</span>{
            req.body = doc;
            <span class="built_in">next</span>();
        }

    });

};
</code></pre><p>};<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./schmeas/<span class="keyword">index</span>.js</span><br></pre></td></tr></table></figure></p>
<p>exports.list = require(‘./list’);<br>exports.item = require(‘./item’);<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./schmeas/<span class="type">list</span>.js</span><br></pre></td></tr></table></figure></p>
<p>var Joi = require(‘joi’);</p>
<p>// npm doc joi</p>
<p>module.exports = Joi.object().required().keys({<br>    name: Joi.string().required(),<br>    description: Joi.string(),<br>    priority: Joi.number().integer().default(0)<br>});<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./schemas/<span class="property">item</span>.js</span><br></pre></td></tr></table></figure></p>
<p>var Joi = require(‘joi’);</p>
<p>// npm doc joi</p>
<p>module.exports = Joi.object().required().keys({<br>    label: Joi.string().required()<br>});<br>```</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/02/21/nodejs-note-23/" itemprop="url">
                  Building restfull API by using restify - 01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-02-21T16:19:49+08:00" content="2016-02-21">
              2016-02-21
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/21/nodejs-note-23/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/21/nodejs-note-23/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Restify">Restify</h2><blockquote>
<p>   restify is a node.js module built specifically to enable you to build correct REST web services. It intentionally borrows heavily from express as that is more or less the de facto API for writing web applications on top of node.js.</p>
</blockquote>
<h3 id="Why_use_restify_and_not_express?">Why use restify and not express?</h3><blockquote>
<pre><code>Express' use case <span class="keyword">is</span> targeted <span class="keyword">at</span> browser applications <span class="keyword">and</span> <span class="keyword">contains</span> a lot <span class="keyword">of</span> functionality, such <span class="keyword">as</span> templating <span class="keyword">and</span> rendering, <span class="keyword">to</span> support <span class="keyword">that</span>. Restify <span class="keyword">does</span> <span class="keyword">not</span>.

Restify exists <span class="keyword">to</span> let you build <span class="string">"strict"</span> API services <span class="keyword">that</span> are maintanable <span class="keyword">and</span> observable. Restify comes <span class="keyword">with</span> automatic DTrace support <span class="keyword">for</span> all your handlers, <span class="keyword">if</span> you're <span class="property">running</span> <span class="function_start"><span class="keyword">on</span></span> a platform <span class="keyword">that</span> supports DTrace.
</code></pre></blockquote>
<h2 id="creating_server">creating server</h2><p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  restify = <span class="built_in">require</span>(<span class="string">'restify'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	name:<span class="string">"Toodoo API"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  server = restify.createServer(options);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br></pre></td></tr></table></figure>
<p>index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  server =<span class="built_in">require</span>(<span class="string">'./server'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  port = <span class="built_in">Number</span>(process.env.SERVER_PORT) || <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">server.listen(port, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">' API server listening on %j'</span>, server.address());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="Routes">Routes</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// Print  direction structure</span><br><span class="line">192:01 Lyn$ find . -print |<span class="string"> sed -e 's;[^/]*/;</span>|<span class="string">____;g;s;____</span>|<span class="string">; </span>|<span class="string">;g'</span><br><span class="line">.</span><br><span class="line"></span>|<span class="string">____index.js</span><br><span class="line"></span>|____node_modules</span><br><span class="line">|<span class="string"> </span><br><span class="line"></span>|<span class="string">____package.json</span><br><span class="line"></span>|____resources</span><br><span class="line">|<span class="string"> </span>|<span class="string">____index.js</span><br><span class="line"></span>|<span class="string"> </span>|____items</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____create.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____del.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____index.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____list.js</span><br><span class="line"></span>|<span class="string"> </span>|____lists</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____create.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____del.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____index.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____list.js</span><br><span class="line"></span>|<span class="string">____routes.js</span><br><span class="line"></span>|<span class="string">____server.js</span></span><br></pre></td></tr></table></figure>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">server</span> = require(<span class="string">'./server'</span>);</span><br><span class="line">var resources = require(<span class="string">'./resources'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//lists</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//	server.get(urlPattern, function(req, res)&#123;</span></span><br><span class="line"><span class="comment">//		res.send(obj);</span></span><br><span class="line"><span class="comment">//	&#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">server</span>.get(<span class="string">'/lists'</span>,resources.lists.list);</span><br><span class="line"><span class="keyword">server</span>.put(<span class="string">'/lists/:list'</span>,resources.lists.create);</span><br><span class="line"><span class="keyword">server</span>.del(<span class="string">'/lists/:list'</span>,resources.lists.del);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Items</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">server</span>.get(<span class="string">'/lists/:list/items'</span>, resources.items.list);</span><br><span class="line"><span class="keyword">server</span>.post(<span class="string">'lists/:list/items'</span>,resources.items.create);</span><br><span class="line"><span class="keyword">server</span>.del(<span class="string">'/lists/:list/items/:item'</span>,resources.items.del);</span><br></pre></td></tr></table></figure>
<p>server.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  restify = <span class="built_in">require</span>(<span class="string">'restify'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	name:<span class="string">"Toodoo API"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  server = restify.createServer(options);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./routes'</span>);</span><br></pre></td></tr></table></figure>
<p>resources/index.js</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exports.lists = <span class="built_in">require</span>(<span class="string">'./lists'</span>);</span><br><span class="line">exports.items = <span class="built_in">require</span>(<span class="string">'./items'</span>);</span><br></pre></td></tr></table></figure>
<p>resources/lists/index.js</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports<span class="built_in">.</span><span class="built_in">list</span> = <span class="keyword">require</span>(<span class="string">'./list'</span>);</span><br><span class="line">exports<span class="built_in">.</span>create = <span class="keyword">require</span>(<span class="string">'./create'</span>);</span><br><span class="line">exports<span class="built_in">.</span>del =<span class="keyword">require</span>(<span class="string">'./del'</span>);</span><br></pre></td></tr></table></figure>
<p>resources/lists/list.js<br>resources/lists/del.js<br>resources/lists/create.js</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports= <span class="function"><span class="keyword">function</span> <span class="title">createItem</span><span class="params">(req,res,next)</span></span>&#123;</span><br><span class="line">	res.send(<span class="number">202</span>,&#123;hey:<span class="string">'there'</span>&#125;);</span><br><span class="line">	<span class="built_in">next</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -R resources<span class="regexp">/lists/</span>* resources<span class="regexp">/items/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192</span>:~ Lyn$ curl -I localhost:<span class="number">8080</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">404</span> Not Found</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: <span class="number">56</span></span><br><span class="line">Date: Sun, <span class="number">21</span> Feb <span class="number">2016</span> <span class="number">13</span>:<span class="number">39</span>:<span class="number">46</span> GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line"><span class="number">192</span>:~ Lyn$ curl -i localhost:<span class="number">8080</span>/lists</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: <span class="number">15</span></span><br><span class="line">Date: Sun, <span class="number">21</span> Feb <span class="number">2016</span> <span class="number">13</span>:<span class="number">40</span>:<span class="number">03</span> GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"hey"</span>:<span class="string">"there"</span>&#125;</span><br><span class="line"><span class="number">192</span>:~ Lyn$</span><br><span class="line"> </span><br><span class="line"><span class="number">192</span>:~ Lyn$ curl -X PUT -i localhost:<span class="number">8080</span>/lists/mylist</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: <span class="number">15</span></span><br><span class="line">Date: Sun, <span class="number">21</span> Feb <span class="number">2016</span> <span class="number">13</span>:<span class="number">41</span>:<span class="number">28</span> GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"hey"</span>:<span class="string">"there"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">192</span>:~ Lyn$</span><br><span class="line"><span class="number">192</span>:~ Lyn$ curl  -i localhost:<span class="number">8080</span>/lists/mylist/items</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: <span class="number">15</span></span><br><span class="line">Date: Sun, <span class="number">21</span> Feb <span class="number">2016</span> <span class="number">13</span>:<span class="number">45</span>:<span class="number">50</span> GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"hey"</span>:<span class="string">"there"</span>&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="number">192</span>:~ Lyn$ curl -X DELETE  -i localhost:<span class="number">8080</span>/lists/mylist/items/itemid</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: <span class="number">15</span></span><br><span class="line">Date: Sun, <span class="number">21</span> Feb <span class="number">2016</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">03</span> GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"hey"</span>:<span class="string">"there"</span>&#125;<span class="number">192</span>:~ Lyn$</span><br><span class="line"><span class="number">192</span>:~ Lyn$</span><br></pre></td></tr></table></figure>
<h2 id="Logging_requests">Logging requests</h2><h3 id="Bunyan">Bunyan</h3><blockquote>
<p>Bunyan is a simple and fast JSON logging library for node.js services<br>It is very powerfull tool which help you to logging specific info </p>
</blockquote>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">log</span> = bunyan.createLogger(&#123;</span><br><span class="line">  name: <span class="string">'myapp'</span>,</span><br><span class="line">  streams: [</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="string">'info'</span>,</span><br><span class="line">      stream: process.stdout            // <span class="built_in">log</span> INFO <span class="literal">and</span> above <span class="keyword">to</span> stdout</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="string">'error'</span>,</span><br><span class="line">      path: <span class="string">'/var/tmp/myapp-error.log'</span>  // <span class="built_in">log</span> ERROR <span class="literal">and</span> above <span class="keyword">to</span> a file</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192</span>:<span class="number">01</span> Lyn$ npm install bunyan --save</span><br><span class="line"></span><br><span class="line">npm WARN package.json api01@<span class="number">1.0</span><span class="number">.0</span> No repository field.</span><br><span class="line">npm WARN package.json api01@<span class="number">1.0</span><span class="number">.0</span> No README data</span><br><span class="line"></span><br><span class="line">&gt; dtrace-provider@<span class="number">0.6</span><span class="number">.0</span> install /Users/Lyn/src/node/node-api/<span class="number">01</span>/node_modules/bunyan/node_modules/dtrace-provider</span><br><span class="line">&gt; node scripts/install.js</span><br><span class="line"></span><br><span class="line">bunyan@<span class="number">1.6</span><span class="number">.0</span> node_modules/bunyan</span><br><span class="line">├── safe-json-stringify@<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">├── moment@<span class="number">2.11</span><span class="number">.2</span></span><br><span class="line">├── dtrace-provider@<span class="number">0.6</span><span class="number">.0</span> (nan@<span class="number">2.2</span><span class="number">.0</span>)</span><br><span class="line">└── mv@<span class="number">2.1</span><span class="number">.1</span> (ncp@<span class="number">2.0</span><span class="number">.0</span>, mkdirp@<span class="number">0.5</span><span class="number">.1</span>, rimraf@<span class="number">2.4</span><span class="number">.5</span>)</span><br></pre></td></tr></table></figure>
<p>server.js<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span>  restify = <span class="keyword">require</span>(<span class="string">'restify'</span>);</span><br><span class="line"><span class="built_in">var</span>  bunyan = <span class="keyword">require</span>(<span class="string">'bunyan'</span>); </span><br><span class="line"><span class="built_in">var</span> options = &#123;</span><br><span class="line">	name:<span class="string">"Toodoo API"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">var</span>  server = restify<span class="built_in">.</span>createServer(options);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server<span class="built_in">.</span><span class="keyword">on</span>(<span class="string">'after'</span>, restify<span class="built_in">.</span>auditLogger(&#123;</span><br><span class="line">	<span class="keyword">log</span>: bunyan<span class="built_in">.</span>createLogger(&#123;</span><br><span class="line">		name:<span class="string">'audit'</span>,</span><br><span class="line">		stream: process<span class="built_in">.</span>stdout</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.on('after', function ()&#123;</span></span><br><span class="line"><span class="comment">//	console.log('after', arguments);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">module<span class="built_in">.</span>exports = server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'./routes'</span>);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192</span>:<span class="number">01</span> Lyn$ node index.js</span><br><span class="line"></span><br><span class="line">API server listening on &#123;<span class="string">"address"</span>:<span class="string">"::"</span>,<span class="string">"family"</span>:<span class="string">"IPv6"</span>,<span class="string">"port"</span>:<span class="number">8080</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"audit"</span>,<span class="string">"hostname"</span>:<span class="string">"Lyn-Cheung-MBP.local"</span>,<span class="string">"pid"</span>:<span class="number">44385</span>,<span class="string">"audit"</span>:<span class="literal">true</span>,<span class="string">"level"</span>:<span class="number">30</span>,<span class="string">"remoteAddress"</span>:<span class="string">"::ffff:127.0.0.1"</span>,<span class="string">"remotePort"</span>:<span class="number">56088</span>,<span class="string">"req_id"</span>:<span class="string">"a701a353-6b55-4aa0-8888-5d67518867fb"</span>,<span class="string">"req"</span>:&#123;<span class="string">"query"</span>:<span class="string">""</span>,<span class="string">"method"</span>:<span class="string">"DELETE"</span>,<span class="string">"url"</span>:<span class="string">"/lists/mylist/items/itemid"</span>,<span class="string">"headers"</span>:&#123;<span class="string">"host"</span>:<span class="string">"localhost:8080"</span>,<span class="string">"user-agent"</span>:<span class="string">"curl/7.43.0"</span>,<span class="string">"accept"</span>:<span class="string">"*/*"</span>&#125;,<span class="string">"httpVersion"</span>:<span class="string">"1.1"</span>,<span class="string">"trailers"</span>:&#123;&#125;,<span class="string">"version"</span>:<span class="string">"*"</span>,<span class="string">"timers"</span>:&#123;<span class="string">"delItem"</span>:<span class="number">4500</span>&#125;&#125;,<span class="string">"res"</span>:&#123;<span class="string">"statusCode"</span>:<span class="number">200</span>,<span class="string">"headers"</span>:&#123;<span class="string">"content-type"</span>:<span class="string">"application/json"</span>,<span class="string">"content-length"</span>:<span class="number">15</span>&#125;,<span class="string">"trailer"</span>:<span class="literal">false</span>&#125;,<span class="string">"latency"</span>:<span class="number">8</span>,<span class="string">"_audit"</span>:<span class="literal">true</span>,<span class="string">"msg"</span>:<span class="string">"handled: 200"</span>,<span class="string">"time"</span>:<span class="string">"2016-02-21T14:21:20.022Z"</span>,<span class="string">"v"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">35</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
