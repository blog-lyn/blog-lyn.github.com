<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://lyn.s76.org/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e1a1e7f61eef21fbacf4a67a19789441";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/28/3des-of-javascript/" itemprop="url">
                  JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-28T20:39:04+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/3des-of-javascript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/3des-of-javascript/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用<a href="https://github.com/brix/crypto-js/tree/develop/src" target="_blank" rel="external">crypto-js库</a>来实现.这个过程把我折腾了一遍让我又好好复习了一遍字符,字符编码(ASCII&amp;Unicode),位运算符,但是还是想要更轻便的实现.于是最终采用了下面的实现方法:</p>
</blockquote>
<h1 id="3Des加密函数">3Des加密函数</h1><ul>
<li><p>内容采用 PKCS5Padding 方式填充，即长度以8 字节切分，不能被8 整除的末尾部分，根据长度不足8 字节的部分，填充“0x01”—“0x08”，如不足1 字节，<br>则填充1 个“0x01”，如不足2 字节，则填充2 个“0x02”，<br>以此类推，如整除，则填充8 个“0x08”；</p>
</li>
<li><p>参数：  </p>
<ol>
<li>key: 8字节字符串作为普通 DES 算法的密钥,或 24 字节字符串作为 3DES.   </li>
<li>message: 加密或解密的信息字符串.  </li>
<li>encrypt: 布尔值参数用来说明信息是加密还是解密.  </li>
<li>mode: 工作模式1:CBC模式，0:ECB模式(默认). </li>
<li>iv: 加密向量.</li>
<li>padding: 可选项, 8字节的输入向量字符串（在 ECB 模式下不使用）. </li>
</ol>
</li>
<li><p>密钥长度不足 24 字节时，右补ASCII 字符“0”；</p>
</li>
</ul>
<p>ps: 这个Des函数是来源于<code>https://etherhack.co.uk</code>的JS</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">des</span> <span class="params">(key, message, encrypt, mode, iv, padding)</span> </span>&#123;  </span><br><span class="line">  <span class="comment">//declaring this locally speeds things up a bit  </span></span><br><span class="line">  var spfunction1 = <span class="keyword">new</span> Array (<span class="number">0x1010400</span>,<span class="number">0</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x1010004</span>,<span class="number">0x10404</span>,<span class="number">0x4</span>,<span class="number">0x10000</span>,<span class="number">0x400</span>,<span class="number">0x1010400</span>,<span class="number">0x1010404</span>,<span class="number">0x400</span>,<span class="number">0x1000404</span>,<span class="number">0x1010004</span>,<span class="number">0x1000000</span>,<span class="number">0x4</span>,<span class="number">0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0x10400</span>,<span class="number">0x10400</span>,<span class="number">0x1010000</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x10004</span>,<span class="number">0x1000004</span>,<span class="number">0x1000004</span>,<span class="number">0x10004</span>,<span class="number">0</span>,<span class="number">0x404</span>,<span class="number">0x10404</span>,<span class="number">0x1000000</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x4</span>,<span class="number">0x1010000</span>,<span class="number">0x1010400</span>,<span class="number">0x1000000</span>,<span class="number">0x1000000</span>,<span class="number">0x400</span>,<span class="number">0x1010004</span>,<span class="number">0x10000</span>,<span class="number">0x10400</span>,<span class="number">0x1000004</span>,<span class="number">0x400</span>,<span class="number">0x4</span>,<span class="number">0x1000404</span>,<span class="number">0x10404</span>,<span class="number">0x1010404</span>,<span class="number">0x10004</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x1000004</span>,<span class="number">0x404</span>,<span class="number">0x10404</span>,<span class="number">0x1010400</span>,<span class="number">0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0</span>,<span class="number">0x10004</span>,<span class="number">0x10400</span>,<span class="number">0</span>,<span class="number">0x1010004</span>);  </span><br><span class="line">  var spfunction2 = <span class="keyword">new</span> Array (-<span class="number">0x7fef7fe0</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x8000</span>,<span class="number">0x108020</span>,<span class="number">0x100000</span>,<span class="number">0x20</span>,-<span class="number">0x7fefffe0</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7fffffe0</span>,-<span class="number">0x7fef7fe0</span>,-<span class="number">0x7fef8000</span>,-<span class="number">0x80000000</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x100000</span>,<span class="number">0x20</span>,-<span class="number">0x7fefffe0</span>,<span class="number">0x108000</span>,<span class="number">0x100020</span>,-<span class="number">0x7fff7fe0</span>,<span class="number">0</span>,-<span class="number">0x80000000</span>,<span class="number">0x8000</span>,<span class="number">0x108020</span>,-<span class="number">0x7ff00000</span>,<span class="number">0x100020</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0</span>,<span class="number">0x108000</span>,<span class="number">0x8020</span>,-<span class="number">0x7fef8000</span>,-<span class="number">0x7ff00000</span>,<span class="number">0x8020</span>,<span class="number">0</span>,<span class="number">0x108020</span>,-<span class="number">0x7fefffe0</span>,<span class="number">0x100000</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7ff00000</span>,-<span class="number">0x7fef8000</span>,<span class="number">0x8000</span>,-<span class="number">0x7ff00000</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x20</span>,-<span class="number">0x7fef7fe0</span>,<span class="number">0x108020</span>,<span class="number">0x20</span>,<span class="number">0x8000</span>,-<span class="number">0x80000000</span>,<span class="number">0x8020</span>,-<span class="number">0x7fef8000</span>,<span class="number">0x100000</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0x100020</span>,-<span class="number">0x7fff7fe0</span>,-<span class="number">0x7fffffe0</span>,<span class="number">0x100020</span>,<span class="number">0x108000</span>,<span class="number">0</span>,-<span class="number">0x7fff8000</span>,<span class="number">0x8020</span>,-<span class="number">0x80000000</span>,-<span class="number">0x7fefffe0</span>,-<span class="number">0x7fef7fe0</span>,<span class="number">0x108000</span>);  </span><br><span class="line">  var spfunction3 = <span class="keyword">new</span> Array (<span class="number">0x208</span>,<span class="number">0x8020200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000200</span>,<span class="number">0</span>,<span class="number">0x20208</span>,<span class="number">0x8000200</span>,<span class="number">0x20008</span>,<span class="number">0x8000008</span>,<span class="number">0x8000008</span>,<span class="number">0x20000</span>,<span class="number">0x8020208</span>,<span class="number">0x20008</span>,<span class="number">0x8020000</span>,<span class="number">0x208</span>,<span class="number">0x8000000</span>,<span class="number">0x8</span>,<span class="number">0x8020200</span>,<span class="number">0x200</span>,<span class="number">0x20200</span>,<span class="number">0x8020000</span>,<span class="number">0x8020008</span>,<span class="number">0x20208</span>,<span class="number">0x8000208</span>,<span class="number">0x20200</span>,<span class="number">0x20000</span>,<span class="number">0x8000208</span>,<span class="number">0x8</span>,<span class="number">0x8020208</span>,<span class="number">0x200</span>,<span class="number">0x8000000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000000</span>,<span class="number">0x20008</span>,<span class="number">0x208</span>,<span class="number">0x20000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000200</span>,<span class="number">0</span>,<span class="number">0x200</span>,<span class="number">0x20008</span>,<span class="number">0x8020208</span>,<span class="number">0x8000200</span>,<span class="number">0x8000008</span>,<span class="number">0x200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000208</span>,<span class="number">0x20000</span>,<span class="number">0x8000000</span>,<span class="number">0x8020208</span>,<span class="number">0x8</span>,<span class="number">0x20208</span>,<span class="number">0x20200</span>,<span class="number">0x8000008</span>,<span class="number">0x8020000</span>,<span class="number">0x8000208</span>,<span class="number">0x208</span>,<span class="number">0x8020000</span>,<span class="number">0x20208</span>,<span class="number">0x8</span>,<span class="number">0x8020008</span>,<span class="number">0x20200</span>);  </span><br><span class="line">  var spfunction4 = <span class="keyword">new</span> Array (<span class="number">0x802001</span>,<span class="number">0x2081</span>,<span class="number">0x2081</span>,<span class="number">0x80</span>,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x800001</span>,<span class="number">0x2001</span>,<span class="number">0</span>,<span class="number">0x802000</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x1</span>,<span class="number">0x2000</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0x80</span>,<span class="number">0x800000</span>,<span class="number">0x2001</span>,<span class="number">0x2080</span>,<span class="number">0x800081</span>,<span class="number">0x1</span>,<span class="number">0x2080</span>,<span class="number">0x800080</span>,<span class="number">0x2000</span>,<span class="number">0x802080</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x802000</span>,<span class="number">0x2080</span>,<span class="number">0x800080</span>,<span class="number">0x800081</span>,<span class="number">0x1</span>,<span class="number">0x802001</span>,<span class="number">0x2081</span>,<span class="number">0x2081</span>,<span class="number">0x80</span>,<span class="number">0x802081</span>,<span class="number">0x81</span>,<span class="number">0x1</span>,<span class="number">0x2000</span>,<span class="number">0x800001</span>,<span class="number">0x2001</span>,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x2001</span>,<span class="number">0x2080</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0x80</span>,<span class="number">0x800000</span>,<span class="number">0x2000</span>,<span class="number">0x802080</span>);  </span><br><span class="line">  var spfunction5 = <span class="keyword">new</span> Array (<span class="number">0x100</span>,<span class="number">0x2080100</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x80000</span>,<span class="number">0x100</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x40080100</span>,<span class="number">0x80000</span>,<span class="number">0x2000100</span>,<span class="number">0x40080100</span>,<span class="number">0x42000100</span>,<span class="number">0x42080000</span>,<span class="number">0x80100</span>,<span class="number">0x40000000</span>,<span class="number">0x2000000</span>,<span class="number">0x40080000</span>,<span class="number">0x40080000</span>,<span class="number">0</span>,<span class="number">0x40000100</span>,<span class="number">0x42080100</span>,<span class="number">0x42080100</span>,<span class="number">0x2000100</span>,<span class="number">0x42080000</span>,<span class="number">0x40000100</span>,<span class="number">0</span>,<span class="number">0x42000000</span>,<span class="number">0x2080100</span>,<span class="number">0x2000000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x80000</span>,<span class="number">0x42000100</span>,<span class="number">0x100</span>,<span class="number">0x2000000</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x40080100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000000</span>,<span class="number">0x42080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40080100</span>,<span class="number">0x100</span>,<span class="number">0x2000000</span>,<span class="number">0x42080000</span>,<span class="number">0x42080100</span>,<span class="number">0x80100</span>,<span class="number">0x42000000</span>,<span class="number">0x42080100</span>,<span class="number">0x2080000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000100</span>,<span class="number">0x80000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40000100</span>);  </span><br><span class="line">  var spfunction6 = <span class="keyword">new</span> Array (<span class="number">0x20000010</span>,<span class="number">0x20400000</span>,<span class="number">0x4000</span>,<span class="number">0x20404010</span>,<span class="number">0x20400000</span>,<span class="number">0x10</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x404010</span>,<span class="number">0x400000</span>,<span class="number">0x20000010</span>,<span class="number">0x400010</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010</span>,<span class="number">0</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0x4000</span>,<span class="number">0x404000</span>,<span class="number">0x20004010</span>,<span class="number">0x10</span>,<span class="number">0x20400010</span>,<span class="number">0x20400010</span>,<span class="number">0</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0x4010</span>,<span class="number">0x404000</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x20004000</span>,<span class="number">0x10</span>,<span class="number">0x20400010</span>,<span class="number">0x404000</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x4010</span>,<span class="number">0x20000010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010</span>,<span class="number">0x20000010</span>,<span class="number">0x20404010</span>,<span class="number">0x404000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>,<span class="number">0x20400010</span>,<span class="number">0x10</span>,<span class="number">0x4000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x4000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>);  </span><br><span class="line">  var spfunction7 = <span class="keyword">new</span> Array (<span class="number">0x200000</span>,<span class="number">0x4200002</span>,<span class="number">0x4000802</span>,<span class="number">0</span>,<span class="number">0x800</span>,<span class="number">0x4000802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x4200802</span>,<span class="number">0x200000</span>,<span class="number">0</span>,<span class="number">0x4000002</span>,<span class="number">0x2</span>,<span class="number">0x4000000</span>,<span class="number">0x4200002</span>,<span class="number">0x802</span>,<span class="number">0x4000800</span>,<span class="number">0x200802</span>,<span class="number">0x200002</span>,<span class="number">0x4000800</span>,<span class="number">0x4000002</span>,<span class="number">0x4200000</span>,<span class="number">0x4200800</span>,<span class="number">0x200002</span>,<span class="number">0x4200000</span>,<span class="number">0x800</span>,<span class="number">0x802</span>,<span class="number">0x4200802</span>,<span class="number">0x200800</span>,<span class="number">0x2</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x200000</span>,<span class="number">0x4000802</span>,<span class="number">0x4000802</span>,<span class="number">0x4200002</span>,<span class="number">0x4200002</span>,<span class="number">0x2</span>,<span class="number">0x200002</span>,<span class="number">0x4000000</span>,<span class="number">0x4000800</span>,<span class="number">0x200000</span>,<span class="number">0x4200800</span>,<span class="number">0x802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x802</span>,<span class="number">0x4000002</span>,<span class="number">0x4200802</span>,<span class="number">0x4200000</span>,<span class="number">0x200800</span>,<span class="number">0</span>,<span class="number">0x2</span>,<span class="number">0x4200802</span>,<span class="number">0</span>,<span class="number">0x200802</span>,<span class="number">0x4200000</span>,<span class="number">0x800</span>,<span class="number">0x4000002</span>,<span class="number">0x4000800</span>,<span class="number">0x800</span>,<span class="number">0x200002</span>);  </span><br><span class="line">  var spfunction8 = <span class="keyword">new</span> Array (<span class="number">0x10001040</span>,<span class="number">0x1000</span>,<span class="number">0x40000</span>,<span class="number">0x10041040</span>,<span class="number">0x10000000</span>,<span class="number">0x10001040</span>,<span class="number">0x40</span>,<span class="number">0x10000000</span>,<span class="number">0x40040</span>,<span class="number">0x10040000</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x10041000</span>,<span class="number">0x41040</span>,<span class="number">0x1000</span>,<span class="number">0x40</span>,<span class="number">0x10040000</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x1040</span>,<span class="number">0x41000</span>,<span class="number">0x40040</span>,<span class="number">0x10040040</span>,<span class="number">0x10041000</span>,<span class="number">0x1040</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x10040040</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x10041000</span>,<span class="number">0x1000</span>,<span class="number">0x40</span>,<span class="number">0x10040040</span>,<span class="number">0x1000</span>,<span class="number">0x41040</span>,<span class="number">0x10001000</span>,<span class="number">0x40</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10040040</span>,<span class="number">0x10000000</span>,<span class="number">0x40000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x40040</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10001000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x41000</span>,<span class="number">0x1040</span>,<span class="number">0x1040</span>,<span class="number">0x40040</span>,<span class="number">0x10000000</span>,<span class="number">0x10041000</span>);  </span><br><span class="line"> </span><br><span class="line">  <span class="comment">//create the 16 or 48 subkeys we will need  </span></span><br><span class="line">  var keys = des_createKeys (key);  </span><br><span class="line">  var m=<span class="number">0</span>, i, j, temp, temp2, right1, right2, left, right, looping;  </span><br><span class="line">  var cbcleft, cbcleft2, cbcright, cbcright2  </span><br><span class="line">  var endloop, loopinc;  </span><br><span class="line">  var len = message.length;  </span><br><span class="line">  var chunk = <span class="number">0</span>;  </span><br><span class="line">  <span class="comment">//set up the loops for single and triple des  </span></span><br><span class="line">  var iterations = keys.length == <span class="number">32</span> ? <span class="number">3</span> : <span class="number">9</span>; <span class="comment">//single or triple des  </span></span><br><span class="line">  <span class="keyword">if</span> (iterations == <span class="number">3</span>) &#123;  </span><br><span class="line">    looping = encrypt ? <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>) : <span class="keyword">new</span> Array (<span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">else</span> &#123;  </span><br><span class="line">    looping = encrypt ? <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>, <span class="number">62</span>, <span class="number">30</span>, -<span class="number">2</span>, <span class="number">64</span>, <span class="number">96</span>, <span class="number">2</span>) : <span class="keyword">new</span> Array (<span class="number">94</span>, <span class="number">62</span>, -<span class="number">2</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">2</span>, <span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//pad the message depending on the padding parameter  </span></span><br><span class="line">  <span class="keyword">if</span> (padding == <span class="number">2</span>)   </span><br><span class="line">    message += <span class="string">"        "</span>; <span class="comment">//pad the message with spaces  </span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (padding == <span class="number">1</span>) &#123;  </span><br><span class="line">    temp = <span class="number">8</span>-(len%<span class="number">8</span>); message += String.fromCharCode (temp,temp,temp,temp,temp,temp,temp,temp);   </span><br><span class="line">      <span class="keyword">if</span> (temp==<span class="number">8</span>)   </span><br><span class="line">        len+=<span class="number">8</span>;  </span><br><span class="line">  &#125; <span class="comment">//PKCS7 padding 这里其实只是PKCS5 padding, PKCS5规定采用8位补全，而PKCS7则不确定位数  </span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (!padding)   </span><br><span class="line">    message += <span class="string">"\0\0\0\0\0\0\0\0"</span>; <span class="comment">//pad the message out with null bytes  </span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//store the result here  </span></span><br><span class="line">  result = <span class="string">""</span>;  </span><br><span class="line">  tempresult = <span class="string">""</span>;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123; <span class="comment">//CBC mode  </span></span><br><span class="line">    cbcleft = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++);  </span><br><span class="line">    cbcright = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++);  </span><br><span class="line">    m=<span class="number">0</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//loop through each 64 bit chunk of the message  </span></span><br><span class="line">  <span class="keyword">while</span> (m &lt; len) &#123;  </span><br><span class="line">    left = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++);  </span><br><span class="line">    right = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//for Cipher Block Chaining mode, xor the message with the previous result  </span></span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123;<span class="keyword">if</span> (encrypt) &#123;left ^= cbcleft; right ^= cbcright;&#125; <span class="keyword">else</span> &#123;cbcleft2 = cbcleft; cbcright2 = cbcright; cbcleft = left; cbcright = right;&#125;&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//first each 64 but chunk of the message must be permuted according to IP  </span></span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0x0000ffff</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">    left = ((left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">31</span>));   </span><br><span class="line">    right = ((right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">31</span>));   </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//do this either 1 or 3 times for each chunk of the message  </span></span><br><span class="line">    <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;iterations; j+=<span class="number">3</span>) &#123;  </span><br><span class="line">      endloop = looping[j+<span class="number">1</span>];  </span><br><span class="line">      loopinc = looping[j+<span class="number">2</span>];  </span><br><span class="line">      <span class="comment">//now go through and perform the encryption or decryption    </span></span><br><span class="line">      <span class="keyword">for</span> (i=looping[j]; i!=endloop; i+=loopinc) &#123; <span class="comment">//for efficiency  </span></span><br><span class="line">        right1 = right ^ keys[i];   </span><br><span class="line">        right2 = ((right &gt;&gt;&gt; <span class="number">4</span>) | (right &lt;&lt; <span class="number">28</span>)) ^ keys[i+<span class="number">1</span>];  </span><br><span class="line">        <span class="comment">//the result is attained by passing these bytes through the S selection functions  </span></span><br><span class="line">        temp = left;  </span><br><span class="line">        left = right;  </span><br><span class="line">        right = temp ^ (spfunction2[(right1 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x3f</span>] | spfunction4[(right1 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction6[(right1 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x3f</span>] | spfunction8[right1 &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction1[(right2 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0x3f</span>] | spfunction3[(right2 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x3f</span>]  </span><br><span class="line">              | spfunction5[(right2 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0x3f</span>] | spfunction7[right2 &amp; <span class="number">0x3f</span>]);  </span><br><span class="line">      &#125;  </span><br><span class="line">      temp = left; left = right; right = temp; <span class="comment">//unreverse left and right  </span></span><br><span class="line">    &#125; <span class="comment">//for either 1 or 3 iterations  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//move then each one bit to the right  </span></span><br><span class="line">    left = ((left &gt;&gt;&gt; <span class="number">1</span>) | (left &lt;&lt; <span class="number">31</span>));   </span><br><span class="line">    right = ((right &gt;&gt;&gt; <span class="number">1</span>) | (right &lt;&lt; <span class="number">31</span>));   </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//now perform IP-1, which is IP in the opposite direction  </span></span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0x0000ffff</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//for Cipher Block Chaining mode, xor the message with the previous result  </span></span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="number">1</span>) &#123;<span class="keyword">if</span> (encrypt) &#123;cbcleft = left; cbcright = right;&#125; <span class="keyword">else</span> &#123;left ^= cbcleft2; right ^= cbcright2;&#125;&#125;  </span><br><span class="line">    tempresult += String.fromCharCode ((left&gt;&gt;&gt;<span class="number">24</span>), ((left&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xff</span>), ((left&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0xff</span>), (left &amp; <span class="number">0xff</span>), (right&gt;&gt;&gt;<span class="number">24</span>), ((right&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xff</span>), ((right&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0xff</span>), (right &amp; <span class="number">0xff</span>));  </span><br><span class="line">  </span><br><span class="line">    chunk += <span class="number">8</span>;  </span><br><span class="line">    <span class="keyword">if</span> (chunk == <span class="number">512</span>) &#123;result += tempresult; tempresult = <span class="string">""</span>; chunk = <span class="number">0</span>;&#125;  </span><br><span class="line">  &#125; <span class="comment">//for every 8 characters, or 64 bits in the message  </span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//return the result as an array  </span></span><br><span class="line">  <span class="keyword">return</span> result + tempresult;  </span><br><span class="line">&#125; <span class="comment">//end of des  </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//des_createKeys  </span></span><br><span class="line"><span class="comment">//this takes as input a 64 bit key (even though only 56 bits are used)  </span></span><br><span class="line"><span class="comment">//as an array of 2 integers, and returns 16 48 bit keys  </span></span><br><span class="line"><span class="function">function <span class="title">des_createKeys</span> <span class="params">(key)</span> </span>&#123;  </span><br><span class="line">  <span class="comment">//declaring this locally speeds things up a bit  </span></span><br><span class="line">  pc2bytes0  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x20000000</span>,<span class="number">0x20000004</span>,<span class="number">0x10000</span>,<span class="number">0x10004</span>,<span class="number">0x20010000</span>,<span class="number">0x20010004</span>,<span class="number">0x200</span>,<span class="number">0x204</span>,<span class="number">0x20000200</span>,<span class="number">0x20000204</span>,<span class="number">0x10200</span>,<span class="number">0x10204</span>,<span class="number">0x20010200</span>,<span class="number">0x20010204</span>);  </span><br><span class="line">  pc2bytes1  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1</span>,<span class="number">0x100000</span>,<span class="number">0x100001</span>,<span class="number">0x4000000</span>,<span class="number">0x4000001</span>,<span class="number">0x4100000</span>,<span class="number">0x4100001</span>,<span class="number">0x100</span>,<span class="number">0x101</span>,<span class="number">0x100100</span>,<span class="number">0x100101</span>,<span class="number">0x4000100</span>,<span class="number">0x4000101</span>,<span class="number">0x4100100</span>,<span class="number">0x4100101</span>);  </span><br><span class="line">  pc2bytes2  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x8</span>,<span class="number">0x800</span>,<span class="number">0x808</span>,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>,<span class="number">0</span>,<span class="number">0x8</span>,<span class="number">0x800</span>,<span class="number">0x808</span>,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>);  </span><br><span class="line">  pc2bytes3  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x200000</span>,<span class="number">0x8000000</span>,<span class="number">0x8200000</span>,<span class="number">0x2000</span>,<span class="number">0x202000</span>,<span class="number">0x8002000</span>,<span class="number">0x8202000</span>,<span class="number">0x20000</span>,<span class="number">0x220000</span>,<span class="number">0x8020000</span>,<span class="number">0x8220000</span>,<span class="number">0x22000</span>,<span class="number">0x222000</span>,<span class="number">0x8022000</span>,<span class="number">0x8222000</span>);  </span><br><span class="line">  pc2bytes4  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x10</span>,<span class="number">0x40010</span>,<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x10</span>,<span class="number">0x40010</span>,<span class="number">0x1000</span>,<span class="number">0x41000</span>,<span class="number">0x1010</span>,<span class="number">0x41010</span>,<span class="number">0x1000</span>,<span class="number">0x41000</span>,<span class="number">0x1010</span>,<span class="number">0x41010</span>);  </span><br><span class="line">  pc2bytes5  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x400</span>,<span class="number">0x20</span>,<span class="number">0x420</span>,<span class="number">0</span>,<span class="number">0x400</span>,<span class="number">0x20</span>,<span class="number">0x420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>);  </span><br><span class="line">  pc2bytes6  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0x2</span>,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0x2</span>,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>);  </span><br><span class="line">  pc2bytes7  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000</span>,<span class="number">0x800</span>,<span class="number">0x10800</span>,<span class="number">0x20000000</span>,<span class="number">0x20010000</span>,<span class="number">0x20000800</span>,<span class="number">0x20010800</span>,<span class="number">0x20000</span>,<span class="number">0x30000</span>,<span class="number">0x20800</span>,<span class="number">0x30800</span>,<span class="number">0x20020000</span>,<span class="number">0x20030000</span>,<span class="number">0x20020800</span>,<span class="number">0x20030800</span>);  </span><br><span class="line">  pc2bytes8  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0</span>,<span class="number">0x40000</span>,<span class="number">0x2</span>,<span class="number">0x40002</span>,<span class="number">0x2</span>,<span class="number">0x40002</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>);  </span><br><span class="line">  pc2bytes9  = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x8</span>,<span class="number">0x10000008</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x8</span>,<span class="number">0x10000008</span>,<span class="number">0x400</span>,<span class="number">0x10000400</span>,<span class="number">0x408</span>,<span class="number">0x10000408</span>,<span class="number">0x400</span>,<span class="number">0x10000400</span>,<span class="number">0x408</span>,<span class="number">0x10000408</span>);  </span><br><span class="line">  pc2bytes10 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x20</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x2000</span>,<span class="number">0x2020</span>,<span class="number">0x2000</span>,<span class="number">0x2020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>);  </span><br><span class="line">  pc2bytes11 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1000000</span>,<span class="number">0x200</span>,<span class="number">0x1000200</span>,<span class="number">0x200000</span>,<span class="number">0x1200000</span>,<span class="number">0x200200</span>,<span class="number">0x1200200</span>,<span class="number">0x4000000</span>,<span class="number">0x5000000</span>,<span class="number">0x4000200</span>,<span class="number">0x5000200</span>,<span class="number">0x4200000</span>,<span class="number">0x5200000</span>,<span class="number">0x4200200</span>,<span class="number">0x5200200</span>);  </span><br><span class="line">  pc2bytes12 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x1000</span>,<span class="number">0x8000000</span>,<span class="number">0x8001000</span>,<span class="number">0x80000</span>,<span class="number">0x81000</span>,<span class="number">0x8080000</span>,<span class="number">0x8081000</span>,<span class="number">0x10</span>,<span class="number">0x1010</span>,<span class="number">0x8000010</span>,<span class="number">0x8001010</span>,<span class="number">0x80010</span>,<span class="number">0x81010</span>,<span class="number">0x8080010</span>,<span class="number">0x8081010</span>);  </span><br><span class="line">  pc2bytes13 = <span class="keyword">new</span> Array (<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x100</span>,<span class="number">0x104</span>,<span class="number">0</span>,<span class="number">0x4</span>,<span class="number">0x100</span>,<span class="number">0x104</span>,<span class="number">0x1</span>,<span class="number">0x5</span>,<span class="number">0x101</span>,<span class="number">0x105</span>,<span class="number">0x1</span>,<span class="number">0x5</span>,<span class="number">0x101</span>,<span class="number">0x105</span>);  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//how many iterations (1 for des, 3 for triple des)  </span></span><br><span class="line">  var iterations = key.length &gt; <span class="number">8</span> ? <span class="number">3</span> : <span class="number">1</span>;   </span><br><span class="line">  <span class="comment">//stores the return keys  </span></span><br><span class="line">  var keys = <span class="keyword">new</span> Array (<span class="number">32</span> * iterations);  </span><br><span class="line">  <span class="comment">//now define the left shifts which need to be done  </span></span><br><span class="line">  var shifts = <span class="keyword">new</span> Array (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);  </span><br><span class="line">  <span class="comment">//other variables  </span></span><br><span class="line">  var lefttemp, righttemp, m=<span class="number">0</span>, n=<span class="number">0</span>, temp;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (var j=<span class="number">0</span>; j&lt;iterations; j++) &#123; <span class="comment">//either 1 or 3 iterations  </span></span><br><span class="line">    left = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++);  </span><br><span class="line">    right = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++);  </span><br><span class="line">  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0x0f0f0f0f</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">4</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0x0000ffff</span>; left ^= temp; right ^= (temp &lt;&lt; -<span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">2</span>) ^ right) &amp; <span class="number">0x33333333</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">2</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0x0000ffff</span>; left ^= temp; right ^= (temp &lt;&lt; -<span class="number">16</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0x00ff00ff</span>; left ^= temp; right ^= (temp &lt;&lt; <span class="number">8</span>);  </span><br><span class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span>; right ^= temp; left ^= (temp &lt;&lt; <span class="number">1</span>);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//the right side needs to be shifted and to get the last four bits of the left side  </span></span><br><span class="line">    temp = (left &lt;&lt; <span class="number">8</span>) | ((right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0x000000f0</span>);  </span><br><span class="line">    <span class="comment">//left needs to be put upside down  </span></span><br><span class="line">    left = (right &lt;&lt; <span class="number">24</span>) | ((right &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xff0000</span>) | ((right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff00</span>) | ((right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf0</span>);  </span><br><span class="line">    right = temp;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//now go through and perform these shifts on the left and right keys  </span></span><br><span class="line">    <span class="keyword">for</span> (var i=<span class="number">0</span>; i &lt; shifts.length; i++) &#123;  </span><br><span class="line">      <span class="comment">//shift the keys either one or two bits to the left  </span></span><br><span class="line">      <span class="keyword">if</span> (shifts[i]) &#123;left = (left &lt;&lt; <span class="number">2</span>) | (left &gt;&gt;&gt; <span class="number">26</span>); right = (right &lt;&lt; <span class="number">2</span>) | (right &gt;&gt;&gt; <span class="number">26</span>);&#125;  </span><br><span class="line">      <span class="keyword">else</span> &#123;left = (left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">27</span>); right = (right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">27</span>);&#125;  </span><br><span class="line">      left &amp;= -<span class="number">0xf</span>; right &amp;= -<span class="number">0xf</span>;  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">//now apply PC-2, in such a way that E is easier when encrypting or decrypting  </span></span><br><span class="line">      <span class="comment">//this conversion will look like PC-2 except only the last 6 bits of each byte are used  </span></span><br><span class="line">      <span class="comment">//rather than 48 consecutive bits and the order of lines will be according to   </span></span><br><span class="line">      <span class="comment">//how the S selection functions will be applied: S2, S4, S6, S8, S1, S3, S5, S7  </span></span><br><span class="line">      lefttemp = pc2bytes0[left &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes1[(left &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes2[(left &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0xf</span>] | pc2bytes3[(left &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes4[(left &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xf</span>] | pc2bytes5[(left &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">              | pc2bytes6[(left &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>];  </span><br><span class="line">      righttemp = pc2bytes7[right &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes8[(right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes9[(right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0xf</span>] | pc2bytes10[(right &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes11[(right &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xf</span>] | pc2bytes12[(right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xf</span>]  </span><br><span class="line">                | pc2bytes13[(right &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xf</span>];  </span><br><span class="line">      temp = ((righttemp &gt;&gt;&gt; <span class="number">16</span>) ^ lefttemp) &amp; <span class="number">0x0000ffff</span>;   </span><br><span class="line">      keys[n++] = lefttemp ^ temp; keys[n++] = righttemp ^ (temp &lt;&lt; <span class="number">16</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125; <span class="comment">//for each iterations  </span></span><br><span class="line">  <span class="comment">//return the keys we've created  </span></span><br><span class="line">  <span class="keyword">return</span> keys;  </span><br><span class="line">&#125; <span class="comment">//end of des_createKeys</span></span><br></pre></td></tr></table></figure>
<h1 id="调用3des加密和解密">调用3des加密和解密</h1><p>由于对加密的结果有以下要求:</p>
<ul>
<li>密钥长度不足 24 字节时，应当右补ASCII 字符“0”；</li>
<li>返回结果使用ASCII 形式的十六进制编码表示，采用大写“ABCDEF”，如加密结果为8 字节二进制字符串：0x0123456789ABCDEF，则Authenticator 为16 字节ASCII 字符串：”0123456789ABCDEF” 。</li>
<li>用hex的加密结果作为解密字符串时,函数应该将十六进制的字符串转换为ASCII码的字符串</li>
</ul>
<p>所以又重新封装了des加密函数. 加密出来的结果实际上是ACSII码,所以看起就是乱码,需要把ASCII码转换成16进制Hex.而解密的时候则需要把16进制的hex先转换回ASCII码.</p>
<p>参考如下:</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function encode3des(key, message) &#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </span><br><span class="line">            key+=<span class="string">"0"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">var</span> _temp=des(key, message, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> string2Hex(_temp);</span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line">function decode3des (key, message) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </span><br><span class="line">            key+=<span class="string">"0"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    message =hex2ASII(message);</span><br><span class="line">    <span class="keyword">return</span>  des(key, message, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function hex2ASII(str) &#123; </span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = '';</span><br><span class="line">    <span class="keyword">while</span> (str.length &gt;= <span class="number">2</span>) &#123; </span><br><span class="line">       <span class="literal">result</span> += <span class="type">String</span>.fromCharCode(parseInt(str.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">        str = str.substring(<span class="number">2</span>, str.length);</span><br><span class="line">    &#125;</span><br><span class="line">    message =<span class="literal">result</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">&#125; </span><br><span class="line">function string2Hex (s) &#123;</span><br><span class="line">    <span class="keyword">var</span> hex, i;</span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;s.length; i++) &#123;</span><br><span class="line">        hex = s.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="literal">result</span> += hex.slice(-<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>.toUpperCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/26/linux-network-cmd/" itemprop="url">
                  Linux网络抓包命令以及dns查询命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-26T19:38:23+08:00" content="2016-06-26">
              2016-06-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/26/linux-network-cmd/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/26/linux-network-cmd/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="tcpdump">tcpdump</h1><p>因为需要远程抓取一台设备的network记录. 所以需要想办法:</p>
<ol>
<li>把mbp做个wifi共享热点,让被抓包的设备连接到热点上来.</li>
<li>再把有线网卡的mac地址伪装成被抓包的设备,方便我们接入被抓包设备的网段.</li>
</ol>
<p>这样做以后:</p>
<ol>
<li>mbp就成了远程的设备的网关,所有流量就会经过mbp的有线网卡.</li>
<li>而且由于远程设备的代码中都是http协议的而不是https的.所以所有的流量都可以说是透明的. </li>
</ol>
<p>于是就可以抓包下来进行分析了.</p>
<p>这时候就需要用到tcpdump命令了,先使用tcpdump命令把所有的包储存成在本地的cap文件,然后再把这个cap文件丢到wireshark里面进行分析.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump -XvvennSs <span class="number">0</span> -w  <span class="built_in">log</span>.cap  host <span class="number">10.100</span><span class="number">.100</span><span class="number">.100</span></span><br></pre></td></tr></table></figure>
<p>ps: 感谢小毅提供的帮助~</p>
<h1 id="dns_查询_dig">dns 查询 dig</h1><p>在科学上网的过程中,dig命令是非常有帮助的一个命令,能帮你分析dns解析的过程.</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dscacheutil -flushcache  <span class="comment">//mac os中清理dns缓存的命令</span></span><br></pre></td></tr></table></figure>
<p>先用<code>man dig</code> 查询dig的manual(手册) </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">       dig - DNS lookup utility</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       dig [@server] [-b address] [-c class] [-f filename] [-k filename] [-m] [-p port#] [-q name] [-t type] [-x addr]</span><br><span class="line">           [-y [hmac:]name:key] [-4] [-6] [name] [type] [class] [queryopt...]</span><br><span class="line"></span><br><span class="line">       dig [-h]</span><br><span class="line"></span><br><span class="line">       dig [global-queryopt...] [query...]</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       dig (domain information groper) is a flexible tool for interrogating DNS name servers. It performs DNS lookups and displays</span><br><span class="line">       the answers that are returned from the name server(s) that were queried. Most DNS administrators <span class="operator"><span class="keyword">use</span> dig <span class="keyword">to</span> troubleshoot</span><br><span class="line">       DNS problems because <span class="keyword">of</span> its flexibility, ease <span class="keyword">of</span> <span class="keyword">use</span> <span class="keyword">and</span> clarity <span class="keyword">of</span> <span class="keyword">output</span>. Other lookup tools tend <span class="keyword">to</span> have <span class="keyword">less</span></span><br><span class="line">       functionality <span class="keyword">than</span> dig.</span><br><span class="line"></span><br><span class="line">       Although dig <span class="keyword">is</span> normally used <span class="keyword">with</span> command-line arguments, it also has a batch <span class="keyword">mode</span> <span class="keyword">of</span> operation <span class="keyword">for</span> reading lookup</span><br><span class="line">       requests <span class="keyword">from</span> a <span class="keyword">file</span>. A brief summary <span class="keyword">of</span> its command-line arguments <span class="keyword">and</span> options <span class="keyword">is</span> printed <span class="keyword">when</span> the -h <span class="keyword">option</span> <span class="keyword">is</span> given.</span><br><span class="line">       Unlike earlier <span class="keyword">versions</span>, the BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig allows multiple lookups <span class="keyword">to</span> be issued <span class="keyword">from</span> the command line.</span><br><span class="line"></span><br><span class="line">       Unless it <span class="keyword">is</span> told <span class="keyword">to</span> <span class="keyword">query</span> a specific <span class="keyword">name</span> <span class="keyword">server</span>, dig will try <span class="keyword">each</span> <span class="keyword">of</span> the servers listed <span class="keyword">in</span> /etc/resolv.conf.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">When</span> <span class="keyword">no</span> command line arguments <span class="keyword">or</span> options <span class="keyword">are</span> given, dig will perform an NS <span class="keyword">query</span> <span class="keyword">for</span> <span class="string">"."</span> (the root).</span><br><span class="line"></span><br><span class="line">       It <span class="keyword">is</span> possible <span class="keyword">to</span> <span class="keyword">set</span> per-<span class="keyword">user</span> <span class="keyword">defaults</span> <span class="keyword">for</span> dig via $&#123;HOME&#125;/.digrc. This <span class="keyword">file</span> <span class="keyword">is</span> <span class="keyword">read</span> <span class="keyword">and</span> <span class="keyword">any</span> options <span class="keyword">in</span> it <span class="keyword">are</span> applied</span><br><span class="line">       <span class="keyword">before</span> the command line arguments.</span><br><span class="line"></span><br><span class="line">       The <span class="keyword">IN</span> <span class="keyword">and</span> CH <span class="keyword">class</span> <span class="keyword">names</span> overlap <span class="keyword">with</span> the <span class="keyword">IN</span> <span class="keyword">and</span> CH top <span class="keyword">level</span> domains <span class="keyword">names</span>. Either <span class="keyword">use</span> the -<span class="keyword">t</span> <span class="keyword">and</span> -<span class="keyword">c</span> options <span class="keyword">to</span> specify</span><br><span class="line">       the <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span>, <span class="keyword">use</span> the -q the specify the <span class="keyword">domain</span> <span class="keyword">name</span>, <span class="keyword">or</span> <span class="keyword">use</span> <span class="string">"IN."</span> <span class="keyword">and</span> <span class="string">"CH."</span> <span class="keyword">when</span> looking up these top <span class="keyword">level</span> domains.</span><br><span class="line"></span><br><span class="line">SIMPLE <span class="keyword">USAGE</span></span><br><span class="line">       A typical invocation <span class="keyword">of</span> dig looks <span class="keyword">like</span>:</span><br><span class="line"></span><br><span class="line">            dig @<span class="keyword">server</span> <span class="keyword">name</span> <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">where</span>:</span><br><span class="line"></span><br><span class="line">       <span class="keyword">server</span></span><br><span class="line">           <span class="keyword">is</span> the <span class="keyword">name</span> <span class="keyword">or</span> IP address <span class="keyword">of</span> the <span class="keyword">name</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">query</span>. This can be an IPv4 address <span class="keyword">in</span> dotted-<span class="built_in">decimal</span> notation <span class="keyword">or</span> an</span><br><span class="line">           IPv6 address <span class="keyword">in</span> colon-<span class="keyword">delimited</span> notation. <span class="keyword">When</span> the supplied <span class="keyword">server</span> argument <span class="keyword">is</span> a hostname, dig resolves that <span class="keyword">name</span></span><br><span class="line">           <span class="keyword">before</span> querying that <span class="keyword">name</span> <span class="keyword">server</span>. <span class="keyword">If</span> <span class="keyword">no</span> <span class="keyword">server</span> argument <span class="keyword">is</span> provided, dig consults /etc/resolv.conf <span class="keyword">and</span> queries the <span class="keyword">name</span></span><br><span class="line">           servers listed there. The reply <span class="keyword">from</span> the <span class="keyword">name</span> <span class="keyword">server</span> that responds <span class="keyword">is</span> displayed.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">name</span></span><br><span class="line">           <span class="keyword">is</span> the <span class="keyword">name</span> <span class="keyword">of</span> the <span class="keyword">resource</span> <span class="built_in">record</span> that <span class="keyword">is</span> <span class="keyword">to</span> be looked up.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">type</span></span><br><span class="line">           indicates what <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">query</span> <span class="keyword">is</span> <span class="keyword">required</span> <span class="comment">-- ANY, A, MX, SIG, etc.  type can be any valid query type. If no type</span></span><br><span class="line">           argument <span class="keyword">is</span> supplied, dig will perform a lookup <span class="keyword">for</span> an A <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">       The -b <span class="keyword">option</span> <span class="keyword">sets</span> the <span class="keyword">source</span> IP address <span class="keyword">of</span> the <span class="keyword">query</span> <span class="keyword">to</span> address. This must be a valid address <span class="keyword">on</span> one <span class="keyword">of</span> the host<span class="string">'s network</span><br><span class="line">       interfaces or "0.0.0.0" or "::". An optional port may be specified by appending "#&lt;port&gt;"</span><br><span class="line"></span><br><span class="line">       The default query class (IN for internet) is overridden by the -c option.  class is any valid class, such as HS for Hesiod</span><br><span class="line">       records or CH for Chaosnet records.</span><br><span class="line"></span><br><span class="line">       The -f option makes dig operate in batch mode by reading a list of lookup requests to process from the file filename. The</span><br><span class="line">       file contains a number of queries, one per line. Each entry in the file should be organized in the same way they would be</span><br><span class="line">       presented as queries to dig using the command-line interface.</span><br><span class="line"></span><br><span class="line">       The -m option enables memory usage debugging.</span><br><span class="line"></span><br><span class="line">       If a non-standard port number is to be queried, the -p option is used.  port# is the port number that dig will send its</span><br><span class="line">       queries instead of the standard DNS port number 53. This option would be used to test a name server that has been</span><br><span class="line">       configured to listen for queries on a non-standard port number.</span><br><span class="line"></span><br><span class="line">       The -4 option forces dig to only use IPv4 query transport. The -6 option forces dig to only use IPv6 query transport.</span><br><span class="line"></span><br><span class="line">       The -t option sets the query type to type. It can be any valid query type which is supported in BIND 9. The default query</span><br><span class="line">       type is "A", unless the -x option is supplied to indicate a reverse lookup. A zone transfer can be requested by specifying</span><br><span class="line">       a type of AXFR. When an incremental zone transfer (IXFR) is required, type is set to ixfr=N. The incremental zone transfer</span><br><span class="line">       will contain the changes made to the zone since the serial number in the zone'</span>s SOA <span class="built_in">record</span> was <span class="keyword">N</span>.</span><br><span class="line"></span><br><span class="line">       The -q <span class="keyword">option</span> <span class="keyword">sets</span> the <span class="keyword">query</span> <span class="keyword">name</span> <span class="keyword">to</span> <span class="keyword">name</span>. This useful <span class="keyword">do</span> distinguish the <span class="keyword">name</span> <span class="keyword">from</span> other arguments.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Reverse</span> lookups <span class="comment">-- mapping addresses to names -- are simplified by the -x option.  addr is an IPv4 address in</span></span><br><span class="line">       dotted-<span class="built_in">decimal</span> notation, <span class="keyword">or</span> a colon-<span class="keyword">delimited</span> IPv6 address. <span class="keyword">When</span> this <span class="keyword">option</span> <span class="keyword">is</span> used, there <span class="keyword">is</span> <span class="keyword">no</span> need <span class="keyword">to</span> provide the <span class="keyword">name</span>,</span><br><span class="line">       <span class="keyword">class</span> <span class="keyword">and</span> <span class="keyword">type</span> arguments.  dig automatically performs a lookup <span class="keyword">for</span> a <span class="keyword">name</span> <span class="keyword">like</span> <span class="number">11.12</span><span class="number">.13</span><span class="number">.10</span>.<span class="keyword">in</span>-addr.arpa <span class="keyword">and</span> <span class="keyword">sets</span> the <span class="keyword">query</span></span><br><span class="line">       <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span> <span class="keyword">to</span> PTR <span class="keyword">and</span> <span class="keyword">IN</span> respectively. <span class="keyword">By</span> <span class="keyword">default</span>, IPv6 addresses <span class="keyword">are</span> looked up <span class="keyword">using</span> nibble <span class="keyword">format</span> <span class="keyword">under</span> the IP6.ARPA</span><br><span class="line">       <span class="keyword">domain</span>. <span class="keyword">To</span> <span class="keyword">use</span> the older RFC1886 method <span class="keyword">using</span> the IP6.<span class="built_in">INT</span> <span class="keyword">domain</span> specify the -<span class="keyword">i</span> <span class="keyword">option</span>. <span class="built_in">Bit</span> <span class="keyword">string</span> labels (RFC2874) <span class="keyword">are</span> <span class="keyword">now</span></span><br><span class="line">       experimental <span class="keyword">and</span> <span class="keyword">are</span> <span class="keyword">not</span> attempted.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">To</span> <span class="keyword">sign</span> the DNS queries sent <span class="keyword">by</span> dig <span class="keyword">and</span> their responses <span class="keyword">using</span> <span class="keyword">transaction</span> signatures (TSIG), specify a TSIG <span class="keyword">key</span> <span class="keyword">file</span> <span class="keyword">using</span></span><br><span class="line">       the -<span class="keyword">k</span> <span class="keyword">option</span>. You can also specify the TSIG <span class="keyword">key</span> itself <span class="keyword">on</span> the command line <span class="keyword">using</span> the -y <span class="keyword">option</span>;</span> hmac is the type of the</span><br><span class="line">       TSIG, default HMAC-MD5, name is the name of the TSIG key and key is the actual key. The key is a base-64 encoded string,</span><br><span class="line">       typically generated by dnssec-keygen(8). Caution should be taken when using the -y option on multi-user systems as the key</span><br><span class="line">       can be visible in the output from ps(1) or in the shell's history file. When using TSIG authentication with dig, the name</span><br><span class="line">       server that is queried needs to know the key and algorithm that is being used. In BIND, this is done by providing</span><br><span class="line">       appropriate key and server statements in named.conf.</span><br><span class="line"></span><br><span class="line">Mac OS X NOTICE</span><br><span class="line">       The dig command does not <span class="operator"><span class="keyword">use</span> the host <span class="keyword">name</span> <span class="keyword">and</span> address resolution <span class="keyword">or</span> the DNS <span class="keyword">query</span> routing mechanisms used <span class="keyword">by</span> other</span><br><span class="line">       processes running <span class="keyword">on</span> Mac OS X.  The results <span class="keyword">of</span> <span class="keyword">name</span> <span class="keyword">or</span> address queries printed <span class="keyword">by</span> dig may differ <span class="keyword">from</span> those <span class="keyword">found</span> <span class="keyword">by</span> other</span><br><span class="line">       processes that <span class="keyword">use</span> the Mac OS X <span class="keyword">native</span> <span class="keyword">name</span> <span class="keyword">and</span> address resolution mechanisms.  The results <span class="keyword">of</span> DNS queries may also differ</span><br><span class="line">       <span class="keyword">from</span> queries that <span class="keyword">use</span> the Mac OS X DNS routing <span class="keyword">library</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">QUERY</span> OPTIONS</span><br><span class="line">       dig provides a <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">query</span> options which affect the way <span class="keyword">in</span> which lookups <span class="keyword">are</span> made <span class="keyword">and</span> the results displayed. <span class="keyword">Some</span> <span class="keyword">of</span></span><br><span class="line">       these <span class="keyword">set</span> <span class="keyword">or</span> <span class="keyword">reset</span> flag bits <span class="keyword">in</span> the <span class="keyword">query</span> header, <span class="keyword">some</span> determine which sections <span class="keyword">of</span> the answer <span class="keyword">get</span> printed, <span class="keyword">and</span> others</span><br><span class="line">       determine the <span class="keyword">timeout</span> <span class="keyword">and</span> retry strategies.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">Each</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">is</span> <span class="keyword">identified</span> <span class="keyword">by</span> a keyword preceded <span class="keyword">by</span> a plus <span class="keyword">sign</span> (+). <span class="keyword">Some</span> keywords <span class="keyword">set</span> <span class="keyword">or</span> <span class="keyword">reset</span> an <span class="keyword">option</span>. These may</span><br><span class="line">       be preceded <span class="keyword">by</span> the <span class="keyword">string</span> <span class="keyword">no</span> <span class="keyword">to</span> negate the meaning <span class="keyword">of</span> that keyword. Other keywords assign <span class="keyword">values</span> <span class="keyword">to</span> options <span class="keyword">like</span> the</span><br><span class="line">       <span class="keyword">timeout</span> <span class="built_in">interval</span>. They have the <span class="keyword">form</span> +keyword=<span class="keyword">value</span>. The <span class="keyword">query</span> options <span class="keyword">are</span>:</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]tcp</span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] TCP <span class="keyword">when</span> querying <span class="keyword">name</span> servers. The <span class="keyword">default</span> behavior <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">use</span> UDP unless an AXFR <span class="keyword">or</span> IXFR <span class="keyword">query</span> <span class="keyword">is</span></span><br><span class="line">           requested, <span class="keyword">in</span> which <span class="keyword">case</span> a TCP <span class="keyword">connection</span> <span class="keyword">is</span> used.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]vc</span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] TCP <span class="keyword">when</span> querying <span class="keyword">name</span> servers. This alternate syntax <span class="keyword">to</span> +[<span class="keyword">no</span>]tcp <span class="keyword">is</span> provided <span class="keyword">for</span> backwards</span><br><span class="line">           <span class="keyword">compatibility</span>. The <span class="string">"vc"</span> stands <span class="keyword">for</span> <span class="string">"virtual circuit"</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">ignore</span></span><br><span class="line">           <span class="keyword">Ignore</span> truncation <span class="keyword">in</span> UDP responses instead <span class="keyword">of</span> retrying <span class="keyword">with</span> TCP. <span class="keyword">By</span> <span class="keyword">default</span>, TCP retries <span class="keyword">are</span> performed.</span><br><span class="line"></span><br><span class="line">       +<span class="keyword">domain</span>=somename</span><br><span class="line">           <span class="keyword">Set</span> the <span class="keyword">search</span> <span class="keyword">list</span> <span class="keyword">to</span> contain the single <span class="keyword">domain</span> somename, <span class="keyword">as</span> <span class="keyword">if</span> specified <span class="keyword">in</span> a <span class="keyword">domain</span> directive <span class="keyword">in</span> /etc/resolv.conf,</span><br><span class="line">           <span class="keyword">and</span> <span class="keyword">enable</span> <span class="keyword">search</span> <span class="keyword">list</span> processing <span class="keyword">as</span> <span class="keyword">if</span> the +<span class="keyword">search</span> <span class="keyword">option</span> were given.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">search</span></span><br><span class="line">           <span class="keyword">Use</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">use</span>] the <span class="keyword">search</span> <span class="keyword">list</span> defined <span class="keyword">by</span> the searchlist <span class="keyword">or</span> <span class="keyword">domain</span> directive <span class="keyword">in</span> resolv.conf (<span class="keyword">if</span> <span class="keyword">any</span>). The <span class="keyword">search</span> <span class="keyword">list</span></span><br><span class="line">           <span class="keyword">is</span> <span class="keyword">not</span> used <span class="keyword">by</span> <span class="keyword">default</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]showsearch</span><br><span class="line">           Perform [<span class="keyword">do</span> <span class="keyword">not</span> perform] a <span class="keyword">search</span> showing intermediate results.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]defname</span><br><span class="line">           Deprecated, treated <span class="keyword">as</span> a <span class="keyword">synonym</span> <span class="keyword">for</span> +[<span class="keyword">no</span>]<span class="keyword">search</span></span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]aaonly</span><br><span class="line">           <span class="keyword">Sets</span> the <span class="string">"aa"</span> flag <span class="keyword">in</span> the <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]aaflag</span><br><span class="line">           A <span class="keyword">synonym</span> <span class="keyword">for</span> +[<span class="keyword">no</span>]aaonly.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]adflag</span><br><span class="line">           <span class="keyword">Set</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">set</span>] the AD (authentic <span class="keyword">data</span>) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This requests the <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">return</span> whether all <span class="keyword">of</span> the answer</span><br><span class="line">           <span class="keyword">and</span> authority sections have all been validated <span class="keyword">as</span> secure according <span class="keyword">to</span> the <span class="keyword">security</span> <span class="keyword">policy</span> <span class="keyword">of</span> the <span class="keyword">server</span>. AD=<span class="number">1</span> indicates</span><br><span class="line">           that all <span class="keyword">records</span> have been validated <span class="keyword">as</span> secure <span class="keyword">and</span> the answer <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">from</span> a OPT-<span class="keyword">OUT</span> <span class="keyword">range</span>. AD=<span class="number">0</span> indicate that <span class="keyword">some</span> part</span><br><span class="line">           <span class="keyword">of</span> the answer was insecure <span class="keyword">or</span> <span class="keyword">not</span> validated.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cdflag</span><br><span class="line">           <span class="keyword">Set</span> [<span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">set</span>] the CD (checking disabled) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This requests the <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">not</span> perform DNSSEC <span class="keyword">validation</span></span><br><span class="line">           <span class="keyword">of</span> responses.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cl</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the <span class="keyword">CLASS</span> <span class="keyword">when</span> printing the <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]ttlid</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the TTL <span class="keyword">when</span> printing the <span class="built_in">record</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]recurse</span><br><span class="line">           Toggle the setting <span class="keyword">of</span> the RD (recursion desired) <span class="built_in">bit</span> <span class="keyword">in</span> the <span class="keyword">query</span>. This <span class="built_in">bit</span> <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">by</span> <span class="keyword">default</span>, which means dig normally</span><br><span class="line">           sends <span class="keyword">recursive</span> queries. Recursion <span class="keyword">is</span> automatically disabled <span class="keyword">when</span> the +nssearch <span class="keyword">or</span> +<span class="keyword">trace</span> <span class="keyword">query</span> options <span class="keyword">are</span> used.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]nssearch</span><br><span class="line">           <span class="keyword">When</span> this <span class="keyword">option</span> <span class="keyword">is</span> <span class="keyword">set</span>, dig attempts <span class="keyword">to</span> find the authoritative <span class="keyword">name</span> servers <span class="keyword">for</span> the zone containing the <span class="keyword">name</span> being</span><br><span class="line">           looked up <span class="keyword">and</span> display the SOA <span class="built_in">record</span> that <span class="keyword">each</span> <span class="keyword">name</span> <span class="keyword">server</span> has <span class="keyword">for</span> the zone.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">trace</span></span><br><span class="line">           Toggle tracing <span class="keyword">of</span> the delegation <span class="keyword">path</span> <span class="keyword">from</span> the root <span class="keyword">name</span> servers <span class="keyword">for</span> the <span class="keyword">name</span> being looked up. Tracing <span class="keyword">is</span> disabled <span class="keyword">by</span></span><br><span class="line">           <span class="keyword">default</span>. <span class="keyword">When</span> tracing <span class="keyword">is</span> enabled, dig makes iterative queries <span class="keyword">to</span> resolve the <span class="keyword">name</span> being looked up. It will follow</span><br><span class="line">           referrals <span class="keyword">from</span> the root servers, showing the answer <span class="keyword">from</span> <span class="keyword">each</span> <span class="keyword">server</span> that was used <span class="keyword">to</span> resolve the lookup.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]cmd</span><br><span class="line">           Toggles the printing <span class="keyword">of</span> the <span class="keyword">initial</span> <span class="keyword">comment</span> <span class="keyword">in</span> the <span class="keyword">output</span> identifying the <span class="keyword">version</span> <span class="keyword">of</span> dig <span class="keyword">and</span> the <span class="keyword">query</span> options that</span><br><span class="line">           have been applied. This <span class="keyword">comment</span> <span class="keyword">is</span> printed <span class="keyword">by</span> <span class="keyword">default</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]<span class="keyword">short</span></span><br><span class="line">           Provide a terse answer. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print the answer <span class="keyword">in</span> a verbose <span class="keyword">form</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]identify</span><br><span class="line">           <span class="keyword">Show</span> [<span class="keyword">or</span> <span class="keyword">do</span> <span class="keyword">not</span> <span class="keyword">show</span>] the IP address <span class="keyword">and</span> port <span class="built_in">number</span> that supplied the answer <span class="keyword">when</span> the +<span class="keyword">short</span> <span class="keyword">option</span> <span class="keyword">is</span> enabled. <span class="keyword">If</span></span><br><span class="line">           <span class="keyword">short</span> <span class="keyword">form</span> answers <span class="keyword">are</span> requested, the <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">to</span> <span class="keyword">show</span> the <span class="keyword">source</span> address <span class="keyword">and</span> port <span class="built_in">number</span> <span class="keyword">of</span> the <span class="keyword">server</span> that</span><br><span class="line">           provided the answer.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]comments</span><br><span class="line">           Toggle the display <span class="keyword">of</span> <span class="keyword">comment</span> <span class="keyword">lines</span> <span class="keyword">in</span> the <span class="keyword">output</span>. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print comments.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]stats</span><br><span class="line">           This <span class="keyword">query</span> <span class="keyword">option</span> toggles the printing <span class="keyword">of</span> <span class="keyword">statistics</span>: <span class="keyword">when</span> the <span class="keyword">query</span> was made, the <span class="keyword">size</span> <span class="keyword">of</span> the reply <span class="keyword">and</span> so <span class="keyword">on</span>. The</span><br><span class="line">           <span class="keyword">default</span> behavior <span class="keyword">is</span> <span class="keyword">to</span> print the <span class="keyword">query</span> <span class="keyword">statistics</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]qr</span><br><span class="line">           Print [<span class="keyword">do</span> <span class="keyword">not</span> print] the <span class="keyword">query</span> <span class="keyword">as</span> it <span class="keyword">is</span> sent. <span class="keyword">By</span> <span class="keyword">default</span>, the <span class="keyword">query</span> <span class="keyword">is</span> <span class="keyword">not</span> printed.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]question</span><br><span class="line">           Print [<span class="keyword">do</span> <span class="keyword">not</span> print] the question <span class="keyword">section</span> <span class="keyword">of</span> a <span class="keyword">query</span> <span class="keyword">when</span> an answer <span class="keyword">is</span> returned. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print the question</span><br><span class="line">           <span class="keyword">section</span> <span class="keyword">as</span> a <span class="keyword">comment</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]answer</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the answer <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]authority</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the authority <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]additional</span><br><span class="line">           Display [<span class="keyword">do</span> <span class="keyword">not</span> display] the additional <span class="keyword">section</span> <span class="keyword">of</span> a reply. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> display it.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]all</span><br><span class="line">           <span class="keyword">Set</span> <span class="keyword">or</span> <span class="keyword">clear</span> all display flags.</span><br><span class="line"></span><br><span class="line">       +<span class="keyword">time</span>=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="keyword">timeout</span> <span class="keyword">for</span> a <span class="keyword">query</span> <span class="keyword">to</span> <span class="keyword">T</span> seconds. The <span class="keyword">default</span> <span class="keyword">timeout</span> <span class="keyword">is</span> <span class="number">5</span> seconds. An attempt <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">T</span> <span class="keyword">to</span> <span class="keyword">less</span> <span class="keyword">than</span> <span class="number">1</span> will</span><br><span class="line">           <span class="keyword">result</span> <span class="keyword">in</span> a <span class="keyword">query</span> <span class="keyword">timeout</span> <span class="keyword">of</span> <span class="number">1</span> <span class="keyword">second</span> being applied.</span><br><span class="line"></span><br><span class="line">       +tries=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="built_in">number</span> <span class="keyword">of</span> times <span class="keyword">to</span> try UDP queries <span class="keyword">to</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">T</span> instead <span class="keyword">of</span> the <span class="keyword">default</span>, <span class="number">3.</span> <span class="keyword">If</span> <span class="keyword">T</span> <span class="keyword">is</span> <span class="keyword">less</span> <span class="keyword">than</span> <span class="keyword">or</span> equal <span class="keyword">to</span></span><br><span class="line">           zero, the <span class="built_in">number</span> <span class="keyword">of</span> tries <span class="keyword">is</span> silently rounded up <span class="keyword">to</span> <span class="number">1.</span></span><br><span class="line"></span><br><span class="line">       +retry=<span class="keyword">T</span></span><br><span class="line">           <span class="keyword">Sets</span> the <span class="built_in">number</span> <span class="keyword">of</span> times <span class="keyword">to</span> retry UDP queries <span class="keyword">to</span> <span class="keyword">server</span> <span class="keyword">to</span> <span class="keyword">T</span> instead <span class="keyword">of</span> the <span class="keyword">default</span>, <span class="number">2.</span> Unlike +tries, this does <span class="keyword">not</span></span><br><span class="line">           <span class="keyword">include</span> the <span class="keyword">initial</span> <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +ndots=<span class="keyword">D</span></span><br><span class="line">           <span class="keyword">Set</span> the <span class="built_in">number</span> <span class="keyword">of</span> dots that have <span class="keyword">to</span> appear <span class="keyword">in</span> <span class="keyword">name</span> <span class="keyword">to</span> <span class="keyword">D</span> <span class="keyword">for</span> it <span class="keyword">to</span> be considered <span class="keyword">absolute</span>. The <span class="keyword">default</span> <span class="keyword">value</span> <span class="keyword">is</span> that</span><br><span class="line">           defined <span class="keyword">using</span> the ndots <span class="keyword">statement</span> <span class="keyword">in</span> /etc/resolv.conf, <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">if</span> <span class="keyword">no</span> ndots <span class="keyword">statement</span> <span class="keyword">is</span> <span class="keyword">present</span>. <span class="keyword">Names</span> <span class="keyword">with</span> fewer dots <span class="keyword">are</span></span><br><span class="line">           interpreted <span class="keyword">as</span> <span class="keyword">relative</span> <span class="keyword">names</span> <span class="keyword">and</span> will be searched <span class="keyword">for</span> <span class="keyword">in</span> the domains listed <span class="keyword">in</span> the <span class="keyword">search</span> <span class="keyword">or</span> <span class="keyword">domain</span> directive <span class="keyword">in</span></span><br><span class="line">           /etc/resolv.conf.</span><br><span class="line"></span><br><span class="line">       +bufsize=B</span><br><span class="line">           <span class="keyword">Set</span> the UDP message buffer <span class="keyword">size</span> advertised <span class="keyword">using</span> EDNS0 <span class="keyword">to</span> B <span class="keyword">bytes</span>. The maximum <span class="keyword">and</span> <span class="keyword">minimum</span> <span class="keyword">sizes</span> <span class="keyword">of</span> this buffer <span class="keyword">are</span></span><br><span class="line">           <span class="number">65535</span> <span class="keyword">and</span> <span class="number">0</span> respectively. <span class="keyword">Values</span> outside this <span class="keyword">range</span> <span class="keyword">are</span> rounded up <span class="keyword">or</span> down appropriately. <span class="keyword">Values</span> other <span class="keyword">than</span> zero will</span><br><span class="line">           cause a EDNS <span class="keyword">query</span> <span class="keyword">to</span> be sent.</span><br><span class="line"></span><br><span class="line">       +edns=#</span><br><span class="line">           Specify the EDNS <span class="keyword">version</span> <span class="keyword">to</span> <span class="keyword">query</span> <span class="keyword">with</span>. Valid <span class="keyword">values</span> <span class="keyword">are</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">255.</span> Setting the EDNS <span class="keyword">version</span> will cause a EDNS <span class="keyword">query</span> <span class="keyword">to</span></span><br><span class="line">           be sent.  +noedns clears the remembered EDNS <span class="keyword">version</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]multiline</span><br><span class="line">           Print <span class="keyword">records</span> <span class="keyword">like</span> the SOA <span class="keyword">records</span> <span class="keyword">in</span> a verbose multi-line <span class="keyword">format</span> <span class="keyword">with</span> human-readable comments. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print</span><br><span class="line">           <span class="keyword">each</span> <span class="built_in">record</span> <span class="keyword">on</span> a single line, <span class="keyword">to</span> facilitate machine parsing <span class="keyword">of</span> the dig <span class="keyword">output</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]onesoa</span><br><span class="line">           Print <span class="keyword">only</span> one (<span class="keyword">starting</span>) SOA <span class="built_in">record</span> <span class="keyword">when</span> performing an AXFR. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> print <span class="keyword">both</span> the <span class="keyword">starting</span> <span class="keyword">and</span> ending SOA</span><br><span class="line">           <span class="keyword">records</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]fail</span><br><span class="line">           <span class="keyword">Do</span> <span class="keyword">not</span> try the <span class="keyword">next</span> <span class="keyword">server</span> <span class="keyword">if</span> you receive a SERVFAIL. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> try the <span class="keyword">next</span> <span class="keyword">server</span> which <span class="keyword">is</span> the <span class="keyword">reverse</span> <span class="keyword">of</span></span><br><span class="line">           <span class="keyword">normal</span> stub resolver behavior.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]besteffort</span><br><span class="line">           Attempt <span class="keyword">to</span> display the <span class="keyword">contents</span> <span class="keyword">of</span> messages which <span class="keyword">are</span> malformed. The <span class="keyword">default</span> <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> display malformed answers.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]dnssec</span><br><span class="line">           Requests DNSSEC <span class="keyword">records</span> be sent <span class="keyword">by</span> setting the DNSSEC OK <span class="built_in">bit</span> (<span class="keyword">DO</span>) <span class="keyword">in</span> the OPT <span class="built_in">record</span> <span class="keyword">in</span> the additional <span class="keyword">section</span> <span class="keyword">of</span> the</span><br><span class="line">           <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]sigchase</span><br><span class="line">           Chase DNSSEC signature chains. Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +trusted-<span class="keyword">key</span>=####</span><br><span class="line">           Specifies a <span class="keyword">file</span> containing trusted <span class="keyword">keys</span> <span class="keyword">to</span> be used <span class="keyword">with</span> +sigchase. <span class="keyword">Each</span> DNSKEY <span class="built_in">record</span> must be <span class="keyword">on</span> its own line.</span><br><span class="line"></span><br><span class="line">           <span class="keyword">If</span> <span class="keyword">not</span> specified, dig will look <span class="keyword">for</span> /etc/trusted-<span class="keyword">key</span>.<span class="keyword">key</span> <span class="keyword">then</span> trusted-<span class="keyword">key</span>.<span class="keyword">key</span> <span class="keyword">in</span> the <span class="keyword">current</span> <span class="keyword">directory</span>.</span><br><span class="line"></span><br><span class="line">           Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]topdown</span><br><span class="line">           <span class="keyword">When</span> chasing DNSSEC signature chains perform a top-down <span class="keyword">validation</span>. Requires dig be <span class="keyword">compiled</span> <span class="keyword">with</span> -DDIG_SIGCHASE.</span><br><span class="line"></span><br><span class="line">       +[<span class="keyword">no</span>]nsid</span><br><span class="line">           <span class="keyword">Include</span> an EDNS <span class="keyword">name</span> <span class="keyword">server</span> <span class="keyword">ID</span> request <span class="keyword">when</span> sending a <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">MULTIPLE QUERIES</span><br><span class="line">       The BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig supports specifying multiple queries <span class="keyword">on</span> the command line (<span class="keyword">in</span> addition <span class="keyword">to</span> supporting the -<span class="keyword">f</span></span><br><span class="line">       batch <span class="keyword">file</span> <span class="keyword">option</span>). <span class="keyword">Each</span> <span class="keyword">of</span> those queries can be supplied <span class="keyword">with</span> its own <span class="keyword">set</span> <span class="keyword">of</span> flags, options <span class="keyword">and</span> <span class="keyword">query</span> options.</span><br><span class="line"></span><br><span class="line">       <span class="keyword">In</span> this <span class="keyword">case</span>, <span class="keyword">each</span> <span class="keyword">query</span> argument represent an individual <span class="keyword">query</span> <span class="keyword">in</span> the command-line syntax described above. <span class="keyword">Each</span> consists</span><br><span class="line">       <span class="keyword">of</span> <span class="keyword">any</span> <span class="keyword">of</span> the standard options <span class="keyword">and</span> flags, the <span class="keyword">name</span> <span class="keyword">to</span> be looked up, an optional <span class="keyword">query</span> <span class="keyword">type</span> <span class="keyword">and</span> <span class="keyword">class</span> <span class="keyword">and</span> <span class="keyword">any</span> <span class="keyword">query</span> options</span><br><span class="line">       that should be applied <span class="keyword">to</span> that <span class="keyword">query</span>.</span><br><span class="line"></span><br><span class="line">       A <span class="keyword">global</span> <span class="keyword">set</span> <span class="keyword">of</span> <span class="keyword">query</span> options, which should be applied <span class="keyword">to</span> all queries, can also be supplied. These <span class="keyword">global</span> <span class="keyword">query</span> options</span><br><span class="line">       must precede the <span class="keyword">first</span> tuple <span class="keyword">of</span> <span class="keyword">name</span>, <span class="keyword">class</span>, <span class="keyword">type</span>, options, flags, <span class="keyword">and</span> <span class="keyword">query</span> options supplied <span class="keyword">on</span> the command line. <span class="keyword">Any</span></span><br><span class="line">       <span class="keyword">global</span> <span class="keyword">query</span> options (<span class="keyword">except</span> the +[<span class="keyword">no</span>]cmd <span class="keyword">option</span>) can be overridden <span class="keyword">by</span> a <span class="keyword">query</span>-specific <span class="keyword">set</span> <span class="keyword">of</span> <span class="keyword">query</span> options. <span class="keyword">For</span> example:</span><br><span class="line"></span><br><span class="line">           dig +qr www.isc.org <span class="keyword">any</span> -x <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> isc.org ns +noqr</span><br><span class="line"></span><br><span class="line">       shows how dig could be used <span class="keyword">from</span> the command line <span class="keyword">to</span> make three lookups: an <span class="keyword">ANY</span> <span class="keyword">query</span> <span class="keyword">for</span> www.isc.org, a <span class="keyword">reverse</span> lookup <span class="keyword">of</span></span><br><span class="line">       <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">and</span> a <span class="keyword">query</span> <span class="keyword">for</span> the NS <span class="keyword">records</span> <span class="keyword">of</span> isc.org. A <span class="keyword">global</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">of</span> +qr <span class="keyword">is</span> applied, so that dig shows the <span class="keyword">initial</span></span><br><span class="line">       <span class="keyword">query</span> it made <span class="keyword">for</span> <span class="keyword">each</span> lookup. The <span class="keyword">final</span> <span class="keyword">query</span> has a <span class="keyword">local</span> <span class="keyword">query</span> <span class="keyword">option</span> <span class="keyword">of</span> +noqr which means that dig will <span class="keyword">not</span> print the</span><br><span class="line">       <span class="keyword">initial</span> <span class="keyword">query</span> <span class="keyword">when</span> it looks up the NS <span class="keyword">records</span> <span class="keyword">for</span> isc.org.</span><br><span class="line"></span><br><span class="line">IDN SUPPORT</span><br><span class="line">       <span class="keyword">If</span> dig has been built <span class="keyword">with</span> IDN (internationalized <span class="keyword">domain</span> <span class="keyword">name</span>) support, it can <span class="keyword">accept</span> <span class="keyword">and</span> display non-<span class="keyword">ASCII</span> <span class="keyword">domain</span> <span class="keyword">names</span>.</span><br><span class="line">       dig appropriately converts <span class="built_in">character</span> <span class="keyword">encoding</span> <span class="keyword">of</span> <span class="keyword">domain</span> <span class="keyword">name</span> <span class="keyword">before</span> sending a request <span class="keyword">to</span> DNS <span class="keyword">server</span> <span class="keyword">or</span> displaying a reply</span><br><span class="line">       <span class="keyword">from</span> the <span class="keyword">server</span>. <span class="keyword">If</span> you<span class="string">'d like to turn off the IDN support for some reason, defines the IDN_DISABLE environment variable.</span><br><span class="line">       The IDN support is disabled if the variable is set when dig runs.</span><br><span class="line"></span><br><span class="line">FILES</span><br><span class="line">       /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">       $&#123;HOME&#125;/.digrc</span><br><span class="line"></span><br><span class="line">SEE ALSO</span><br><span class="line">       host(1), named(8), dnssec-keygen(8), RFC1035.</span><br><span class="line"></span><br><span class="line">BUGS</span><br><span class="line">       There are probably too many query options.</span><br><span class="line"></span><br><span class="line">COPYRIGHT</span><br><span class="line">       Copyright (C) 2004-2010 Internet Systems Consortium, Inc. ("ISC")</span><br><span class="line">       Copyright (C) 2000-2003 Internet Software Consortium.</span></span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+short">dig +short</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +<span class="keyword">short</span>  googlevideo.com</span><br><span class="line"><span class="number">172.217</span><span class="number">.25</span><span class="number">.228</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+nocmd">dig +nocmd</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +nocmd @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> www.google.com</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">51997</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">900</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">274</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">32</span>:<span class="number">49</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_-q">dig -q</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig -q  www.google.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; -q www.google.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">31256</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">839</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">0</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">33</span>:<span class="number">50</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+tcp">dig +tcp</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="cpp">Lyn-Cheung-MBP:~ Lyn$ dig +tcp www.google.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; +tcp www.google.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">41777</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">1</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.google.com.			IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.google.com.		<span class="number">744</span>	IN	A	<span class="number">216.58</span><span class="number">.200</span><span class="number">.196</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">5</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>)</span></span><br><span class="line">;; WHEN: Sun Jun <span class="number">26</span> <span class="number">19</span>:<span class="number">35</span>:<span class="number">25</span> <span class="number">2016</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">48</span></span></span><br></pre></td></tr></table></figure>
<h2 id="dig_+trace">dig +trace</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP:~ Lyn$ dig +trace @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> gooogle.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.8</span><span class="number">.3</span>-P1 &lt;&lt;&gt;&gt; +trace @<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> gooogle.com</span><br><span class="line">; (<span class="number">1</span> server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	a.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	b.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	c.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	d.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	e.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	f.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	g.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	h.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	i.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	j.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	k.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	l.root-servers.net.</span><br><span class="line">.			<span class="number">59872</span>	IN	NS	m.root-servers.net.</span><br><span class="line">;; Received <span class="number">228</span> bytes from <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span>) in <span class="number">4778</span> ms</span></span><br><span class="line"></span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	a.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	b.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	c.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	d.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	e.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	f.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	g.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	h.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	i.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	j.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	k.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	l.gtld-servers.net.</span><br><span class="line">com.			<span class="number">172800</span>	IN	NS	m.gtld-servers.net.</span><br><span class="line">;; Received <span class="number">489</span> bytes from <span class="number">198.97</span><span class="number">.190</span><span class="number">.53</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">198.97</span><span class="number">.190</span><span class="number">.53</span>) in <span class="number">932</span> ms</span></span><br><span class="line"></span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns2.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns1.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns3.google.com.</span><br><span class="line">gooogle.com.		<span class="number">172800</span>	IN	NS	ns4.google.com.</span><br><span class="line">;; Received <span class="number">172</span> bytes from <span class="number">192.31</span><span class="number">.80</span><span class="number">.30</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">192.31</span><span class="number">.80</span><span class="number">.30</span>) in <span class="number">1347</span> ms</span></span><br><span class="line"></span><br><span class="line">gooogle.com.		<span class="number">300</span>	IN	A	<span class="number">216.58</span><span class="number">.203</span><span class="number">.36</span></span><br><span class="line">;; Received <span class="number">45</span> bytes from <span class="number">216.239</span><span class="number">.38</span><span class="number">.10</span><span class="preprocessor">#<span class="number">53</span>(<span class="number">216.239</span><span class="number">.38</span><span class="number">.10</span>) in <span class="number">217</span> ms</span></span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/09/ios8-cors-prefilght/" itemprop="url">
                  iOS8下CORS请求返回504错误的Dubug记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-09T23:53:46+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/ios8-cors-prefilght/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/ios8-cors-prefilght/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>放假前遇到一个奇葩的问题,做了一个移动端使用原生JS写的一个互动的的web页面,这个页面需要通过ajax调用对后台的接口,结果出现了很诡异的现象:</p>
<blockquote>
<p>在Chrome浏览器上模拟手机或者是在安卓上都可以请求到后台的数据,但是在公司几台iOS的测试机(因为不想升级OS和xcode所以都还是iOS8的版本)上请求后台数据的时候,在Safari的开发调试中都会看到,http请求都会返回一个504网关超时的报错(然后还提示是CORS错误).具体现象就是请求发出去一分钟以后超时,返回504错误.</p>
</blockquote>
<h1 id="Debug过程:">Debug过程:</h1><h2 id="第一步_排除后台原因">第一步 排除后台原因</h2><p>因为上午的时候就发现了后台接口返回的<code>ResponseHeader</code>里没有对cors header的 <code>access-control-allow-origin</code>属性进行配置,导致请求接口被拒绝的情况,所以先怀疑是后台服务器的在中午更新之后又出了什么问题.</p>
<p>于是就让后台查一下服务器日志,看是不是接收到了这个请求(但是他们告诉我没有这个请求的日志).所以他们认为我这边请求没有发出来.(而且安卓都可以只有iOS不行,他们就觉得更不可能是他们的问题了)</p>
<ul>
<li>结论: 可能和他们没有关系.</li>
</ul>
<h2 id="第二步_排除iOS代码原因">第二步 排除iOS代码原因</h2><p>当时因为JS和iOS之间的调用接口是使用的是github上的开源库”WebViewJavascriptBridge”实现的.而这个库的原理就是在web页面中建立带有特定Url连接的iframe,然后在iOS端用webview的delegate来拦截带有特定标志的请求作为调用信号的.<br>所以就找到iOS开发的同学,问他们是不是有这种不正确的拦截的可能,以及是不是在他们代码中有其他的拦截http请求的设置? 答案也是没有.他们认为是我的代码有兼容性问题,或者是后台的问题.</p>
<p>这时候为了排除是不是iOS APP拦截造成的,于是就把web页面的url放进iPhone的Safari浏览器里运行,结果还是相同的504错误!这时候为了排除是App的干扰,索性把设备上的App都删掉了结果还是相同的错误!这说明确实不是iOS APP代码造成的!于是我又在自己的iPhone上的Safari中进行同样的测试,结果发现错误消失了!</p>
<ul>
<li>结论: 确实不是iOS APP代码的问题!</li>
</ul>
<h2 id="第三步_抓包分析">第三步 抓包分析</h2><p>这时候为了验证我的请求确实是发出了,就使用了Charles进行抓包(在iPhone的wifi中设置Charles的proxy代理地址),结果发现在公司的测试机上确实是有发出了一个请求,但是请求类型却是OPTIONS.然后Http请求就一直等待返回然后就超时了! 这时候后这个坑才要浮现出他的真面目!</p>
<h1 id="原因分析">原因分析</h1><ol>
<li>原来我们公司的服务器是基于Apache Mina Server(一个网络通信应用框架)自己开发的一个关网服务器来对Http请求进行处理,然而他们在实现中只接受post的Http请求!所以当接收到一个Options的请求的时候,当然置之不理了!更别说会在日志中记录这次请求!!!</li>
<li><p>那为什么我的ajax里面明明是post请求但在iOS8为什么发出的却是OPTIONS请求呢?!</p>
<p>查资料得知:原来都是<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="external">预请求(preflight)</a>挖的坑.</p>
</li>
</ol>
<blockquote>
<p>跨源资源共享标准通过新增一系列 HTTP 头，让服务器能声明哪些来源可以通过浏览器访问该服务器上的资源。另外，对那些会对服务器数据造成破坏性影响的 HTTP 请求方法（特别是 GET 以外的 HTTP 方法，或者搭配某些MIME类型的POST请求），标准强烈要求浏览器必须先以 OPTIONS 请求方式发送一个预请求(preflight request)，从而获知服务器端对跨源请求所支持 HTTP 方法。在确认服务器允许该跨源请求的情况下，以实际的 HTTP 请求方法发送那个真正的请求。服务器端也可以通知客户端，是不是需要随同请求一起发送信用信息（包括 Cookies 和 HTTP 认证相关数据）。</p>
</blockquote>
<p>那为什么在iOS9下就不存在这个问题呢? 还要抓包分析才能知道了.</p>
<p>正确的预请求和响应:</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-12/81504459.jpg" alt=""></p>
<h2 id="iOS8中web页面的CORS_http请求过程:">iOS8中web页面的CORS http请求过程:</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//OPTIONS 请求</span><br><span class="line">OPTIONS /editor/get_info' HTTP/1.1</span><br><span class="line">Host: <span class="number">192.168.8.64</span>:5555</span><br><span class="line">Accept-Language: zh-cn</span><br><span class="line">User-Agent: Mozilla/5.0 (iPhone<span class="comment">; CPU iPhone OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H321 Safari/600.1.4</span></span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://resource.domain.com/<span class="number">284671214/28</span><span class="number">4671249</span>/app.html</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Request-Headers: origin, content-type</span><br><span class="line">Content-Length: 0</span><br><span class="line">Origin: http://resource.domain.com/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">//服务器响应 OPTIONS请求的Header信息</span><br><span class="line">HTTP/<span class="number">1.1 200</span> OK</span><br><span class="line">Server: nginx/1.9.0</span><br><span class="line">Date: Sun, 12 Jun <span class="number">2016 01:58</span>:13 GMT</span><br><span class="line">Content-Type: text/html<span class="comment">; charset=UTF-8</span></span><br><span class="line">Content-Length: 30</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Access-Control-Allow-Headers: Origin,X-Requested-With,Content-Type,Accept</span><br><span class="line">Access-Control-Allow-Methods: GET,POST,OPTIONS</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line"></span><br><span class="line">//接下来就是像正常的POST请求一样发送</span><br><span class="line">POST /editor/get_info HTTP/1.1</span><br><span class="line">Host: <span class="number">192.168.8.64</span>:5555</span><br><span class="line">Referer: http://resource.domain.com/<span class="number">284671214/28</span><span class="number">4671249</span>/app.html?appId=<span class="number">5078b48f8</span>dbb<span class="number">3b8a14e8</span>d86df<span class="number">1c6691d51</span>42</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Accept-Language: zh-cn</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Origin: http://resource.domain.com/</span><br><span class="line">Content-Length: 31</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/5.0 (iPhone<span class="comment">; CPU iPhone OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H321 Safari/600.1.4</span></span><br></pre></td></tr></table></figure>
<h2 id="Chrome中web页面CORS请求">Chrome中web页面CORS请求</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="request">POST <span class="string">/editor/get_vote_info</span> HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="string">service.domain.com</span></span><br><span class="line"><span class="attribute">Connection</span>: <span class="string">keep-alive</span></span><br><span class="line"><span class="attribute">Content-Length</span>: <span class="string">74</span></span><br><span class="line"><span class="attribute">Cache-Control</span>: <span class="string">max-age=0</span></span><br><span class="line"><span class="attribute">Origin</span>: <span class="string">http://resource.domain.com</span></span><br><span class="line"><span class="attribute">User-Agent</span>: <span class="string">Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.23 Mobile Safari/537.36</span></span><br><span class="line"><span class="attribute">Content-Type</span>: <span class="string">text/plain;charset=UTF-8</span></span><br><span class="line"><span class="attribute">Accept</span>: <span class="string">*/*</span></span><br><span class="line"><span class="attribute">Referer</span>: <span class="string">http://resource.domain.com/268441891/268441895/app.html?appId=ed60a4c24aae8026e96402f83e097036edff</span></span><br><span class="line"><span class="attribute">Accept-Encoding</span>: <span class="string">gzip, deflate</span></span><br><span class="line"><span class="attribute">Accept-Language</span>: <span class="string">zh-CN,zh;q=0.8,en;q=0.6,ja;q=0.4,zh-TW;q=0.2</span></span><br></pre></td></tr></table></figure>
<h2 id="iOS9中的CORS请求">iOS9中的CORS请求</h2><p>和 Chrome 一致</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="built_in">Type</span>:	<span class="built_in">text</span>/plain;charset=UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure>
<h2 id="区别:">区别:</h2><p>原来都是Content-type没有设置,导致浏览器给设置了不同的content-type导致的.<br>参考w3中http1.1的关于<a href="https://www.w3.org/Protocols/rfc1341/4_Content-Type.html" target="_blank" rel="external">Content-Type</a>的定义:<br>Content-type的值必须要设置,如果没有设置的情况下会被当做”application/octet-stream”类型来处理,在这个bug中由虽然没有设置xhr的Content-Type但是浏览器设定了这个字段.</p>
<h1 id="解决方法:">解决方法:</h1><h2 id="让服务器对OPTIONS请求返回合适值">让服务器对OPTIONS请求返回合适值</h2><ol>
<li>处理OPTIONS请求</li>
<li>给OPTIONS正确的response(让浏览器知道服务器支持CORS的POST请求).<code>Access-Control-Allow-Methods: GET,POST,OPTIONS</code></li>
<li>返回正确的 <code>Access-Control-Allow-Headers: Content-Type</code></li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="status">HTTP/1.1 <span class="number">200</span> OK</span></span><br><span class="line"><span class="attribute">Server</span>: <span class="string">nginx/1.9.0</span></span><br><span class="line"><span class="attribute">Date</span>: <span class="string">Sun, 12 Jun 2016 01:58:13 GMT</span></span><br><span class="line"><span class="attribute">Content-Type</span>: <span class="string">text/html; charset=UTF-8</span></span><br><span class="line"><span class="attribute">Content-Length</span>: <span class="string">30</span></span><br><span class="line"><span class="attribute">Connection</span>: <span class="string">keep-alive</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: <span class="string">*</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span>: <span class="string">Origin,X-Requested-With,Content-Type,Accept</span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span>: <span class="string">GET,POST,OPTIONS //这里要接受OPTIONS </span></span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: <span class="string">true</span></span><br></pre></td></tr></table></figure>
<h2 id="设置XHR的RequestHeader">设置XHR的RequestHeader</h2><p>这里大神的书里也有偏差,道神写的书里记载着跨域的xhr的不能使用setRequestHeader.但实际上是可以的:</p>
<p>由于:</p>
<blockquote>
<p>从Gecko 2.0开始，text/plain, application/x-www-form-urlencoded 和 multipart/form-data 类型的数据都可以直接用于跨站请求，而不需要先发起“预请求”了</p>
</blockquote>
<p>所以可以把请求的类型强制设置为这三种之中的一种,但是也需要后台的接口能正确的处理这三种中的一种才可以选择这个解决方法.</p>
<h3 id="方法一:">方法一:</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">"<span class="keyword">POST</span>"</span>, url, true);</span><br><span class="line">xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'); //模拟form提交的数据</span><br><span class="line">xhr.send(paramStr);</span><br></pre></td></tr></table></figure>
<h3 id="方法二:">方法二:</h3><p>如果是使用formData,默认是把<code>Content-Type</code>设置为:<code>multipart/form-data</code>的. 但可以使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="external">Blob</a>作为构造函数指定要生成的对象的<code>Content-Type</code> 但是比起前面一种略麻烦:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> formData = <span class="built_in">new</span> FormData();</span><br><span class="line">formData.<span class="built_in">append</span>(<span class="string">'items'</span>, <span class="built_in">new</span> Blob([JSON.stringify(&#123;</span><br><span class="line">    name: <span class="string">"Book"</span>,</span><br><span class="line">    quantity: <span class="string">"12"</span></span><br><span class="line">&#125;)], &#123;</span><br><span class="line">    <span class="keyword">type</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<h1 id="总结:">总结:</h1><p>如果一开始的时候就去抓包分析,只要发现了OPTIONS请求类型和我设置的不一致,再展开去查找,而不是去胡乱猜想,一定会更快找到这个bug的原因.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/30/installEsxiOnGen8/" itemprop="url">
                  Mac 环境下 Hp Gen8 microServer安装 Esxi Synology DSM
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-30T20:33:03+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/30/installEsxiOnGen8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/30/installEsxiOnGen8/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="结构设计">结构设计</h1><ul>
<li>ESXI安装在TF卡/U盘上(8gb肯定足够用了)</li>
<li>SSD上装虚拟机</li>
<li>raid1直通虚拟机作数据存储</li>
</ul>
<blockquote>
<p>esxi读取是在启动时读取一次的,启动完成后，ESXi就在内存中运行了。<br>所以Esxi直接安装在MicroSD上。安装完毕后把卡拔下来，做一个完整的克隆备份或者直接克隆一个MicroSD实体卡以备不测</p>
</blockquote>
<h1 id="HP_gen8_相关工具">HP gen8 相关工具</h1><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/8170796.jpg" alt=""></p>
<blockquote>
<p>HP Gen8有自己的一套底层的管理系统,这里先讲一个小故事:<br>Gen8是当时在淘宝上买的,结果卖家亲自开车过来送货,同时还在淘宝卖家那里买了内存条,当时就说插上看看有没有问题(卖家车上自带电源逆变器,没有显示器). 结果开机半天了都还没有听到蜂鸣器的声音,于是我们拿着Gen8去路边的打印店借用显示器看下是什么原因.结果打印店的显示器都不方便拆线,卖家就问有没有网线,只要有网线就够了.<br>结果我们就插了一根网线到Gen8的ILO console口.在浏览器上访问gen8的ip地址,用机箱上自带的账号密码就登陆上ILO管理系统.发现确实是卡在了内存自检上.于是卖家就换了一根新的内存条给我.</p>
</blockquote>
<p>这就是服务器和普通PC相比的的神奇之处了吧.即使内存条有问题,Gen8底层的管理系统也可以启动起来,然后我们就可以方便的远程连接到ILO上看到服务器当前的状况.<br>可以查看服务器的各种信息.还可以在web页面上启动.net或者Java的远程桌面.(要在ie或者Safari下面打开ILO才行.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/90646810.jpg" alt=""></p>
<p>ILO的高级功能需要输入一个license-key 可以到淘宝去购买,很便宜.</p>
<h2 id="ILO">ILO</h2><h2 id="ADM">ADM</h2><h1 id="安装_ESXI_6-0_u2">安装 ESXI 6.0 u2</h1><h2 id="准备一个USB键盘">准备一个USB键盘</h2><p>因为mac的键盘和esxi还是ilo的映射不太正确,在安装过程中会出现F11按了不能被识别的情况,这时候就需要使用直接连接在Gen8上面的物理键盘按一下F11了.</p>
<h2 id="下载HPE_Custom_Image_for_ESXi_6-0_U2">下载HPE Custom Image for ESXi 6.0 U2</h2><ul>
<li><a href="https://my.vmware.com/web/vmware/details?downloadGroup=OEM-ESXI60U2-HPE&amp;productId=491" target="_blank" rel="external">https://my.vmware.com/web/vmware/details?downloadGroup=OEM-ESXI60U2-HPE&amp;productId=491</a> </li>
<li>Version: 6.0 U2</li>
<li>Release Date:2016-04-07</li>
</ul>
<p>下载好了以后,在Windows下就是在系统里挂载这个iSO然后像下面一样的勾选.<br>然而Hp的ILO对mac支持不是很好,能运行起来但是看不见选择加载的ISO.所以变通一下:把刚下载的esxi的ISO文件作为光驱挂载在Mac的PD9里的Windows上.(是不是特别绕?)还是直接看图:<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/87630709.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/78457314.jpg" alt=""></p>
<p>然后输入GEN8 dhcp或得到的ip启动ILO.选择virtual device 加载刚才的光驱.</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/79146767.jpg" alt=""></p>
<p>然后插上Usb键盘. 这时候就可以开机了</p>
<p>然后如果BIOS里的启动顺序是出厂的设置的话,那么等漫长的自检过了以后就会开始读取虚拟DVD里的镜像了.(注意 你的mac最好是使用网线,而且要和ilo在同一局域网内.不然加载会很慢,因为这里加载的iso实际上是在你的mac硬盘上的)</p>
<p>然后就会出现启动选择界面,当然选择install ESXI 然后就会开始加载了</p>
<p>加载好了以后就会要你选择安装的磁盘位置,设置管理员密码,然后就会按F11确认就开始安装了,因为ISO文件都只有300多MB所以安装的速度还是很快的.(这里为了防止装错.我是只插上了U盘其他的设备都没有接.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/83348189.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/31566859.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/41675492.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/78129151.jpg" alt=""></p>
<p>安装好了以后会提示重启.这时候就需要把网线接进Gen8的另外两个网口上了(或者其中之一),然后在管理界面就会提示你去浏览器上打开esxi的ip地址配置虚拟机.<br>接下来的就比较简单了:<br>和普通的VMware配置虚拟机没有什么区别.因为VMware的客户端只有Windows的,所以我就没有安装专业的配置客户端,而是全部都在VMware的web管理页面上操作的.对了,这个时候就需要输入你的VMwarelicense了.<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/6061113.jpg" alt=""></p>
<p>这时候就可以在开机自检的时候按F5去HPSSA(HP smart storage Administrator)中初始化你的磁盘了,如果是单块硬盘就只能加载成raid0才能识别.</p>
<h3 id="RDM">RDM</h3><p>磁盘直通,也就是把完整的一块Raid或者一块SATA 直接映射成为一个VMdk,然后虚拟机可以通过加载这个vmdk硬盘文件,实现passthrough. </p>
<p>在配置好虚拟机以后,在web管理页面或者ilo中按F2进入管理界面,启用SSH<br>然后ssh 上esxi<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@<span class="number">192.168</span><span class="number">.1</span><span class="number">.222</span>(你的esxi的dhcpIP地址)</span><br></pre></td></tr></table></figure></p>
<p>然后使用以下的命令获取到你要RDM的磁盘信息</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> ls <span class="regexp">/dev/</span>disks</span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span>L0</span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">1</span></span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">5</span></span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">6</span></span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">7</span></span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">8</span></span><br><span class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">9</span></span><br><span class="line">naa<span class="number">.600508</span>b1001c0f178bbb175b496a3f68</span><br><span class="line">naa<span class="number">.600508</span><span class="string">b1001c0f178bbb175b496a3f68:</span><span class="number">1</span></span><br><span class="line">naa<span class="number">.600508</span>b1001c2031e2eb51ae0420a11f</span><br></pre></td></tr></table></figure>
<p>通过下面的命令获取到volumes下面的SSD系统盘的名称</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ls vmfs/volumes/ -l</span><br><span class="line">total <span class="number">1792</span></span><br><span class="line">drwxr-xr-t    <span class="number">1</span> root     root          <span class="number">2100</span> Jul <span class="number">19</span> <span class="number">23</span>:<span class="number">57</span> <span class="number">55</span>a7da09-<span class="number">6</span>a7727f6-d50b-<span class="number">70106f</span>3eb224</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root     root             <span class="number">8</span> Jan  <span class="number">1</span>  <span class="number">1970</span> <span class="number">55</span>a834d9-c3bb963e-<span class="number">218</span>c-<span class="number">70106f</span>3eb224</span><br><span class="line">lrwxr-xr-x    <span class="number">1</span> root     root            <span class="number">35</span> Jul <span class="number">20</span> <span class="number">00</span>:<span class="number">35</span> SSD-&gt; <span class="number">55</span>a7da09-<span class="number">6</span>a7727f6-d50b-<span class="number">70106f</span>3eb224</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root     root             <span class="number">8</span> Jan  <span class="number">1</span>  <span class="number">1970</span> e052ace5-bc3d44fd-<span class="number">4</span>b45-<span class="number">39</span>d0f75d754e</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root     root             <span class="number">8</span> Jan  <span class="number">1</span>  <span class="number">1970</span> f0811cef-d4c5ddf9-<span class="number">1088</span>-<span class="number">94015e0</span>ad7d9</span><br></pre></td></tr></table></figure>
<p>请自行替换磁盘（naa.xxx）、ssd系统盘（system）、虚拟磁盘文件（*.vmdk）的名称，创建成功后会在ssd系统目录下出现于磁盘容量相同的vmdk文件。然后就可以添加这个vmdk作为现有硬盘到虚拟机使用了.</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -z <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks/</span>naa.<span class="number">600508</span>b1001c94879db735b10944bfc2<span class="regexp">/vmfs/</span>volumes<span class="regexp">/system/</span>raid0.vmdk</span><br></pre></td></tr></table></figure>
<p>查看vmdk映射内容</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span><span class="symbol">:/vmfs/volumes/</span><span class="number">55</span>a7da09-<span class="number">6</span>a7727f6-d50b-<span class="number">70106</span>f3eb224] cat <span class="constant">Raid1.</span>vmdk</span><br><span class="line"><span class="comment"># Disk DescriptorFile</span></span><br><span class="line">version=<span class="number">1</span></span><br><span class="line">encoding=<span class="string">"UTF-8"</span></span><br><span class="line"><span class="constant">CID=</span>fffffffe</span><br><span class="line">parentCID=ffffffff</span><br><span class="line">isNativeSnapshot=<span class="string">"no"</span></span><br><span class="line">createType=<span class="string">"vmfsPassthroughRawDeviceMap"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extent description</span></span><br><span class="line"><span class="constant">RW </span><span class="number">5860467632</span> <span class="constant">VMFSRDM </span><span class="string">"Raid1-rdmp.vmdk"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Disk Data Base</span></span><br><span class="line"><span class="comment">#DDB</span></span><br><span class="line"></span><br><span class="line">ddb.adapterType = <span class="string">"lsilogic"</span></span><br><span class="line">ddb.geometry.cylinders = <span class="string">"364797"</span></span><br><span class="line">ddb.geometry.heads = <span class="string">"255"</span></span><br><span class="line">ddb.geometry.sectors = <span class="string">"63"</span></span><br><span class="line">ddb.longContentID = <span class="string">"b1655129dd033737e3ead76ffffffffe"</span></span><br><span class="line">ddb.uuid = <span class="string">"60 00 C2 94 d1 90 d9 b1-11 6e 14 90 58 0d 39 0f"</span></span><br><span class="line">ddb.virtualHWVersion = <span class="string">"11"</span></span><br></pre></td></tr></table></figure>
<h3 id="RDM官方文档参考:">RDM官方文档参考:</h3><p>要使用 ESXi/ESX 主机配置本地存储上的 RDM，需要满足以下两个条件：</p>
<ul>
<li><p>候选设备必须支持 SCSI Inquiry 重要产品数据 (VPD) 页面代码 0x83，该代码用于直接寻址和与 RDM 设备通信。有关 SCSI 感知代码的详细信息，请参见 Understanding SCSI Check Conditions in VMkernel logs during rescan operations (1010244)。</p>
</li>
<li><p>候选设备必须导出可使 ESXi/ESX 主机唯一标识用作 RDM 的设备的全局序列号。<br>注意：充当 RDM 的此功能可能在一些本地控制器及其连接的存储上不可用。请联系您的硬件供应商以确认您的控制器是否支持所需条件，并寻求任何技术支持。</p>
</li>
</ul>
<p>如果您有合适的控制器，则可以将本地设备配置为 RDM。必须使用命令行界面 (CLI) 将本地存储设备配置为 RDM，无法通过 vSphere Client 执行此操作。</p>
<p>要将本地设备配置为 RDM 磁盘，请执行以下操作：<br>打开与 ESXi/ESX 主机的 SSH 会话。<br>运行以下命令列出已连接到 ESXi 主机的磁盘：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> -<span class="keyword">l</span> /vmfs/devices/disks</span><br></pre></td></tr></table></figure>
<p>在列表中，标识要配置为 RDM 的本地设备，并复制设备名称。</p>
<p><strong>注意</strong>：设备名称将很可能使用 t10. 前缀，类似于以下名称：<code>t10.F405E46494C4540046F455B64787D285941707D203F45765</code></p>
<p>要将设备配置为 RDM，并将 RDM 指针文件输出到您所选的目标，请运行以下命令：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -z <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks/</span>diskname<span class="regexp">/vmfs/</span>volumes<span class="regexp">/datastorename/</span>vmfolder<span class="regexp">/vmname.vmdk</span></span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -z /vmfs/devices/disks/t10.F<span class="number">405E46494</span>C<span class="number">4540046F45</span><span class="number">5B64787D28</span><span class="number">5941707D203</span>F45765 /vmfs/volumes/Datastore2/localrdm1/localrdm1.vmdk</span><br></pre></td></tr></table></figure>
<p>注意：新创建的 RDM 指针文件的大小显示为与其映射到的裸设备相同的大小，它是一个虚拟文件，不占用任何存储空间。</p>
<p>如果已创建 RDM 指针文件，请使用 vSphere Client 将 RDM 连接到虚拟机：</p>
<ol>
<li>右键单击要将 RDM 磁盘添加到的虚拟机。</li>
<li>单击编辑设置。</li>
<li>单击添加…</li>
<li>选择硬盘。</li>
<li>选择使用现有虚拟磁盘。</li>
<li>浏览到步骤 5 中保存 RDM 指针的目录，选择 RDM 指针文件，然后单击下一步。</li>
<li>选择要将磁盘连接到的虚拟 SCSI 控制器，然后单击下一步。</li>
<li>单击完成。</li>
</ol>
<p>现在，虚拟机清单中的新硬盘应显示为映射的裸 LUN。</p>
<p><strong>注意:</strong></p>
<ul>
<li>由于此虚拟机现有已连接的本地磁盘迁移，因此无法使用 vMotion。</li>
<li>如果需要从虚拟机中移除本地 RDM 映射，只需对共享存储 RDM 应用相同步骤。在 vSphere Client 中，右键单击虚拟机，单击编辑设置，选择 RDM 然后单击从磁盘删除。此操作不会删除磁盘中的数据，而仅删除 RDM 映射文件。</li>
</ul>
<h3 id="ESXI磁盘分区(不是必须的)">ESXI磁盘分区(不是必须的)</h3><p>如果你的磁盘之前安装过别的系统导致esxi下无法正确加载 可以参考以下方法 重新分区.</p>
<p>ssh到esxi 上后使用 Fdisk 或者 esxi 提供的分区工具 可以删除原有分区,然后直接在虚拟机中进行格式化</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:~] fdisk /dev/disks/naa.<span class="number">600508b100</span><span class="number">1c2031e2</span>eb51ae0420a11f</span><br><span class="line">Command Action</span><br><span class="line">a	toggle a bootable flag</span><br><span class="line">b	edit bsd disklabel</span><br><span class="line">c	toggle the dos compatibility flag</span><br><span class="line">d	delete a partition</span><br><span class="line">l	list known partition types</span><br><span class="line">n	add a new partition</span><br><span class="line">o	create a new empty DOS partition table</span><br><span class="line">p	print the partition table</span><br><span class="line">q	quit without saving changes</span><br><span class="line">s	create a new empty Sun disklabel</span><br><span class="line">t	change a partition's system id</span><br><span class="line">u	change display/entry units</span><br><span class="line">v	verify the partition table</span><br><span class="line">w	write table to disk and exit</span><br><span class="line">x	extra functionality (experts only)</span><br><span class="line"></span><br><span class="line">[root@localhost:~] ls /vmfs/devices/disks/</span><br><span class="line"></span><br><span class="line">[root@localhost:~] partedUtil getptbl /vmfs/devices/disks/naa.<span class="number">600508b100</span><span class="number">1c2031e2</span>eb51ae0420a11f</span><br><span class="line">msdos</span><br><span class="line"><span class="number">364797 255</span> <span class="number">63 58604676</span>32</span><br><span class="line"><span class="number">1 63 42949</span><span class="number">61684 131 0</span></span><br><span class="line">Usage:</span><br><span class="line"> Get Partitions : get &lt;diskName&gt;</span><br><span class="line"> Set Partitions : set &lt;diskName&gt; ["partNum startSector endSector type attr"]*</span><br><span class="line"> Delete Partition : delete &lt;diskName&gt; &lt;partNum&gt;</span><br><span class="line"> Resize Partition : resize &lt;diskName&gt; &lt;partNum&gt; &lt;start&gt; &lt;end&gt;</span><br><span class="line"> Get Partitions : getptbl &lt;diskName&gt;</span><br><span class="line"> Set Partitions : setptbl &lt;diskName&gt; &lt;label&gt; ["partNum startSector endSector type/guid attr"]*</span><br><span class="line"> Fix Partition Table : fix &lt;diskName&gt;</span><br><span class="line"> Create New Label (all existing data will be lost): mklabel &lt;diskName&gt; &lt;label&gt;</span><br><span class="line"> Show commonly used partition type guids : showGuids</span><br><span class="line"> Get usable first and last sectors : getUsableSectors &lt;diskName&gt;</span><br><span class="line"> Fix GPT Table interactively : fixGpt &lt;diskName&gt;</span><br><span class="line"></span><br><span class="line">[root@localhost:~] partedUtil delete /vmfs/devices/disks/naa.<span class="number">600508b100</span><span class="number">1c2031e2</span>eb51ae0420a11f 1</span><br><span class="line"></span><br><span class="line">[root@localhost:~] partedUtil showGuids</span><br><span class="line"> Partition Type       GUID</span><br><span class="line"> vmfs                 AA<span class="number">31E02A400</span>F11DB<span class="number">9590000C29</span>11D1B8</span><br><span class="line"> vmkDiagnostic        <span class="number">9D27538040</span>AD11DBBF<span class="number">97000C2911</span>D1B8</span><br><span class="line"> vsan                 381CFCCC<span class="number">728811E09</span>2EE<span class="number">000C2911</span>D0B2</span><br><span class="line"> virsto               <span class="number">77719A0</span>CA<span class="number">4A011E3</span><span class="keyword">A</span><span class="number">47E000C29</span>745A24</span><br><span class="line"> VMware Reserved      9198EFFC31C011DB<span class="number">8F78000C29</span>11D1B8</span><br><span class="line"> Basic Data           EBD<span class="number">0A0A2B9</span>E<span class="number">5443387C06</span><span class="number">8B6B72699</span>C7</span><br><span class="line"> Linux Swap           0657FD6DA4AB<span class="number">43C484E50</span><span class="number">933C84B4</span>F4F</span><br><span class="line"> Linux Lvm            E<span class="number">6D6D379</span>F<span class="number">50744C2A23</span>C<span class="number">238F2A3</span>DF928</span><br><span class="line"> Linux Raid           <span class="keyword">A</span><span class="number">19D880F05</span>FC4D3BA<span class="number">006743F0</span>F84911E</span><br><span class="line"> Efi System           C<span class="number">12A7328F81</span>F11D2BA<span class="number">4B00A0C93</span>EC93B</span><br><span class="line"> Microsoft Reserved   E<span class="number">3C9E3160</span>B5C4DB8817DF92DF00215AE</span><br><span class="line"> Unused Entry         <span class="number">00000000000</span><span class="number">00000000000</span><span class="number">0000000000</span></span><br></pre></td></tr></table></figure>
<h2 id="黑群辉的安装">黑群辉的安装</h2><p>到下面的网址上去下载两个文件:</p>
<blockquote>
<p>xpenology.me/downloads/</p>
</blockquote>
<ul>
<li>第一个是DSM_DS3615xs_5644.pat,这个是群辉的升级文件,一会儿在配置群辉的时候会用上.</li>
<li>第二个是XPEnoboot_DS3615xs_5.2-5644.4.vmdk的启动文件</li>
</ul>
<ol>
<li>先上传vmdk文件到服务器的磁盘上,在虚拟机里加载vmdk文件作为第二块硬盘(注意添加的时候选择现有的硬盘).</li>
<li>选择启动虚拟机</li>
<li>在群辉助手中去配置和升级DSM系统记得选择PAT文件的时候选择我们刚才下载的那个Pat文件.(不想下载群辉助手也可以直接在群辉的ip地址后面加上端口号:5000去访问web管理页面.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/70593634.jpg" alt=""></li>
<li>升级设置完毕以后会要求重启,这时候可能会出现黑裙启动不起来的问题,报missing operating Syetem的错.这时候检查一下虚拟机的硬盘启动顺序.或者直接删除刚才添加的第二块20mb的硬盘,按照步骤一重新添加一次群辉的启动vmdk文件.</li>
</ol>
<h3 id="加载RDM的Raid1作为数据储存">加载RDM的Raid1作为数据储存</h3><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/75391528.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/95718109.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/88694438.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/4528211.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/97145984.jpg" alt=""><br>Raid1就没必要检查磁盘奇偶了 因为实在太慢了…..<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/28774652.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/19661986.jpg" alt=""></p>
<h1 id="测试">测试</h1><p>上传写入速度 55mb/s 下载速度117Mb/s</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/26/addNativeJavaSciptsInterface/" itemprop="url">
                  JS与Native交互接口定义 Native JavaScipts Interface
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-26T23:05:54+08:00" content="2016-05-26">
              2016-05-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/26/addNativeJavaSciptsInterface/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/26/addNativeJavaSciptsInterface/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="技术需求:">技术需求:</h1><ul>
<li>Native代码调用webview里面的js脚本,获取返回值</li>
<li>webview中的js脚本调用本地的Native代码,获取返回值</li>
<li>Native 调用js并传递参数,获取返回值</li>
<li>Js调用 Native并传递参数,获取返回值</li>
</ul>
<h1 id="相关文档:">相关文档:</h1><h2 id="Android_:">Android :</h2><p><code>addJavascriptInterface(java.lang.Object, java.lang.String)</code></p>
<h3 id="官方文档:">官方文档:</h3><ul>
<li><code>https://developer.android.com/guide/webapps/webview.html#UsingJavaScript</code></li>
<li><code>https://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)</code></li>
</ul>
<h3 id="Android_参考文档:">Android 参考文档:</h3><ul>
<li><code>https://github.com/pedant/safe-java-js-webview-bridge</code></li>
<li><code>http://droidyue.com/blog/2014/09/20/interaction-between-java-and-javascript-in-android/index.html</code></li>
<li><code>http://rensanning.iteye.com/blog/2043049</code></li>
</ul>
<h2 id="iOS:">iOS:</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NSString <span class="keyword">*</span>returnvalue = [webViewstringByEvaluatingJavaScriptFromString:<span class="comment">@"your javascript code string here"];</span></span><br></pre></td></tr></table></figure>
<h3 id="官方文档:-1">官方文档:</h3><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/" target="_blank" rel="external">https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/</a></li>
</ul>
<h3 id="iOS_实现参考:">iOS 实现参考:</h3><ul>
<li><a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">https://github.com/marcuswestin/WebViewJavascriptBridge</a></li>
<li><a href="http://dukeland.hk/2013/01/28/adding-JavaScript-interface-to-uiwebview-like-android/" target="_blank" rel="external">http://dukeland.hk/2013/01/28/adding-JavaScript-interface-to-uiwebview-like-android/</a></li>
</ul>
<h1 id="技术实现示例:">技术实现示例:</h1><p>这里以Android 为例: iOS可以使用github上的Bridge库(<code>https://github.com/marcuswestin/WebViewJavascriptBridge</code>),实现类似Android的调用方法.</p>
<h2 id="新建一个_WebView">新建一个 WebView</h2><p>代码参考如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="title">WebView</span>  <span class="attribute">xmlns:android</span>=<span class="value">http:</span>//<span class="attribute">schemas.android.com</span>/<span class="attribute">apk</span>/<span class="attribute">res</span>/<span class="attribute">android</span></span><br><span class="line"><span class="attribute">android:id</span>=<span class="value">"@+id/webview"</span>     </span><br><span class="line"><span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span>     </span><br><span class="line"><span class="attribute">android:layout_height</span>=<span class="value">"fill_parent"</span></span><br><span class="line"> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 loadUrl()方法在WebView中加载web页面, 参考如下:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = (WebView) findViewById(R.<span class="property">id</span>.webview); </span><br><span class="line"></span><br><span class="line">myWebView.loadUrl(<span class="string">"http://www.example.com"</span>);</span><br></pre></td></tr></table></figure>
<p>记得设置外网权限:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">...</span> &gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span> /&gt;</span>     </span><br><span class="line">... </span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>所有的设置如上就应该可以使用了</p>
<h2 id="在_WebView_中启用JavaScript">在 WebView 中启用JavaScript</h2><p>JavaScript默认情况下是disable的需要通过设置<code>WebSettings</code>到<code>WebView</code>.<br>可以通过<code>getSettings()</code>获取到WebSettings然后设置<code>setJavaScriptEnabled()</code>.<br>示例如下:</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = <span class="list">(<span class="keyword">WebView</span>)</span> findViewById<span class="list">(<span class="keyword">R</span>.id.webview)</span><span class="comment">; WebSettings webSettings = myWebView.getSettings(); webSettings.setJavaScriptEnabled(true);</span></span><br></pre></td></tr></table></figure>
<h2 id="实现_JavaScript_代码_和_Android_代码的接口">实现 JavaScript 代码 和 Android 代码的接口</h2><p>调用<code>webview</code>的<code>addJavascriptInterface()</code>, 传入两个参数:第一个是Java中定义的class对象,第二个是javaScript中的接口对象名.</p>
<h3 id="第一步_在Android中声明被js调用的class">第一步 在Android中声明被js调用的class</h3><p>参考以下代码:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WebAppInterface</span> &#123;</span><br><span class="line">Context mContext;      </span><br><span class="line"><span class="comment">/** Instantiate the interface and set the context*/</span>     </span><br><span class="line">	WebAppInterface(Context c) &#123; </span><br><span class="line">        		mContext = c;     </span><br><span class="line">	&#125;      </span><br><span class="line"><span class="comment">/** Show a toast from the web page */</span>     </span><br><span class="line">	@<span class="function">JavascriptInterface     </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span>(<span class="params">String toast</span>) </span>&#123; </span><br><span class="line">          Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();     </span><br><span class="line"> 	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码说明:<code>WebAppInterface</code>这个接口绑定的对象在被js调用时传入<code>Toast</code>参数,调用这个 <code>showToast()</code>方法</p>
<p><strong>注意</strong>: </p>
<pre><code>如果你的 <span class="attr_selector">[targetSdkVersiong]</span> 高于<span class="tag">17</span> (<span class="attribute">https</span>:<span class="comment">//developer.android.com/guide/topics/manifest/uses-sdk-element.html#target), 你必须增加 @JavascriptInterface 注释 到所有你想要Js可以调用的public方法中,如果没有注释那么js在 Android 4.2 或更高的版本中不能调用到安卓的方法.</span>
</code></pre><h3 id="第二步,在webview中定义接口">第二步,在webview中定义接口</h3><p>addJavascriptInterface()定义接口为:<code>hostApp</code>, 把这个对象和webview中的JavaScript进行绑定.</p>
<p>参考代码:</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebView webView = <span class="list">(<span class="keyword">WebView</span>)</span> findViewById<span class="list">(<span class="keyword">R</span>.id.webview)</span><span class="comment">; webView.addJavascriptInterface(new WebAppInterface(this), "hostApp");</span></span><br></pre></td></tr></table></figure>
<p>代码说明:<br>为在webview中运行的JavaScript定义好了一个接口:<code>hostApp</code>这样js就可以调用<code>WebAppInterface</code>这个Java的方法. </p>
<h3 id="第三步,js中调用webview中定义的接口:">第三步,js中调用webview中定义的接口:</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">value</span>=<span class="value">"Say hello"</span> <span class="attribute">onClick</span>=<span class="value">"showAndroidToast('Hello Android!')"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showAndroidToast</span><span class="params">(toast)</span> </span>&#123;</span><br><span class="line">         hostApp.showToast(toast);     </span><br><span class="line">&#125; </span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript中不需要做任何声明,直接可以使用webview中提供的<code>hostApp</code>接口.<br>当你点击input按钮时<code>showAndroidToast()</code>function会自动使用<code>hostApp</code>接口 去调用<code>WebAppInterface.showToast()</code>方法.</p>
<h2 id="Java调用JavaScript_:">Java调用JavaScript :</h2><ul>
<li>直接把要运行的js代码作为参数调用<code>loadUrl</code>方法.就可以实现调用,但注意要声明传入的参数是JavaScript.</li>
</ul>
<h3 id="代码实现:">代码实现:</h3><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String call = <span class="string">"javascript:helloWorld(1,2)"</span>;</span><br><span class="line"><span class="transposed_variable">WebView.</span>loadUrl(<span class="string">"http://www.hs.com"</span>);  </span><br><span class="line"></span><br><span class="line"><span class="comment">//先加载页面后就可以load JavaScript代码.</span></span><br><span class="line"></span><br><span class="line"><span class="transposed_variable">WebView.</span>loadUrl(call);    </span><br><span class="line">  </span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span><span class="params">(num1, num2)</span> &#123;</span></span><br><span class="line">	   <span class="built_in">sum</span> =num1+num2;</span><br><span class="line">       alert(<span class="string">"helloWord!"</span>+<span class="built_in">sum</span>); </span><br><span class="line">	<span class="comment">//这里也可以在java中定义一个方法接受js返回的参数.</span></span><br><span class="line">	<span class="comment">//参考上面的js调用java的代码    </span></span><br><span class="line">&#125; </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/19/JRE-setup-doc/" itemprop="url">
                  Setup Java Eclipse Tomcat & FreeMarker on Mac
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-19T09:07:51+08:00" content="2016-05-19">
              2016-05-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/19/JRE-setup-doc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/19/JRE-setup-doc/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Install_Homebrew">Install <a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a></h2><ul>
<li>Open Terminal.</li>
<li>If you don’t already have Homebrew installed:<ul>
<li>Run command to install Homebrew.<ul>
<li><code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></li>
</ul>
</li>
</ul>
</li>
<li>Make sure that it is up to date.<ul>
<li><code>brew update</code></li>
</ul>
</li>
<li>Check that there would not be any potential problems in your system.<ul>
<li><code>brew doctor</code></li>
</ul>
</li>
<li>Upgrade Homebrew packages.<ul>
<li><code>brew upgrade</code></li>
</ul>
</li>
</ul>
<h2 id="Install_JAVA_SDK">Install JAVA SDK</h2><p>Check if Java installed</p>
<p><code>java -version</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Lyn-Cheung-MBP: Lyn$ java -version</span><br><span class="line">java version <span class="string">"1.7.0_79"</span></span><br><span class="line"><span class="function"><span class="title">Java</span><span class="params">(TM)</span></span> SE Runtime Environment (build <span class="number">1.7</span>.<span class="number">0</span>_79-b15)</span><br><span class="line">Java <span class="function"><span class="title">HotSpot</span><span class="params">(TM)</span></span> <span class="number">64</span>-Bit Server VM (build <span class="number">24.79</span>-b02, mixed mode)</span><br></pre></td></tr></table></figure>
<p>Java SE Development Kit 8 Downloads</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.oracle.com/technetwork</span><span class="regexp">/java/javase</span><span class="regexp">/downloads/jdk</span>8-downloads-<span class="number">2133151</span>.html</span><br></pre></td></tr></table></figure>
<p>edit  <code>~/.bash_profile</code></p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.bash_profile</span><br><span class="line">export PATH=$&#123;PATH&#125;:/Development/android-sdk/tools</span><br><span class="line">export JAVA_HOME=$(/usr/libexec/java_home)</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:<span class="variable">$PATH</span></span><br><span class="line">export PATH=/usr/local/bin:<span class="variable">$PATH</span></span><br><span class="line">export path=/usr/local/bin:<span class="variable">$path</span></span><br></pre></td></tr></table></figure>
<p>reload bash_profile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<h2 id="Eclipse">Eclipse</h2><ul>
<li>Download and install latest version of <em>Eclipse IDE for Java EE developers</em> from <a href="http://www.eclipse.org/downloads/" target="_blank" rel="external">Eclipse Downloads</a></li>
</ul>
<h3 id="Set_Eclipse_to_use_the_previously_installed_version_of_Java">Set Eclipse to use the previously installed version of Java</h3><ul>
<li>If you have multiple versions of Java installed, set the Eclipse to use the version installed earlier in these instructions.</li>
<li><em>Window &gt;&gt; Preferences &gt;&gt; Java &gt;&gt; Installed JREs</em> Add the path to the Java version you installed (e.g. <em>/usr/lib/jvm/java-7-oracle (java-7-oracle)</em> )</li>
</ul>
<h2 id="Installing_Tomcat_8">Installing Tomcat 8</h2><ul>
<li><p><code>brew install tomcat</code>: <a href="http://blog.bolshchikov.net/post/50277857673/installing-tomcat-on-macos-with-homebrew" target="_blank" rel="external">Installing Tomcat on MacOS with homebrew</a></p>
<ul>
<li><code>sudo ln -s /usr/local/Cellar/tomcat/8.0.14/libexec /Library/Tomcat</code></li>
<li><code>sudo chown -R /Library/Tomcat</code></li>
<li><code>sudo chmod +x /Library/Tomcat/bin/*.sh</code></li>
</ul>
</li>
<li><p>In Eclipse:</p>
<ul>
<li><em>Eclipse &gt;&gt; Preferences</em></li>
<li><em>Server &gt;&gt; Runtime Environment</em></li>
<li>Click <em>“Add…”</em></li>
<li>Under <em>“Apache”</em> select <em>“Tomcat v8.0”</em></li>
<li>Click <em>“Next”</em></li>
<li>Click <em>“Browse…”</em></li>
<li>Select the folder where you installed Tomcat (e.g.<em>/usr/local/Cellar/tomcat/8.0.33/libexec</em>)</li>
<li>Click <em>“Finish”</em></li>
</ul>
</li>
</ul>
<h2 id="MySQL">MySQL</h2><ul>
<li>Install MySQL<ul>
<li><code>brew install mysql</code></li>
</ul>
</li>
<li>To have launchd start mysql at login:<ul>
<li><code>ln -sfv /usr/local/opt/mysql/*.plist ~/Library/LaunchAgents</code></li>
</ul>
</li>
<li>Then to load mysql now:<ul>
<li><code>launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</code></li>
</ul>
</li>
<li>Or, if you don’t want/need launchctl, you can just run:<ul>
<li><code>mysql.server start</code></li>
</ul>
</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/12/react-js-02-router/" itemprop="url">
                  react.js-Notes-02 react-router
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-12T20:34:25+08:00" content="2016-05-12">
              2016-05-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/12/react-js-02-router/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/12/react-js-02-router/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="install_react_router_to_your_project">install react router to your project</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> react-router <span class="comment">--save</span></span></span><br></pre></td></tr></table></figure>
<h1 id="clean_index-html">clean index.html</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css"</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">integrity</span>=<span class="value">"sha384-XYCjB+hFAjSbgf9yKUgbysEjaVLOXhCgATTEBpCqT1R3jvG5LGRAK5ZIyRbH5vpX"</span> <span class="attribute">crossorigin</span>=<span class="value">"anonymous"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Some page <span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">"text/css"</span>&gt;</span><span class="css"> <span class="class">.md-scroll-mask</span> <span class="rules">&#123; <span class="rule"><span class="attribute">position</span>:<span class="value"> initial</span></span>;&#125;</span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"app"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"./scripts.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="-/js/scripts-js">./js/scripts.js</h1><p>import Router Route and IndexRoute</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router, Route, IndexRoute, hashHistory &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Archives  <span class="keyword">from</span> <span class="string">"./pages/Archives"</span>;</span><br><span class="line"><span class="keyword">import</span> Featured <span class="keyword">from</span> <span class="string">"./pages/Featured"</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"./pages/Layout"</span>;</span><br><span class="line"><span class="keyword">import</span> Settings <span class="keyword">from</span> <span class="string">"./pages/Settings"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">	<span class="xml"><span class="tag">&lt;<span class="title">Router</span>  <span class="attribute">history</span>=<span class="value">&#123;hashHistory&#125;</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"/"</span> <span class="attribute">component</span>=<span class="value">&#123;Layout&#125;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">IndexRoute</span> <span class="attribute">component</span>=<span class="value">&#123;Featured&#125;</span>&gt;</span><span class="tag">&lt;/<span class="title">IndexRoute</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"archives(/:article)"</span>  <span class="attribute">name</span>=<span class="value">"archives"</span> <span class="attribute">component</span>=<span class="value">&#123;Archives&#125;</span>&gt;</span><span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">Route</span> <span class="attribute">path</span>=<span class="value">"settings"</span>  <span class="attribute">name</span>=<span class="value">"settings"</span><span class="value">component=&#123;Settings&#125;</span>&gt;</span><span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">Route</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">Router</span>&gt;</span>,</span><br><span class="line"> app);</span></span><br></pre></td></tr></table></figure>
<h1 id="-/js/pages/">./js/pages/</h1><h2 id="-/js/pages/Layout-js">./js/pages/Layout.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">Nav</span> from <span class="string">"../components/layout/Nav"</span>;</span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">		const&#123; location &#125; =<span class="keyword">this</span>.props;</span><br><span class="line">		const containerStyle = &#123; </span><br><span class="line">			marginTop:  <span class="string">"60px"</span></span><br><span class="line">		&#125;;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;<span class="type">Nav</span> location =&#123;location&#125; /&gt;</span><br><span class="line">				&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"container"</span> style=&#123;containerStyle&#125;&gt;</span><br><span class="line">					&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"row"</span>&gt;</span><br><span class="line">		          			&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"col-lg-12"</span>&gt;</span><br><span class="line">								&lt;h1&gt; <span class="type">Hello</span> <span class="type">World</span> &lt;/h1&gt;</span><br><span class="line">								&#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">						&lt;/div&gt;</span><br><span class="line">					&lt;/div&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="-/js/pages/Archives-js">./js/pages/Archives.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="type">Link</span> &#125; from <span class="string">"react-router"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">Article</span> from <span class="string">"../components/Article"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Archives</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		const &#123; query &#125; = <span class="keyword">this</span>.props.location;</span><br><span class="line">		const &#123; article &#125; = <span class="keyword">this</span>.props.params;</span><br><span class="line">		const &#123; date, filter &#125;  = query;</span><br><span class="line">		<span class="comment">//console.log(this.props);</span></span><br><span class="line">		const <span class="type">Articles</span> = [</span><br><span class="line">			<span class="string">"Some Article"</span>,</span><br><span class="line">			<span class="string">"Some Other Article"</span>,</span><br><span class="line">			<span class="string">"Yet  Another Article "</span>,</span><br><span class="line">			<span class="string">"Still More"</span>,</span><br><span class="line">			<span class="string">"Fake Article"</span>,</span><br><span class="line">			<span class="string">"Partial Another  "</span>,</span><br><span class="line">			<span class="string">"Still More"</span>,</span><br><span class="line">		].map((title, i) =&gt;  &lt;<span class="type">Article</span> key=&#123;i&#125;  title=&#123;title&#125; /&gt; );</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;h1&gt; <span class="type">Archives</span> &lt;/h1&gt;</span><br><span class="line">				&lt;p&gt;hello  <span class="keyword">this</span>  is  archives&lt;/p&gt;</span><br><span class="line">				&lt;h4&gt;date: &#123;date&#125;, filter: &#123;filter&#125; &lt;/h4&gt;</span><br><span class="line">				&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"row"</span>&gt;&#123;<span class="type">Articles</span>&#125;&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="-/js/pages/Featured-js">./js/pages/Featured.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">Article</span> from <span class="string">"../components/Article"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Featured</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	render() &#123;</span><br><span class="line">		const <span class="type">Articles</span> = [</span><br><span class="line">			<span class="string">"Some Article"</span>,</span><br><span class="line">			<span class="string">"Some Other Article"</span>,</span><br><span class="line">			<span class="string">"Yet  Another Article "</span>,</span><br><span class="line">			<span class="string">"Still More"</span>,</span><br><span class="line">		].map((title, i) =&gt;  &lt;<span class="type">Article</span> key=&#123;i&#125;  title=&#123;title&#125; /&gt; );</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"row"</span>&gt;&#123;<span class="type">Articles</span>&#125;&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="-/js/page/Settings-js">./js/page/Settings.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="type">Link</span> &#125; from <span class="string">"react-router"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Settings</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	render() &#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;h1&gt; <span class="type">Settings</span> &lt;/h1&gt;</span><br><span class="line">				&lt;p&gt;hello  <span class="keyword">this</span>  is  <span class="type">Settings</span>&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="-/js/components/layout/">./js/components/layout/</h1><h2 id="-/js/components/layout/Nav-js">./js/components/layout/Nav.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="type">IndexLink</span>, <span class="type">Link</span> &#125; from <span class="string">"react-router"</span>;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	constructor()&#123;</span><br><span class="line">		<span class="keyword">super</span>()</span><br><span class="line">		<span class="keyword">this</span>.state=&#123;</span><br><span class="line">			collapsed : <span class="literal">true</span>,</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	toggleCollapse()&#123;</span><br><span class="line">		const collapsed = !<span class="keyword">this</span>.state.collapsed;</span><br><span class="line">		<span class="keyword">this</span>.setState(&#123;collapsed&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	render() &#123;</span><br><span class="line">		const &#123; location &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">		const &#123; collapsed &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">		const featuredClass = location.pathname ===<span class="string">"/"</span> ? <span class="string">"active"</span>:<span class="string">""</span>;</span><br><span class="line">		const archivesClass = location.pathname.<span class="keyword">match</span>(/^\/archives/) ? <span class="string">"active"</span>:<span class="string">""</span>;</span><br><span class="line">		const settingsClass =  location.pathname.<span class="keyword">match</span>(/^\/settings/) ? <span class="string">"active"</span>:<span class="string">""</span>;</span><br><span class="line">		const navClass = collapsed ? <span class="string">"collapse"</span> : <span class="string">""</span>;</span><br><span class="line">		 </span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			   &lt;nav <span class="class"><span class="keyword">class</span>=</span><span class="string">"navbar navbar-default navbar-fixed-top"</span> role=<span class="string">"navgation"</span>&gt;</span><br><span class="line">			      &lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"container"</span>&gt;</span><br><span class="line">				        &lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"navbar-header"</span>&gt;        </span><br><span class="line">				          &lt;button <span class="class"><span class="keyword">class</span>=</span><span class="string">"navbar-toggle"</span> <span class="class"><span class="keyword">type</span>=</span><span class="string">"button"</span> onClick=&#123;<span class="keyword">this</span>.toggleCollapse.bind(<span class="keyword">this</span>)&#125;&gt;</span><br><span class="line">					            &lt;span <span class="class"><span class="keyword">class</span>=</span><span class="string">"icon-bar"</span>&gt;&lt;/span&gt;</span><br><span class="line">					            &lt;span <span class="class"><span class="keyword">class</span>=</span><span class="string">"icon-bar"</span>&gt;&lt;/span&gt;</span><br><span class="line">					            &lt;span <span class="class"><span class="keyword">class</span>=</span><span class="string">"icon-bar"</span>&gt;&lt;/span&gt;</span><br><span class="line">				          &lt;/button&gt;</span><br><span class="line">				        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			        	&lt;div <span class="class"><span class="keyword">class</span>=</span>&#123;<span class="string">"navbar-collapse "</span>+ navClass&#125; id=<span class="string">"navbar-main"</span>&gt;</span><br><span class="line">				          &lt;ul <span class="class"><span class="keyword">class</span>=</span><span class="string">"nav navbar-nav"</span>&gt;</span><br><span class="line"></span><br><span class="line">					            &lt;li <span class="class"><span class="keyword">class</span>=</span><span class="string">"&#123;featuredClass&#125;"</span>&gt;</span><br><span class="line">					            &lt;<span class="type">IndexLink</span> to=<span class="string">"/"</span>  onClick=&#123;<span class="keyword">this</span>.toggleCollapse.bind(<span class="keyword">this</span>)&#125;&gt; <span class="type">Featured</span> &lt;/<span class="type">IndexLink</span>&gt;</span><br><span class="line">					            &lt;/li&gt;   </span><br><span class="line">					            &lt;li <span class="class"><span class="keyword">class</span>=</span><span class="string">"&#123;archivesClass&#125;"</span>&gt;</span><br><span class="line">					            &lt;<span class="type">Link</span> to=<span class="string">"archives"</span>  onClick=&#123;<span class="keyword">this</span>.toggleCollapse.bind(<span class="keyword">this</span>)&#125;&gt; <span class="type">Archives</span> &lt;/<span class="type">Link</span>&gt;</span><br><span class="line">					            &lt;/li&gt;   </span><br><span class="line">					            &lt;li <span class="class"><span class="keyword">class</span>=</span><span class="string">"&#123;settingsClass&#125;"</span>&gt;</span><br><span class="line">					            &lt;<span class="type">Link</span> to=<span class="string">"settings"</span>  onClick=&#123;<span class="keyword">this</span>.toggleCollapse.bind(<span class="keyword">this</span>)&#125;&gt; <span class="type">Settings</span> &lt;/<span class="type">Link</span>&gt;</span><br><span class="line">					            &lt;/li&gt;</span><br><span class="line">	 </span><br><span class="line">				          &lt;/ul&gt;</span><br><span class="line">			        	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			      &lt;/div&gt;</span><br><span class="line">			    &lt;/nav&gt;</span><br><span class="line">			</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="-/js/components">./js/components</h1><h2 id="-/js/components/Article-js">./js/components/Article.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	render()&#123;</span><br><span class="line"></span><br><span class="line">		const  &#123; title &#125;= <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>(</span><br><span class="line">		&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"col-md-4"</span>&gt;</span><br><span class="line">				&lt;h2&gt;&#123;title&#125;&lt;/h2&gt;</span><br><span class="line">				&lt;p&gt; <span class="type">Lorem</span> ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</span><br><span class="line">					tempor incididunt ut labore et dolore magna aliqua. <span class="type">Ut</span> enim ad minim veniam,</span><br><span class="line">					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo</span><br><span class="line">					consequat. &lt;/p&gt;</span><br><span class="line">				&lt;a <span class="class"><span class="keyword">class</span>=</span><span class="string">"btn btn-default"</span> href=<span class="string">"#"</span>&gt; <span class="type">More</span> <span class="type">Info</span> &lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/11/react-js-01/" itemprop="url">
                  react.js-Notes-01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-11T22:08:32+08:00" content="2016-05-11">
              2016-05-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/11/react-js-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/11/react-js-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="config_before_development">config before development</h1><h2 id="npm">npm</h2><p>use command to initialize your package.json file </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init <span class="operator">-f</span></span><br></pre></td></tr></table></figure>
<p>my npm package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"Test"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"1.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"index.js"</span></span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">dev</span>": <span class="value"><span class="string">"webpack-dev-server --content-base src  --inline --hot"</span></span>,</span><br><span class="line">    "<span class="attribute">lint</span>": <span class="value"><span class="string">"eslint js"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">""</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-plugin-add-module-exports</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-react-html-attrs</span>": <span class="value"><span class="string">"^2.0.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-class-properties</span>": <span class="value"><span class="string">"^6.3.13"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-plugin-transform-decorators-legacy</span>": <span class="value"><span class="string">"^1.3.4"</span></span>,</span><br><span class="line">    "<span class="attribute">react</span>": <span class="value"><span class="string">"^15.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">react-dom</span>": <span class="value"><span class="string">"^15.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack</span>": <span class="value"><span class="string">"^1.13.0"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">devDependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-core</span>": <span class="value"><span class="string">"^6.7.7"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-eslint</span>": <span class="value"><span class="string">"^6.0.4"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-loader</span>": <span class="value"><span class="string">"^6.2.4"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-es2015</span>": <span class="value"><span class="string">"^6.6.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-react</span>": <span class="value"><span class="string">"^6.5.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-stage-0</span>": <span class="value"><span class="string">"^6.5.0"</span></span>,</span><br><span class="line">    "<span class="attribute">eslint</span>": <span class="value"><span class="string">"^2.9.0"</span></span>,</span><br><span class="line">    "<span class="attribute">eslint-plugin-react</span>": <span class="value"><span class="string">"^5.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack-dev-server</span>": <span class="value"><span class="string">"^1.14.1"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>after you edit your package.json file, you can run npm install to install all the dependencies automatically</p>
<h2 id="webpack">webpack</h2><p>after all the packages is  installled.</p>
<p>we can config webpack by create webpack.config.js file under your project path.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debug   = process.env.NODE_ENV !==<span class="string">"production"</span>;</span><br><span class="line"><span class="keyword">var</span> webpack =<span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports=</span>&#123;</span><br><span class="line">	context: __dirname+<span class="string">"/src"</span>,</span><br><span class="line">	devtool: debug ? <span class="string">"inline-sourcemap"</span> : <span class="literal">null</span>,</span><br><span class="line">	entry:<span class="string">"./js/scripts.js"</span>,</span><br><span class="line">	output:&#123;</span><br><span class="line">		path: __dirname +<span class="string">"/src"</span>,</span><br><span class="line">		filename:<span class="string">"scripts.min.js"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	devServer:&#123;</span><br><span class="line">		inline:<span class="literal">true</span>,</span><br><span class="line">		port:<span class="number">1336</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="module"><span class="keyword">module</span>:</span>&#123;</span><br><span class="line">		loaders:[</span><br><span class="line">		&#123;</span><br><span class="line">			test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">			exclude:<span class="regexp">/node_modules|bower_components/</span>,</span><br><span class="line">			loader:<span class="string">'babel-loader'</span>,</span><br><span class="line">			query:&#123;</span><br><span class="line">				presets:[<span class="string">'es2015'</span>,<span class="string">'react'</span>,<span class="string">'stage-0'</span>],</span><br><span class="line">				plugins:[<span class="string">'react-html-attrs'</span>,<span class="string">'transform-class-properties'</span>, <span class="string">'transform-decorators-legacy'</span>]</span><br><span class="line">			&#125;</span><br><span class="line">		 &#125;,</span><br><span class="line">	    ]</span><br><span class="line">	&#125;,</span><br><span class="line">	plugins: debug ? []:[</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.DedupePlugin(),</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</span><br><span class="line">		<span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123; mangle:<span class="literal">false</span>, sourcemap:<span class="literal">false</span>&#125;),</span><br><span class="line">	],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="eslint">eslint</h2><p>as jshint doesnot support react.js very well,<br>I replace jshint with eslint.<br>you can also install eslint sublime plugin to help you check your code in Sublime.</p>
<p>install eslint locally in your project folder (you must have package.json file there):</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> eslint</span><br></pre></td></tr></table></figure>
<p>Init eslint config if you don’t have any. Run in your code folder:</p>
<!--if eslint is installed locally-->
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./node_modules/.bin/eslint <span class="comment">--init</span></span><br></pre></td></tr></table></figure>
<p>To install via Package Control, do the following:</p>
<ol>
<li><p>Within Sublime Text, bring up the Command Palette and type install. Among the commands you should see Package Control: Install Package. If that command is not highlighted, use the keyboard or mouse to select it. There will be a pause of a few seconds while Package Control fetches the list of available plugins.</p>
</li>
<li><p>When the plugin list appears, type eslint. Among the entries you should see SublimeLinter-contrib-eslint. If that entry is not highlighted, use the keyboard or mouse to select it.</p>
</li>
</ol>
<p>my .eslintrc config file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">env</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">browser</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">        "<span class="attribute">node</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">        "<span class="attribute">es6</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">extends</span>": <span class="value"><span class="string">"eslint:recommended"</span></span>,</span><br><span class="line">    "<span class="attribute">parser</span>": <span class="value"><span class="string">"babel-eslint"</span></span>,</span><br><span class="line">    "<span class="attribute">ecmaFeatures</span>": <span class="value">&#123;</span><br><span class="line">       "<span class="attribute">jsx</span>": <span class="value"><span class="literal">true</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">rules</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">semi</span>": <span class="value">[<span class="number">2</span>, <span class="string">"always"</span>]</span><br><span class="line">    </span>&#125;</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        <span class="string">"react"</span></span><br><span class="line">    ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="your_first_react-js_component">your first react.js component</h1><h2 id="Folder_Structure">Folder Structure</h2><p> Lyn-Cheung-MBP:01 Lyn$ find . -print | sed -e ‘s;[^/]*/;|<strong><strong>;g;s;</strong></strong>|; `|;g’</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|<span class="string">____package.json</span><br><span class="line"></span>|____src</span><br><span class="line">|<span class="string"> </span>|<span class="string">____index.html</span><br><span class="line"></span>|<span class="string"> </span>|____js</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|____components</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Footer.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|____Header</span><br><span class="line">|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Title.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Header.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____Layout.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____scripts.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">____scripts.min.js</span><br><span class="line"></span>|<span class="string"> </span>|<span class="string">____scripts.min.js</span><br><span class="line"></span>|<span class="string">____webpack.config.js</span></span><br></pre></td></tr></table></figure>
<h2 id="Code_files">Code files</h2><p>index.html is very simple:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span>Some page <span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"app"</span>&gt;</span> <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">script</span>  <span class="attribute">src</span>=<span class="value">"./scripts.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>scripts.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"./components/Layout"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app =<span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="title">Layout</span>/&gt;</span>, app);</span></span><br></pre></td></tr></table></figure>
<p>Layout.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Header</span> from <span class="string">"./Header"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Footer</span> from <span class="string">"./Footer"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line"> 	 constructor()&#123;</span><br><span class="line"> 	 	<span class="keyword">super</span>();</span><br><span class="line"> 	 	<span class="keyword">this</span>.state=&#123;</span><br><span class="line"> 	 		title:<span class="string">"Welcome"</span>,</span><br><span class="line"> 	 	&#125;</span><br><span class="line"> 	 &#125;</span><br><span class="line"> 	 changeTitle(title)&#123;</span><br><span class="line"> 	 	<span class="keyword">this</span>.setState(&#123;title&#125;);</span><br><span class="line"> 	 &#125;</span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;<span class="type">Header</span> changeTitle=&#123;<span class="keyword">this</span>.changeTitle.bind(<span class="keyword">this</span>)&#125; title=&#123;<span class="keyword">this</span>.state.title&#125; /&gt;</span><br><span class="line">				&lt;<span class="type">Footer</span> /&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			);</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Header.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="type">Title</span> from <span class="string">"./Header/Title"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	 handleChange(e)&#123;</span><br><span class="line">	 	const title =e.target.value;</span><br><span class="line">	 	<span class="keyword">this</span>.props.changeTitle(title);</span><br><span class="line">	 &#125;</span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;<span class="type">Title</span>  title=&#123;<span class="keyword">this</span>.props.title&#125; /&gt;</span><br><span class="line">				&lt;input value=&#123;<span class="keyword">this</span>.props.title&#125;  onChange=&#123;<span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>)&#125;  /&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Title.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	 </span><br><span class="line">	</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;h1&gt; &#123;<span class="keyword">this</span>.props.title&#125;&lt;/h1&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Footer.js</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Footer</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">React</span>.<span class="title">Component</span>&#123;</span></span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;footer&gt; <span class="type">This</span> is <span class="type">Footer</span> &lt;/footer&gt;</span><br><span class="line">			);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Run_your_react-js_on_your_local_sever">Run your react.js on your local sever</h2><p>simply use these commands:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br><span class="line"></span><br><span class="line">npm <span class="command">run</span> dev</span><br></pre></td></tr></table></figure>
<p>then you can visit your first react.js project on your browser by:<br><a href="http://127.0.0.1:1336/" target="_blank" rel="external">http://127.0.0.1:1336/</a> </p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/04/22/css/" itemprop="url">
                  css权重优先级问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-22T11:58:01+08:00" content="2016-04-22">
              2016-04-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/22/css/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/22/css/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>CSS的选择器是有权重的，当不同选择器的样式设置有冲突时，会采用权重高的选择器设置样式。<br>权重（即优先级）的规则如下，权重越高，优先级越高：<br>  同一个元素可以使用多个规则来指定它的同一样式（比如字体颜色），每个规则都有自己的选择器。显然最终只有一个规则起作用（不可能一个字既是红色又是绿色），那么该规则的特殊性最高，特殊性即css优先级。<br> 很多人仅仅知道选择器优先级：ID&gt;class&gt;元素选择器，而不知道ID的优先级为什么大于class的优先级。</p>
<h1 id="那么css优先级到底是怎么计算的呢？">那么css优先级到底是怎么计算的呢？</h1><p>选择器的特殊性值表述为4个部分，用0,0,0,0表示：<br> 行间样式，加1,0,0,0.<br> ID选择器的特殊性值，加0,1,0,0。<br> 类选择器、属性选择器或伪类，加0,0,1,0。<br> 元素和伪元素，加0,0,0,1。<br> 通配选择器*对特殊性没有贡献，即0,0,0,0。</p>
<p> 最后比较特殊的一个标志!important（权重），它没有特殊性值，但它的优先级是最高的，为了方便记忆，可以认为它的特殊性值为1,0,0,0,0。<br> 选择器特殊性值是从左向右排序的，特殊性值1,0,0,0大于以0开头的所有特殊性值，即便它是0,99,99,99，优先级依然比1,0,0,0要低。</p>
<p>  很多人都知道a标签有四种状态：链接访问前、链接访问后、鼠标滑过、激活，分别对应四种伪类:link、:visited、:hover、:active，并且这四个伪类如果对同一个元素设置同一个属性，那它们的声明顺序还有一定要求，一般大家都遵循“爱恨原则LVHA”（LoVe HAte），为什么是这个顺序？不能是其它顺序吗？<br>  根据css优先级计算规则，伪类的特殊性值是0,0,1,0，4个伪类的特殊性值相同，那么后面声明的规则优先级高。当鼠标滑过a链接时，满足:link和:hover两个伪类，要改变a标签的颜色，就必须将:hover伪类在:link伪类后面声明；同理，当鼠标点击激活a链接时，同时满足:link、:hover、:active三种状态，要显示a标签激活时的样式（:active），必须将:active声明放到:link和:hover之后。因此得出LVHA这个顺序。这个顺序能不能变？可以，但也只有:link和:visited可以交换位置，因为一个链接要么访问过要么没访问过，不可能同时满足，也就不存在覆盖的问题。</p>
<h1 id="简单的理解方式:">简单的理解方式:</h1><p>标签选择器、伪类及伪对象：优先积分1<br>类选择器、属性选择器：优先积分10<br>ID选择器：优先积分100<br>其他选择器（通配符等）：0<br>根据以上优先积分，统计样式表中出现的每个选择器的个数，再相加，最终得出的分数就是某个选择器的优先级别。</p>
<p>例如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">p</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="tag">p</span><span class="class">.myColor</span> = <span class="number">1</span>+<span class="number">10</span> = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="class">.myColor</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="id">#myColor</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure></p>
<p>再次说明：!important关键字 &gt; style属性 &gt; 以上选择器</p>
<blockquote>
<p>前面提到!important属性，!important是用来使IE6和IE7、IE8、火狐(Firefox)、google等浏览器做兼容的，但IE6不能执行!important。当 !important 规则被应用在一个样式声明中时,该样式声明会覆盖CSS中任何其他的声明, 无论它处在声明列表中的哪个位置. 尽管如此, !important规则还是与优先级毫无关系.使用 !important不是一个好习惯，因为它改变了你样式表本来的级联规则，从而难以调试。</p>
</blockquote>
<h1 id="在使用!important时需要注意：">在使用!important时需要注意：</h1><p>Never 永远不要在全站范围的 css 上使用 !important<br>Only 只在需要覆盖全站或外部 css（例如引用的 ExtJs 或者YUI ）的特定页面中使用  !important<br>Never 永远不要在你的插件中使用 !important<br>Always 要优化考虑使用样式规则的优先级来解决问题而不是 !important<br>什么时候应该使用：</p>
<h2 id="A)_一种情况">A) 一种情况</h2><p>  你的网站上有一个设定了全站样式的CSS文件，同时你（或是你同事）写了一些效果通常都是很差的行内样式（行内样式的优先级是最高的）。在这种情况下，你就可以在你全局的CSS文件中写一些!important的样式来覆盖掉那些直接写在元素上的行内样式。</p>
<h2 id="B)_另一种情况">B) 另一种情况</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="id">#someElement</span> <span class="tag">p</span> <span class="rules">&#123;  </span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> blue</span></span>;  </span><br><span class="line">&#125;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">p</span><span class="class">.awesome</span> <span class="rules">&#123;  </span><br><span class="line">    <span class="rule"><span class="attribute">color</span>:<span class="value"> red</span></span>;  </span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>  在外层有 #someElement 的情况下，你怎样能使 awesome 的段落变成红色呢？这种情况下，如果不使用!important，第一条规则永远比第二条的优先级更高。</p>
<h2 id="怎样覆盖掉_!important：">怎样覆盖掉 !important：</h2><p>很简单，你只需要再加一条!important 的CSS语句，将其应用到更高优先级的选择器（在原有基础上添加额外的标签、class或id选择器）上；或是保持选择器一样，但添加的位置需要在原有声明的后面（优先级相同的情况下，后边定义的会覆盖前边定义的）。<br>[html] view plain copy print?</p>
<p>#test.a{<br>  color: red !important;     <!--尽管这条声明在前，但是仍会覆盖下边的样式--><br>}<br>a{<br>  color: green !important;<br>}<br>或：<br>[html] view plain copy print?<br>a{<br>  color: green !important;<br>}<br>a{<br>  color: red !important;     <!--同样的选择器，后边的声明会覆盖前边的--><br>}  </p>
<h1 id="link:">link:</h1><p><a href="http://blog.csdn.net/lzgs_4/article/details/43446303" target="_blank" rel="external">http://blog.csdn.net/lzgs_4/article/details/43446303</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/04/17/css-media/" itemprop="url">
                  Responsive Web Design
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-04-17T22:52:20+08:00" content="2016-04-17">
              2016-04-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/17/css-media/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/17/css-media/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="允许网页宽度自动调整">允许网页宽度自动调整</h1><p>“自适应网页设计” 到底是怎么做到的？ </p>
<p>首先，在网页代码的头部，加入一行viewport元标签。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span> /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>width 控制Viewport的宽度,可以指定一个值或者设备的宽度,如device-width为设备的宽度(单位为设备缩放比例1:1的像素),上面代码里设置的宽度是取设备宽度;</p>
<p> initial-scale 原始缩放比例（initial-scale=1）为1.0，即网页初始大小占屏幕面积的100%, 对应的值是一个浮点值,页面呈现大小等于设置原始的宽度乘以initial-scale的值;</p>
<p> maximum-scale 最大缩放,即允许用户缩放的最大比例,也是乘积关系.一般设置为1:1的比例不会让用户缩放的;</p>
<p> minimum-scale 最小缩放,如上;</p>
<p> user-scalable 用户是否可以手动缩放,一般值设为no,不允许用户缩放;</p>
</blockquote>
<p>这段代码的大意是让viewport的物理宽度等于设备的分辨率,不允许用户缩放.原始缩放比例（initial-scale=1）为1.0，即网页初始大小占屏幕面积的100%,所有主流浏览器都支持这个设置，包括IE9。</p>
<h2 id="meta_viewport标签动态改变的方法">meta viewport标签动态改变的方法</h2><h3 id="第一种方法:">第一种方法:</h3><p>可以使用document.write来动态输出meta viewport标签，例如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.<span class="command">write</span>('&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width,initial-scale=1"</span>&gt;')</span><br></pre></td></tr></table></figure>
<h3 id="第二种方法:">第二种方法:</h3><p>通过setAttribute来改变</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">id</span>=<span class="value">"testViewport"</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width = 380"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> mvp = <span class="built_in">document</span>.getElementById(<span class="string">'testViewport'</span>);</span><br><span class="line">mvp.setAttribute(<span class="string">'content'</span>,<span class="string">'width=480'</span>);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="CSS_@Media查询">CSS @Media查询</h1><p>引用MDN的描述:</p>
<blockquote>
<p> 媒体查询 包含了一个媒体类型和至少一个使用如宽度、高度和颜色等媒体属性来限制样式表范围的表达式。CSS3加入的媒体查询使得无需修改内容便可以使样式应用于某些特定的设备范围。<br>媒体查询包含了一个媒体类型 和如CSS3规范中描述的包含一个或多个表达式的媒体属性，这些媒体属性会被解析成真或假。如果媒体查询中的媒体类型与文档要展示的设备相符则查询结果为真，并且媒体查询中的所有表达式为真。</p>
<h2 id="在stylesheet_Link_选择加载制定的CSS">在stylesheet Link 选择加载制定的CSS</h2></blockquote>
<p>“自适应网页设计”的核心，就是CSS3引入的Media Query模块。<br>它的意思就是，自动探测屏幕宽度，然后加载相应的CSS文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- link元素中的CSS媒体查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"(max-width: 800px)"</span> <span class="attribute">href</span>=<span class="value">"example.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的代码意思是，如果屏幕宽度不超过800像素（max-width: 800px），就加载example.css文件。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text/css"</span> media=<span class="string">"screen and (min-width: 400px) and (max-device-width: 600px)"</span> href=<span class="string">"smallScreen.css"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>如果屏幕宽度在400像素到600像素之间，则加载smallScreen.css文件。<br>除了用html标签加载CSS文件，还可以在现有CSS文件中使用@import来实现加载。<br>但是并不推荐这样做.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="constant">@import</span> url(<span class="string">"tinyScreen.css"</span>) screen <span class="literal">and</span> (<span class="built_in">max</span>-device-width: <span class="number">400</span>px)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>当媒体查询为真时，相关的样式表或样式规则就会按照正常的级联规则被应用。即使媒体查询返回假， <link> 标签上带有媒体查询的样式表 仍将被下载 （只不过不会被应用）。</p>
<h2 id="在CSS文件内使用@media规则加载不同的CSS">在CSS文件内使用@media规则加载不同的CSS</h2><p>同一个CSS文件中，也可以根据不同的屏幕分辨率，选择应用不同的CSS规则。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="at_rule">@<span class="keyword">media</span> screen and (max-device-width: <span class="number">400px</span>) </span>&#123;</span><br><span class="line">　　　　<span class="class">.column</span> <span class="rules">&#123;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">float</span>:<span class="value"> none</span></span>;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">width</span>:<span class="value">auto</span></span>;</span><br><span class="line">　　　　&#125;</span></span><br><span class="line">　　　　<span class="id">#sidebar</span> <span class="rules">&#123;</span><br><span class="line">　　　　　　<span class="rule"><span class="attribute">display</span>:<span class="value">none</span></span>;</span><br><span class="line">　　　　&#125;</span></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码意思是，如果屏幕宽度小于400像素，<br>则column块取消浮动（float:none）、宽度自动调节（width:auto），sidebar块不显示（display:none）。</p>
<h2 id="媒体属性">媒体属性</h2><p><em>引用自 MDN</em></p>
<h3 id="媒体查询所有可用的查询方法以及属性">媒体查询所有可用的查询方法以及属性</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">media_query: [[only |<span class="string"> not]? &lt;media_type&gt; [ and &lt;expression&gt; ]*]</span><br><span class="line">  </span>|<span class="string"> &lt;expression&gt; [ and &lt;expression&gt; ]*</span><br><span class="line">expression: ( &lt;media_feature&gt; [: &lt;value&gt;]? )</span><br><span class="line"></span><br><span class="line">&lt;!-- 在不使用 not 或 only 操作符的情况下，媒体类型(media type)是可选的，如果没有设置则默认为 all 。 --&gt;</span><br><span class="line"></span><br><span class="line">media_type: all </span>|<span class="string"> aural </span>|<span class="string"> braille </span>|<span class="string"> handheld </span>|<span class="string"> print </span>|</span><br><span class="line">  projection |<span class="string"> screen </span>|<span class="string"> tty </span>|<span class="string"> tv </span>|<span class="string"> embossed</span><br><span class="line"></span><br><span class="line">media_feature: width </span>|<span class="string"> min-width </span>|<span class="string"> max-width</span><br><span class="line">  </span>|<span class="string"> height </span>|<span class="string"> min-height </span>|<span class="string"> max-height</span><br><span class="line">  </span>|<span class="string"> device-width </span>|<span class="string"> min-device-width </span>|<span class="string"> max-device-width</span><br><span class="line">  </span>|<span class="string"> device-height </span>|<span class="string"> min-device-height </span>|<span class="string"> max-device-height</span><br><span class="line">  </span>|<span class="string"> aspect-ratio </span>|<span class="string"> min-aspect-ratio </span>|<span class="string"> max-aspect-ratio</span><br><span class="line">  </span>|<span class="string"> device-aspect-ratio </span>|<span class="string"> min-device-aspect-ratio </span>|<span class="string"> max-device-aspect-ratio</span><br><span class="line">  </span>|<span class="string"> color </span>|<span class="string"> min-color </span>|<span class="string"> max-color</span><br><span class="line">  </span>|<span class="string"> color-index </span>|<span class="string"> min-color-index </span>|<span class="string"> max-color-index</span><br><span class="line">  </span>|<span class="string"> monochrome </span>|<span class="string"> min-monochrome </span>|<span class="string"> max-monochrome</span><br><span class="line">  </span>|<span class="string"> resolution </span>|<span class="string"> min-resolution </span>|<span class="string"> max-resolution</span><br><span class="line">  </span>|<span class="string"> scan </span>|<span class="string"> grid</span></span><br></pre></td></tr></table></figure>
<p>大多数媒体属性带有“min-”和“max-”前缀，用于表达“小于等于”和“大于等于”。这避免了使用与HTML和XML冲突的“&lt;”和“&gt;”字符。如果你未向媒体属性指定一个值，并且该特性的实际值不为零，则该表达式被解析为真。</p>
<p>注意：如果浏览器运行的设备上没有该属性值，包含这个属性值的表达式一般返回假。例如，在语音合成器上查询屏幕长宽比总是返回假。</p>
<h3 id="颜色（color）">颜色（color）</h3><p>指定输出设备每个像素单元的比特值。如果设备不支持输出颜色，则该值为0。\</p>
<p>值： <color><br>媒体： visual<br>是否接受 min/max 前缀：是</color></p>
<p>注意：如果每个颜色单元具有不同数量的比特值，则使用最小的。例如，如果显示器为蓝色和红色提供5比特，而为绿色提供6比特，则认为每个颜色单元有5比特。如果设备使用索引颜色，则使用颜色表中颜色单元的最小比特数。</p>
<h4 id="示例">示例</h4><p>向所有能显示颜色的设备应用样式表：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@media</span> <span class="function">all <span class="title">and</span> <span class="params">(color)</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>向每个颜色单元至少有4个比特的设备应用样式表：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> all <span class="literal">and</span> (<span class="built_in">min</span>-color: <span class="number">4</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h3 id="颜色索引（color-index）">颜色索引（color-index）</h3><p>指定了输出设备中颜色查询表中的条目数量。</p>
<p>值：<integer><br>媒体： visual<br>是否接受 min/max 前缀：是</integer></p>
<h4 id="示例-1">示例</h4><p>向所有使用索引颜色的设备应用样式表，你可以这么做：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@media</span> all <span class="keyword">and</span> (color-<span class="keyword">index</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>向所有使用至少256个索引颜色的设备应用样式表：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"all and (min-color-index: 256)"</span> <span class="attribute">href</span>=<span class="value">"http://foo.bar.com/stylesheet.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="宽高比（aspect-ratio）">宽高比（aspect-ratio）</h3><p>描述了输出设备目标显示区域的宽高比。该值包含两个以“/”分隔的正整数。代表了水平像素数（第一个值）与垂直像素数（第二个值）的比例。</p>
<p>值：<ratio><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</ratio></p>
<h4 id="示例-2">示例</h4><p>下面为显示区域宽高至少为一比一的设备选择了一个特殊的样式表。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-aspect-ratio: <span class="number">1</span>/<span class="number">1</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>这指定了宽高比或者1：1或者更大。换句话说，可视区域或者是正方形或者是宽屏。</p>
<h3 id="设备宽高比（device-aspect-ratio）">设备宽高比（device-aspect-ratio）</h3><p>描述了输出设备的宽高比。该值包含两个以“/”分隔的正整数。代表了水平像素数（第一个值）与垂直像素数（第二个值）的比例。</p>
<p>值：<ratio><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</ratio></p>
<h4 id="示例-3">示例</h4><p>下面为宽屏设备选择了一个特殊的样式表。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> screen and (<span class="attribute">device-aspect-ratio</span>: <span class="number">16</span>/<span class="number">9</span>), screen and (<span class="attribute">device-aspect-ratio</span>: <span class="number">16</span>/<span class="number">10</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>宽高比或者16：9或者16：10。</p>
<h3 id="设备高度（device-height）">设备高度（device-height）</h3><p>描述了输出设备的高度（整个屏幕或页的高度，而不是仅仅像文档窗口一样的渲染区域）。</p>
<p>值：<length><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<h4 id="示例-4">示例</h4><p>向显示在最大宽度800px的屏幕上的文档应用样式表，你可以这样做：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"screen and (max-device-width: 799px)"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="设备宽度（device-width）">设备宽度（device-width）</h3><p>描述了输出设备的宽度（整个屏幕或页的高度，而不是仅仅像文档窗口一样的渲染区域）。</p>
<p>值：<length><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<h3 id="网格（grid）">网格（grid）</h3><p>判断输出设备是网格设备还是位图设备。如果设备是基于网格的（例如电传打字机终端或只能显示一种字形的电话），该值为1，否则为0。</p>
<p>值：<integer><br>媒体：all<br>是否接受 min/max 前缀： 否</integer></p>
<h4 id="示例-5">示例</h4><p>向一个15字符宽度或更窄的手持设备应用样式：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> handheld <span class="literal">and</span> (grid) <span class="literal">and</span> (<span class="built_in">max</span>-width: <span class="number">15</span>em) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>注意：“em” 在网格设备中有不同的意义；一个“em”的实际宽度不得而知，假设1em相当于一个网格单元的宽高。</p>
<h3 id="高度（height）">高度（height）</h3><p>height 媒体属性描述了输出设备渲染区域（如可视区域的高度或打印机纸盒的高度）的高度。</p>
<p>值：<length><br>媒体：visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<p>注意：用户调整窗口大小后，火狐浏览器会根据使用了width和height属性的媒体查询来切换合适的样式表。</p>
<h3 id="方向（orientation）">方向（orientation）</h3><p>指定了设备处于横屏（宽度大于宽度）模式还是竖屏（高度大于宽度）模式。</p>
<p>值：landscape | portrait<br>媒体：visual<br>是否接受 min/max 前缀：否</p>
<h4 id="示例-6">示例</h4><p>向竖屏设备应用样式表：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> all and (<span class="attribute">orientation</span>: portrait) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h3 id="分辨率（resolution）">分辨率（resolution）</h3><p>指定输出设备的分辨率（像素密度）。分辨率可以用每英寸（dpi）或每厘米（dpcm）的点数来表示。</p>
<p>值： <resolution><br>媒体： bitmap<br>是否接受 min/max 前缀：是</resolution></p>
<h4 id="示例-7">示例</h4><p>为每英寸至多300点的打印机应用样式：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> print <span class="literal">and</span> (<span class="built_in">min</span>-resolution: <span class="number">300</span>dpi) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<p>替换老旧的 (min-device-pixel-ratio: 2) 语法：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-resolution: <span class="number">2</span>dppx) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="扫描（scan）">扫描（scan）</h3><p>描述了电视输出设备的扫描过程。</p>
<p>值： progressive | interlace<br>媒体：tv<br>是否接受 min/max 前缀：否</p>
<p>示例</p>
<p>向以顺序方式扫描的电视机上应用样式表：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> tv and (<span class="attribute">scan</span>: progressive) &#123; ... &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="宽度（width）">宽度（width）</h3><p>width 媒体属性描述了输出设备渲染区域（如可视区域的宽度或打印机纸盒的宽度）的宽度。</p>
<p>值： <length><br>媒体： visual, tactile<br>是否接受 min/max 前缀：是</length></p>
<p>注意：用户调整窗口大小后，火狐浏览器会根据使用了width和height属性的媒体查询来切换合适的样式表。<br>示例</p>
<p>如果你想向最小宽度20em的手持设备或屏幕应用样式表，你可以使用这样的查询：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> handheld <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">20</span>em), screen <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">20</span>em) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>这个媒体查询将向最小宽度8.5英寸的打印机应用样式表：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">media</span>=<span class="value">"print and (min-width: 8.5in)"</span></span><br><span class="line">    <span class="attribute">href</span>=<span class="value">"http://foo.com/mystyle.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个查询适用于宽度在500px和800px之间的屏幕：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">@media</span> screen <span class="literal">and</span> (<span class="built_in">min</span>-width: <span class="number">500</span>px) <span class="literal">and</span> (<span class="built_in">max</span>-width: <span class="number">800</span>px) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h2 id="更多的例子">更多的例子</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> screen and (max-width: <span class="number">1000px</span>) and (min-width: <span class="number">700px</span>) </span>&#123;</span><br><span class="line">    <span class="tag">ul</span> <span class="tag">li</span> <span class="tag">a</span><span class="pseudo">:before</span> <span class="rules">&#123;</span><br><span class="line">        <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">"Email: "</span></span></span>;</span><br><span class="line">        <span class="rule"><span class="attribute">font-style</span>:<span class="value"> italic</span></span>;</span><br><span class="line">        <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666666</span></span></span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的这段代码的意思是:当屏幕的宽度是在700到1000之间的时候,我们会在Email连接之前用Css 添加一个Email的文字以及设置斜体和颜色.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* For mobile phones: */</span></span><br><span class="line"><span class="attr_selector">[class*="col-"]</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span> only screen and (min-width: <span class="number">768px</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* For desktop: */</span></span><br><span class="line">    <span class="class">.col-1</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">8.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-2</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">16.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-3</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">25%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-4</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">33.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-5</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">41.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-6</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">50%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-7</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">58.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-8</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">66.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-9</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">75%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-10</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">83.33%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-11</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">91.66%</span></span></span>;&#125;</span></span><br><span class="line">    <span class="class">.col-12</span> <span class="rules">&#123;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的这段代码的意思是: 默认情况下是为手机做的宽度适配(即所有的宽度都是100%),当只有屏幕的宽度大于768像素的时候,才会单独给各个col设置宽度的值. </p>
<h1 id="当页面为自适应页面时,实现图片自适应的奇妙的解决方法:">当页面为自适应页面时,实现图片自适应的奇妙的解决方法:</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML: --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"image-container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"xxx.png"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- CSS: --&gt;</span></span><br><span class="line">p.image-container &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 0;</span><br><span class="line">  padding-bottom: 60%;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p.image-container img &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="思路:">思路:</h2><p><em>原作者: zihua-li</em></p>
<blockquote>
<p>需求:在保持 item 元素宽高比恒定（如高是宽的 1.618 倍）的情况下，使得 item 元素可以和父元素同比缩放。 </p>
</blockquote>
<p>我们知道，如果当 item 元素是图片，同时需要保持的宽高比恰好为图片本身的宽高比时，<br>可以设置 item 的 height 为 auto 即可轻松实现这个需求。<br>然而当 item 元素不是图片或者要保持的宽高比和图片本身的宽高比不同时，这个需求显得很难直接用 CSS 实现。<br>为此我放弃 CSS，直接用 JavaScript 绑定 window 的 onresize 事件来动态获取每个 item 的宽度，从而计算并设置其高度。<br>我一直在使用这个解决方案，直到今天调整样式时，突然想到这个需求竟然是可以只使用 CSS 解决的。<br>首先需要知道，一个元素的 padding，如果值是一个百分比，那这个百分比是相对于其父元素的宽度而言的，即使对于 padding-bottom 和 padding-top 也是如此。<br>另外，在计算 Overflow 时，是将元素的内容区域（即 width / height 对应的区域）和 Padding 区域一起计算的。换句话说，即使将元素的 overflow 设置为 hidden，“溢出”到 Padding 区域的内容也会照常显示。<br>综上两条所述，我们可以使用 padding-bottom 来代替 height 来实现高度与宽度成比例的效果。因为 item 元素的宽度是其父元素宽度的 21%，所以我们将 padding-bottom 设置为它的 1.618 倍，即 33.98%。同时将其 height 设置为 0 以使元素的“高度”等于 padding-bottom 的值，从而实现需要的效果。<br>最后 item 元素的 CSS 样式为：</p>
<p>.item {<br>  float: left;<br>  margin: 10px 5%;<br>  padding-bottom: 33.98%;<br>  width: 21%;<br>  height: 0;<br>}<br>页面效果见 <a href="http://jsfiddle.net/luin/25BbH/7/，拖动窗口调整页面宽度，item" target="_blank" rel="external">http://jsfiddle.net/luin/25BbH/7/，拖动窗口调整页面宽度，item</a> 元素始终保持恒定的宽高比。</p>
<h1 id="兼容情况:">兼容情况:</h1><h2 id="@media_screen_属性的浏览器支持情况">@media screen 属性的浏览器支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-17/99373677.jpg" alt=""></p>
<h2 id="@media_width_属性浏览器的支持情况">@media width 属性浏览器的支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-17/7417540.jpg" alt=""></p>
<h2 id="@Media_Queries支持情况">@Media Queries支持情况</h2><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-4-18/50675002.jpg" alt=""></p>
<h1 id="Ref:">Ref:</h1><p><a href="http://www.ruanyifeng.com/blog/2012/05/responsive_web_design.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/05/responsive_web_design.html</a> -阮一峰<br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media#Examples" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/CSS/@media#Examples</a> -MDN<br><a href="http://zihua.li/2013/12/keep-height-relevant-to-width-using-css/" target="_blank" rel="external">http://zihua.li/2013/12/keep-height-relevant-to-width-using-css/</a> -zihuali</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
