<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://lyn.s76.org/page/6/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36568696-2', 'auto');
  ga('send', 'pageview');

</script>








  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/09/21/nodejs-note-06/" itemprop="url">
                  How to learn Node.js -- organize your code by using require and exports
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-09-21T18:19:05+08:00" content="2015-09-21">
              2015-09-21
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/09/21/nodejs-note-06/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/21/nodejs-note-06/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Require_and_Exports">Require and  Exports</h1><p>here is a example of exports.function and module.exports</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">exports.theAnswerVal = <span class="number">41</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">module</span>.<span class="title">exports</span> =</span> <span class="function"><span class="keyword">function</span> <span class="title">theAnswer</span><span class="params">()</span> &#123;</span> console.<span class="built_in">log</span>(theAnswerVal) &#125;</div><div class="line"></div><div class="line">exports.theAnswer = <span class="number">43</span></div></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">handlers= <span class="built_in">require</span>(<span class="string">'./handlers'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(handlers)</div></pre></td></tr></table></figure>
<p>The result is :[function: theAnswer]</p>
<p>because exports is only a helper to collect exports iterms and trans them to module.exports,</p>
<p>if the module.exports is  defined, then the exports function will be ignored.</p>
<h1 id="Split_codes_into_different_files_by_function-">Split codes  into  different files by function.</h1><p>in order to make our code more clear, we’d better put code into specific files,</p>
<p>for example : we can split our original code into handlers.js routes.js, middleware.js and index.js.</p>
<p>this help us to find related code more easily. </p>
<h2 id="First,_split_handlers_into_handlers-js">First, split handlers into handlers.js</h2><p>handlers.js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">exports.home = function home (req, res)&#123;</div><div class="line">	//console.log("Hi! I was called at: ", req.originalUrl)</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">\</span>"/<span class="attr">login</span>\" <span class="attr">method</span>=<span class="string">\</span>"<span class="attr">POST</span>\"&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">\</span>"<span class="attr">username</span>\"&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">\</span>"<span class="attr">username</span>\" <span class="attr">type</span>=<span class="string">\</span>"<span class="attr">text</span>\" <span class="attr">name</span>=<span class="string">\</span>"<span class="attr">username</span>\"&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">\</span>"<span class="attr">submit</span>\"&gt;</span>Start ye adventures!<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">\</span>"/<span class="attr">images</span>/<span class="attr">logo.jpg</span>\"&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">exports.adventuresIndex =function adventuresIndex(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave " + req.session.username + " ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">exports.createAdventure = function createAdventure(req, res)&#123;</div><div class="line">	console.log(req.body);</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures/?_method=PUT'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="name">a</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>" );</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.updateAdventure = function updateAdventure(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="name">H1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.showLoot = function showLoot(req, res)&#123;</div><div class="line">	var id = req.params.id</div><div class="line">	res.setHeader("Content-Type", 'text/html')</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line">&#125;</div><div class="line">exports.login = function login(req, res)&#123;</div><div class="line"></div><div class="line">	if(req.body.username)&#123;</div><div class="line">		console.log(req.body.username);</div><div class="line">		req.session.username = req.body.username</div><div class="line">	</div><div class="line">		res.redirect("/adventures")</div><div class="line">	&#125; else &#123;</div><div class="line">		res.redirect("/")</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"></div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> handlers       = <span class="keyword">require</span>(<span class="string">'./handlers.js'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</div><div class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</div><div class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</div><div class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </div><div class="line"> </div><div class="line"><span class="comment">//console.log(handlers);</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//Middlewares</span></div><div class="line"> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</div><div class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</div><div class="line">     </div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span> (req.session.username)&#123;</div><div class="line">		console.log(req.session.username)</div><div class="line">		next()</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		console.log(req.session.username)</div><div class="line">		res.redirect(<span class="string">"/"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</div><div class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</div><div class="line">	next(err)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</div><div class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="comment">//Routes</span></div><div class="line"> </div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> indexRouter  = express.Router()</div><div class="line">indexRouter.get(<span class="string">'/'</span>, handlers.home)</div><div class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</div><div class="line">indexRouter.post(<span class="string">'/login'</span>, handlers.login)</div><div class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</div><div class="line">indexRouter.route(<span class="string">'/adventures'</span>)</div><div class="line">	 </div><div class="line">	.get(handlers.adventuresIndex)</div><div class="line">	.post(handlers.createAdventure)</div><div class="line">	.put(handlers.updateAdventure)</div><div class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, handlers.showLoot)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></div><div class="line">  extended: <span class="keyword">false</span></div><div class="line">&#125;)); </div><div class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</div><div class="line">app.<span class="keyword">use</span>(cookieParser())</div><div class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</div><div class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</div><div class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</div><div class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</div><div class="line">app.<span class="keyword">use</span>(notFound)</div><div class="line">app.<span class="keyword">use</span>(catchError)</div><div class="line">app.<span class="keyword">use</span>(showErroPage)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</div></pre></td></tr></table></figure>
<h1 id="Second,_split_routes_into_routes-js_file">Second, split routes into  routes.js file</h1><p>routes.js</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var express       = <span class="built_in">require</span>(<span class="string">"express"</span>)</div><div class="line">var handlers      = <span class="built_in">require</span>(<span class="string">'./handlers.js'</span>)</div><div class="line">var indexRouter   =  express.Router()</div><div class="line"></div><div class="line"></div><div class="line">indexRouter.<span class="built_in">get</span>(<span class="string">'/'</span>, handlers.home)</div><div class="line">indexRouter.<span class="built_in">get</span>(<span class="string">'/read_from_db'</span>, handlers.readFromDB)</div><div class="line">indexRouter.<span class="built_in">post</span>(<span class="string">'/login'</span>, handlers.login)</div><div class="line">indexRouter.all(<span class="string">'*'</span>,  handlers.ensureAuthenticated)</div><div class="line">indexRouter.route(<span class="string">'/adventures'</span>)</div><div class="line">	 </div><div class="line">	.<span class="built_in">get</span>(handlers.adventuresIndex)</div><div class="line">	.<span class="built_in">post</span>(handlers.createAdventure)</div><div class="line">	.<span class="built_in">put</span>(handlers.updateAdventure)</div><div class="line"></div><div class="line">indexRouter.<span class="built_in">get</span>(<span class="string">'/loot/:id'</span>, handlers.showLoot)</div><div class="line"></div><div class="line"></div><div class="line">module.exports = indexRouter</div></pre></td></tr></table></figure>
<h1 id="Third,_split_middlewares_into_middlewares-js">Third, split middlewares into middlewares.js</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Middlewares</span></div><div class="line"> </div><div class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">"express"</span>)</div><div class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</div><div class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</div><div class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</div><div class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</div><div class="line"></div><div class="line">  	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</div><div class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</div><div class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</div><div class="line">	next(err)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"> module.exports = <span class="function"><span class="keyword">function</span><span class="params">(indexRouter)</span></span>&#123;</div><div class="line"></div><div class="line">	app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></div><div class="line">	  extended: <span class="keyword">false</span></div><div class="line">	&#125;)); </div><div class="line">	app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</div><div class="line">	app.<span class="keyword">use</span>(cookieParser())</div><div class="line">	app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</div><div class="line">	app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</div><div class="line">	 </div><div class="line">	app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</div><div class="line">	app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</div><div class="line"></div><div class="line">	app.<span class="keyword">use</span>(notFound)</div><div class="line">	app.<span class="keyword">use</span>(catchError)</div><div class="line">	app.<span class="keyword">use</span>(showErroPage)</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index.js file </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"></div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></div><div class="line"></div><div class="line">	<span class="comment">//var bodyParser     = require('body-parser')</span></div><div class="line">	<span class="comment">//var methodOverride = require('method-override')</span></div><div class="line">	<span class="comment">//var cookieParser   = require('cookie-parser')</span></div><div class="line">	<span class="comment">//var cookieSession  = require('cookie-session') </span></div><div class="line"></div><div class="line"><span class="comment">//Routes</span></div><div class="line"><span class="keyword">var</span> handlers       = <span class="built_in">require</span>(<span class="string">'./handlers.js'</span>)</div><div class="line"><span class="keyword">var</span> indexRouter	   = <span class="built_in">require</span>(<span class="string">'./routes.js'</span>)</div><div class="line"></div><div class="line"><span class="comment">//middlewares</span></div><div class="line"><span class="keyword">var</span> middlewares    = <span class="built_in">require</span>(<span class="string">'./middlewares.js'</span>)</div><div class="line">   </div><div class="line">    middlewares(indexRouter)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</div></pre></td></tr></table></figure>
<h1 id="Error">Error</h1><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">throw new TypeError(<span class="string">'Router.use() requires middleware function but got a '</span> + gettype(fn));</div><div class="line">      ^</div><div class="line"></div><div class="line"><span class="symbol">TypeError:</span> Router.use() requires middleware function but got a undefined</div><div class="line">    at Function.use (<span class="regexp">/Users/</span>Lyn/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">router</span>/<span class="title">index</span>.<span class="title">js</span>:458:13)</span></div><div class="line">    at EventEmitter.&lt;anonymous&gt; (<span class="regexp">/Users/</span>Lyn/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:219:21)</span></div><div class="line">    at Array.forEach (native)</div><div class="line">    at EventEmitter.use (<span class="regexp">/Users/</span>Lyn/src/node/node-<span class="number">05</span>/node_modules/express/<span class="class"><span class="keyword">lib</span>/<span class="title">application</span>.<span class="title">js</span>:216:7)</span></div><div class="line">    at <span class="class"><span class="keyword">module</span>.<span class="title">exports</span> (/<span class="title">Users</span>/<span class="title">Lyn</span>/<span class="title">src</span>/<span class="title">node</span>/<span class="title">node</span>-05/<span class="title">middlewares</span>.<span class="title">js</span>:45:6)</span></div><div class="line">    at Object.&lt;anonymous&gt; (<span class="regexp">/Users/</span>Lyn/src/node/node-<span class="number">05</span>/index.<span class="symbol">js:</span><span class="number">37</span>:<span class="number">1</span>)</div><div class="line">    at Module._compile (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:435:26)</span></div><div class="line">    at Object.Module._extensions..js (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:442:10)</span></div><div class="line">    at Module.load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:356:32)</span></div><div class="line">    at Function.Module._load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:311:12)</span></div></pre></td></tr></table></figure>
<p>if you see this error during your programing,</p>
<p>you could check the the location of the middleware and routes handlers.</p>
<p>handlers must be claimed the handlers function before app.use router function,</p>
<p>and the check routes rules as well,</p>
<p>you can try console.log()  to check the  value of routes object.</p>
<p>it should be looks like this:</p>
<pre><code>
{ [<span class="built_in">Function</span>: router]
  params: {},
  _params: [],
  caseSensitive: <span class="literal">undefined</span>,
  mergeParams: <span class="literal">undefined</span>,
  strict: <span class="literal">undefined</span>,
  stack:
   [ Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/read_from_db\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/login\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^(.*)\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [],
       regexp: <span class="regexp">/^\/adventures\/?$/i</span>,
       route: [<span class="built_in">Object</span>] },
     Layer {
       handle: [<span class="built_in">Function</span>: bound dispatch],
       name: <span class="string">'bound dispatch'</span>,
       params: <span class="literal">undefined</span>,
       path: <span class="literal">undefined</span>,
       keys: [<span class="built_in">Object</span>],
       regexp: <span class="regexp">/^\/loot\/(?:([^\/]+?))\/?$/i</span>,
       route: [<span class="built_in">Object</span>] } ] }
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/09/05/nodejs-note-05/" itemprop="url">
                  How to learn Node.js -- 05 usages of express.Router(), middleware, cookieParser, cookieSession, create 404 control and catchError function
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-09-05T15:54:49+08:00" content="2015-09-05">
              2015-09-05
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/09/05/nodejs-note-05/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/05/nodejs-note-05/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Concept_of_Middleware_queue">Concept of Middleware queue</h1><h2 id="Custom_middleware">Custom middleware</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span>(<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello! I was called at: "</span>, req.path)</div><div class="line">     </div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="The_middleware_queue">The middleware queue</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Routes</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> indexRouter  = express.Router()</div><div class="line">indexRouter.<span class="built_in">get</span>('/', home)</div><div class="line">indexRouter.<span class="built_in">get</span>('/read_from_db', readFromDB)</div><div class="line">indexRouter.<span class="keyword">post</span>('/login', login)</div><div class="line">indexRouter.all('*',  ensureAuthenticated)</div><div class="line">indexRouter.route('/adventures') </div><div class="line">	.<span class="built_in">get</span>(adventuresIndex)</div><div class="line">	.<span class="keyword">post</span>(createAdventure)</div><div class="line">	.put(updateAdventure)</div><div class="line">indexRouter.<span class="built_in">get</span>('/loot/:id', showLoot)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></div><div class="line">  extended: false</div><div class="line">&#125;)); </div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(methodOverride('_method'));</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(cookieParser())</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>('/images', express.static(__dirname + '/images'));</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>('/',indexRouter)</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(notFound)</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(catchError)</div><div class="line"><span class="keyword">app</span>.<span class="keyword">use</span>(showErroPage)</div></pre></td></tr></table></figure>
<p> <img src="http://7xnuw0.com1.z0.glb.clouddn.com/15-11-5/52848128.jpg" alt=""></p>
<h1 id="Code">Code</h1><h2 id="dependencies">dependencies</h2><p>  The Package.json file </p>
<pre><code><span class="comment"><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">	&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"expressapp"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"first express app"</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;</div><div class="line">    <span class="attr">"method-override"</span>: <span class="string">"2.3.5"</span>,</div><div class="line">    <span class="attr">"express"</span>: <span class="string">"^4.13.3"</span>,</div><div class="line">    <span class="attr">"body-parser"</span>:<span class="string">"1.14.1"</span>,</div><div class="line">    <span class="attr">"cookie-session"</span>:<span class="string">"2.0.0-alpha.1"</span>,</div><div class="line">    <span class="attr">"cookie-parser"</span>:<span class="string">"1.4.0"</span></div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></span>
</code></pre><h2 id="the_index-js_Code">the index.js Code</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"></div><div class="line">app.get("/", home)</div><div class="line">app.get("/adventures", adventuresIndex)</div><div class="line">app.post("/adventures", createAdventure)</div><div class="line">app.put("/adventures", updateAdventure)</div><div class="line">app.get("/loot/:id", showLoot)</div><div class="line"></div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line"><span class="keyword">var</span>  express = <span class="keyword">require</span>(<span class="string">"express"</span>)</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> bodyParser     = <span class="keyword">require</span>(<span class="string">'body-parser'</span>)</div><div class="line"><span class="keyword">var</span> methodOverride = <span class="keyword">require</span>(<span class="string">'method-override'</span>)</div><div class="line"><span class="keyword">var</span> cookieParser   = <span class="keyword">require</span>(<span class="string">'cookie-parser'</span>)</div><div class="line"><span class="keyword">var</span> cookieSession  = <span class="keyword">require</span>(<span class="string">'cookie-session'</span>) </div><div class="line"> </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">home</span> <span class="params">(req, res)</span></span>&#123;</div><div class="line">	<span class="comment">//console.log("Hi! I was called at: ", req.originalUrl)</span></div><div class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>);</div><div class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;Node Slash&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Browser Game&lt;/h1&gt;&lt;form action=\"/login\" method=\"POST\"&gt;&lt;label for=\"username\"&gt;Username&lt;/label&gt;&lt;input id=\"username\" type=\"text\" name=\"username\"&gt;&lt;button type=\"submit\"&gt;Start ye adventures!&lt;/button&gt;&lt;/form&gt;&lt;img src=\"/images/logo.jpg\"&gt;&lt;a href='/adventures'&gt; Go to adventures &lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">adventuresIndex</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</div><div class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; Are you brave "</span> + req.session.username + <span class="string">" ?&lt;/h1&gt;&lt;form action='/adventures' method='POST'&gt; &lt;button type='submit'&gt; Yes! i am !&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAdventure</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	console.log(req.body);</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</div><div class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt; So  you are brave!&lt;/h1&gt;&lt;form action='/adventures/?_method=PUT' method='POST'&gt;  &lt;button type='submit'&gt; Cheat &lt;/button&gt;&lt;/form&gt;&lt;form action='/adventures' method='POST'&gt;  &lt;button type='submit'&gt; again !&lt;/button&gt;&lt;p&gt;you have found some &lt;a href='/loot/1'&gt;loot &lt;/a&gt; here&lt;/p&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span> );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateAdventure</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>);</div><div class="line">	res.send(<span class="string">"&lt;html&gt;&lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;H1&gt;Method override help you to change method from post to put ! &lt;/H1&gt;&lt;p&gt;It's a secret to everybody &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoot</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	<span class="keyword">var</span> id = req.params.id</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="string">"&lt;html&gt; &lt;head&gt; &lt;title&gt;adventures &lt;/title&gt;&lt;/head&gt; &lt;body&gt; &lt;h1&gt; Ogre-slaying knife&lt;/h1&gt;&lt;p&gt; it has 9 orges,  it was"</span> + id + <span class="string">" &lt;/p&gt; &lt;/body&gt;&lt;/html&gt;"</span>)</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">(req, res)</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(req.body.username)&#123;</div><div class="line">		console.log(req.body.username);</div><div class="line">		req.session.username = req.body.username</div><div class="line">	</div><div class="line">		res.redirect(<span class="string">"/adventures"</span>)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		res.redirect(<span class="string">"/"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Middlewares</span></div><div class="line"> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stoopidLogger</span><span class="params">(options)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">stoopidLoggerInner</span><span class="params">(req,res,next)</span> </span>&#123;</div><div class="line">    console.log(<span class="string">"Hello! I was called at: "</span>, req.path)</div><div class="line">     </div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureAuthenticated</span><span class="params">(req, res, next)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span> (req.session.username)&#123;</div><div class="line">		console.log(req.session.username)</div><div class="line">		next()</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		console.log(req.session.username)</div><div class="line">		res.redirect(<span class="string">"/"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Conetent-Type"</span>, <span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">404</span>, <span class="string">"&lt;h1&gt;confound it all! We could not find your page!&lt;/h1&gt;"</span>)</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">catchError</span><span class="params">(err, req, res, next)</span></span>&#123;</div><div class="line">	console.log(<span class="string">"there was  an error! In the real world, I might be alerting the engineering team."</span>)</div><div class="line">	next(err)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showErroPage</span><span class="params">(err,req,res,next)</span></span>&#123;</div><div class="line">	res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">'text/html'</span>)</div><div class="line">	res.send(<span class="number">500</span>,<span class="string">"&lt;h1&gt;confound it all! it's a 500 error!&lt;/h1&gt;"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFromDB</span><span class="params">(req,res,next)</span></span>&#123;</div><div class="line">	next(<span class="keyword">new</span> Error(<span class="string">"we dont have DB!"</span>))</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Routes</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> indexRouter  = express.Router()</div><div class="line">indexRouter.get(<span class="string">'/'</span>, home)</div><div class="line">indexRouter.get(<span class="string">'/read_from_db'</span>, readFromDB)</div><div class="line">indexRouter.post(<span class="string">'/login'</span>, login)</div><div class="line">indexRouter.all(<span class="string">'*'</span>,  ensureAuthenticated)</div><div class="line">indexRouter.route(<span class="string">'/adventures'</span>) </div><div class="line">	.get(adventuresIndex)</div><div class="line">	.post(createAdventure)</div><div class="line">	.put(updateAdventure)</div><div class="line">indexRouter.get(<span class="string">'/loot/:id'</span>, showLoot)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">app.<span class="keyword">use</span>(bodyParser.urlencoded(&#123;     <span class="comment">// to support URL-encoded bodies</span></div><div class="line">  extended: <span class="keyword">false</span></div><div class="line">&#125;)); </div><div class="line">app.<span class="keyword">use</span>(methodOverride(<span class="string">'_method'</span>));</div><div class="line">app.<span class="keyword">use</span>(cookieParser())</div><div class="line">app.<span class="keyword">use</span>(cookieSession(&#123;secret: <span class="string">"it's a secret to  everybody"</span>, key:<span class="string">"session"</span>&#125;))</div><div class="line">app.<span class="keyword">use</span>(<span class="string">"/"</span>, stoopidLogger())</div><div class="line">app.<span class="keyword">use</span>(<span class="string">'/images'</span>, express.<span class="keyword">static</span>(__dirname + <span class="string">'/images'</span>));</div><div class="line">app.<span class="keyword">use</span>(<span class="string">'/'</span>,indexRouter)</div><div class="line">app.<span class="keyword">use</span>(notFound)</div><div class="line">app.<span class="keyword">use</span>(catchError)</div><div class="line">app.<span class="keyword">use</span>(showErroPage)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</div></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/08/30/nodejs-note-04/" itemprop="url">
                  How to learn Node.js - 04 express with middleware bodyParser, method-override and static
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-08-30T13:57:02+08:00" content="2015-08-30">
              2015-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/30/nodejs-note-04/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/30/nodejs-note-04/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Middleware">Middleware</h1><p>Middleware is a function with access to the request object (req), the response object (res), and the next middleware in the application’s request-response cycle, commonly denoted by a variable named next.</p>
<p>Middleware can:</p>
<ul>
<li>Execute any code.</li>
<li>Make changes to the request and the response objects.</li>
<li>End the request-response cycle.</li>
<li>Call the next middleware in the stack.</li>
</ul>
<h2 id="method-Overide">method-Overide</h2><p>Lets you use HTTP verbs such as PUT or DELETE in places where the client doesn’t support it.</p>
<p>this middleware help to catch ‘_method= post’  in the form, so that we can return a different response. </p>
<h3 id="methodOverride(getter,_options)">methodOverride(getter, options)</h3><p>middleware is for requests from clients that only natively support simple verbs like GET and POST,but methodOverride Create a new middleware function to override the req.method property(put, delete or path ) with a new value(like: POST). This value will be pulled from the provided getter.</p>
<p>getter - The getter to use to look up the overridden request method for the request. (default: X-HTTP-Method-Override)<br>options.methods - The allowed methods the original request must be in to check for a method override value. (default: [‘POST’])<br>If the found method is supported by node.js core, then req.method will be set to this value, as if it has originally been that value. The previous req.method value will be stored in req.originalMethod.</p>
<h3 id="getter">getter</h3><p>This is the method of getting the override value from the request. If a function is provided, the req is passed as the first argument, the res as the second argument and the method is expected to be returned. If a string is provided, the string is used to look up the method with the following rules:</p>
<p>If the string starts with X-, then it is treated as the name of a header and that header is used for the method override. If the request contains the same header multiple times, the first occurrence is used.<br>All other strings are treated as a key in the URL query string.<br>options.methods</p>
<p>This allows the specification of what methods(s) the request MUST be in in order to check for the method override value. This defaults to only POST methods, which is the only method the override should arrive in. More methods may be specified here, but it may introduce security issues and cause weird behavior when requests travel through caches. This value is an array of methods in upper-case. null can be specified to allow all methods.</p>
<h2 id="bodyParser">bodyParser</h2><p>var bodyParser = require(‘body-parser’)</p>
<p>The bodyParser object exposes various factories to create middlewares. All middlewares will populate the req.body property with the parsed body or provide an error to the callback.</p>
<h2 id="Serving_static_files_in_Express">Serving static files in Express</h2><p>Serving files, such as images, CSS, JavaScript and other static files is accomplished with the help of a built-in middleware in Express - express.static.</p>
<p>Pass the name of the directory, which is to be marked as the location of static assets, to the express.static middleware to start serving the files directly. For example, if you keep your images, CSS, and JavaScript files in a directory named public, you can do this:</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.<span class="keyword">use</span>(express.<span class="keyword">static</span>('<span class="keyword">public</span>'));</div></pre></td></tr></table></figure>
<h1 id="Example_of_middlewares">Example of middlewares</h1><h2 id="installation_of_middlewares">installation of middlewares</h2><p>we will write the function based on the last browser game express app.</p>
<p>create a  new package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"expressapp"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"first express app"</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;</div><div class="line">    <span class="attr">"method-override"</span>: <span class="string">"2.3.5"</span>,</div><div class="line">    <span class="attr">"express"</span>: <span class="string">"^4.13.3"</span>,</div><div class="line">    <span class="attr">"body-parser"</span>:<span class="string">"1.14.1"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>and install the dependencies .</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> <span class="comment">--save</span></div></pre></td></tr></table></figure>
<h2 id="Example_of_using_bodyParser">Example of using bodyParser</h2><p>then we can add a hidden input and cheat button based on last project.</p>
<p>and we can receive the input by using bodyParser middleware.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line">var  express = require("express")</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env['port'] || 3000</div><div class="line"></div><div class="line">var methodOverride = require('method-override')</div><div class="line">var bodyParser = require('body-parser')</div><div class="line">app.use(methodOverride('_method'))</div><div class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</div><div class="line">  extended: true</div><div class="line">&#125;)); </div><div class="line"></div><div class="line">app.get("/", home)</div><div class="line">app.get("/adventures", adventuresIndex)</div><div class="line">app.post("/adventures", createAdventure)</div><div class="line">//app.put("/adventures", updateAdventure)</div><div class="line">app.get("/loot/:id", showLoot)</div><div class="line"></div><div class="line"></div><div class="line">function home (req, res)&#123;</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function adventuresIndex(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function createAdventure(req, res)&#123;</div><div class="line">	console.log(req.body);</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="name">a</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>" );</div><div class="line">&#125;</div><div class="line"></div><div class="line">function showLoot(req, res)&#123;</div><div class="line">	var id = req.params.id</div><div class="line">	res.setHeader("Content-Type", 'text/html')</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</div></pre></td></tr></table></figure>
<p>We can check the result of console.log<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="title">-03</span> Lyn$ <span class="keyword">node</span> <span class="title">index</span>.js</div><div class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3000</span>/</div><div class="line">&#123;&#125;</div><div class="line">&#123; _method: 'input' &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Example_of_methodOverride_middleware">Example of methodOverride middleware</h2><p>We can use  methodOverride to make a put request on adventures path.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line">var  express = require("express")</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env['port'] || 3000</div><div class="line"></div><div class="line">var bodyParser     = require('body-parser')</div><div class="line">var methodOverride = require('method-override')</div><div class="line"></div><div class="line"></div><div class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</div><div class="line">  extended: true</div><div class="line">&#125;)); </div><div class="line">app.use(methodOverride('_method'));</div><div class="line"></div><div class="line"></div><div class="line">app.get("/", home)</div><div class="line">app.get("/adventures", adventuresIndex)</div><div class="line">app.post("/adventures", createAdventure)</div><div class="line">app.put("/adventures", updateAdventure)</div><div class="line">app.get("/loot/:id", showLoot)</div><div class="line"></div><div class="line"></div><div class="line">function home (req, res)&#123;</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function adventuresIndex(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function createAdventure(req, res)&#123;</div><div class="line">	console.log(req.body);</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures/?_method=PUT'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="name">a</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>" );</div><div class="line">&#125;</div><div class="line"></div><div class="line">function updateAdventure(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="name">H1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line">function showLoot(req, res)&#123;</div><div class="line">	var id = req.params.id</div><div class="line">	res.setHeader("Content-Type", 'text/html')</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</div></pre></td></tr></table></figure>
<h2 id="Example_of_express-static_function">Example of  express.static function</h2><p>We will add one server images on index page by using  express.static function.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line">var  express = require("express")</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env['port'] || 3000</div><div class="line"></div><div class="line">var bodyParser     = require('body-parser')</div><div class="line">var methodOverride = require('method-override')</div><div class="line"></div><div class="line"></div><div class="line">app.use(bodyParser.urlencoded(&#123;     // to support URL-encoded bodies</div><div class="line">  extended: true</div><div class="line">&#125;)); </div><div class="line">app.use(methodOverride('_method'));</div><div class="line">app.use(express.static('images'));</div><div class="line"></div><div class="line">app.get("/", home)</div><div class="line">app.get("/adventures", adventuresIndex)</div><div class="line">app.post("/adventures", createAdventure)</div><div class="line">app.put("/adventures", updateAdventure)</div><div class="line">app.get("/loot/:id", showLoot)</div><div class="line"></div><div class="line"></div><div class="line">function home (req, res)&#123;</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">'/images/hello.png'</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function adventuresIndex(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function createAdventure(req, res)&#123;</div><div class="line">	console.log(req.body);</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures/?_method=PUT'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Cheat <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="name">a</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>" );</div><div class="line">&#125;</div><div class="line"></div><div class="line">function updateAdventure(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">H1</span>&gt;</span>Method override help you to change method from post to put ! <span class="tag">&lt;/<span class="name">H1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>It's a secret to everybody <span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line">function showLoot(req, res)&#123;</div><div class="line">	var id = req.params.id</div><div class="line">	res.setHeader("Content-Type", 'text/html')</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</div></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/08/25/nodejs-note-03/" itemprop="url">
                  How to learn Node.js - 03 Express route and params handling
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-08-25T11:49:21+08:00" content="2015-08-25">
              2015-08-25
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/25/nodejs-note-03/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/25/nodejs-note-03/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span> <span class="title">Lyn</span>$ mkdir <span class="keyword">node</span><span class="title">-02</span></div><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span> <span class="title">Lyn</span>$ cd <span class="keyword">node</span><span class="title">-02</span></div><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span><span class="title">-02</span> Lyn$ npm init</div><div class="line">This utility will walk you through creating a package.json file.</div><div class="line">It only covers the most common items, <span class="keyword">and</span> tries to guess sensible defaults.</div><div class="line"></div><div class="line">See `npm help json` for definitive documentation on these fields</div><div class="line"><span class="keyword">and</span> exactly what they do.</div><div class="line"></div><div class="line">Use `npm install <span class="tag">&lt;pkg&gt;</span> --save` afterwards to install a package <span class="keyword">and</span></div><div class="line">save it as a dependency <span class="keyword">in</span> the package.json file.</div><div class="line"></div><div class="line">Press ^C at any time to quit.</div><div class="line">name: (<span class="keyword">node</span><span class="title">-02</span>) expressapp</div><div class="line"><span class="keyword">version</span>: (<span class="number">1.0</span>.<span class="number">0</span>)</div><div class="line">description: first express app</div><div class="line">entry point: (index.js)</div><div class="line">test command:</div><div class="line">git repository:</div><div class="line">keywords:</div><div class="line">author: lyn</div><div class="line">license: (ISC) MIT</div><div class="line">About to <span class="keyword">write</span> to /Users/Lyn/src/<span class="keyword">node</span><span class="title">/node-02</span>/package.json:</div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"expressapp"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">"first express app"</span>,</div><div class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">Is this ok? (yes) yes</div></pre></td></tr></table></figure>
<p>config package.json</p>
<p>add the dependency</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"expressapp"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"first express app"</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;</div><div class="line">    <span class="attr">"connect-busboy"</span>: <span class="string">"0.0.2"</span>,</div><div class="line">    <span class="attr">"express"</span>: <span class="string">"^4.13.3"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Then use NPM to  install all the dependency for us </p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:node<span class="number">-02</span> Lyn$ npm install --save</div><div class="line">npm WARN package.json expressapp<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span> No repository field.</div><div class="line">npm WARN package.json expressapp<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span> No README data</div><div class="line">connect-busboy<span class="symbol">@0</span><span class="number">.0</span><span class="number">.2</span> node_modules/connect-busboy</div><div class="line">└── busboy<span class="symbol">@0</span><span class="number">.2</span><span class="number">.11</span> (readable-stream<span class="symbol">@1</span><span class="number">.1</span><span class="number">.13</span>, dicer<span class="symbol">@0</span><span class="number">.2</span><span class="number">.3</span>)</div><div class="line"></div><div class="line">express<span class="symbol">@4</span><span class="number">.13</span><span class="number">.3</span> node_modules/express</div><div class="line">├── escape-html<span class="symbol">@1</span><span class="number">.0</span><span class="number">.2</span></div><div class="line">├── merge-descriptors<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── cookie<span class="symbol">@0</span><span class="number">.1</span><span class="number">.3</span></div><div class="line">├── array-flatten<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span></div><div class="line">├── cookie-signature<span class="symbol">@1</span><span class="number">.0</span><span class="number">.6</span></div><div class="line">├── methods<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span></div><div class="line">├── vary<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── content-type<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── utils-merge<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── etag<span class="symbol">@1</span><span class="number">.7</span><span class="number">.0</span></div><div class="line">├── content-disposition<span class="symbol">@0</span><span class="number">.5</span><span class="number">.0</span></div><div class="line">├── path-<span class="keyword">to</span>-regexp<span class="symbol">@0</span><span class="number">.1</span><span class="number">.7</span></div><div class="line">├── fresh<span class="symbol">@0</span><span class="number">.3</span><span class="number">.0</span></div><div class="line">├── serve-<span class="keyword">static</span><span class="symbol">@1</span><span class="number">.10</span><span class="number">.0</span></div><div class="line">├── range-parser<span class="symbol">@1</span><span class="number">.0</span><span class="number">.3</span></div><div class="line">├── parseurl<span class="symbol">@1</span><span class="number">.3</span><span class="number">.0</span></div><div class="line">├── depd<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── qs<span class="symbol">@4</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── debug<span class="symbol">@2</span><span class="number">.2</span><span class="number">.0</span> (ms<span class="symbol">@0</span><span class="number">.7</span><span class="number">.1</span>)</div><div class="line">├── finalhandler<span class="symbol">@0</span><span class="number">.4</span><span class="number">.0</span> (unpipe<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span>)</div><div class="line">├── on-finished<span class="symbol">@2</span><span class="number">.3</span><span class="number">.0</span> (ee-first<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span>)</div><div class="line">├── proxy-addr<span class="symbol">@1</span><span class="number">.0</span><span class="number">.8</span> (forwarded<span class="symbol">@0</span><span class="number">.1</span><span class="number">.0</span>, ipaddr.js<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span>)</div><div class="line">├── <span class="built_in">send</span><span class="symbol">@0</span><span class="number">.13</span><span class="number">.0</span> (destroy<span class="symbol">@1</span><span class="number">.0</span><span class="number">.3</span>, statuses<span class="symbol">@1</span><span class="number">.2</span><span class="number">.1</span>, ms<span class="symbol">@0</span><span class="number">.7</span><span class="number">.1</span>, mime<span class="symbol">@1</span><span class="number">.3</span><span class="number">.4</span>, http-errors<span class="symbol">@1</span><span class="number">.3</span><span class="number">.1</span>)</div><div class="line">├── accepts<span class="symbol">@1</span><span class="number">.2</span><span class="number">.13</span> (negotiator<span class="symbol">@0</span><span class="number">.5</span><span class="number">.3</span>, mime-types<span class="symbol">@2</span><span class="number">.1</span><span class="number">.7</span>)</div><div class="line">└── type-is<span class="symbol">@1</span><span class="number">.6</span><span class="number">.9</span> (media-typer<span class="symbol">@0</span><span class="number">.3</span><span class="number">.0</span>, mime-types<span class="symbol">@2</span><span class="number">.1</span><span class="number">.7</span>)</div></pre></td></tr></table></figure>
<p>Now our express framework is installed by NPM and we can create index.js !</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"><span class="meta"></span></div><div class="line">'use strict';</div><div class="line"></div><div class="line"><span class="keyword">var</span>  express = <span class="built_in">require</span>(<span class="string">"express"</span>)</div><div class="line">	, app    = express()</div><div class="line">	, port   = process.env[<span class="string">'port'</span>] || <span class="number">3000</span></div><div class="line"></div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:'</span> + port + <span class="string">'/'</span>);</div></pre></td></tr></table></figure>
<p>we can write a  game by  handle get and post request.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line">var  express = require("express")</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env['port'] || 3000</div><div class="line"></div><div class="line">app.get("/", function(req, res)&#123;</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get("/adventures", function(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.post("/adventures",function(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line"></div><div class="line">&#125;)</div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</div></pre></td></tr></table></figure>
<p>in order to  orgnize our code better,</p>
<p>we can seperate  out route and function into  two parts as follow:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line">var  express = require("express")</div><div class="line">	  app    = express() </div><div class="line">	  port   = process.env['port'] || 3000</div><div class="line"></div><div class="line">app.get("/", home)</div><div class="line">app.get("/adventures", adventuresIndex)</div><div class="line">app.post("/adventures", createAdventure)</div><div class="line">app.get("/loot/:id", showLoot)</div><div class="line"></div><div class="line">function home (req, res)&#123;</div><div class="line">	res.setHeader("Conetent-Type", 'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>Node Slash<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Browser Game<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/adventures'</span>&gt;</span> Go to adventures <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>");</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function adventuresIndex(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Are you brave ?<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> Yes! i am !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function createAdventure(req, res)&#123;</div><div class="line">	res.setHeader("Content-Type",'text/html');</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span> So  you are brave!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'/adventures'</span> <span class="attr">method</span>=<span class="string">'POST'</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span>&gt;</span> ! again !<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>you have found some <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/loot/1'</span>&gt;</span>loot <span class="tag">&lt;/<span class="name">a</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line">function showLoot(req, res)&#123;</div><div class="line">	var id = req.params.id</div><div class="line">	res.setHeader("Content-Type", 'text/html')</div><div class="line">	res.send("<span class="tag">&lt;<span class="name">html</span>&gt;</span> <span class="tag">&lt;<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>adventures <span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> <span class="tag">&lt;<span class="name">body</span>&gt;</span> <span class="tag">&lt;<span class="name">h1</span>&gt;</span> Ogre-slaying knife<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span> it has 9 orges,  it was" + id + " <span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span>")</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.listen(port);</div><div class="line"></div><div class="line">console.log('Server running at http://127.0.0.1:' + port + '/');</div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/07/05/nodejs-note-02/" itemprop="url">
                  How to learn Node.js - 02 how to handle Url request
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-07-05T21:59:25+08:00" content="2015-07-05">
              2015-07-05
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/07/05/nodejs-note-02/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/05/nodejs-note-02/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Simple_fuction_to_response_browser_request_based_on_different_url_request">Simple fuction to response browser request based on different url request</h1><p>based on the last server.js fuction </p>
<p>we can add more features to our server :</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="symbol">'http</span>');</div><div class="line"></div><div class="line">http.createServer(<span class="keyword">function</span>(req, res)&#123;</div><div class="line">        <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</div><div class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">         res.<span class="keyword">end</span>(<span class="symbol">'hello</span> world \n');</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === '/marketing')&#123;</div><div class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">         res.<span class="keyword">end</span>(<span class="symbol">'hello</span> marketing! \n');</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          res.writeHead(<span class="number">404</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">          res.<span class="keyword">end</span>(<span class="symbol">'page</span> <span class="keyword">not</span> found \n');</div><div class="line">        &#125;</div><div class="line">        &#125;).listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line">console.log(<span class="symbol">'Server</span> running <span class="keyword">at</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/');</div></pre></td></tr></table></figure>
<p>here we defined three different route : home page, marketing page, and 404 page.</p>
<p>when we access to different url we will get different response from our urlHandler server.</p>
<h1 id="Usage_of_req-method">Usage of req.method</h1><p>after we can delivery different content to the browsers,  we could try to handle uploads from browsers! </p>
<p>in this function we use req.method fuction to identify get and post medthond and define different response.  </p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var http = require(<span class="symbol">'http</span>');</div><div class="line"></div><div class="line">http.createServer(<span class="keyword">function</span>(req, res)&#123;</div><div class="line">        <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</div><div class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">         res.<span class="keyword">end</span>(<span class="symbol">'hello</span> world \n');</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === '/marketing')&#123;</div><div class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">         res.<span class="keyword">end</span>(<span class="symbol">'hello</span> marketing! \n');</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (req.url === '/uploads')&#123;</div><div class="line">         console.log(req.method)</div><div class="line">         <span class="keyword">if</span> (req.method === <span class="symbol">'POST</span>') &#123;</div><div class="line">                console.log(<span class="symbol">'handling</span> the upload request')</div><div class="line">                res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">                res.<span class="keyword">end</span>(<span class="symbol">'handling</span> it');</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">         res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/html' &#125;);</div><div class="line">         res.<span class="keyword">end</span>('&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;<span class="keyword">body</span>&gt; &lt;form action=<span class="string">"/uploads"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; &lt;input <span class="keyword">type</span>=<span class="string">"file"</span> name=<span class="string">"the_file"</span>&gt;&lt;input <span class="keyword">type</span>=<span class="string">"submit"</span> &gt; &lt;/form&gt; &lt;/<span class="keyword">body</span>&gt; &lt;/html&gt;');</div><div class="line">             &#125;</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">          res.writeHead(<span class="number">404</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">          res.<span class="keyword">end</span>(<span class="symbol">'page</span> <span class="keyword">not</span> found \n');</div><div class="line">        &#125;</div><div class="line">        &#125;).listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line">console.log(<span class="symbol">'Server</span> running <span class="keyword">at</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/');</div></pre></td></tr></table></figure>
<p>we can see the console log when we refresh and submit uploads page :</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span> <span class="title">Lyn</span>$ <span class="keyword">node</span> <span class="title">urlHandler</span>.js</div><div class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</div><div class="line">GET</div><div class="line">POST</div><div class="line">handling the upload request</div><div class="line">POST</div><div class="line">handling the upload request</div></pre></td></tr></table></figure>
<h1 id="catch_the_post_chunk_on_your_server_side">catch the post chunk on your server side</h1><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="symbol">'http</span>');</div><div class="line"></div><div class="line">http.createServer(<span class="keyword">function</span>(req, res)&#123;</div><div class="line">    <span class="keyword">if</span>(req.url === <span class="string">'/'</span>)&#123;</div><div class="line">     res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">     res.<span class="keyword">end</span>(<span class="symbol">'hello</span> world \n');</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === '/marketing')&#123;</div><div class="line">     res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">     res.<span class="keyword">end</span>(<span class="symbol">'hello</span> marketing! \n');</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === '/uploads')&#123;</div><div class="line">     </div><div class="line">     console.log(req.method)</div><div class="line">     <span class="keyword">if</span> (req.method === <span class="symbol">'POST</span>') &#123;</div><div class="line">        </div><div class="line">        var upload =''</div><div class="line">        req.on(<span class="string">"data"</span>, <span class="keyword">function</span>(chunk)&#123;</div><div class="line">            upload += chunk </div><div class="line">            console.log(<span class="string">"chunk"</span>, chunk)</div><div class="line">        &#125;)</div><div class="line">        req.on(<span class="string">"end"</span>, <span class="keyword">function</span>()&#123;</div><div class="line"></div><div class="line">            console.log(<span class="symbol">'handling</span> the upload request <span class="keyword">is</span> <span class="keyword">end</span>, the size <span class="keyword">of</span> upload file <span class="keyword">is</span>:', upload.length)</div><div class="line">            res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">            res.<span class="keyword">end</span>(<span class="symbol">'upload</span> successfully! \n');</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">     res.writeHead(<span class="number">200</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/html' &#125;);</div><div class="line">     res.<span class="keyword">end</span>('&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt; &lt;<span class="keyword">body</span>&gt; &lt;form action=<span class="string">"/uploads"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; &lt;input <span class="keyword">type</span>=<span class="string">"file"</span> name=<span class="string">"the_file"</span>&gt;&lt;input <span class="keyword">type</span>=<span class="string">"submit"</span> &gt; &lt;/form&gt; &lt;/<span class="keyword">body</span>&gt; &lt;/html&gt;');</div><div class="line">         &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      res.writeHead(<span class="number">404</span>, &#123;<span class="symbol">'Content</span>-<span class="keyword">Type</span>': <span class="symbol">'text</span>/plain'&#125;);</div><div class="line">      res.<span class="keyword">end</span>(<span class="symbol">'page</span> <span class="keyword">not</span> found \n');</div><div class="line">    &#125;</div><div class="line">    &#125;).listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line">console.log(<span class="symbol">'Server</span> running <span class="keyword">at</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/');</div></pre></td></tr></table></figure>
<p>console log:</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Lyn-Cheung-MBP:node Lyn$ node urlHandler.js</div><div class="line">Server running at http://127.0.0.1:1337/</div><div class="line">POST</div><div class="line">chunk &lt;Buffer 2d 2d 2d 2d 2d 2d<span class="number"> 57 </span>65<span class="number"> 62 </span>4b<span class="number"> 69 </span>74<span class="number"> 46 </span>6f<span class="number"> 72 </span>6d<span class="number"> 42 </span>6f<span class="number"> 75 </span>6e<span class="number"> 64 </span>61<span class="number"> 72 </span>79<span class="number"> 53 </span>43<span class="number"> 53 </span>41 6b<span class="number"> 41 </span>69<span class="number"> 35 </span>55<span class="number"> 46 </span>5a<span class="number"> 55 </span>62<span class="number"> 46 </span>4c<span class="number"> 43 </span>0d 0a<span class="number"> 43 </span>6f 6e<span class="number"> 74 </span>65 6e<span class="number"> 74 </span>2d ... &gt;</div><div class="line">handling the upload request is end, the size of upload file is: 54976</div></pre></td></tr></table></figure>
<h1 id="Helper_to_simplize_code:_Express">Helper to simplize code: Express</h1><p>Express is a popular minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications.</p>
<h2 id="install_expres">install expres</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>mkdir myserver</div><div class="line"></div><div class="line"><span class="variable">$ </span>cd myserver</div><div class="line"></div><div class="line"><span class="variable">$ </span>npm init</div><div class="line"></div><div class="line"></div><div class="line"><span class="variable">$ </span>npm install express --save</div></pre></td></tr></table></figure>
<p>it will go through  the follow process:</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:node Lyn$ mkdir myserver</div><div class="line">Lyn-Cheung-MBP:node Lyn$ cd myserver/</div><div class="line">Lyn-Cheung-MBP:myserver Lyn$ npm init</div><div class="line"></div><div class="line"></div><div class="line">This utility will walk you through creating a package.json file.</div><div class="line">It only covers the most common items, <span class="literal">and</span> tries <span class="keyword">to</span> guess sensible defaults.</div><div class="line"></div><div class="line">See `npm help json` <span class="keyword">for</span> definitive documentation on these fields</div><div class="line"><span class="literal">and</span> exactly what they <span class="keyword">do</span>.</div><div class="line"></div><div class="line">Use `npm install &lt;pkg&gt; --save` afterwards <span class="keyword">to</span> install a package <span class="literal">and</span></div><div class="line">save it as a dependency <span class="keyword">in</span> the package.json file.</div><div class="line"></div><div class="line">Press ^C at any time <span class="keyword">to</span> quit.</div><div class="line"></div><div class="line">name: (myserver)</div><div class="line">version: (<span class="number">1.0</span><span class="number">.0</span>)</div><div class="line">description: my simple server</div><div class="line">entry point: (index.js)</div><div class="line">test command:</div><div class="line">git repository:</div><div class="line">keywords: server</div><div class="line">author: lyn</div><div class="line">license: (ISC)</div><div class="line"></div><div class="line">About <span class="keyword">to</span> write <span class="keyword">to</span> /Users/Lyn/src/node/myserver/package.json:</div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"myserver"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">"my simple server"</span>,</div><div class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"echo \"</span>Error: no test specified\<span class="string">" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"keywords"</span>: [</div><div class="line">    <span class="string">"server"</span></div><div class="line">  ],</div><div class="line">  <span class="string">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">Is this ok? (yes) yes</div><div class="line"></div><div class="line">Lyn-Cheung-MBP:myserver Lyn$ npm install express --save</div><div class="line"></div><div class="line">npm WARN package.json myserver<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span> No repository field.</div><div class="line">npm WARN package.json myserver<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span> No README data</div><div class="line"></div><div class="line">express<span class="symbol">@4</span><span class="number">.13</span><span class="number">.3</span> node_modules/express</div><div class="line">├── escape-html<span class="symbol">@1</span><span class="number">.0</span><span class="number">.2</span></div><div class="line">├── merge-descriptors<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── array-flatten<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span></div><div class="line">├── cookie<span class="symbol">@0</span><span class="number">.1</span><span class="number">.3</span></div><div class="line">├── utils-merge<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── cookie-signature<span class="symbol">@1</span><span class="number">.0</span><span class="number">.6</span></div><div class="line">├── methods<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span></div><div class="line">├── vary<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── path-<span class="keyword">to</span>-regexp<span class="symbol">@0</span><span class="number">.1</span><span class="number">.7</span></div><div class="line">├── content-type<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── range-parser<span class="symbol">@1</span><span class="number">.0</span><span class="number">.3</span></div><div class="line">├── content-disposition<span class="symbol">@0</span><span class="number">.5</span><span class="number">.0</span></div><div class="line">├── etag<span class="symbol">@1</span><span class="number">.7</span><span class="number">.0</span></div><div class="line">├── fresh<span class="symbol">@0</span><span class="number">.3</span><span class="number">.0</span></div><div class="line">├── serve-<span class="keyword">static</span><span class="symbol">@1</span><span class="number">.10</span><span class="number">.0</span></div><div class="line">├── parseurl<span class="symbol">@1</span><span class="number">.3</span><span class="number">.0</span></div><div class="line">├── depd<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">├── qs<span class="symbol">@4</span><span class="number">.0</span><span class="number">.0</span></div><div class="line">├── debug<span class="symbol">@2</span><span class="number">.2</span><span class="number">.0</span> (ms<span class="symbol">@0</span><span class="number">.7</span><span class="number">.1</span>)</div><div class="line">├── finalhandler<span class="symbol">@0</span><span class="number">.4</span><span class="number">.0</span> (unpipe<span class="symbol">@1</span><span class="number">.0</span><span class="number">.0</span>)</div><div class="line">├── on-finished<span class="symbol">@2</span><span class="number">.3</span><span class="number">.0</span> (ee-first<span class="symbol">@1</span><span class="number">.1</span><span class="number">.1</span>)</div><div class="line">├── proxy-addr<span class="symbol">@1</span><span class="number">.0</span><span class="number">.8</span> (forwarded<span class="symbol">@0</span><span class="number">.1</span><span class="number">.0</span>, ipaddr.js<span class="symbol">@1</span><span class="number">.0</span><span class="number">.1</span>)</div><div class="line">├── <span class="built_in">send</span><span class="symbol">@0</span><span class="number">.13</span><span class="number">.0</span> (destroy<span class="symbol">@1</span><span class="number">.0</span><span class="number">.3</span>, statuses<span class="symbol">@1</span><span class="number">.2</span><span class="number">.1</span>, ms<span class="symbol">@0</span><span class="number">.7</span><span class="number">.1</span>, mime<span class="symbol">@1</span><span class="number">.3</span><span class="number">.4</span>, http-errors<span class="symbol">@1</span><span class="number">.3</span><span class="number">.1</span>)</div><div class="line">├── accepts<span class="symbol">@1</span><span class="number">.2</span><span class="number">.13</span> (negotiator<span class="symbol">@0</span><span class="number">.5</span><span class="number">.3</span>, mime-types<span class="symbol">@2</span><span class="number">.1</span><span class="number">.7</span>)</div><div class="line">└── type-is<span class="symbol">@1</span><span class="number">.6</span><span class="number">.9</span> (media-typer<span class="symbol">@0</span><span class="number">.3</span><span class="number">.0</span>, mime-types<span class="symbol">@2</span><span class="number">.1</span><span class="number">.7</span>)</div></pre></td></tr></table></figure>
<p>now  the express is installed, </p>
<p>as we need use express middlewares busboy to handle upload file infomations,</p>
<p>so  we also install it here first.</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:express Lyn$ npm install <span class="keyword">connect</span>-busboy</div><div class="line"><span class="keyword">connect</span>-busboy@0.<span class="number">0</span>.<span class="number">2</span> node_modules/<span class="keyword">connect</span>-busboy</div><div class="line">└── busboy@0.<span class="number">2.11</span> (readable-stream@1.<span class="number">1.13</span>, dicer@0.<span class="number">2.3</span>)</div></pre></td></tr></table></figure>
<p>Alternately, we can also define the dependency of our node app in package.json file in advance.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"myserver"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"my simple server"</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"keywords"</span>: [</div><div class="line">    <span class="string">"server"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"author"</span>: <span class="string">"lyn"</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;</div><div class="line">    <span class="attr">"connect-busboy"</span>: <span class="string">"0.0.2"</span>,</div><div class="line">    <span class="attr">"express"</span>: <span class="string">"^4.13.3"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Then we can go to edit index.js in myserver folder, to rewrite the Url routing function. </p>
<p>Use Express to write  first  helloworld express app.</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line"> * express</div><div class="line"> * Copyright(c) 2009-2013 TJ Holowaychuk</div><div class="line"> * Copyright(c) 2013 Roman Shtylman</div><div class="line"> * Copyright(c) 2014-2015 Douglas Christopher Wilson</div><div class="line"> * MIT Licensed</div><div class="line"> *  </div><div class="line"> */</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">var express    = require(<span class="string">'./lib/express'</span>)<span class="comment">;</span></div><div class="line"> </div><div class="line">         app   = express()<span class="comment">;</span></div><div class="line"></div><div class="line">app.use(<span class="keyword">bodyParser());</span></div><div class="line"></div><div class="line">app.get(<span class="string">"/"</span>, function(req,res)&#123;</div><div class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>)<span class="comment">;</span></div><div class="line">    res<span class="meta">.end</span>(<span class="string">"Hello World! \n"</span>)<span class="comment">;</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">1337</span>)<span class="comment">;</span></div><div class="line"></div><div class="line">console.log(<span class="string">"Server running as http://127.0.0.1:1337"</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>after we save the editing, we can run  express app here.</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Lyn-Cheung-MBP:express Lyn$ <span class="keyword">node</span> <span class="title">index</span>.js</div><div class="line">Server running as http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span></div></pre></td></tr></table></figure>
<p>Check it out in the browser.</p>
<p>then we can create  uploads function in express and use middlewares busboy to upload files,</p>
<p>fs.createWriteStream function help to create upload on the server files folder(need create path first).</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var express    = require(<span class="string">'./lib/express'</span>);</div><div class="line">var busboy     = require(<span class="string">'connect-busboy'</span>);</div><div class="line">var fs         = require(<span class="string">'fs'</span>);</div><div class="line">         app   = express();</div><div class="line"></div><div class="line">app.use(busboy());</div><div class="line"></div><div class="line">app.get(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req,res)</span>&#123;</span></div><div class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</div><div class="line">    res.<span class="keyword">end</span>(<span class="string">"Hello World! \n"</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get(<span class="string">"/marketing"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></div><div class="line">    res.send(<span class="string">"this is marketing dept."</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get(<span class="string">"/uploads"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></div><div class="line">    res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">'text/html'</span>);</div><div class="line">    res.<span class="keyword">end</span>(<span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;upload program &lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;form action="</span>/uploads<span class="string">" method="</span>POST<span class="string">" enctype="</span>multipart/form-data<span class="string">"&gt; &lt;input type="</span>file<span class="string">" name="</span>the_file<span class="string">"&gt;&lt;input type="</span>submit<span class="string">" &gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.post(<span class="string">"/uploads"</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span>&#123;</span></div><div class="line">      </div><div class="line">    var fstream;</div><div class="line">    req.pipe(req.busboy);</div><div class="line">    req.busboy.on(<span class="string">'file'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(fieldname, file, filename)</span> &#123;</span></div><div class="line">        console.<span class="built_in">log</span>(<span class="string">"Uploading: "</span> + filename); </div><div class="line">        fstream = fs.createWriteStream(__dirname + <span class="string">'/files/'</span> + filename);</div><div class="line">        file.pipe(fstream);</div><div class="line">        fstream.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">            res.redirect(<span class="string">'back'</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="string">"Server running as http://127.0.0.1:1337"</span>);</div></pre></td></tr></table></figure>
<p>then we can run the express app to upload file to the server </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-<span class="string">MBP:</span>express Lyn$ node index.js</div><div class="line">Server running <span class="keyword">as</span> <span class="string">http:</span><span class="comment">//127.0.0.1:1337</span></div><div class="line"><span class="string">Uploading:</span> no_image.png</div></pre></td></tr></table></figure>
<p>Now we can see the file we submit  in our  express/files folder !</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/06/28/hellowordnodejs/" itemprop="url">
                  How to learn Node.js - 01 hello world !
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-06-28T00:40:11+08:00" content="2015-06-28">
              2015-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/06/28/hellowordnodejs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/06/28/hellowordnodejs/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Try_Node-js_in_Read-Eval-Print_Loop_mode_first">Try Node.js in Read-Eval-Print Loop mode first</h1><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"> Lyn-Cheung-MBP:node Lyn$ node</div><div class="line">&gt; <span class="number">50</span>+<span class="number">50</span></div><div class="line"><span class="number">100</span></div><div class="line">&gt; console</div><div class="line">Console &#123;</div><div class="line">  <span class="built_in">log</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  info: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  warn: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  <span class="built_in">error</span>: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  dir: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  time: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  timeEnd: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  trace: [<span class="function"><span class="keyword">Function</span>:</span> bound trace],</div><div class="line">  assert: [<span class="function"><span class="keyword">Function</span>:</span> bound ],</div><div class="line">  Console: [<span class="function"><span class="keyword">Function</span>:</span> Console] &#125;</div><div class="line">&gt; console.<span class="built_in">log</span>(<span class="string">"hello REPL"</span>)</div><div class="line">hello REPL</div><div class="line">undefined</div><div class="line">&gt; var foo = <span class="string">"toy!"</span></div><div class="line">undefined</div><div class="line">&gt; foo</div><div class="line"><span class="comment">'toy!'</span></div><div class="line">&gt;</div><div class="line">(^C again <span class="keyword">to</span> quit)</div><div class="line">&gt;</div><div class="line">Lyn-Cheung-MBP:node Lyn$</div></pre></td></tr></table></figure>
<h1 id="Run_Node-js_code_in_files">Run Node.js code in files</h1><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim <span class="keyword">server</span>.js</div></pre></td></tr></table></figure>
<p>Then enter insert mode to write your code </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">        res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</div><div class="line">                res.end(<span class="string">'hello world \n'</span>);</div><div class="line">&#125;).listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</div></pre></td></tr></table></figure>
<p>then Save this file in VIM by type “w” </p>
<p>after this, we can run Node.js file in another iTerm terminal(press command + shift + d)</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:<span class="keyword">node</span> <span class="title">Lyn</span>$ <span class="keyword">node</span> <span class="title">hello</span>.js                  </div><div class="line"></div><div class="line">Server running at http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1337</span>/</div></pre></td></tr></table></figure>
<p>then you can access to this server in your browser by <a href="http://127.0.0.1:1337/" target="_blank" rel="external">http://127.0.0.1:1337/</a> </p>
<p>req = request<br>res = responde</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> http =<span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line">	, handler =<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</div><div class="line">		res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/plain'</span>&#125;);</div><div class="line">		res.end(<span class="string">'Hello World\n'</span>);</div><div class="line">		&#125;</div><div class="line">	, sever = http.createServer(handler)</div><div class="line"></div><div class="line">server.listen(<span class="number">1337</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</div></pre></td></tr></table></figure>
<p>here is  a clear way  to explain the relation  between http (Node.js moduel), createServer (moduel function) and handler (the parameters of createServer)</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/03/26/vagrant_gfw_errors/" itemprop="url">
                  How to modify puphpet file to avoid vagrant up errors
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-03-26T16:46:25+08:00" content="2015-03-26">
              2015-03-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/26/vagrant_gfw_errors/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/26/vagrant_gfw_errors/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Error_code_when_run_vagrant_up:">Error code when run vagrant up:</h1><p>recently when I want to use vagrant to build PHP environment on my Mac,<br>I got three Errors :</p>
<ol>
<li><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">error: </span>/Stage[main]/Supervisord::Pip/Exec[install_setuptools]/returns: change from notrun to 0 failed: Command exceeded timeout</div><div class="line">Warning: /Stage[main]/Supervisord::Reload/Exec[supervisorctl_update]: Skipping because of failed dependencies</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR: While executing gem ... (Gem::RemoteFetcher::FetchError) ==&gt; <span class="keyword">default</span>: SSL_connect SYSCALL returned=<span class="number">5</span> errno=<span class="number">0</span> <span class="keyword">state</span>=<span class="literal">unknown</span> <span class="keyword">state</span> (https://rubygems.<span class="keyword">global</span>.ssl.fastly.net/<span class="keyword">quick</span>/Marshal.<span class="number">4.8</span>/deep_merge-<span class="number">1.0</span>.<span class="number">1</span>.gemspec.rz)</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Error: </span>"false" is not a boolean. It looks to be a String at /tmp/vagrant-puppet/modules-b7f682531389374ec63e7be34e57b9e6/nginx/manifests/resource/location.pp:198 on node 1</div></pre></td></tr></table></figure>
</li>
</ol>
<p>After investgating,I found the  root cause of the first two is  the same. The network between Mac and the ruby/pip servers is blocked by China GFW(as I am using Chinatelecom broadband).</p>
<p>Therefore, I have to introduce China domestic ruby and pip sources to puphprt configuraions as followed:</p>
<h1 id="Walkaround:">Walkaround:</h1><p>##Replce config.yaml nginx config </p>
<p>the syntax should be :</p>
<p>internal: off or internal :”false”</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">locations:</div><div class="line">                nxvl_6x40k3ysb0yt:</div><div class="line">                    location: /</div><div class="line">                    autoindex: 'off'</div><div class="line">                    internal: off</div><div class="line">                    try_files:</div><div class="line">                        -<span class="ruby"> $uri</span></div><div class="line">                        -<span class="ruby"> $uri/</span></div><div class="line">                        -<span class="ruby"> /index.php$is_args$args</span></div><div class="line">                    fastcgi: ''</div><div class="line">                    fastcgi_index: ''</div><div class="line">                    fastcgi_split_path: ''</div><div class="line">                nxvl_6punkjmd4tp3:</div><div class="line">                    location: '~ \.php$'</div><div class="line">                    autoindex: 'off'</div><div class="line">                    internal: off</div><div class="line">                    try_files:</div><div class="line">                        -<span class="ruby"> $uri</span></div><div class="line">                        -<span class="ruby"> $uri/</span></div><div class="line">                        -<span class="ruby"> /index.php$is_args$args</span></div><div class="line">                    fastcgi: '127.0.0.1:9000'</div><div class="line">                    fastcgi_index: index.php</div><div class="line">                    fastcgi_split_path: '^(.+\.php)(/.*)$'</div><div class="line">                    fast_cgi_params_extra:</div><div class="line">                        -<span class="ruby"> <span class="string">'SCRIPT_FILENAME $request_filename'</span></span></div><div class="line">                        -<span class="ruby"> <span class="string">'APP_ENV dev'</span></span></div></pre></td></tr></table></figure>
<h2 id="Replace_gem_sources_in_initial-setup-sh">Replace gem sources in initial-setup.sh</h2><p>gem sources –remove <a href="https://rubygems.org/" target="_blank" rel="external">https://rubygems.org/</a><br>gem sources -a <a href="http://ruby.taobao.org/" target="_blank" rel="external">http://ruby.taobao.org/</a></p>
<h2 id="Add_douban_pypi_source_in_puphpet/manifests/python/pip-pp">Add douban pypi source in  puphpet/manifests/python/pip.pp</h2><figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> <span class="title">puphpet::python::pip</span> &#123;</div><div class="line"></div><div class="line">  <span class="keyword">Exec</span> &#123; <span class="attr">path</span> =&gt; [ <span class="string">'/usr/bin/'</span>, <span class="string">'/usr/local/bin'</span>, <span class="string">'/bin'</span>, <span class="string">'/usr/local/sbin'</span>, <span class="string">'/usr/sbin'</span>, <span class="string">'/sbin'</span> ] &#125;</div><div class="line"></div><div class="line">  $url = <span class="string">'https://bootstrap.pypa.io/ez_setup.py'</span></div><div class="line">  <span class="variable">$download_location</span> = <span class="string">'/.puphpet-stuff/ez_setup.py'</span></div><div class="line"></div><div class="line">  <span class="keyword">exec</span> &#123; <span class="string">"Download and install ez_setup"</span>:</div><div class="line">    <span class="attr">creates</span> =&gt; <span class="variable">$download_location</span>,</div><div class="line">    <span class="attr">command</span> =&gt; <span class="string">"wget $&#123;url&#125; -O $&#123;download_location&#125; &amp;&amp; \</span></div><div class="line">                python $&#123;download_location&#125;",</div><div class="line">    <span class="attr">timeout</span> =&gt; <span class="number">30</span>,</div><div class="line">    <span class="attr">path</span>    =&gt; <span class="string">'/usr/bin'</span></div><div class="line">  &#125;</div><div class="line">  -&gt; <span class="keyword">exec</span> &#123; <span class="string">'easy_install pip -i http://pypi.douban.com/simple '</span>:</div><div class="line">    <span class="attr">unless</span> =&gt; <span class="string">'which pip'</span>,</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> $::osfamily == <span class="string">'RedHat'</span> &#123;</div><div class="line">    <span class="keyword">exec</span> &#123; <span class="string">'rhel pip_provider_name_fix'</span>:</div><div class="line">      <span class="attr">command</span>   =&gt; <span class="string">'alternatives --install /usr/bin/pip-python pip-python /usr/bin/pip 1'</span>,</div><div class="line">      <span class="attr">subscribe</span> =&gt; Exec[<span class="string">'easy_install pip'</span>],</div><div class="line">      <span class="attr">unless</span>    =&gt; <span class="string">'which pip-python'</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>hope these help :D</p>
<p>if there is any mistake,please contact me to update! </p>
<p>thank you</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2014/12/26/hello-world/" itemprop="url">
                  My first blog post launched with my new blog
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2014-12-26T16:46:25+08:00" content="2014-12-26">
              2014-12-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/12/26/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/12/26/hello-world/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Finally I launched my personal blog after years of delay.</p>
<h1 id="why?">why?</h1><p>Sereral years ago when I was opreating some websites in compus,</p>
<p>I was thinking to launch my personal blog someday in the future,</p>
<p>however after the social websites developing  these years, my most time was comsumed on Weibo.com(Chinese twiter) and Weixin.</p>
<p>but after time as the social network in China is no longer as popular as it used to be(as be regulated heavily by Gov) and I think a place can be used to recording my ideas as part of my knowledge bases is realy useful.</p>
<p>Now, here we go, a wholly new blog, afetr I compared hexo, ghost blog, Jekyll, I finanly chose ghost blog to launch my blog. because nodejs now is really hot in github. secondly, Ghost blog  can be edited on smartphone. I spend some time to rewrite theme files. I will keep adding new features on this current version.</p>
<p>meanwhile I chose to host ghostblog on my VPS to keep updating my server opreating skills.</p>
<h1 id="Wishes_for_the_future">Wishes for the future</h1><p>I hope this blog would become a dual-lingual blog.</p>
<p>so that I could get in touch with people around the world. </p>
<p>hope I could have a  nice time here and  write and update my posts as much as possible. </p>
<p>Looking forward that I could meet some friends who share mutral intrests and values. </p>
<p>any good advise is highly welcomed, please feel free to contact me :D</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
