<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyn's Blog">
<meta property="og:url" content="http://lyn.s76.org/page/2/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lyn's Blog">
<meta name="twitter:description" content="Lyn&apos;s Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36568696-2', 'auto');
  ga('send', 'pageview');

</script>








  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/09/26/redux-notes-01/" itemprop="url">
                  Redux 快速入门 -- 01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-09-26T21:25:17+08:00" content="2016-09-26">
              2016-09-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/26/redux-notes-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/26/redux-notes-01/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="配置开发环境">配置开发环境</h1><p>对于新手来说,React和Redux都免不了需要配置各种环境.<br>还好ali的开源项目 <a href="https://ant-tool.github.io/quick-start.html" target="_blank" rel="external">Ant-Tool</a>为大家送上了福利,大大降低了入门的难度.</p>
<h2 id="首先需要确认你的npm版本">首先需要确认你的npm版本</h2><blockquote>
<p>由于atool 依赖了 babel 6，而 babel 6 在npm2 下会有严重的性能问题, 所以npm版本需要&gt;3)</p>
</blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//检查确认npm版本</span></div><div class="line">npm -v</div><div class="line">3.10.8</div><div class="line"><span class="comment">// 安装手脚架工具</span></div><div class="line">npm i antd-init -<span class="keyword">g</span></div><div class="line"><span class="comment">// 检查版本确认安装成功</span></div><div class="line">antd-init -v</div><div class="line">1.1.2</div><div class="line"><span class="comment">// 在当前目录下创建文件夹并进入这个文件夹</span></div><div class="line"><span class="keyword">mkdir</span> blog &amp;&amp; <span class="keyword">cd</span> blog</div><div class="line"><span class="comment">//运行手脚架工具 任选其一搭建一个sample</span></div><div class="line">antd-init</div><div class="line"><span class="comment">// 启动应用</span></div><div class="line">npm start</div><div class="line"><span class="comment">// 在浏览器中打开</span></div><div class="line"><span class="keyword">open</span> http:<span class="comment">//localhost:8989</span></div></pre></td></tr></table></figure>
<p>配置package.json中的 entry属性:<br>(这个属性和webpack中配置的entry是同一个东西)</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"entry"</span>: &#123;</div><div class="line">    <span class="string">"index"</span>: <span class="string">"./src/index.js"</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="遇到的问题:">遇到的问题:</h2><ul>
<li>在升级npm的过程中升级失败</li>
</ul>
<h3 id="原因:">原因:</h3><p>PATH目录下npm文件夹的权限问题</p>
<h3 id="解决办法:">解决办法:</h3><ul>
<li>重新安装node,并根据NPM官方的方法选择其中一种来 修改npm的三个目录的权限问题(lib/node_modules, bin,share)    </li>
<li>只要是不和别人共用同一台电脑,那就可以用下面的方法把npm的文件夹owner修改成自己来解决:</li>
</ul>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/<span class="regexp">/ 获取npm PATH</span></div><div class="line">npm config get prefix</div><div class="line">/usr<span class="regexp">/local</span></div><div class="line">/<span class="regexp">/ 改变文件夹的owner</span></div><div class="line">sudo chown -R $(whoami) $(npm config get prefix)/&#123;<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>,<span class="title">bin</span>,<span class="title">share</span>&#125;</span></div><div class="line">/<span class="regexp">/ 设置 npm 源为淘宝镜像</span></div><div class="line">npm config set registry https:/<span class="regexp">/registry.npm.taobao.org</span></div><div class="line">/<span class="regexp">/ 更新npm到最新版本</span></div><div class="line">npm install npm -g</div><div class="line">/<span class="regexp">/ 检查更新后的版本</span></div><div class="line">npm -v</div><div class="line">3.10.8</div></pre></td></tr></table></figure>
<h2 id="配置Sublime_Text_3代码检查工具">配置Sublime Text 3代码检查工具</h2><p>打开package control install package(cmd+shift+p),安装下面两个插件:</p>
<ul>
<li>Sublimelinter</li>
<li>Sublimelinter-contrib-eslint</li>
</ul>
<p>可能需要修改Sublimelinter 配置，Preferences-&gt;Package Settings-&gt;SublimeLinter-&gt;Settings-User,</p>
<ul>
<li>debug: true 开启 debug 模式 </li>
<li>paths: 为 ESLint 路径，window 平台下 path：<code>%APPDATA%\\Roaming\\npm</code>，如果该路径已经在系统环境变量中，则可省略，具体可根据实际情况进行相应调整.<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"> &#123;</div><div class="line">    <span class="string">"user"</span>: &#123;</div><div class="line">        <span class="string">"debug"</span>: <span class="literal">true</span>,</div><div class="line">        ...</div><div class="line">        <span class="string">"linters"</span>: &#123;</div><div class="line">            <span class="string">"eslint"</span>: &#123;</div><div class="line">                ...</div><div class="line">                <span class="string">"excludes"</span>: [<span class="string">"*.html"</span>]</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        ...</div><div class="line">        <span class="string">"paths"</span>: &#123;</div><div class="line">            ....</div><div class="line">            <span class="string">"osx"</span>: [</div><div class="line">                <span class="string">"/usr/local/node/v0.12.7/bin"</span></div><div class="line">            ],</div><div class="line">            <span class="string">"windows"</span>: [</div><div class="line">             <span class="string">"C:\\Users\\用户名\\AppData\\Roaming\\npm"</span></div><div class="line">            ]</div><div class="line">        &#125; </div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="eslint全局配置文件">eslint全局配置文件</h3><p>如果想要全局使用一个eslint规则去检查代码.<br>那么需要创建.eslintrc.* 文件放在用户目录下,但是推荐的做法还是在每个项目目录下单独配置.<br>配置方法如下:</p>
<ul>
<li>osx:  <code>/Users/用户名</code></li>
<li>win:  <code>C:\Users\用户名</code></li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"parser"</span>: <span class="string">"babel-eslint"</span>,</div><div class="line">  <span class="string">"extends"</span>: <span class="string">"eslint-config-airbnb"</span>,</div><div class="line">  <span class="string">"rules"</span>: &#123;</div><div class="line">    //<span class="string">"spaced-comment"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"no-unused-vars"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"no-empty"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"react/wrap-multilines"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"react/no-multi-comp"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"no-constant-condition"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"react/jsx-no-bind"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"react/prop-types"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"arrow-body-style"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"react/prefer-stateless-function"</span>: [<span class="number">0</span>],</div><div class="line">    <span class="string">"semi"</span>: [<span class="number">0</span>]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"ecmaFeatures"</span>: &#123;</div><div class="line">    <span class="string">"experimentalObjectRestSpread"</span>: <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>还需要全局安装这些package<code>npm install eslint-config-airbnb eslint babel-eslint  -g</code></li>
</ul>
<h2 id="配置格式化工具">配置格式化工具</h2><p>A-tool使用eslint来检查代码风格(基于airbnb推荐的编码风格)<br>可以选择以下两种方式来配置sublime的格式化功能:</p>
<h3 id="使用sublime的build功能来格式化:">使用sublime的build功能来格式化:</h3><ol>
<li>Tools-&gt;Build System-&gt;New Build System…，</li>
<li>在新建的脚本文件中 添加以下代码，保持为eslint.sublime-build到默认位置。</li>
<li>然后运行cmd+b(mac) 或 ctrl+b(win) 即可。</li>
</ol>
<p>mac：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">   &#123;</div><div class="line">    <span class="attr">"cmd"</span>: [<span class="string">"eslint --fix $file"</span>],</div><div class="line">    <span class="attr">"shell"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">"path"</span>: <span class="string">"/usr/local/bin"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>window：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line">    <span class="attr">"cmd"</span>: [<span class="string">"eslint"</span>, <span class="string">"--fix"</span>, <span class="string">"$file"</span>],</div><div class="line">    <span class="attr">"shell"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Tips</strong>：</p>
<ul>
<li>Mac下的”path”可以通过 <code>which node</code>来查看系统中node的路径</li>
</ul>
<h3 id="jsformart">jsformart</h3><p>打开preference&gt;package settings&gt;jsformat&gt;settings user<br>把如下代码粘进去保存即可.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Documentation: https://github.com/beautify-web/js-beautify</span></div><div class="line"><span class="comment">// Example URL: https://github.com/victorporof/Sublime-HTMLPrettify/blob/master/.jsbeautifyrc</span></div><div class="line"><span class="comment">// Based on Airbnb's JavaScript Style Guide, URL: https://github.com/airbnb/javascript</span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// Collapse curly brackets</span></div><div class="line">    <span class="string">"brace_style"</span>: <span class="string">"collapse"</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Break chained method calls across subsequent lines</span></div><div class="line">    <span class="string">"break_chained_methods"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">// End output with newline</span></div><div class="line">    <span class="string">"end_with_newline"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Evaluate code</span></div><div class="line">    <span class="string">"eval_code"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Indentation character</span></div><div class="line">    <span class="string">"indent_char"</span>: <span class="string">" "</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Initial indentation level</span></div><div class="line">    <span class="string">"indent_level"</span>: <span class="number">0</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Indentation character size</span></div><div class="line">    <span class="string">"indent_size"</span>: <span class="number">2</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Indent with tabs, overrides 'indent_size' and 'indent_char'</span></div><div class="line">    <span class="string">"indent_with_tabs"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Enable jslint-stricter mode</span></div><div class="line">    <span class="string">"jslint_happy"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Preserve array indentation</span></div><div class="line">    <span class="string">"keep_array_indentation"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Preserve function indentation</span></div><div class="line">    <span class="string">"keep_function_indentation"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Number of line-breaks to be preserved in one chunk</span></div><div class="line">    <span class="string">"max_preserve_newlines"</span>: <span class="number">10</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Preserve newlines</span></div><div class="line">    <span class="string">"preserve_newlines"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Add a space before an anonymous function's parentheses, i.e. function ()</span></div><div class="line">    <span class="string">"space_after_anon_function"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Add a space before the conditional statement i.e. 'if (true)'</span></div><div class="line">    <span class="string">"space_before_conditional"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Add padding spaces within empty parentheses i.e. 'f( )'</span></div><div class="line">    <span class="string">"space_in_empty_paren"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Add padding spaces within parentheses i.e. 'f( a, b )'</span></div><div class="line">    <span class="string">"space_in_paren"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Decode printable characters encoded in xNN notation</span></div><div class="line">    <span class="string">"unescape_strings"</span>: <span class="literal">false</span>,</div><div class="line"></div><div class="line">    <span class="comment">// Wrap lines at next opportunity after N characters</span></div><div class="line">    <span class="string">"wrap_line_length"</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// <span class="doctag">Note:</span> Remove the comments when adding to the project</span></div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/" itemprop="url">
                  ESXI中实现UPS断电自动关闭GEN8的功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-07-03T16:29:03+08:00" content="2016-07-03">
              2016-07-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/03/gen8-exsi-ubuntu-apc-autoshutdown/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="安装ubuntu">安装ubuntu</h1><p>参考: <a href="http://lyn.s76.org/2016/07/02/ubuntu-settings/">http://lyn.s76.org/2016/07/02/ubuntu-settings/</a><br>​    </p>
<h1 id="ESXI中配置APC的USB设备">ESXI中配置APC的USB设备</h1><ol>
<li><p>添加usb控制器<br> <img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/44958482.jpg" alt=""></p>
</li>
<li><p>添加usb设备<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/42030707.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-7-3/72111678.jpg" alt=""></p>
</li>
<li><p>开启ESXI的ssh登录  </p>
</li>
<li><p>在esxi的console界面(也就是黄黑色的那个界面)按F2 进入esxi配置界面   </p>
</li>
<li>选择/Select Troubleshooting Options </li>
<li><p>从Troubleshooting Mode Options 菜单, 选择 Enable ESXi Shell,找到:</p>
<pre><code><span class="escape">`E</span>nable ESXi Shell<span class="escape">` </span> 
<span class="escape">`E</span>nable SSH`
</code></pre><p>按Enter键来enable .<br>ps: 更多方式可以参考<a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2030463" target="_blank" rel="external">vm官方的kb</a> :</p>
</li>
</ol>
<h1 id="APC_UPS控件">APC UPS控件</h1><p>ps:我的ups型号是APC的 bk650</p>
<h2 id="安装控件">安装控件</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">get</span> install apcupsd</div></pre></td></tr></table></figure>
<h2 id="配置">配置</h2><p>使用vi 编辑 <code>/etc/apcupsd/apcupsd.conf</code> 文件</p>
<ol>
<li><p>设置name 和usb模式  </p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UPSNAME <span class="params">&lt;自定义名称&gt;</span> <span class="meta">#这行定义你的UPS名称</span></div><div class="line">UPSCABLE usb <span class="meta">#设置UPS的通讯模式为USB模式</span></div><div class="line">UPSTYPE usb <span class="meta">#设置UPS类型为usb型</span></div></pre></td></tr></table></figure>
</li>
<li><p>注释DEVICE /dev/ttyS0</p>
<p>(UPSTYPE usb下面那行)前面加上#号注释掉  </p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># DEVICE /dev/ttyS0</span></div></pre></td></tr></table></figure>
</li>
<li><p>编辑 /etc/default/apcupsd 中的: </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">ISCONFIGURED</span>=<span class="literal">yes</span></div></pre></td></tr></table></figure>
</li>
<li><p>重启服务   </p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sudo service apcupsd restart</span></div></pre></td></tr></table></figure>
</li>
<li><p>测试APC组件  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">sudo apcaccess</div><div class="line"></div><div class="line"><span class="comment">// 输出结果:</span></div><div class="line"><span class="string">APC      :</span> <span class="number">001</span>,<span class="number">034</span>,<span class="number">0834</span></div><div class="line"><span class="string">DATE     :</span> <span class="number">2016</span><span class="number">-07</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">27</span>:<span class="number">22</span> +<span class="number">0800</span></div><div class="line"><span class="string">HOSTNAME :</span> <span class="number">1102</span>Server</div><div class="line"><span class="string">VERSION  :</span> <span class="number">3.14</span><span class="number">.12</span> (<span class="number">29</span> March <span class="number">2014</span>) debian</div><div class="line"><span class="string">UPSNAME  :</span> APC</div><div class="line"><span class="string">CABLE    :</span> USB Cable</div><div class="line"><span class="string">DRIVER   :</span> USB UPS Driver</div><div class="line"><span class="string">UPSMODE  :</span> Stand Alone</div><div class="line"><span class="string">STARTTIME:</span> <span class="number">2016</span><span class="number">-07</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">09</span> +<span class="number">0800</span></div><div class="line"><span class="string">MODEL    :</span> Back-UPS <span class="number">650</span></div><div class="line"><span class="string">STATUS   :</span> ONLINE</div><div class="line"><span class="string">LINEV    :</span> <span class="number">226.0</span> Volts</div><div class="line"><span class="string">LOADPCT  :</span> <span class="number">30.0</span> Percent</div><div class="line"><span class="string">BCHARGE  :</span> <span class="number">100.0</span> Percent</div><div class="line"><span class="string">TIMELEFT :</span> <span class="number">23.8</span> Minutes</div><div class="line"><span class="string">MBATTCHG :</span> <span class="number">5</span> Percent</div><div class="line"><span class="string">MINTIMEL :</span> <span class="number">3</span> Minutes</div><div class="line"><span class="string">MAXTIME  :</span> <span class="number">0</span> Seconds</div><div class="line"><span class="string">SENSE    :</span> Low</div><div class="line"><span class="string">LOTRANS  :</span> <span class="number">165.0</span> Volts</div><div class="line"><span class="string">HITRANS  :</span> <span class="number">266.0</span> Volts</div><div class="line"><span class="string">ALARMDEL :</span> <span class="number">30</span> Seconds</div><div class="line"><span class="string">BATTV    :</span> <span class="number">13.5</span> Volts</div><div class="line"><span class="string">LASTXFER :</span> Automatic or explicit self test</div><div class="line"><span class="string">NUMXFERS :</span> <span class="number">0</span></div><div class="line"><span class="string">TONBATT  :</span> <span class="number">0</span> Seconds</div><div class="line"><span class="string">CUMONBATT:</span> <span class="number">0</span> Seconds</div><div class="line"><span class="string">XOFFBATT :</span> N/A</div><div class="line"><span class="string">STATFLAG :</span> <span class="number">0x05000008</span></div><div class="line"><span class="string">SERIALNO :</span> <span class="number">3</span>sadsadsa520</div><div class="line"><span class="string">BATTDATE :</span> <span class="number">2015</span><span class="number">-06</span><span class="number">-15</span></div><div class="line"><span class="string">NOMINV   :</span> <span class="number">220</span> Volts</div><div class="line"><span class="string">NOMBATTV :</span> <span class="number">12.0</span> Volts</div><div class="line"><span class="string">FIRMWARE :</span> <span class="number">822.</span>A3.I USB <span class="string">FW:</span>A3</div><div class="line">END <span class="string">APC  :</span> <span class="number">2016</span><span class="number">-07</span><span class="number">-03</span> <span class="number">16</span>:<span class="number">28</span>:<span class="number">04</span> +<span class="number">0800</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="修改apc任务脚本">修改apc任务脚本</h2><p> 编辑 <code>/etc/apcupsd/apccontrol</code> 脚本，找到 <code>doshutdown</code> 将下面3行替换为  </p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"UPS <span class="variable">$&#123;2&#125;</span> initiated Shutdown Sequence"</span> | <span class="variable">$&#123;WALL&#125;</span></div><div class="line">/usr/bin/ssh root@esxi的ip地址   <span class="string">"/sbin/shutdown.sh &amp;&amp; /sbin/poweroff"</span></div><div class="line">;;</div></pre></td></tr></table></figure>
<h1 id="配置Ubuntu到ESXI的RSA_SSH">配置Ubuntu到ESXI的RSA SSH</h1><p>为了更安全的免密码登录esxi,还需要配置esxi的rsa秘钥登录:</p>
<h2 id="生成公钥/私钥">生成公钥/私钥</h2><p>使用命令生成RSA秘钥对<br>可以参考:<br><a href="http://lyn.s76.org/2016/07/02/ubuntu-settings/">http://lyn.s76.org/2016/07/02/ubuntu-settings/</a></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ssh-keygen</span></div></pre></td></tr></table></figure>
<p>注意:</p>
<ul>
<li><p>生成两个 ~/.ssh 文件：id_rsa 和 id_rsa.pub。</p>
</li>
<li><p>对于 ESXi 5.0~6.0，authorized_keys 的位置为：/etc/ssh/keys-<username>/authorized_keys(root用户对应的就是:/etc/ssh/keys-root/authorized_keys)</username></p>
</li>
<li>可以在此文件中存储多个密钥(直接在文件内容后面追加)。</li>
<li>使用下面的命令上传到指定的目录:</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh user<span class="variable">@host</span> <span class="string">'mkdir -p .ssh &amp;&amp; cat &gt;&gt; /etc/ssh/keys-root/authorized_keys'</span> &lt; ~<span class="regexp">/.ssh/id</span>_rsa.pub</div></pre></td></tr></table></figure>
<h2 id="配置-1">配置</h2><p>ssh到exsi,修改ssh config配置文件:<code>/etc/ssh/sshd_config</code>.</p>
<ul>
<li>要允许授予 root 访问权限，请在 /etc/ssh/sshd_config 文件中将 PermitRootLogin no 更改为 PermitRootLogin yes。</li>
<li>要禁用密码登录，请务必将 ChallengeResponseAuthentication 和 PasswordAuthentication 设置为 no。</li>
<li><p>重新加载服务：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/SSH restart</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>配置好的<code>/etc/ssh/sshd_config</code>文件:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># running from inetd</span></div><div class="line"><span class="comment"># Port 2200</span></div><div class="line"><span class="attribute">Protocol</span> <span class="number">2</span></div><div class="line">HostKey /etc/ssh/ssh_host_rsa_key</div><div class="line">HostKey /etc/ssh/ssh_host_dsa_key</div><div class="line"></div><div class="line">UsePrivilegeSeparation <span class="literal">no</span></div><div class="line"></div><div class="line">SyslogFacility auth</div><div class="line">LogLevel <span class="literal">info</span></div><div class="line"></div><div class="line">PermitRootLogin <span class="literal">yes</span></div><div class="line"></div><div class="line">PrintMotd <span class="literal">yes</span></div><div class="line">PrintLastLog <span class="literal">no</span></div><div class="line"></div><div class="line">TCPKeepAlive <span class="literal">yes</span></div><div class="line"></div><div class="line">X11Forwarding <span class="literal">no</span></div><div class="line"></div><div class="line">Ciphers aes128-ctr,aes192-ctr,aes256-ctr,3des-cbc</div><div class="line"></div><div class="line">MACs hmac-sha2-<span class="number">256</span>,hmac-sha2-<span class="number">512</span>,hmac-sha1,hmac-sha1-<span class="number">96</span></div><div class="line"></div><div class="line">UsePAM <span class="literal">yes</span></div><div class="line"><span class="comment"># only use PAM challenge-response (keyboard-interactive)</span></div><div class="line">PasswordAuthentication <span class="literal">no</span></div><div class="line"></div><div class="line"></div><div class="line">Banner /etc/issue</div><div class="line"></div><div class="line">Subsystem sftp /usr/lib/vmware/openssh/bin/sftp-server -f LOCAL5 -l INFO</div><div class="line"></div><div class="line">AuthorizedKeysFile /etc/ssh/keys-%u/authorized_keys</div><div class="line"></div><div class="line"><span class="comment"># hostsRSAAuthentication no</span></div><div class="line">ChallengeResponseAuthentication <span class="literal">no</span></div><div class="line">PasswordAuthentication <span class="literal">no</span></div><div class="line">PubkeyAuthentication <span class="literal">yes</span></div><div class="line"></div><div class="line"><span class="comment"># Timeout value of 10 mins. The default value of ClientAliveCountMax is 3.</span></div><div class="line"><span class="comment"># Hence, we get a  3 * 200 = 600 seconds timeout if the client has been</span></div><div class="line"><span class="comment"># unresponsive.</span></div><div class="line">ClientAliveInterval <span class="number">200</span></div><div class="line"></div><div class="line"><span class="comment"># sshd(8) will refuse connection attempts with a probability of “rate/100”</span></div><div class="line"><span class="comment"># (30%) if there are currently “start” (10) unauthenticated connections.  The</span></div><div class="line"><span class="comment"># probability increases linearly and all connection attempts are refused if the</span></div><div class="line"><span class="comment"># number of unauthenticated connections reaches “full” (100)</span></div><div class="line">MaxStartups <span class="number">10</span>:<span class="number">30</span>:<span class="number">200</span></div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/07/02/ubuntu-settings/" itemprop="url">
                  Securing your Ubuntu Server
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-07-02T23:20:19+08:00" content="2016-07-02">
              2016-07-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/02/ubuntu-settings/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/02/ubuntu-settings/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在服务器上部署了linux系统以后,还需要以下操作来确保服务器的安全.</p>
<h1 id="新建一个非root用户">新建一个非root用户</h1><p>使用如下命令新建一个用户 并且把这个用户加到sudo组中</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//新建用户</span></div><div class="line">adduser 你的用户名</div><div class="line"><span class="comment">//把用户加入到sudo组</span></div><div class="line">adduser 你的用户名 sudo</div></pre></td></tr></table></figure>
<h1 id="RSA秘钥登录">RSA秘钥登录</h1><h2 id="生成RSA秘钥对">生成RSA秘钥对</h2><p>mac或者linux用户都可以使用以下命令在/home/你的用户名/.ssh文件夹下创建Rsa秘钥</p>
<ol>
<li><p>使用下面的命令,所有选择都直接按enter使用默认值 就会生成这两个秘钥 <code>id_rsa</code> 和  <code>id_rsa.pub</code> </p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -<span class="selector-tag">b</span> <span class="number">4096</span></div></pre></td></tr></table></figure>
</li>
<li><p>在服务器上创建.ssh文件夹</p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -<span class="selector-tag">p</span> ~/<span class="selector-class">.ssh</span> &amp;&amp; sudo chmod -R <span class="number">700</span> ~/.ssh/</div></pre></td></tr></table></figure>
</li>
<li><p>然后从本地的terminal中使用scp命令上传到服务器上</p>
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp -P 服务器的ssh端口号  ~<span class="regexp">/.ssh/id</span>_rsa.pub 服务器上的用户名<span class="variable">@203</span>.<span class="number">0</span>.<span class="number">113.10</span><span class="symbol">:~/</span>.ssh/authorized_keys</div></pre></td></tr></table></figure>
</li>
<li><p>修改文件夹权限 </p>
<p>用下面的命令修改:</p>
 <figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chmod <span class="number">700</span> -R ~/.ssh &amp;&amp; chmod <span class="number">600</span> ~/.ssh/authorized_keys</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Tips:</strong> 如果服务器上已有authorized_keys文件:  </p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh user<span class="variable">@host</span> <span class="string">'mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</span> &lt; ~<span class="regexp">/.ssh/id</span>_rsa.pub</div></pre></td></tr></table></figure>
<ul>
<li>“$ ssh user@host”，表示登录远程主机；  </li>
<li>单引号中的mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys，表示登录后在远程shell上执行的命令：  </li>
<li>“$ mkdir -p .ssh”的作用是，如果用户主目录中的.ssh目录不存在，就创建一个；  </li>
<li>‘cat &gt;&gt; .ssh/authorized_keys’ &lt; ~/.ssh/id_rsa.pub的作用是，将本地的公钥文件~/.ssh/id_rsa.pub，重定向追加到远程文件authorized_keys的末尾。</li>
<li>这一行命令等同于在linux下运行:ssh-copy-id user@host   </li>
</ul>
<h2 id="修改ssh配置文件">修改ssh配置文件</h2><ul>
<li><p>在服务器上用vi修改<code>/etc/ssh/sshd_config</code>文件中的这几行  </p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 修改默认的ssh的22端口到你想要的任意端口 这里修改为38000</span></div><div class="line"><span class="attribute">Port</span> <span class="number">38000</span></div><div class="line"></div><div class="line"><span class="comment">#禁止root用户使用ssh登录</span></div><div class="line">PermitRootLogin <span class="literal">no</span></div><div class="line"></div><div class="line"><span class="comment">#禁止用户使用密码登录服务器</span></div><div class="line">PasswordAuthentication <span class="literal">no</span></div></pre></td></tr></table></figure>
</li>
<li><p>使用下面的命令来关闭不需要的ipv4或者ipv6 的ssh访问  </p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'AddressFamily inet'</span> | sudo tee <span class="_">-a</span> /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
</li>
<li><p>重启ssh服务生效  </p>
  <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sudo service ssh restart</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="ufw_防火墙">ufw 防火墙</h1><h2 id="安装">安装</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">get</span> install ufw</div></pre></td></tr></table></figure>
<h2 id="配置">配置</h2><ul>
<li>设置默认规则  </li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="title">sudo</span> ufw <span class="keyword">default</span> allow outgoing</div><div class="line"><span class="title">sudo</span> ufw <span class="keyword">default</span> deny incoming</div></pre></td></tr></table></figure>
<ul>
<li>增加允许的规则  </li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo ufw allow ssh</div><div class="line">sudo ufw allow OpenSSH</div><div class="line">sudo ufw allow <span class="number">22</span></div><div class="line">sudo ufw allow <span class="number">80</span>/tcp</div><div class="line">sudo ufw allow http/tcp</div><div class="line">sudo ufw allow <span class="number">1725</span>/udp</div></pre></td></tr></table></figure>
<ul>
<li>屏蔽访问</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ufw <span class="keyword">deny</span> <span class="number">111</span></div></pre></td></tr></table></figure>
<ul>
<li>高级规则  </li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//允许所有来自该ip的连接</span></div><div class="line">sudo ufw allow from <span class="number">123.45</span><span class="number">.67</span><span class="number">.89</span></div><div class="line"><span class="comment">//指定访问端口和协议</span></div><div class="line">sudo ufw allow from <span class="number">123.45</span><span class="number">.67</span><span class="number">.89</span> to any port <span class="number">22</span> proto tcp</div></pre></td></tr></table></figure>
<h2 id="启动ufw">启动ufw</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//启动防火墙</span></div><div class="line">sudo ufw <span class="keyword">enable</span></div><div class="line"><span class="comment">//关闭防火墙</span></div><div class="line">sudo ufw <span class="keyword">disable</span></div></pre></td></tr></table></figure>
<h2 id="日志功能">日志功能</h2><p>日志规则可以在<code>/var/logs/ufw</code>文件夹中设置<br>规则如下:</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[UFW <span class="keyword">BLOCK</span>]: This location <span class="keyword">is</span> where the description <span class="keyword">of</span> the logged event will be located. <span class="keyword">In</span> this instance, it blocked a connection.</div><div class="line"><span class="keyword">IN</span>: <span class="keyword">If</span> this contains a value, <span class="keyword">then</span> the event was incoming</div><div class="line"><span class="keyword">OUT</span>: <span class="keyword">If</span> this contain a value, <span class="keyword">then</span> the event was outgoing</div><div class="line">MAC: A combination <span class="keyword">of</span> the destination <span class="keyword">and</span> source MAC addresses</div><div class="line">SRC: The IP <span class="keyword">of</span> the packet source</div><div class="line">DST: The IP <span class="keyword">of</span> the packet destination</div><div class="line">LEN: Packet length</div><div class="line">TTL: The packet TTL, <span class="keyword">or</span> <span class="built_in">time</span> <span class="keyword">to</span> live. How long it will bounce between routers <span class="keyword">until</span> it expires, <span class="keyword">if</span> no destination <span class="keyword">is</span> found.</div><div class="line">PROTO: The packet’s protocal</div><div class="line">SPT: The source <span class="keyword">port</span> <span class="keyword">of</span> the <span class="keyword">package</span></div><div class="line">DPT: The destination <span class="keyword">port</span> <span class="keyword">of</span> the <span class="keyword">package</span></div><div class="line">WINDOW: The size <span class="keyword">of</span> the packet the sender can receive</div><div class="line">SYN URGP: Indicated <span class="keyword">if</span> a three-way handshake <span class="keyword">is</span> required. <span class="number">0</span> means it <span class="keyword">is</span> <span class="keyword">not</span>.</div></pre></td></tr></table></figure>
<p>开启日志功能</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo ufw logging <span class="keyword">on</span></div></pre></td></tr></table></figure>
<h1 id="Fail2ban">Fail2ban</h1><p>fail2ban 会把恶意尝试ssh登录服务器的主机ip拉进黑名单中</p>
<h2 id="安装-1">安装</h2><ol>
<li><p>更新你的系统    </p>
 <figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-<span class="built_in">get</span> <span class="keyword">update</span> &amp;&amp; apt-<span class="built_in">get</span> upgrade -y</div></pre></td></tr></table></figure>
</li>
<li><p>安装 fail2ban    </p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-<span class="keyword">get</span> install fail2ban</div></pre></td></tr></table></figure>
</li>
<li><p>如果你需要email通知服务还需要安装  </p>
 <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-<span class="keyword">get</span> install sendmail</div></pre></td></tr></table></figure>
</li>
<li><p>配置ufw,确保UFW允许ssh访问  </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ufw <span class="built_in">enable</span></div><div class="line">ufw allow ssh</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="配置-1">配置</h2><ul>
<li>切换目录  </li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd <span class="regexp">/etc/</span>fail2ban</div></pre></td></tr></table></figure>
<ul>
<li>拷贝配置文件  </li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp jail<span class="selector-class">.conf</span> jail<span class="selector-class">.local</span></div><div class="line">cp fail2ban<span class="selector-class">.conf</span> fail2ban.local</div></pre></td></tr></table></figure>
<ul>
<li>配置  </li>
</ul>
<p>在<code>/etc/fail2ban/jail.local</code>文件中配置  </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># "bantime" is the number of seconds that a host is banned.</span></div><div class="line"><span class="attr">bantime</span>  = <span class="number">600</span></div><div class="line"><span class="comment"># A host is banned if it has generated "maxretry" during the last "findtime"</span></div><div class="line"><span class="comment"># seconds.</span></div><div class="line"><span class="attr">findtime</span> = <span class="number">600</span></div><div class="line"><span class="attr">maxretry</span> = <span class="number">3</span></div><div class="line">	</div><div class="line"><span class="comment"># SSH 重试次数</span></div><div class="line"><span class="attr">enabled</span>  = <span class="literal">true</span></div><div class="line"><span class="attr">port</span>     = ssh</div><div class="line"><span class="attr">filter</span>   = sshd</div><div class="line"><span class="attr">logpath</span>  = /var/log/auth.log</div><div class="line"><span class="attr">maxretry</span> = <span class="number">6</span></div></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/28/3des-of-javascript/" itemprop="url">
                  JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-28T20:39:04+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/3des-of-javascript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/3des-of-javascript/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p> 最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用<a href="https://github.com/brix/crypto-js/tree/develop/src" target="_blank" rel="external">crypto-js库</a>来实现.</p>
<p>由于还是想要更轻便的实现.于是最终采用了下面的实现方法<br>(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;Unicode),位运算符):</p>
<h1 id="3DES_三重数据加密算法">3DES 三重数据加密算法</h1><ul>
<li>引用自维基百科:</li>
</ul>
<blockquote>
<p>三重数据加密算法（Triple Data Encryption Algorithm，缩写为TDEA，Triple DEA），或称3DES（Triple DES），是一种对称密钥加密块密码，相当于是对每个数据块应用三次数据加密标准（DES）算法。由于计算机运算能力的增强，原版DES密码的密钥长度变得容易被暴力破解；3DES即是设计用来提供一种相对简单的方法，即通过增加DES的密钥长度来避免类似的攻击，而不是设计一种全新的块密码算法。</p>
</blockquote>
<h2 id="算法">算法</h2><p>3DES使用“密钥包”，其包含3个DES密钥，K1，K2和K3，均为56位（除去奇偶校验位）。加密算法为：</p>
<ul>
<li>密文 = EK3(DK2(EK1(平文)))</li>
</ul>
<p>也就是说，使用K1为密钥进行DES加密，再用K2为密钥进行DES“解密”，最后以K3进行DES加密。</p>
<p>而解密则为其反过程：</p>
<ul>
<li>平文 = DK1(EK2(DK3(密文)))<br>即以K3解密，以K2“加密”，最后以K1解密。</li>
</ul>
<p>每次加密操作都只处理64位数据，称为一块。</p>
<p>无论是加密还是解密，中间一步都是前后两步的逆。这种做法提高了使用密钥选项2时的算法强度，并在使用密钥选项3时与DES兼容。</p>
<h2 id="密钥选项">密钥选项</h2><p>标准定义了三种密钥选项：</p>
<ul>
<li>密钥选项1：三个密钥是独立的。</li>
<li>密钥选项2：K1和K2是独立的，而K3=K1</li>
<li>密钥选项3：三个密钥均相等，即K1=K2=K3</li>
<li>密钥选项1的强度最高，拥有3 x 56 = 168个独立的密钥位。</li>
</ul>
<p>密钥选项2的安全性稍低，拥有2 x 56 = 112个独立的密钥位。该选项比简单的应用DES两次的强度较高，即使用K1和K2，因为它可以防御中途相遇攻击。</p>
<p>密钥选项3等同与DES，只有56个密钥位。这个选项提供了与DES的兼容性，因为第1和第2次DES操作相互抵消了。该选项不再为国家标准科技协会（NIST）所建议[6]，亦不为ISO/IEC 18033-3所支持。</p>
<h1 id="3Des加密函数">3Des加密函数</h1><ul>
<li><p>内容采用 PKCS5Padding 方式填充，即长度以8 字节切分，不能被8 整除的末尾部分，根据长度不足8 字节的部分，填充“0x01”—“0x08”，如不足1 字节，<br>则填充1 个“0x01”，如不足2 字节，则填充2 个“0x02”，<br>以此类推，如整除，则填充8 个“0x08”；</p>
</li>
<li><p>参数：  </p>
<ol>
<li>key: 8字节字符串作为普通 DES 算法的密钥,或 24 字节字符串作为 3DES.   </li>
<li>message: 加密或解密的信息字符串.  </li>
<li>encrypt: 布尔值参数用来说明信息是加密还是解密.  </li>
<li>mode: 工作模式1:CBC模式，0:ECB模式(默认). </li>
<li>iv: 加密向量.</li>
<li>padding: 可选项, 8字节的输入向量字符串（在 ECB 模式下不使用）. </li>
</ol>
</li>
<li><p>密钥长度不足 24 字节时，右补ASCII 字符“0”；</p>
</li>
</ul>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line">function des (key, message, encrypt, mode, iv, padding) &#123;  </div><div class="line">  //declaring this locally speeds things up a bit  </div><div class="line">  var spfunction1 = new Array (<span class="number">0x1010400</span>,<span class="number">0,0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x1010004</span>,<span class="number">0x10404</span>,<span class="number">0</span>x<span class="number">4,0x10000</span>,<span class="number">0</span>x400,<span class="number">0x1010400</span>,<span class="number">0x1010404</span>,<span class="number">0</span>x400,<span class="number">0x1000404</span>,<span class="number">0x1010004</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x<span class="number">4,0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0x10400</span>,<span class="number">0x10400</span>,<span class="number">0x1010000</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x10004</span>,<span class="number">0x1000004</span>,<span class="number">0x1000004</span>,<span class="number">0x10004,0</span>,<span class="number">0</span>x4<span class="number">04,0x10404</span>,<span class="number">0x1000000</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0</span>x4,<span class="number">0x1010000</span>,<span class="number">0x1010400</span>,<span class="number">0x1000000</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x400,<span class="number">0x1010004</span>,<span class="number">0x10000</span>,<span class="number">0x10400</span>,<span class="number">0x1000004</span>,<span class="number">0</span>x<span class="number">400,0x4</span>,<span class="number">0x1000404</span>,<span class="number">0x10404</span>,<span class="number">0x1010404</span>,<span class="number">0x10004</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x1000004</span>,<span class="number">0</span>x4<span class="number">04,0x10404</span>,<span class="number">0x1010400</span>,<span class="number">0</span>x404,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0,0x10004</span>,<span class="number">0x10400,0</span>,<span class="number">0x1010004</span>)<span class="comment">;  </span></div><div class="line">  var spfunction2 = new Array (-<span class="number">0</span>x7fef7fe0,-<span class="number">0</span>x7fff80<span class="number">00,0x8000</span>,<span class="number">0x108020</span>,<span class="number">0x100000</span>,<span class="number">0</span>x20,-<span class="number">0</span>x7fefffe0,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7fffffe0,-<span class="number">0</span>x7fef7fe0,-<span class="number">0</span>x7fef8000,-<span class="number">0x80000000</span>,-<span class="number">0</span>x7fff80<span class="number">00,0x100000</span>,<span class="number">0</span>x20,-<span class="number">0</span>x7fefffe<span class="number">0,0x108000</span>,<span class="number">0x100020</span>,-<span class="number">0</span>x7fff7fe0,<span class="number">0</span>,-<span class="number">0x80000000</span>,<span class="number">0</span>x80<span class="number">00,0x108020</span>,-<span class="number">0</span>x7ff000<span class="number">00,0x100020</span>,-<span class="number">0</span>x7fffffe0,<span class="number">0,0x108000</span>,<span class="number">0</span>x8020,-<span class="number">0</span>x7fef8000,-<span class="number">0</span>x7ff000<span class="number">00,0x8020</span>,<span class="number">0,0x108020</span>,-<span class="number">0</span>x7fefffe<span class="number">0,0x100000</span>,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7ff00000,-<span class="number">0</span>x7fef80<span class="number">00,0x8000</span>,-<span class="number">0</span>x7ff00000,-<span class="number">0</span>x7fff<span class="number">8000,0x20</span>,-<span class="number">0</span>x7fef7fe<span class="number">0,0x108020</span>,<span class="number">0</span>x<span class="number">20,0x8000</span>,-<span class="number">0x80000000</span>,<span class="number">0</span>x8020,-<span class="number">0</span>x7fef80<span class="number">00,0x100000</span>,-<span class="number">0</span>x7fffffe<span class="number">0,0x100020</span>,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7fffffe<span class="number">0,0x100020</span>,<span class="number">0x108000,0</span>,-<span class="number">0</span>x7fff80<span class="number">00,0x8020</span>,-<span class="number">0x80000000</span>,-<span class="number">0</span>x7fefffe0,-<span class="number">0</span>x7fef7fe<span class="number">0,0x108000</span>)<span class="comment">;  </span></div><div class="line">  var spfunction3 = new Array (<span class="number">0</span>x208,<span class="number">0x8020200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000200</span>,<span class="number">0,0x20208</span>,<span class="number">0x8000200</span>,<span class="number">0x20008</span>,<span class="number">0x8000008</span>,<span class="number">0x8000008</span>,<span class="number">0x20000</span>,<span class="number">0x8020208</span>,<span class="number">0x20008</span>,<span class="number">0x8020000</span>,<span class="number">0</span>x208,<span class="number">0x8000000</span>,<span class="number">0</span>x8,<span class="number">0x8020200</span>,<span class="number">0</span>x<span class="number">200,0x20200</span>,<span class="number">0x8020000</span>,<span class="number">0x8020008</span>,<span class="number">0x20208</span>,<span class="number">0x8000208</span>,<span class="number">0x20200</span>,<span class="number">0x20000</span>,<span class="number">0x8000208</span>,<span class="number">0</span>x8,<span class="number">0x8020208</span>,<span class="number">0</span>x200,<span class="number">0x8000000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000000</span>,<span class="number">0x20008</span>,<span class="number">0</span>x<span class="number">208,0x20000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000200</span>,<span class="number">0,0x200</span>,<span class="number">0x20008</span>,<span class="number">0x8020208</span>,<span class="number">0x8000200</span>,<span class="number">0x8000008</span>,<span class="number">0x200,0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000208</span>,<span class="number">0x20000</span>,<span class="number">0x8000000</span>,<span class="number">0x8020208</span>,<span class="number">0</span>x<span class="number">8,0x20208</span>,<span class="number">0x20200</span>,<span class="number">0x8000008</span>,<span class="number">0x8020000</span>,<span class="number">0x8000208</span>,<span class="number">0</span>x208,<span class="number">0x8020000</span>,<span class="number">0x20208</span>,<span class="number">0</span>x8,<span class="number">0x8020008</span>,<span class="number">0x20200</span>)<span class="comment">;  </span></div><div class="line">  var spfunction4 = new Array (<span class="number">0x802001</span>,<span class="number">0</span>x20<span class="number">81,0x2081</span>,<span class="number">0</span>x80,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x800001</span>,<span class="number">0x2001,0</span>,<span class="number">0x802000</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0</span>x81,<span class="number">0</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0</span>x<span class="number">1,0x2000</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0</span>x80,<span class="number">0x800000</span>,<span class="number">0</span>x20<span class="number">01,0x2080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x<span class="number">1,0x2080</span>,<span class="number">0x800080</span>,<span class="number">0</span>x2000,<span class="number">0x802080</span>,<span class="number">0x802081</span>,<span class="number">0</span>x81,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81,0,0</span>,<span class="number">0x802000</span>,<span class="number">0</span>x2080,<span class="number">0x800080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x1,<span class="number">0x802001</span>,<span class="number">0</span>x20<span class="number">81,0x2081</span>,<span class="number">0</span>x80,<span class="number">0x802081</span>,<span class="number">0x81,0x1</span>,<span class="number">0</span>x2000,<span class="number">0x800001</span>,<span class="number">0</span>x2001,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x20<span class="number">01,0x2080</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0</span>x80,<span class="number">0x800000</span>,<span class="number">0</span>x2000,<span class="number">0x802080</span>)<span class="comment">;  </span></div><div class="line">  var spfunction5 = new Array (<span class="number">0</span>x<span class="number">100,0x2080100</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x80000</span>,<span class="number">0</span>x100,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x40080100</span>,<span class="number">0x80000</span>,<span class="number">0x2000100</span>,<span class="number">0x40080100</span>,<span class="number">0x42000100</span>,<span class="number">0x42080000</span>,<span class="number">0x80100</span>,<span class="number">0x40000000</span>,<span class="number">0x2000000</span>,<span class="number">0x40080000</span>,<span class="number">0x40080000</span>,<span class="number">0</span>,<span class="number">0x40000100</span>,<span class="number">0x42080100</span>,<span class="number">0x42080100</span>,<span class="number">0x2000100</span>,<span class="number">0x42080000</span>,<span class="number">0x40000100</span>,<span class="number">0</span>,<span class="number">0x42000000</span>,<span class="number">0x2080100</span>,<span class="number">0x2000000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x80000</span>,<span class="number">0x42000100</span>,<span class="number">0</span>x100,<span class="number">0x2000000</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x40080100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000000</span>,<span class="number">0x42080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40080100</span>,<span class="number">0</span>x100,<span class="number">0x2000000</span>,<span class="number">0x42080000</span>,<span class="number">0x42080100</span>,<span class="number">0x80100</span>,<span class="number">0x42000000</span>,<span class="number">0x42080100</span>,<span class="number">0x2080000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000100</span>,<span class="number">0x80000,0</span>,<span class="number">0x40080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40000100</span>)<span class="comment">;  </span></div><div class="line">  var spfunction6 = new Array (<span class="number">0x20000010</span>,<span class="number">0x20400000</span>,<span class="number">0</span>x4000,<span class="number">0x20404010</span>,<span class="number">0x20400000</span>,<span class="number">0</span>x10,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x404010</span>,<span class="number">0x400000</span>,<span class="number">0x20000010</span>,<span class="number">0x400010</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010,0</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>x4000,<span class="number">0x404000</span>,<span class="number">0x20004010</span>,<span class="number">0</span>x10,<span class="number">0x20400010</span>,<span class="number">0x20400010</span>,<span class="number">0</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>x4010,<span class="number">0x404000</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x20004000</span>,<span class="number">0</span>x10,<span class="number">0x20400010</span>,<span class="number">0x404000</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0</span>x4010,<span class="number">0x20000010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0</span>x4010,<span class="number">0x20000010</span>,<span class="number">0x20404010</span>,<span class="number">0x404000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>,<span class="number">0x20400010</span>,<span class="number">0</span>x<span class="number">10,0x4000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0</span>x4000,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>)<span class="comment">;  </span></div><div class="line">  var spfunction7 = new Array (<span class="number">0x200000</span>,<span class="number">0x4200002</span>,<span class="number">0x4000802</span>,<span class="number">0,0x800</span>,<span class="number">0x4000802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x4200802</span>,<span class="number">0x200000,0</span>,<span class="number">0x4000002</span>,<span class="number">0</span>x2,<span class="number">0x4000000</span>,<span class="number">0x4200002</span>,<span class="number">0</span>x802,<span class="number">0x4000800</span>,<span class="number">0x200802</span>,<span class="number">0x200002</span>,<span class="number">0x4000800</span>,<span class="number">0x4000002</span>,<span class="number">0x4200000</span>,<span class="number">0x4200800</span>,<span class="number">0x200002</span>,<span class="number">0x4200000</span>,<span class="number">0</span>x8<span class="number">00,0x802</span>,<span class="number">0x4200802</span>,<span class="number">0x200800</span>,<span class="number">0</span>x2,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x200000</span>,<span class="number">0x4000802</span>,<span class="number">0x4000802</span>,<span class="number">0x4200002</span>,<span class="number">0x4200002</span>,<span class="number">0</span>x<span class="number">2,0x200002</span>,<span class="number">0x4000000</span>,<span class="number">0x4000800</span>,<span class="number">0x200000</span>,<span class="number">0x4200800</span>,<span class="number">0</span>x8<span class="number">02,0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0</span>x802,<span class="number">0x4000002</span>,<span class="number">0x4200802</span>,<span class="number">0x4200000</span>,<span class="number">0x200800,0</span>,<span class="number">0</span>x2,<span class="number">0x4200802</span>,<span class="number">0,0x200802</span>,<span class="number">0x4200000</span>,<span class="number">0</span>x800,<span class="number">0x4000002</span>,<span class="number">0x4000800</span>,<span class="number">0</span>x8<span class="number">00,0x200002</span>)<span class="comment">;  </span></div><div class="line">  var spfunction8 = new Array (<span class="number">0x10001040</span>,<span class="number">0</span>x10<span class="number">00,0x40000</span>,<span class="number">0x10041040</span>,<span class="number">0x10000000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>x40,<span class="number">0x10000000</span>,<span class="number">0x40040</span>,<span class="number">0x10040000</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x10041000</span>,<span class="number">0x41040</span>,<span class="number">0</span>x<span class="number">1000,0x40</span>,<span class="number">0x10040000</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0</span>x10<span class="number">40,0x41000</span>,<span class="number">0x40040</span>,<span class="number">0x10040040</span>,<span class="number">0x10041000</span>,<span class="number">0x1040,0</span>,<span class="number">0</span>,<span class="number">0x10040040</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x10041000</span>,<span class="number">0</span>x<span class="number">1000,0x40</span>,<span class="number">0x10040040</span>,<span class="number">0</span>x10<span class="number">00,0x41040</span>,<span class="number">0x10001000</span>,<span class="number">0</span>x40,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10040040</span>,<span class="number">0x10000000</span>,<span class="number">0x40000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x40040</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10001000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x41000</span>,<span class="number">0</span>x10<span class="number">40,0x1040</span>,<span class="number">0x40040</span>,<span class="number">0x10000000</span>,<span class="number">0x10041000</span>)<span class="comment">;  </span></div><div class="line"> </div><div class="line">  //create the <span class="number">16</span> or <span class="number">48</span> subkeys we will need  </div><div class="line">  var keys = des_createKeys (key)<span class="comment">;  </span></div><div class="line">  var m=<span class="number">0</span>, i, j, temp, temp2, right1, right2, left, right, looping<span class="comment">;  </span></div><div class="line">  var cbcleft, cbcleft2, cbcright, cbcright2  </div><div class="line">  var endloop, loopinc<span class="comment">;  </span></div><div class="line">  var len = message.length<span class="comment">;  </span></div><div class="line">  var chunk = <span class="number">0</span><span class="comment">;  </span></div><div class="line">  //set up the loops for single and triple des  </div><div class="line">  var iterations = keys.length == <span class="number">32</span> ? <span class="number">3</span> : <span class="number">9</span><span class="comment">; //single or triple des  </span></div><div class="line">  if (iterations == <span class="number">3</span>) &#123;  </div><div class="line">    looping = encrypt ? new Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>) : new Array (<span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>)<span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  else &#123;  </div><div class="line">    looping = encrypt ? new Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>, <span class="number">62</span>, <span class="number">30</span>, -<span class="number">2</span>, <span class="number">64</span>, <span class="number">96</span>, <span class="number">2</span>) : new Array (<span class="number">94</span>, <span class="number">62</span>, -<span class="number">2</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">2</span>, <span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>)<span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  //pad the message depending on the padding parameter  </div><div class="line">  if (padding == <span class="number">2</span>)   </div><div class="line">    message += "        "<span class="comment">; //pad the message with spaces  </span></div><div class="line">  else if (padding == <span class="number">1</span>) &#123;  </div><div class="line">    temp = <span class="number">8</span>-(len%<span class="number">8</span>)<span class="comment">; message += String.fromCharCode (temp,temp,temp,temp,temp,temp,temp,temp);   </span></div><div class="line">      if (temp==<span class="number">8</span>)   </div><div class="line">        len+=<span class="number">8</span><span class="comment">;  </span></div><div class="line">  &#125; //PKCS7 padding 这里其实只是PKCS5 padding, PKCS5规定采用<span class="number">8</span>位补全，而PKCS7则不确定位数  </div><div class="line">  else if (!padding)   </div><div class="line">    message += "\<span class="number">0\0\0\0</span>\<span class="number">0\0\0\0</span>"<span class="comment">; //pad the message out with null bytes  </span></div><div class="line">  </div><div class="line">  //store the result here  </div><div class="line">  result = ""<span class="comment">;  </span></div><div class="line">  tempresult = ""<span class="comment">;  </span></div><div class="line">  </div><div class="line">  if (mode == <span class="number">1</span>) &#123; //CBC mode  </div><div class="line">    cbcleft = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    cbcright = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    m=<span class="number">0</span><span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  //loop through each <span class="number">64</span> bit chunk of the message  </div><div class="line">  while (m &lt; len) &#123;  </div><div class="line">    left = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    right = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">  </div><div class="line">    //for Cipher Block Chaining mode, xor the message with the previous result  </div><div class="line">    if (mode == <span class="number">1</span>) &#123;if (encrypt) &#123;left ^= cbcleft<span class="comment">; right ^= cbcright;&#125; else &#123;cbcleft2 = cbcleft; cbcright2 = cbcright; cbcleft = left; cbcright = right;&#125;&#125;  </span></div><div class="line">  </div><div class="line">    //first each <span class="number">64</span> but chunk of the message must be permuted according to IP  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0</span>x0000ffff<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 16);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span><span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">  </div><div class="line">    left = ((left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">    right = ((right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">  </div><div class="line">    //do this either <span class="number">1</span> or <span class="number">3</span> times for each chunk of the message  </div><div class="line">    for (j=<span class="number">0</span><span class="comment">; j&lt;iterations; j+=3) &#123;  </span></div><div class="line">      endloop = looping[j+<span class="number">1</span>]<span class="comment">;  </span></div><div class="line">      loopinc = looping[j+<span class="number">2</span>]<span class="comment">;  </span></div><div class="line">      //now go through and perform the encryption or decryption    </div><div class="line">      for (i=looping[j]<span class="comment">; i!=endloop; i+=loopinc) &#123; //for efficiency  </span></div><div class="line">        right1 = right ^ keys[i]<span class="comment">;   </span></div><div class="line">        right2 = ((right &gt;&gt;&gt; <span class="number">4</span>) | (right &lt;&lt; <span class="number">28</span>)) ^ keys[i+<span class="number">1</span>]<span class="comment">;  </span></div><div class="line">        //the result is attained by passing these bytes through the S selection functions  </div><div class="line">        temp = left<span class="comment">;  </span></div><div class="line">        left = right<span class="comment">;  </span></div><div class="line">        right = temp ^ (spfunction2[(right1 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>x3f] | spfunction4[(right1 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction6[(right1 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0</span>x3f] | spfunction8[right1 &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction1[(right2 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>x3f] | spfunction3[(right2 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction5[(right2 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0</span>x3f] | spfunction7[right2 &amp; <span class="number">0</span>x3f])<span class="comment">;  </span></div><div class="line">      &#125;  </div><div class="line">      temp = left<span class="comment">; left = right; right = temp; //unreverse left and right  </span></div><div class="line">    &#125; //for either <span class="number">1</span> or <span class="number">3</span> iterations  </div><div class="line">  </div><div class="line">    //move then each one bit to the right  </div><div class="line">    left = ((left &gt;&gt;&gt; <span class="number">1</span>) | (left &lt;&lt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">    right = ((right &gt;&gt;&gt; <span class="number">1</span>) | (right &lt;&lt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">  </div><div class="line">    //now perform IP-<span class="number">1</span>, which is IP in the opposite direction  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span><span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0</span>x0000ffff<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">  </div><div class="line">    //for Cipher Block Chaining mode, xor the message with the previous result  </div><div class="line">    if (mode == <span class="number">1</span>) &#123;if (encrypt) &#123;cbcleft = left<span class="comment">; cbcright = right;&#125; else &#123;left ^= cbcleft2; right ^= cbcright2;&#125;&#125;  </span></div><div class="line">    tempresult += String.fromCharCode ((left&gt;&gt;&gt;<span class="number">24</span>), ((left&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0</span>xff), ((left&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0</span>xff), (left &amp; <span class="number">0</span>xff), (right&gt;&gt;&gt;<span class="number">24</span>), ((right&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0</span>xff), ((right&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0</span>xff), (right &amp; <span class="number">0</span>xff))<span class="comment">;  </span></div><div class="line">  </div><div class="line">    chunk += <span class="number">8</span><span class="comment">;  </span></div><div class="line">    if (chunk == <span class="number">512</span>) &#123;result += tempresult<span class="comment">; tempresult = ""; chunk = 0;&#125;  </span></div><div class="line">  &#125; //for every <span class="number">8</span> characters, or <span class="number">64</span> bits in the message  </div><div class="line">  </div><div class="line">  //return the result as an array  </div><div class="line">  return result + tempresult<span class="comment">;  </span></div><div class="line">&#125; //end of des  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">//des_createKeys  </div><div class="line">//this takes as input a <span class="number">64</span> bit key (even though only <span class="number">56</span> bits are used)  </div><div class="line">//as an array of <span class="number">2</span> integers, and returns <span class="number">16</span> <span class="number">48</span> bit keys  </div><div class="line">function des_createKeys (key) &#123;  </div><div class="line">  //declaring this locally speeds things up a bit  </div><div class="line">  pc2bytes0  = new Array (<span class="number">0</span>,<span class="number">0</span>x4,<span class="number">0x20000000</span>,<span class="number">0x20000004</span>,<span class="number">0x10000</span>,<span class="number">0x10004</span>,<span class="number">0x20010000</span>,<span class="number">0x20010004</span>,<span class="number">0x200,0x204</span>,<span class="number">0x20000200</span>,<span class="number">0x20000204</span>,<span class="number">0x10200</span>,<span class="number">0x10204</span>,<span class="number">0x20010200</span>,<span class="number">0x20010204</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes1  = new Array (<span class="number">0</span>,<span class="number">0</span>x<span class="number">1,0x100000</span>,<span class="number">0x100001</span>,<span class="number">0x4000000</span>,<span class="number">0x4000001</span>,<span class="number">0x4100000</span>,<span class="number">0x4100001</span>,<span class="number">0x100,0x101</span>,<span class="number">0x100100</span>,<span class="number">0x100101</span>,<span class="number">0x4000100</span>,<span class="number">0x4000101</span>,<span class="number">0x4100100</span>,<span class="number">0x4100101</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes2  = new Array (<span class="number">0</span>,<span class="number">0</span>x<span class="number">8,0x800</span>,<span class="number">0</span>x808,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>,<span class="number">0</span>,<span class="number">0</span>x<span class="number">8,0x800</span>,<span class="number">0</span>x808,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes3  = new Array (<span class="number">0,0x200000</span>,<span class="number">0x8000000</span>,<span class="number">0x8200000</span>,<span class="number">0</span>x20<span class="number">00,0x202000</span>,<span class="number">0x8002000</span>,<span class="number">0x8202000</span>,<span class="number">0x20000</span>,<span class="number">0x220000</span>,<span class="number">0x8020000</span>,<span class="number">0x8220000</span>,<span class="number">0x22000</span>,<span class="number">0x222000</span>,<span class="number">0x8022000</span>,<span class="number">0x8222000</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes4  = new Array (<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">10,0x40010</span>,<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">10,0x40010</span>,<span class="number">0</span>x10<span class="number">00,0x41000</span>,<span class="number">0</span>x10<span class="number">10,0x41010</span>,<span class="number">0</span>x10<span class="number">00,0x41000</span>,<span class="number">0</span>x10<span class="number">10,0x41010</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes5  = new Array (<span class="number">0,0x400</span>,<span class="number">0</span>x<span class="number">20,0x420</span>,<span class="number">0,0x400</span>,<span class="number">0</span>x<span class="number">20,0x420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes6  = new Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0</span>x2,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0</span>x2,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes7  = new Array (<span class="number">0,0x10000</span>,<span class="number">0</span>x8<span class="number">00,0x10800</span>,<span class="number">0x20000000</span>,<span class="number">0x20010000</span>,<span class="number">0x20000800</span>,<span class="number">0x20010800</span>,<span class="number">0x20000</span>,<span class="number">0x30000</span>,<span class="number">0x20800</span>,<span class="number">0x30800</span>,<span class="number">0x20020000</span>,<span class="number">0x20030000</span>,<span class="number">0x20020800</span>,<span class="number">0x20030800</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes8  = new Array (<span class="number">0,0x40000</span>,<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">2,0x40002</span>,<span class="number">0</span>x<span class="number">2,0x40002</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes9  = new Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0</span>x8,<span class="number">0x10000008</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0</span>x8,<span class="number">0x10000008</span>,<span class="number">0</span>x400,<span class="number">0x10000400</span>,<span class="number">0</span>x408,<span class="number">0x10000408</span>,<span class="number">0</span>x400,<span class="number">0x10000400</span>,<span class="number">0</span>x408,<span class="number">0x10000408</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes10 = new Array (<span class="number">0,0x20,0</span>,<span class="number">0</span>x<span class="number">20,0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0</span>x20<span class="number">00,0x2020</span>,<span class="number">0</span>x20<span class="number">00,0x2020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes11 = new Array (<span class="number">0</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x<span class="number">200,0x1000200</span>,<span class="number">0x200000</span>,<span class="number">0x1200000</span>,<span class="number">0x200200</span>,<span class="number">0x1200200</span>,<span class="number">0x4000000</span>,<span class="number">0x5000000</span>,<span class="number">0x4000200</span>,<span class="number">0x5000200</span>,<span class="number">0x4200000</span>,<span class="number">0x5200000</span>,<span class="number">0x4200200</span>,<span class="number">0x5200200</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes12 = new Array (<span class="number">0,0x1000</span>,<span class="number">0x8000000</span>,<span class="number">0x8001000</span>,<span class="number">0x80000</span>,<span class="number">0x81000</span>,<span class="number">0x8080000</span>,<span class="number">0x8081000</span>,<span class="number">0</span>x<span class="number">10,0x1010</span>,<span class="number">0x8000010</span>,<span class="number">0x8001010</span>,<span class="number">0x80010</span>,<span class="number">0x81010</span>,<span class="number">0x8080010</span>,<span class="number">0x8081010</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes13 = new Array (<span class="number">0</span>,<span class="number">0x4,0x100</span>,<span class="number">0x104,0</span>,<span class="number">0x4,0x100</span>,<span class="number">0x104,0x1</span>,<span class="number">0x5,0x101</span>,<span class="number">0x105,0x1</span>,<span class="number">0x5,0x101</span>,<span class="number">0</span>x105)<span class="comment">;  </span></div><div class="line">  </div><div class="line">  //how many iterations (<span class="number">1</span> for des, <span class="number">3</span> for triple des)  </div><div class="line">  var iterations = key.length &gt; <span class="number">8</span> ? <span class="number">3</span> : <span class="number">1</span><span class="comment">;   </span></div><div class="line">  //stores the return keys  </div><div class="line">  var keys = new Array (<span class="number">32</span> * iterations)<span class="comment">;  </span></div><div class="line">  //now define the left shifts which need to be done  </div><div class="line">  var shifts = new Array (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)<span class="comment">;  </span></div><div class="line">  //other variables  </div><div class="line">  var lefttemp, righttemp, m=<span class="number">0</span>, n=<span class="number">0</span>, temp<span class="comment">;  </span></div><div class="line">  </div><div class="line">  for (var j=<span class="number">0</span><span class="comment">; j&lt;iterations; j++) &#123; //either 1 or 3 iterations  </span></div><div class="line">    left = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    right = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0</span>x0000ffff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; -16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">2</span>) ^ right) &amp; <span class="number">0x33333333</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0</span>x0000ffff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; -16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">  </div><div class="line">    //the right side needs to be shifted and to get the last four bits of the left side  </div><div class="line">    temp = (left &lt;&lt; <span class="number">8</span>) | ((right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>x<span class="number">000000f0</span>)<span class="comment">;  </span></div><div class="line">    //left needs to be put upside down  </div><div class="line">    left = (right &lt;&lt; <span class="number">24</span>) | ((right &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0</span>xff0000) | ((right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xff00) | ((right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf0)<span class="comment">;  </span></div><div class="line">    right = temp<span class="comment">;  </span></div><div class="line">  </div><div class="line">    //now go through and perform these shifts on the left and right keys  </div><div class="line">    for (var i=<span class="number">0</span><span class="comment">; i &lt; shifts.length; i++) &#123;  </span></div><div class="line">      //shift the keys either one or two bits to the left  </div><div class="line">      if (shifts[i]) &#123;left = (left &lt;&lt; <span class="number">2</span>) | (left &gt;&gt;&gt; <span class="number">26</span>)<span class="comment">; right = (right &lt;&lt; 2) | (right &gt;&gt;&gt; 26);&#125;  </span></div><div class="line">      else &#123;left = (left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">27</span>)<span class="comment">; right = (right &lt;&lt; 1) | (right &gt;&gt;&gt; 27);&#125;  </span></div><div class="line">      left &amp;= -<span class="number">0</span>xf<span class="comment">; right &amp;= -0xf;  </span></div><div class="line">  </div><div class="line">      //now apply PC-<span class="number">2</span>, in such a way that E is easier when encrypting or decrypting  </div><div class="line">      //this conversion will look like PC-<span class="number">2</span> except only the last <span class="number">6</span> bits of each byte are used  </div><div class="line">      //rather than <span class="number">48</span> consecutive bits and the order of lines will be according to   </div><div class="line">      //how the S selection functions will be applied: S2, S4, S6, S8, S1, S3, S5, S7  </div><div class="line">      lefttemp = pc2bytes0[left &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes1[(left &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes2[(left &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>xf] | pc2bytes3[(left &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes4[(left &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0</span>xf] | pc2bytes5[(left &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes6[(left &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0</span>xf]<span class="comment">;  </span></div><div class="line">      righttemp = pc2bytes7[right &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes8[(right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes9[(right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>xf] | pc2bytes10[(right &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes11[(right &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0</span>xf] | pc2bytes12[(right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes13[(right &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0</span>xf]<span class="comment">;  </span></div><div class="line">      temp = ((righttemp &gt;&gt;&gt; <span class="number">16</span>) ^ lefttemp) &amp; <span class="number">0</span>x0000ffff<span class="comment">;   </span></div><div class="line">      keys[n++] = lefttemp ^ temp<span class="comment">; keys[n++] = righttemp ^ (temp &lt;&lt; 16);  </span></div><div class="line">    &#125;  </div><div class="line">  &#125; //for each iterations  </div><div class="line">  //return the keys we've created  </div><div class="line">  return keys<span class="comment">;  </span></div><div class="line">&#125; //end of des_createKeys</div></pre></td></tr></table></figure>
<h1 id="调用3des加密和解密">调用3des加密和解密</h1><p>由于对加密的结果有以下要求:</p>
<ul>
<li>密钥长度不足 24 字节时，应当右补ASCII 字符“0”；</li>
<li>返回结果使用ASCII 形式的十六进制编码表示，采用大写“ABCDEF”，如加密结果为8 字节二进制字符串：0x0123456789ABCDEF，则Authenticator 为16 字节ASCII 字符串：”0123456789ABCDEF” 。</li>
<li>用hex的加密结果作为解密字符串时,函数应该将十六进制的字符串转换为ASCII码的字符串</li>
</ul>
<p>所以又重新封装了des加密函数. 加密出来的结果因为变量类型是字符串所以实际上是ACSII码,所以看起就像乱码一样,需求需要把ASCII码转换成16进制Hex.所以在解密的时候则需要把16进制的hex先转换回ASCII码在进行解密.</p>
<p>参考如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode3des</span>(<span class="params">key, message</span>) </span>&#123;  </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </div><div class="line">            key+=<span class="string">"0"</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">var</span> _temp=des(key, message, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> string2Hex(_temp);</div><div class="line">&#125;  </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode3des</span> (<span class="params">key, message</span>) </span>&#123; </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </div><div class="line">            key+=<span class="string">"0"</span>;  </div><div class="line">    &#125;  </div><div class="line">    message =hex2ASCII(message);</div><div class="line">    <span class="keyword">return</span>  des(key, message, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);  </div><div class="line">&#125; </div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex2ASCII</span>(<span class="params">str</span>) </span>&#123; </div><div class="line">    <span class="keyword">var</span> result = <span class="string">''</span>;</div><div class="line">    <span class="keyword">while</span> (str.length &gt;= <span class="number">2</span>) &#123; </div><div class="line">       result += <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(str.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>));</div><div class="line">        str = str.substring(<span class="number">2</span>, str.length);</div><div class="line">    &#125;</div><div class="line">    message =result;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">string2Hex</span>(<span class="params">s</span>) </span>&#123;  </div><div class="line">  <span class="keyword">var</span> r = <span class="string">""</span>;</div><div class="line">  <span class="keyword">var</span> hexes = <span class="keyword">new</span> <span class="built_in">Array</span> (<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>,<span class="string">"5"</span>,<span class="string">"6"</span>,<span class="string">"7"</span>,<span class="string">"8"</span>,<span class="string">"9"</span>,<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>,<span class="string">"E"</span>,<span class="string">"F"</span>);  </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;s.length; i++) &#123;r += hexes [s.charCodeAt(i) &gt;&gt; <span class="number">4</span>] + hexes [s.charCodeAt(i) &amp; <span class="number">0xf</span>];&#125;  </div><div class="line">  <span class="keyword">return</span> r;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里还有一种将Unicode转为hex的方法,但是要注意这里如果转化出来是02 那么它是会当做2写进字符串的,所以要做一下判断,给他补零补齐两位.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function string2Hex (s) &#123;</div><div class="line">    var <span class="built_in">hex</span>, i<span class="comment">;</span></div><div class="line">    var result = <span class="string">""</span><span class="comment">;</span></div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span><span class="comment">; i&lt;s.length; i++) &#123;</span></div><div class="line">        <span class="built_in">hex</span> = s.codePointAt(i).toString(<span class="number">16</span>)<span class="comment">;</span></div><div class="line">        <span class="keyword">if</span>(<span class="built_in">hex</span>.length&lt;<span class="number">2</span>)&#123;</div><div class="line">           <span class="built_in">hex</span>=<span class="string">'0'</span>+<span class="built_in">hex</span><span class="comment">;</span></div><div class="line">        &#125;</div><div class="line">        result += (<span class="built_in">hex</span>).slice(<span class="number">-4</span>)<span class="comment">;</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result.toUpperCase()<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/26/linux-network-cmd/" itemprop="url">
                  Linux网络抓包命令以及dns查询命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-26T19:38:23+08:00" content="2016-06-26">
              2016-06-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/26/linux-network-cmd/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/26/linux-network-cmd/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="tcpdump">tcpdump</h1><p>因为需要远程抓取一台设备的network记录. 所以需要想办法:</p>
<ol>
<li>把mbp做个wifi共享热点,让被抓包的设备连接到热点上来.</li>
<li>再把有线网卡的mac地址伪装成被抓包的设备,方便我们接入被抓包设备的网段.</li>
</ol>
<p>这样做以后:</p>
<ol>
<li>mbp就成了远程的设备的网关,所有流量就会经过mbp的有线网卡.</li>
<li>而且由于远程设备的代码中都是http协议的而不是https的.所以所有的流量都可以说是透明的. </li>
</ol>
<p>于是就可以抓包下来进行分析了.</p>
<p>这时候就需要用到tcpdump命令了,先使用tcpdump命令把所有的包储存成在本地的cap文件,然后再把这个cap文件丢到wireshark里面进行分析.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">tcpdump</span> <span class="selector-tag">-XvvennSs</span> 0 <span class="selector-tag">-w</span>  <span class="selector-tag">log</span><span class="selector-class">.cap</span>  <span class="selector-tag">host</span> 10<span class="selector-class">.100</span><span class="selector-class">.100</span><span class="selector-class">.100</span></div></pre></td></tr></table></figure>
<p>ps: 感谢小毅提供的帮助~</p>
<h1 id="dns_查询_dig">dns 查询 dig</h1><p>在科学上网的过程中,dig命令是非常有帮助的一个命令,能帮你分析dns解析的过程.</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo dscacheutil -flushcache  <span class="comment">//mac os中清理dns缓存的命令</span></div></pre></td></tr></table></figure>
<p>先用<code>man dig</code> 查询dig的manual(手册) </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div></pre></td><td class="code"><pre><div class="line">NAME</div><div class="line">       dig - DNS lookup utility</div><div class="line"></div><div class="line">SYNOPSIS</div><div class="line">       dig [@server] [-b address] [-c <span class="built_in">class</span>] [-f filename] [-k filename] [-m] [-p port<span class="comment">#] [-q name] [-t type] [-x addr]</span></div><div class="line">           [-y [hmac:]<span class="built_in">name</span>:key] [<span class="number">-4</span>] [<span class="number">-6</span>] [<span class="built_in">name</span>] [type] [<span class="built_in">class</span>] [queryopt...]</div><div class="line"></div><div class="line">       dig [-h]</div><div class="line"></div><div class="line">       dig [<span class="keyword">global</span>-queryopt...] [query...]</div><div class="line"></div><div class="line">DESCRIPTION</div><div class="line">       dig (domain information groper) <span class="keyword">is</span> a flexible tool <span class="keyword">for</span> interrogating DNS <span class="built_in">name</span> servers. It performs DNS lookups <span class="keyword">and</span> displays</div><div class="line">       <span class="keyword">the</span> answers <span class="keyword">that</span> are returned <span class="keyword">from</span> <span class="keyword">the</span> <span class="built_in">name</span> server(s) <span class="keyword">that</span> were queried. Most DNS administrators use dig <span class="keyword">to</span> troubleshoot</div><div class="line">       DNS problems because <span class="keyword">of</span> <span class="keyword">its</span> flexibility, ease <span class="keyword">of</span> use <span class="keyword">and</span> clarity <span class="keyword">of</span> output. Other lookup tools tend <span class="keyword">to</span> have less</div><div class="line">       functionality than dig.</div><div class="line"></div><div class="line">       Although dig <span class="keyword">is</span> normally used <span class="keyword">with</span> command-line arguments, <span class="keyword">it</span> also has a batch mode <span class="keyword">of</span> operation <span class="keyword">for</span> reading lookup</div><div class="line">       requests <span class="keyword">from</span> a <span class="built_in">file</span>. A brief summary <span class="keyword">of</span> <span class="keyword">its</span> command-line arguments <span class="keyword">and</span> options <span class="keyword">is</span> printed when <span class="keyword">the</span> -h option <span class="keyword">is</span> <span class="keyword">given</span>.</div><div class="line">       Unlike earlier versions, <span class="keyword">the</span> BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig allows multiple lookups <span class="keyword">to</span> be issued <span class="keyword">from</span> <span class="keyword">the</span> command line.</div><div class="line"></div><div class="line">       Unless <span class="keyword">it</span> <span class="keyword">is</span> told <span class="keyword">to</span> query a specific <span class="built_in">name</span> server, dig will <span class="keyword">try</span> each <span class="keyword">of</span> <span class="keyword">the</span> servers listed <span class="keyword">in</span> /etc/resolv.conf.</div><div class="line"></div><div class="line">       When no command line arguments <span class="keyword">or</span> options are <span class="keyword">given</span>, dig will perform an NS query <span class="keyword">for</span> <span class="string">"."</span> (<span class="keyword">the</span> root).</div><div class="line"></div><div class="line">       It <span class="keyword">is</span> possible <span class="keyword">to</span> <span class="keyword">set</span> per-user defaults <span class="keyword">for</span> dig via $&#123;HOME&#125;/.digrc. This <span class="built_in">file</span> <span class="keyword">is</span> <span class="built_in">read</span> <span class="keyword">and</span> any options <span class="keyword">in</span> <span class="keyword">it</span> are applied</div><div class="line">       <span class="keyword">before</span> <span class="keyword">the</span> command line arguments.</div><div class="line"></div><div class="line">       The IN <span class="keyword">and</span> CH <span class="built_in">class</span> names overlap <span class="keyword">with</span> <span class="keyword">the</span> IN <span class="keyword">and</span> CH top level domains names. Either use <span class="keyword">the</span> -t <span class="keyword">and</span> -c options <span class="keyword">to</span> specify</div><div class="line">       <span class="keyword">the</span> type <span class="keyword">and</span> <span class="built_in">class</span>, use <span class="keyword">the</span> -q <span class="keyword">the</span> specify <span class="keyword">the</span> domain <span class="built_in">name</span>, <span class="keyword">or</span> use <span class="string">"IN."</span> <span class="keyword">and</span> <span class="string">"CH."</span> when looking up these top level domains.</div><div class="line"></div><div class="line">SIMPLE USAGE</div><div class="line">       A typical invocation <span class="keyword">of</span> dig looks like:</div><div class="line"></div><div class="line">            dig @server <span class="built_in">name</span> type</div><div class="line"></div><div class="line">       <span class="keyword">where</span>:</div><div class="line"></div><div class="line">       server</div><div class="line">           <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">or</span> IP address <span class="keyword">of</span> <span class="keyword">the</span> <span class="built_in">name</span> server <span class="keyword">to</span> query. This can be an IPv4 address <span class="keyword">in</span> dotted-decimal notation <span class="keyword">or</span> an</div><div class="line">           IPv6 address <span class="keyword">in</span> colon-delimited notation. When <span class="keyword">the</span> supplied server argument <span class="keyword">is</span> a hostname, dig resolves <span class="keyword">that</span> <span class="built_in">name</span></div><div class="line">           <span class="keyword">before</span> querying <span class="keyword">that</span> <span class="built_in">name</span> server. If no server argument <span class="keyword">is</span> provided, dig consults /etc/resolv.conf <span class="keyword">and</span> queries <span class="keyword">the</span> <span class="built_in">name</span></div><div class="line">           servers listed there. The reply <span class="keyword">from</span> <span class="keyword">the</span> <span class="built_in">name</span> server <span class="keyword">that</span> responds <span class="keyword">is</span> displayed.</div><div class="line"></div><div class="line">       <span class="built_in">name</span></div><div class="line">           <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> <span class="keyword">the</span> resource <span class="built_in">record</span> <span class="keyword">that</span> <span class="keyword">is</span> <span class="keyword">to</span> be looked up.</div><div class="line"></div><div class="line">       type</div><div class="line">           indicates what type <span class="keyword">of</span> query <span class="keyword">is</span> required <span class="comment">-- ANY, A, MX, SIG, etc.  type can be any valid query type. If no type</span></div><div class="line">           argument <span class="keyword">is</span> supplied, dig will perform a lookup <span class="keyword">for</span> an A <span class="built_in">record</span>.</div><div class="line"></div><div class="line">OPTIONS</div><div class="line">       The -b option sets <span class="keyword">the</span> source IP address <span class="keyword">of</span> <span class="keyword">the</span> query <span class="keyword">to</span> address. This must be a valid address <span class="keyword">on</span> one <span class="keyword">of</span> <span class="keyword">the</span> host's network</div><div class="line">       interfaces <span class="keyword">or</span> <span class="string">"0.0.0.0"</span> <span class="keyword">or</span> <span class="string">"::"</span>. An optional port may be specified <span class="keyword">by</span> appending <span class="string">"#&lt;port&gt;"</span></div><div class="line"></div><div class="line">       The default query <span class="built_in">class</span> (IN <span class="keyword">for</span> internet) <span class="keyword">is</span> overridden <span class="keyword">by</span> <span class="keyword">the</span> -c option.  <span class="built_in">class</span> <span class="keyword">is</span> any valid <span class="built_in">class</span>, such <span class="keyword">as</span> HS <span class="keyword">for</span> Hesiod</div><div class="line">       records <span class="keyword">or</span> CH <span class="keyword">for</span> Chaosnet records.</div><div class="line"></div><div class="line">       The -f option makes dig operate <span class="keyword">in</span> batch mode <span class="keyword">by</span> reading a <span class="built_in">list</span> <span class="keyword">of</span> lookup requests <span class="keyword">to</span> process <span class="keyword">from</span> <span class="keyword">the</span> <span class="built_in">file</span> filename. The</div><div class="line">       <span class="built_in">file</span> <span class="keyword">contains</span> a <span class="built_in">number</span> <span class="keyword">of</span> queries, one per line. Each entry <span class="keyword">in</span> <span class="keyword">the</span> <span class="built_in">file</span> should be organized <span class="keyword">in</span> <span class="keyword">the</span> same way they would be</div><div class="line">       presented <span class="keyword">as</span> queries <span class="keyword">to</span> dig using <span class="keyword">the</span> command-line interface.</div><div class="line"></div><div class="line">       The -m option enables memory usage debugging.</div><div class="line"></div><div class="line">       If a non-standard port <span class="built_in">number</span> <span class="keyword">is</span> <span class="keyword">to</span> be queried, <span class="keyword">the</span> -p option <span class="keyword">is</span> used.  port<span class="comment"># is the port number that dig will send its</span></div><div class="line">       queries <span class="keyword">instead of</span> <span class="keyword">the</span> standard DNS port <span class="built_in">number</span> <span class="number">53.</span> This option would be used <span class="keyword">to</span> test a <span class="built_in">name</span> server <span class="keyword">that</span> has been</div><div class="line">       configured <span class="keyword">to</span> listen <span class="keyword">for</span> queries <span class="keyword">on</span> a non-standard port <span class="built_in">number</span>.</div><div class="line"></div><div class="line">       The <span class="number">-4</span> option forces dig <span class="keyword">to</span> only use IPv4 query transport. The <span class="number">-6</span> option forces dig <span class="keyword">to</span> only use IPv6 query transport.</div><div class="line"></div><div class="line">       The -t option sets <span class="keyword">the</span> query type <span class="keyword">to</span> type. It can be any valid query type which <span class="keyword">is</span> supported <span class="keyword">in</span> BIND <span class="number">9.</span> The default query</div><div class="line">       type <span class="keyword">is</span> <span class="string">"A"</span>, unless <span class="keyword">the</span> -x option <span class="keyword">is</span> supplied <span class="keyword">to</span> indicate a <span class="built_in">reverse</span> lookup. A zone transfer can be requested <span class="keyword">by</span> specifying</div><div class="line">       a type <span class="keyword">of</span> AXFR. When an incremental zone transfer (IXFR) <span class="keyword">is</span> required, type <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> ixfr=N. The incremental zone transfer</div><div class="line">       will <span class="keyword">contain</span> <span class="keyword">the</span> changes made <span class="keyword">to</span> <span class="keyword">the</span> zone <span class="keyword">since</span> <span class="keyword">the</span> serial <span class="built_in">number</span> <span class="keyword">in</span> <span class="keyword">the</span> zone's SOA <span class="built_in">record</span> was N.</div><div class="line"></div><div class="line">       The -q option sets <span class="keyword">the</span> query <span class="built_in">name</span> <span class="keyword">to</span> <span class="built_in">name</span>. This useful do distinguish <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">from</span> other arguments.</div><div class="line"></div><div class="line">       Reverse lookups <span class="comment">-- mapping addresses to names -- are simplified by the -x option.  addr is an IPv4 address in</span></div><div class="line">       dotted-decimal notation, <span class="keyword">or</span> a colon-delimited IPv6 address. When this option <span class="keyword">is</span> used, there <span class="keyword">is</span> no need <span class="keyword">to</span> provide <span class="keyword">the</span> <span class="built_in">name</span>,</div><div class="line">       <span class="built_in">class</span> <span class="keyword">and</span> type arguments.  dig automatically performs a lookup <span class="keyword">for</span> a <span class="built_in">name</span> like <span class="number">11.12</span><span class="number">.13</span><span class="number">.10</span>.<span class="keyword">in</span>-addr.arpa <span class="keyword">and</span> sets <span class="keyword">the</span> query</div><div class="line">       type <span class="keyword">and</span> <span class="built_in">class</span> <span class="keyword">to</span> PTR <span class="keyword">and</span> IN respectively. By default, IPv6 addresses are looked up using nibble format under <span class="keyword">the</span> IP6.ARPA</div><div class="line">       domain. To use <span class="keyword">the</span> older RFC1886 method using <span class="keyword">the</span> IP6.INT domain specify <span class="keyword">the</span> -i option. Bit <span class="built_in">string</span> labels (RFC2874) are now</div><div class="line">       experimental <span class="keyword">and</span> are <span class="keyword">not</span> attempted.</div><div class="line"></div><div class="line">       To sign <span class="keyword">the</span> DNS queries sent <span class="keyword">by</span> dig <span class="keyword">and</span> their responses using <span class="keyword">transaction</span> signatures (TSIG), specify a TSIG key <span class="built_in">file</span> using</div><div class="line">       <span class="keyword">the</span> -k option. You can also specify <span class="keyword">the</span> TSIG key itself <span class="keyword">on</span> <span class="keyword">the</span> command line using <span class="keyword">the</span> -y option; hmac <span class="keyword">is</span> <span class="keyword">the</span> type <span class="keyword">of</span> <span class="keyword">the</span></div><div class="line">       TSIG, default HMAC-MD5, <span class="built_in">name</span> <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> <span class="keyword">the</span> TSIG key <span class="keyword">and</span> key <span class="keyword">is</span> <span class="keyword">the</span> actual key. The key <span class="keyword">is</span> a base<span class="number">-64</span> encoded <span class="built_in">string</span>,</div><div class="line">       typically generated <span class="keyword">by</span> dnssec-keygen(<span class="number">8</span>). Caution should be taken when using <span class="keyword">the</span> -y option <span class="keyword">on</span> multi-user systems <span class="keyword">as</span> <span class="keyword">the</span> key</div><div class="line">       can be visible <span class="keyword">in</span> <span class="keyword">the</span> output <span class="keyword">from</span> ps(<span class="number">1</span>) <span class="keyword">or</span> <span class="keyword">in</span> <span class="keyword">the</span> shell's history <span class="built_in">file</span>. When using TSIG authentication <span class="keyword">with</span> dig, <span class="keyword">the</span> <span class="built_in">name</span></div><div class="line">       server <span class="keyword">that</span> <span class="keyword">is</span> queried needs <span class="keyword">to</span> know <span class="keyword">the</span> key <span class="keyword">and</span> algorithm <span class="keyword">that</span> <span class="keyword">is</span> being used. In BIND, this <span class="keyword">is</span> done <span class="keyword">by</span> providing</div><div class="line">       appropriate key <span class="keyword">and</span> server statements <span class="keyword">in</span> named.conf.</div><div class="line"></div><div class="line">Mac OS X NOTICE</div><div class="line">       The dig command <span class="keyword">does</span> <span class="keyword">not</span> use <span class="keyword">the</span> host <span class="built_in">name</span> <span class="keyword">and</span> address resolution <span class="keyword">or</span> <span class="keyword">the</span> DNS query routing mechanisms used <span class="keyword">by</span> other</div><div class="line">       processes <span class="built_in">running</span> <span class="keyword">on</span> Mac OS X.  The results <span class="keyword">of</span> <span class="built_in">name</span> <span class="keyword">or</span> address queries printed <span class="keyword">by</span> dig may differ <span class="keyword">from</span> those found <span class="keyword">by</span> other</div><div class="line">       processes <span class="keyword">that</span> use <span class="keyword">the</span> Mac OS X native <span class="built_in">name</span> <span class="keyword">and</span> address resolution mechanisms.  The results <span class="keyword">of</span> DNS queries may also differ</div><div class="line">       <span class="keyword">from</span> queries <span class="keyword">that</span> use <span class="keyword">the</span> Mac OS X DNS routing library.</div><div class="line"></div><div class="line">QUERY OPTIONS</div><div class="line">       dig provides a <span class="built_in">number</span> <span class="keyword">of</span> query options which affect <span class="keyword">the</span> way <span class="keyword">in</span> which lookups are made <span class="keyword">and</span> <span class="keyword">the</span> results displayed. Some <span class="keyword">of</span></div><div class="line">       these <span class="keyword">set</span> <span class="keyword">or</span> reset flag bits <span class="keyword">in</span> <span class="keyword">the</span> query header, <span class="keyword">some</span> determine which sections <span class="keyword">of</span> <span class="keyword">the</span> answer <span class="keyword">get</span> printed, <span class="keyword">and</span> others</div><div class="line">       determine <span class="keyword">the</span> <span class="keyword">timeout</span> <span class="keyword">and</span> retry strategies.</div><div class="line"></div><div class="line">       Each query option <span class="keyword">is</span> identified <span class="keyword">by</span> a keyword preceded <span class="keyword">by</span> a plus sign (+). Some keywords <span class="keyword">set</span> <span class="keyword">or</span> reset an option. These may</div><div class="line">       be preceded <span class="keyword">by</span> <span class="keyword">the</span> <span class="built_in">string</span> no <span class="keyword">to</span> negate <span class="keyword">the</span> meaning <span class="keyword">of</span> <span class="keyword">that</span> keyword. Other keywords assign values <span class="keyword">to</span> options like <span class="keyword">the</span></div><div class="line">       <span class="keyword">timeout</span> interval. They have <span class="keyword">the</span> form +keyword=value. The query options are:</div><div class="line"></div><div class="line">       +[no]tcp</div><div class="line">           Use [do <span class="keyword">not</span> use] TCP when querying <span class="built_in">name</span> servers. The default behavior <span class="keyword">is</span> <span class="keyword">to</span> use UDP unless an AXFR <span class="keyword">or</span> IXFR query <span class="keyword">is</span></div><div class="line">           requested, <span class="keyword">in</span> which case a TCP connection <span class="keyword">is</span> used.</div><div class="line"></div><div class="line">       +[no]vc</div><div class="line">           Use [do <span class="keyword">not</span> use] TCP when querying <span class="built_in">name</span> servers. This alternate syntax <span class="keyword">to</span> +[no]tcp <span class="keyword">is</span> provided <span class="keyword">for</span> backwards</div><div class="line">           compatibility. The <span class="string">"vc"</span> stands <span class="keyword">for</span> <span class="string">"virtual circuit"</span>.</div><div class="line"></div><div class="line">       +[no]ignore</div><div class="line">           Ignore truncation <span class="keyword">in</span> UDP responses <span class="keyword">instead of</span> retrying <span class="keyword">with</span> TCP. By default, TCP retries are performed.</div><div class="line"></div><div class="line">       +domain=somename</div><div class="line">           Set <span class="keyword">the</span> search <span class="built_in">list</span> <span class="keyword">to</span> <span class="keyword">contain</span> <span class="keyword">the</span> single domain somename, <span class="keyword">as</span> <span class="keyword">if</span> specified <span class="keyword">in</span> a domain directive <span class="keyword">in</span> /etc/resolv.conf,</div><div class="line">           <span class="keyword">and</span> enable search <span class="built_in">list</span> processing <span class="keyword">as</span> <span class="keyword">if</span> <span class="keyword">the</span> +search option were <span class="keyword">given</span>.</div><div class="line"></div><div class="line">       +[no]search</div><div class="line">           Use [do <span class="keyword">not</span> use] <span class="keyword">the</span> search <span class="built_in">list</span> defined <span class="keyword">by</span> <span class="keyword">the</span> searchlist <span class="keyword">or</span> domain directive <span class="keyword">in</span> resolv.conf (<span class="keyword">if</span> any). The search <span class="built_in">list</span></div><div class="line">           <span class="keyword">is</span> <span class="keyword">not</span> used <span class="keyword">by</span> default.</div><div class="line"></div><div class="line">       +[no]showsearch</div><div class="line">           Perform [do <span class="keyword">not</span> perform] a search showing intermediate results.</div><div class="line"></div><div class="line">       +[no]defname</div><div class="line">           Deprecated, treated <span class="keyword">as</span> a synonym <span class="keyword">for</span> +[no]search</div><div class="line"></div><div class="line">       +[no]aaonly</div><div class="line">           Sets <span class="keyword">the</span> <span class="string">"aa"</span> flag <span class="keyword">in</span> <span class="keyword">the</span> query.</div><div class="line"></div><div class="line">       +[no]aaflag</div><div class="line">           A synonym <span class="keyword">for</span> +[no]aaonly.</div><div class="line"></div><div class="line">       +[no]adflag</div><div class="line">           Set [do <span class="keyword">not</span> <span class="keyword">set</span>] <span class="keyword">the</span> AD (authentic data) bit <span class="keyword">in</span> <span class="keyword">the</span> query. This requests <span class="keyword">the</span> server <span class="keyword">to</span> <span class="literal">return</span> whether all <span class="keyword">of</span> <span class="keyword">the</span> answer</div><div class="line">           <span class="keyword">and</span> authority sections have all been validated <span class="keyword">as</span> secure according <span class="keyword">to</span> <span class="keyword">the</span> security policy <span class="keyword">of</span> <span class="keyword">the</span> server. AD=<span class="number">1</span> indicates</div><div class="line">           <span class="keyword">that</span> all records have been validated <span class="keyword">as</span> secure <span class="keyword">and</span> <span class="keyword">the</span> answer <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">from</span> a OPT-OUT range. AD=<span class="number">0</span> indicate <span class="keyword">that</span> <span class="keyword">some</span> part</div><div class="line">           <span class="keyword">of</span> <span class="keyword">the</span> answer was insecure <span class="keyword">or</span> <span class="keyword">not</span> validated.</div><div class="line"></div><div class="line">       +[no]cdflag</div><div class="line">           Set [do <span class="keyword">not</span> <span class="keyword">set</span>] <span class="keyword">the</span> CD (checking disabled) bit <span class="keyword">in</span> <span class="keyword">the</span> query. This requests <span class="keyword">the</span> server <span class="keyword">to</span> <span class="keyword">not</span> perform DNSSEC validation</div><div class="line">           <span class="keyword">of</span> responses.</div><div class="line"></div><div class="line">       +[no]cl</div><div class="line">           Display [do <span class="keyword">not</span> display] <span class="keyword">the</span> CLASS when printing <span class="keyword">the</span> <span class="built_in">record</span>.</div><div class="line"></div><div class="line">       +[no]ttlid</div><div class="line">           Display [do <span class="keyword">not</span> display] <span class="keyword">the</span> TTL when printing <span class="keyword">the</span> <span class="built_in">record</span>.</div><div class="line"></div><div class="line">       +[no]recurse</div><div class="line">           Toggle <span class="keyword">the</span> setting <span class="keyword">of</span> <span class="keyword">the</span> RD (recursion desired) bit <span class="keyword">in</span> <span class="keyword">the</span> query. This bit <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">by</span> default, which means dig normally</div><div class="line">           sends recursive queries. Recursion <span class="keyword">is</span> automatically disabled when <span class="keyword">the</span> +nssearch <span class="keyword">or</span> +trace query options are used.</div><div class="line"></div><div class="line">       +[no]nssearch</div><div class="line">           When this option <span class="keyword">is</span> <span class="keyword">set</span>, dig attempts <span class="keyword">to</span> find <span class="keyword">the</span> authoritative <span class="built_in">name</span> servers <span class="keyword">for</span> <span class="keyword">the</span> zone containing <span class="keyword">the</span> <span class="built_in">name</span> being</div><div class="line">           looked up <span class="keyword">and</span> display <span class="keyword">the</span> SOA <span class="built_in">record</span> <span class="keyword">that</span> each <span class="built_in">name</span> server has <span class="keyword">for</span> <span class="keyword">the</span> zone.</div><div class="line"></div><div class="line">       +[no]trace</div><div class="line">           Toggle tracing <span class="keyword">of</span> <span class="keyword">the</span> delegation path <span class="keyword">from</span> <span class="keyword">the</span> root <span class="built_in">name</span> servers <span class="keyword">for</span> <span class="keyword">the</span> <span class="built_in">name</span> being looked up. Tracing <span class="keyword">is</span> disabled <span class="keyword">by</span></div><div class="line">           default. When tracing <span class="keyword">is</span> enabled, dig makes iterative queries <span class="keyword">to</span> resolve <span class="keyword">the</span> <span class="built_in">name</span> being looked up. It will follow</div><div class="line">           referrals <span class="keyword">from</span> <span class="keyword">the</span> root servers, showing <span class="keyword">the</span> answer <span class="keyword">from</span> each server <span class="keyword">that</span> was used <span class="keyword">to</span> resolve <span class="keyword">the</span> lookup.</div><div class="line"></div><div class="line">       +[no]cmd</div><div class="line">           Toggles <span class="keyword">the</span> printing <span class="keyword">of</span> <span class="keyword">the</span> initial comment <span class="keyword">in</span> <span class="keyword">the</span> output identifying <span class="keyword">the</span> <span class="built_in">version</span> <span class="keyword">of</span> dig <span class="keyword">and</span> <span class="keyword">the</span> query options <span class="keyword">that</span></div><div class="line">           have been applied. This comment <span class="keyword">is</span> printed <span class="keyword">by</span> default.</div><div class="line"></div><div class="line">       +[no]short</div><div class="line">           Provide a terse answer. The default <span class="keyword">is</span> <span class="keyword">to</span> print <span class="keyword">the</span> answer <span class="keyword">in</span> a verbose form.</div><div class="line"></div><div class="line">       +[no]identify</div><div class="line">           Show [<span class="keyword">or</span> do <span class="keyword">not</span> show] <span class="keyword">the</span> IP address <span class="keyword">and</span> port <span class="built_in">number</span> <span class="keyword">that</span> supplied <span class="keyword">the</span> answer when <span class="keyword">the</span> +short option <span class="keyword">is</span> enabled. If</div><div class="line">           short form answers are requested, <span class="keyword">the</span> default <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">to</span> show <span class="keyword">the</span> source address <span class="keyword">and</span> port <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">the</span> server <span class="keyword">that</span></div><div class="line">           provided <span class="keyword">the</span> answer.</div><div class="line"></div><div class="line">       +[no]comments</div><div class="line">           Toggle <span class="keyword">the</span> display <span class="keyword">of</span> comment lines <span class="keyword">in</span> <span class="keyword">the</span> output. The default <span class="keyword">is</span> <span class="keyword">to</span> print comments.</div><div class="line"></div><div class="line">       +[no]stats</div><div class="line">           This query option toggles <span class="keyword">the</span> printing <span class="keyword">of</span> statistics: when <span class="keyword">the</span> query was made, <span class="keyword">the</span> size <span class="keyword">of</span> <span class="keyword">the</span> reply <span class="keyword">and</span> so <span class="keyword">on</span>. The</div><div class="line">           default behavior <span class="keyword">is</span> <span class="keyword">to</span> print <span class="keyword">the</span> query statistics.</div><div class="line"></div><div class="line">       +[no]qr</div><div class="line">           Print [do <span class="keyword">not</span> print] <span class="keyword">the</span> query <span class="keyword">as</span> <span class="keyword">it</span> <span class="keyword">is</span> sent. By default, <span class="keyword">the</span> query <span class="keyword">is</span> <span class="keyword">not</span> printed.</div><div class="line"></div><div class="line">       +[no]question</div><div class="line">           Print [do <span class="keyword">not</span> print] <span class="keyword">the</span> question section <span class="keyword">of</span> a query when an answer <span class="keyword">is</span> returned. The default <span class="keyword">is</span> <span class="keyword">to</span> print <span class="keyword">the</span> question</div><div class="line">           section <span class="keyword">as</span> a comment.</div><div class="line"></div><div class="line">       +[no]answer</div><div class="line">           Display [do <span class="keyword">not</span> display] <span class="keyword">the</span> answer section <span class="keyword">of</span> a reply. The default <span class="keyword">is</span> <span class="keyword">to</span> display <span class="keyword">it</span>.</div><div class="line"></div><div class="line">       +[no]authority</div><div class="line">           Display [do <span class="keyword">not</span> display] <span class="keyword">the</span> authority section <span class="keyword">of</span> a reply. The default <span class="keyword">is</span> <span class="keyword">to</span> display <span class="keyword">it</span>.</div><div class="line"></div><div class="line">       +[no]additional</div><div class="line">           Display [do <span class="keyword">not</span> display] <span class="keyword">the</span> additional section <span class="keyword">of</span> a reply. The default <span class="keyword">is</span> <span class="keyword">to</span> display <span class="keyword">it</span>.</div><div class="line"></div><div class="line">       +[no]all</div><div class="line">           Set <span class="keyword">or</span> clear all display flags.</div><div class="line"></div><div class="line">       +<span class="built_in">time</span>=T</div><div class="line">           Sets <span class="keyword">the</span> <span class="keyword">timeout</span> <span class="keyword">for</span> a query <span class="keyword">to</span> T seconds. The default <span class="keyword">timeout</span> <span class="keyword">is</span> <span class="number">5</span> seconds. An attempt <span class="keyword">to</span> <span class="keyword">set</span> T <span class="keyword">to</span> <span class="keyword">less than</span> <span class="number">1</span> will</div><div class="line">           <span class="literal">result</span> <span class="keyword">in</span> a query <span class="keyword">timeout</span> <span class="keyword">of</span> <span class="number">1</span> <span class="keyword">second</span> being applied.</div><div class="line"></div><div class="line">       +tries=T</div><div class="line">           Sets <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">times</span> <span class="keyword">to</span> <span class="keyword">try</span> UDP queries <span class="keyword">to</span> server <span class="keyword">to</span> T <span class="keyword">instead of</span> <span class="keyword">the</span> default, <span class="number">3.</span> If T <span class="keyword">is</span> <span class="keyword">less than or equal</span> <span class="keyword">to</span></div><div class="line">           zero, <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> tries <span class="keyword">is</span> silently rounded up <span class="keyword">to</span> <span class="number">1.</span></div><div class="line"></div><div class="line">       +retry=T</div><div class="line">           Sets <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">times</span> <span class="keyword">to</span> retry UDP queries <span class="keyword">to</span> server <span class="keyword">to</span> T <span class="keyword">instead of</span> <span class="keyword">the</span> default, <span class="number">2.</span> Unlike +tries, this <span class="keyword">does</span> <span class="keyword">not</span></div><div class="line">           include <span class="keyword">the</span> initial query.</div><div class="line"></div><div class="line">       +ndots=D</div><div class="line">           Set <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> dots <span class="keyword">that</span> have <span class="keyword">to</span> appear <span class="keyword">in</span> <span class="built_in">name</span> <span class="keyword">to</span> D <span class="keyword">for</span> <span class="keyword">it</span> <span class="keyword">to</span> be considered absolute. The default value <span class="keyword">is</span> <span class="keyword">that</span></div><div class="line">           defined using <span class="keyword">the</span> ndots statement <span class="keyword">in</span> /etc/resolv.conf, <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">if</span> no ndots statement <span class="keyword">is</span> present. Names <span class="keyword">with</span> fewer dots are</div><div class="line">           interpreted <span class="keyword">as</span> relative names <span class="keyword">and</span> will be searched <span class="keyword">for</span> <span class="keyword">in</span> <span class="keyword">the</span> domains listed <span class="keyword">in</span> <span class="keyword">the</span> search <span class="keyword">or</span> domain directive <span class="keyword">in</span></div><div class="line">           /etc/resolv.conf.</div><div class="line"></div><div class="line">       +bufsize=B</div><div class="line">           Set <span class="keyword">the</span> UDP message buffer size advertised using EDNS0 <span class="keyword">to</span> B bytes. The maximum <span class="keyword">and</span> minimum sizes <span class="keyword">of</span> this buffer are</div><div class="line">           <span class="number">65535</span> <span class="keyword">and</span> <span class="number">0</span> respectively. Values outside this range are rounded up <span class="keyword">or</span> down appropriately. Values other than zero will</div><div class="line">           cause a EDNS query <span class="keyword">to</span> be sent.</div><div class="line"></div><div class="line">       +edns=<span class="comment">#</span></div><div class="line">           Specify <span class="keyword">the</span> EDNS <span class="built_in">version</span> <span class="keyword">to</span> query <span class="keyword">with</span>. Valid values are <span class="number">0</span> <span class="keyword">to</span> <span class="number">255.</span> Setting <span class="keyword">the</span> EDNS <span class="built_in">version</span> will cause a EDNS query <span class="keyword">to</span></div><div class="line">           be sent.  +noedns clears <span class="keyword">the</span> remembered EDNS <span class="built_in">version</span>.</div><div class="line"></div><div class="line">       +[no]multiline</div><div class="line">           Print records like <span class="keyword">the</span> SOA records <span class="keyword">in</span> a verbose multi-line format <span class="keyword">with</span> human-readable comments. The default <span class="keyword">is</span> <span class="keyword">to</span> print</div><div class="line">           each <span class="built_in">record</span> <span class="keyword">on</span> a single line, <span class="keyword">to</span> facilitate machine parsing <span class="keyword">of</span> <span class="keyword">the</span> dig output.</div><div class="line"></div><div class="line">       +[no]onesoa</div><div class="line">           Print only one (starting) SOA <span class="built_in">record</span> when performing an AXFR. The default <span class="keyword">is</span> <span class="keyword">to</span> print both <span class="keyword">the</span> starting <span class="keyword">and</span> ending SOA</div><div class="line">           records.</div><div class="line"></div><div class="line">       +[no]fail</div><div class="line">           Do <span class="keyword">not</span> <span class="keyword">try</span> <span class="keyword">the</span> next server <span class="keyword">if</span> you receive a SERVFAIL. The default <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> <span class="keyword">try</span> <span class="keyword">the</span> next server which <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">reverse</span> <span class="keyword">of</span></div><div class="line">           normal stub resolver behavior.</div><div class="line"></div><div class="line">       +[no]besteffort</div><div class="line">           Attempt <span class="keyword">to</span> display <span class="keyword">the</span> <span class="built_in">contents</span> <span class="keyword">of</span> messages which are malformed. The default <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">not</span> display malformed answers.</div><div class="line"></div><div class="line">       +[no]dnssec</div><div class="line">           Requests DNSSEC records be sent <span class="keyword">by</span> setting <span class="keyword">the</span> DNSSEC OK bit (DO) <span class="keyword">in</span> <span class="keyword">the</span> OPT <span class="built_in">record</span> <span class="keyword">in</span> <span class="keyword">the</span> additional section <span class="keyword">of</span> <span class="keyword">the</span></div><div class="line">           query.</div><div class="line"></div><div class="line">       +[no]sigchase</div><div class="line">           Chase DNSSEC signature chains. Requires dig be compiled <span class="keyword">with</span> -DDIG_SIGCHASE.</div><div class="line"></div><div class="line">       +trusted-key=<span class="comment">####</span></div><div class="line">           Specifies a <span class="built_in">file</span> containing trusted keys <span class="keyword">to</span> be used <span class="keyword">with</span> +sigchase. Each DNSKEY <span class="built_in">record</span> must be <span class="keyword">on</span> <span class="keyword">its</span> own line.</div><div class="line"></div><div class="line">           If <span class="keyword">not</span> specified, dig will look <span class="keyword">for</span> /etc/trusted-key.key <span class="keyword">then</span> trusted-key.key <span class="keyword">in</span> <span class="keyword">the</span> current directory.</div><div class="line"></div><div class="line">           Requires dig be compiled <span class="keyword">with</span> -DDIG_SIGCHASE.</div><div class="line"></div><div class="line">       +[no]topdown</div><div class="line">           When chasing DNSSEC signature chains perform a top-down validation. Requires dig be compiled <span class="keyword">with</span> -DDIG_SIGCHASE.</div><div class="line"></div><div class="line">       +[no]nsid</div><div class="line">           Include an EDNS <span class="built_in">name</span> server ID request when sending a query.</div><div class="line"></div><div class="line">MULTIPLE QUERIES</div><div class="line">       The BIND <span class="number">9</span> implementation <span class="keyword">of</span> dig supports specifying multiple queries <span class="keyword">on</span> <span class="keyword">the</span> command line (<span class="keyword">in</span> addition <span class="keyword">to</span> supporting <span class="keyword">the</span> -f</div><div class="line">       batch <span class="built_in">file</span> option). Each <span class="keyword">of</span> those queries can be supplied <span class="keyword">with</span> <span class="keyword">its</span> own <span class="keyword">set</span> <span class="keyword">of</span> flags, options <span class="keyword">and</span> query options.</div><div class="line"></div><div class="line">       In this case, each query argument represent an individual query <span class="keyword">in</span> <span class="keyword">the</span> command-line syntax described <span class="keyword">above</span>. Each consists</div><div class="line">       <span class="keyword">of</span> any <span class="keyword">of</span> <span class="keyword">the</span> standard options <span class="keyword">and</span> flags, <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">to</span> be looked up, an optional query type <span class="keyword">and</span> <span class="built_in">class</span> <span class="keyword">and</span> any query options</div><div class="line">       <span class="keyword">that</span> should be applied <span class="keyword">to</span> <span class="keyword">that</span> query.</div><div class="line"></div><div class="line">       A <span class="keyword">global</span> <span class="keyword">set</span> <span class="keyword">of</span> query options, which should be applied <span class="keyword">to</span> all queries, can also be supplied. These <span class="keyword">global</span> query options</div><div class="line">       must precede <span class="keyword">the</span> <span class="keyword">first</span> tuple <span class="keyword">of</span> <span class="built_in">name</span>, <span class="built_in">class</span>, type, options, flags, <span class="keyword">and</span> query options supplied <span class="keyword">on</span> <span class="keyword">the</span> command line. Any</div><div class="line">       <span class="keyword">global</span> query options (except <span class="keyword">the</span> +[no]cmd option) can be overridden <span class="keyword">by</span> a query-specific <span class="keyword">set</span> <span class="keyword">of</span> query options. For example:</div><div class="line"></div><div class="line">           dig +qr www.isc.org any -x <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> isc.org ns +noqr</div><div class="line"></div><div class="line">       shows how dig could be used <span class="keyword">from</span> <span class="keyword">the</span> command line <span class="keyword">to</span> make three lookups: an ANY query <span class="keyword">for</span> www.isc.org, a <span class="built_in">reverse</span> lookup <span class="keyword">of</span></div><div class="line">       <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">and</span> a query <span class="keyword">for</span> <span class="keyword">the</span> NS records <span class="keyword">of</span> isc.org. A <span class="keyword">global</span> query option <span class="keyword">of</span> +qr <span class="keyword">is</span> applied, so <span class="keyword">that</span> dig shows <span class="keyword">the</span> initial</div><div class="line">       query <span class="keyword">it</span> made <span class="keyword">for</span> each lookup. The final query has a <span class="keyword">local</span> query option <span class="keyword">of</span> +noqr which means <span class="keyword">that</span> dig will <span class="keyword">not</span> print <span class="keyword">the</span></div><div class="line">       initial query when <span class="keyword">it</span> looks up <span class="keyword">the</span> NS records <span class="keyword">for</span> isc.org.</div><div class="line"></div><div class="line">IDN SUPPORT</div><div class="line">       If dig has been built <span class="keyword">with</span> IDN (internationalized domain <span class="built_in">name</span>) support, <span class="keyword">it</span> can accept <span class="keyword">and</span> display non-ASCII domain names.</div><div class="line">       dig appropriately converts <span class="built_in">character</span> encoding <span class="keyword">of</span> domain <span class="built_in">name</span> <span class="keyword">before</span> sending a request <span class="keyword">to</span> DNS server <span class="keyword">or</span> displaying a reply</div><div class="line">       <span class="keyword">from</span> <span class="keyword">the</span> server. If you'd like <span class="keyword">to</span> turn off <span class="keyword">the</span> IDN support <span class="keyword">for</span> <span class="keyword">some</span> reason, defines <span class="keyword">the</span> IDN_DISABLE environment variable.</div><div class="line">       The IDN support <span class="keyword">is</span> disabled <span class="keyword">if</span> <span class="keyword">the</span> variable <span class="keyword">is</span> <span class="keyword">set</span> when dig runs.</div><div class="line"></div><div class="line">FILES</div><div class="line">       /etc/resolv.conf</div><div class="line"></div><div class="line">       $&#123;HOME&#125;/.digrc</div><div class="line"></div><div class="line">SEE ALSO</div><div class="line">       host(<span class="number">1</span>), named(<span class="number">8</span>), dnssec-keygen(<span class="number">8</span>), RFC1035.</div><div class="line"></div><div class="line">BUGS</div><div class="line">       There are probably too many query options.</div><div class="line"></div><div class="line">COPYRIGHT</div><div class="line">       Copyright (C) <span class="number">2004</span><span class="number">-2010</span> Internet Systems Consortium, Inc. (<span class="string">"ISC"</span>)</div><div class="line">       Copyright (C) <span class="number">2000</span><span class="number">-2003</span> Internet Software Consortium.</div></pre></td></tr></table></figure>
<h2 id="dig_+short">dig +short</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-<span class="string">MBP:</span>~ Lyn$ dig +<span class="keyword">short</span>  googlevideo.com</div><div class="line"><span class="number">172.217</span><span class="number">.25</span><span class="number">.228</span></div></pre></td></tr></table></figure>
<h2 id="dig_+nocmd">dig +nocmd</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">Lyn-Cheung-MBP:~ Lyn$ <span class="keyword">dig </span>+nocmd @<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">1</span> www.google.com</div><div class="line"><span class="comment">;; Got answer:</span></div><div class="line"><span class="comment">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 51997</span></div><div class="line"><span class="comment">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></div><div class="line"></div><div class="line"><span class="comment">;; QUESTION SECTION:</span></div><div class="line"><span class="comment">;www.google.com.			IN	A</span></div><div class="line"></div><div class="line"><span class="comment">;; ANSWER SECTION:</span></div><div class="line">www.google.com.		<span class="number">900</span>	IN	A	<span class="number">216</span>.<span class="number">58</span>.<span class="number">200</span>.<span class="number">196</span></div><div class="line"></div><div class="line"><span class="comment">;; Query time: 274 msec</span></div><div class="line"><span class="comment">;; SERVER: 192.168.2.1#53(192.168.2.1)</span></div><div class="line"><span class="comment">;; WHEN: Sun Jun 26 19:32:49 2016</span></div><div class="line"><span class="comment">;; MSG SIZE  rcvd: 48</span></div></pre></td></tr></table></figure>
<h2 id="dig_-q">dig -q</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:~ Lyn$ <span class="keyword">dig </span>-q  www.google.com</div><div class="line"></div><div class="line"><span class="comment">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; -q www.google.com</span></div><div class="line"><span class="comment">;; global options: +cmd</span></div><div class="line"><span class="comment">;; Got answer:</span></div><div class="line"><span class="comment">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31256</span></div><div class="line"><span class="comment">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></div><div class="line"></div><div class="line"><span class="comment">;; QUESTION SECTION:</span></div><div class="line"><span class="comment">;www.google.com.			IN	A</span></div><div class="line"></div><div class="line"><span class="comment">;; ANSWER SECTION:</span></div><div class="line">www.google.com.		<span class="number">839</span>	IN	A	<span class="number">216</span>.<span class="number">58</span>.<span class="number">200</span>.<span class="number">196</span></div><div class="line"></div><div class="line"><span class="comment">;; Query time: 0 msec</span></div><div class="line"><span class="comment">;; SERVER: 192.168.2.1#53(192.168.2.1)</span></div><div class="line"><span class="comment">;; WHEN: Sun Jun 26 19:33:50 2016</span></div><div class="line"><span class="comment">;; MSG SIZE  rcvd: 48</span></div></pre></td></tr></table></figure>
<h2 id="dig_+tcp">dig +tcp</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line"></div><div class="line"><span class="mipsasm">Lyn-Cheung-MBP:~ Lyn$ <span class="keyword">dig </span>+tcp www.google.com</span></div><div class="line"></div><div class="line"><span class="comment">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; +tcp www.google.com</span></div><div class="line"><span class="comment">;; global options: +cmd</span></div><div class="line"><span class="comment">;; Got answer:</span></div><div class="line"><span class="comment">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41777</span></div><div class="line"><span class="comment">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></div><div class="line"></div><div class="line"><span class="comment">;; QUESTION SECTION:</span></div><div class="line"><span class="comment">;www.google.com.			IN	A</span></div><div class="line"></div><div class="line"><span class="comment">;; ANSWER SECTION:</span></div><div class="line">www.google.com.		<span class="number">744</span>	IN	A	<span class="number">216</span>.<span class="number">58</span>.<span class="number">200</span>.<span class="number">196</span></div><div class="line"></div><div class="line"><span class="comment">;; Query time: 5 msec</span></div><div class="line"><span class="comment">;; SERVER: 192.168.2.1#53(192.168.2.1)</span></div><div class="line"><span class="comment">;; WHEN: Sun Jun 26 19:35:25 2016</span></div><div class="line"><span class="comment">;; MSG SIZE  rcvd: 48</span></div></pre></td></tr></table></figure>
<h2 id="dig_+trace">dig +trace</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP:~ Lyn$ dig +trace @<span class="number">192.168.2.1</span> gooogle.com</div><div class="line"></div><div class="line"><span class="comment">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; +trace @192.168.2.1 gooogle.com</span></div><div class="line"><span class="comment">; (1 server found)</span></div><div class="line"><span class="comment">;; global options: +cmd</span></div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	a.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	b.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	c.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	d.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	e.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	f.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	g.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	h.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	i.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	j.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	k.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	l.root-servers.net.</div><div class="line">.			<span class="number">59872</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	m.root-servers.net.</div><div class="line"><span class="comment">;; Received 228 bytes from 192.168.2.1#53(192.168.2.1) in 4778 ms</span></div><div class="line"></div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	a.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	b.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	c.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	d.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	e.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	f.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	g.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	h.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	i.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	j.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	k.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	l.gtld-servers.net.</div><div class="line">com.			<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	m.gtld-servers.net.</div><div class="line"><span class="comment">;; Received 489 bytes from 198.97.190.53#53(198.97.190.53) in 932 ms</span></div><div class="line"></div><div class="line">gooogle.com.		<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	ns2.google.com.</div><div class="line">gooogle.com.		<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	ns1.google.com.</div><div class="line">gooogle.com.		<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	ns3.google.com.</div><div class="line">gooogle.com.		<span class="number">172800</span>	<span class="keyword">IN</span>	<span class="keyword">NS</span>	ns4.google.com.</div><div class="line"><span class="comment">;; Received 172 bytes from 192.31.80.30#53(192.31.80.30) in 1347 ms</span></div><div class="line"></div><div class="line">gooogle.com.		<span class="number">300</span>	<span class="keyword">IN</span>	<span class="keyword">A</span>	<span class="number">216.58.203.36</span></div><div class="line"><span class="comment">;; Received 45 bytes from 216.239.38.10#53(216.239.38.10) in 217 ms</span></div></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/06/09/ios8-cors-prefilght/" itemprop="url">
                  iOS8下CORS请求返回504错误的Dubug记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-09T23:53:46+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/ios8-cors-prefilght/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/ios8-cors-prefilght/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>放假前遇到一个奇葩的问题,做了一个移动端使用原生JS写的一个互动的的web页面,这个页面需要通过ajax调用对后台的接口,结果出现了很诡异的现象:</p>
<blockquote>
<p>在Chrome浏览器上模拟手机或者是在安卓上都可以请求到后台的数据,但是在公司几台iOS的测试机(因为不想升级OS和xcode所以都还是iOS8的版本)上请求后台数据的时候,在Safari的开发调试中都会看到,http请求都会返回一个504网关超时的报错(然后还提示是CORS错误).具体现象就是请求发出去一分钟以后超时,返回504错误.</p>
</blockquote>
<h1 id="Debug过程:">Debug过程:</h1><h2 id="第一步_排除后台原因">第一步 排除后台原因</h2><p>因为上午的时候就发现了后台接口返回的<code>ResponseHeader</code>里没有对cors header的 <code>access-control-allow-origin</code>属性进行配置,导致请求接口被拒绝的情况,所以先怀疑是后台服务器的在中午更新之后又出了什么问题.</p>
<p>于是就让后台查一下服务器日志,看是不是接收到了这个请求(但是他们告诉我没有这个请求的日志).所以他们认为我这边请求没有发出来.(而且安卓都可以只有iOS不行,他们就觉得更不可能是他们的问题了)</p>
<ul>
<li>结论: 可能和他们没有关系.</li>
</ul>
<h2 id="第二步_排除iOS代码原因">第二步 排除iOS代码原因</h2><p>当时因为JS和iOS之间的调用接口是使用的是github上的开源库”WebViewJavascriptBridge”实现的.而这个库的原理就是在web页面中建立带有特定Url连接的iframe,然后在iOS端用webview的delegate来拦截带有特定标志的请求作为调用信号的.<br>所以就找到iOS开发的同学,问他们是不是有这种不正确的拦截的可能,以及是不是在他们代码中有其他的拦截http请求的设置? 答案也是没有.他们认为是我的代码有兼容性问题,或者是后台的问题.</p>
<p>这时候为了排除是不是iOS APP拦截造成的,于是就把web页面的url放进iPhone的Safari浏览器里运行,结果还是相同的504错误!这时候为了排除是App的干扰,索性把设备上的App都删掉了结果还是相同的错误!这说明确实不是iOS APP代码造成的!于是我又在自己的iPhone上的Safari中进行同样的测试,结果发现错误消失了!</p>
<ul>
<li>结论: 确实不是iOS APP代码的问题!</li>
</ul>
<h2 id="第三步_抓包分析">第三步 抓包分析</h2><p>这时候为了验证我的请求确实是发出了,就使用了Charles进行抓包(在iPhone的wifi中设置Charles的proxy代理地址),结果发现在公司的测试机上确实是有发出了一个请求,但是请求类型却是OPTIONS.然后Http请求就一直等待返回然后就超时了! 这时候后这个坑才要浮现出他的真面目!</p>
<h1 id="原因分析">原因分析</h1><ol>
<li>原来我们公司的服务器是基于Apache Mina Server(一个网络通信应用框架)自己开发的一个关网服务器来对Http请求进行处理,然而他们在实现中只接受post的Http请求!所以当接收到一个Options的请求的时候,当然置之不理了!更别说会在日志中记录这次请求!!!</li>
<li><p>那为什么我的ajax里面明明是post请求但在iOS8为什么发出的却是OPTIONS请求呢?!</p>
<p>查资料得知:原来都是<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="external">预请求(preflight)</a>挖的坑.</p>
</li>
</ol>
<blockquote>
<p>跨源资源共享标准通过新增一系列 HTTP 头，让服务器能声明哪些来源可以通过浏览器访问该服务器上的资源。另外，对那些会对服务器数据造成破坏性影响的 HTTP 请求方法（特别是 GET 以外的 HTTP 方法，或者搭配某些MIME类型的POST请求），标准强烈要求浏览器必须先以 OPTIONS 请求方式发送一个预请求(preflight request)，从而获知服务器端对跨源请求所支持 HTTP 方法。在确认服务器允许该跨源请求的情况下，以实际的 HTTP 请求方法发送那个真正的请求。服务器端也可以通知客户端，是不是需要随同请求一起发送信用信息（包括 Cookies 和 HTTP 认证相关数据）。</p>
</blockquote>
<p>那为什么在iOS9下就不存在这个问题呢? 还要抓包分析才能知道了.</p>
<p>正确的预请求和响应:</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-12/81504459.jpg" alt=""></p>
<h2 id="iOS8中web页面的CORS_http请求过程:">iOS8中web页面的CORS http请求过程:</h2><figure class="highlight ldif"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">//OPTIONS 请求</div><div class="line"><span class="attribute">OPTIONS /editor/get_info' HTTP/1.1</span></div><div class="line">Host: 192.168.8.64:5555</div><div class="line"><span class="attribute">Accept-Language</span>: zh-cn</div><div class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (iPhone; CPU iPhone OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H321 Safari/600.1.4</div><div class="line"><span class="attribute">Accept</span>: */*</div><div class="line"><span class="attribute">Referer</span>: http://resource.domain.com/284671214/284671249/app.html</div><div class="line"><span class="attribute">Access-Control-Request-Method</span>: POST</div><div class="line"><span class="attribute">Connection</span>: keep-alive</div><div class="line"><span class="attribute">Access-Control-Request-Headers</span>: origin, content-type</div><div class="line"><span class="attribute">Content-Length</span>: 0</div><div class="line"><span class="attribute">Origin</span>: http://resource.domain.com/</div><div class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</div><div class="line"></div><div class="line">//服务器响应 OPTIONS请求的Header信息</div><div class="line"><span class="attribute">HTTP/1.1 200 OK</span></div><div class="line">Server: nginx/1.9.0</div><div class="line"><span class="attribute">Date</span>: Sun, 12 Jun 2016 01:58:13 GMT</div><div class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</div><div class="line"><span class="attribute">Content-Length</span>: 30</div><div class="line"><span class="attribute">Connection</span>: keep-alive</div><div class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</div><div class="line"><span class="attribute">Access-Control-Allow-Headers</span>: Origin,X-Requested-With,Content-Type,Accept</div><div class="line"><span class="attribute">Access-Control-Allow-Methods</span>: GET,POST,OPTIONS</div><div class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</div><div class="line"></div><div class="line">//接下来就是像正常的POST请求一样发送</div><div class="line"><span class="attribute">POST /editor/get_info HTTP/1.1</span></div><div class="line">Host: 192.168.8.64:5555</div><div class="line"><span class="attribute">Referer</span>: http://resource.domain.com/284671214/284671249/app.html?appId=5078b48f8dbb3b8a14e8d86df1c6691d5142</div><div class="line"><span class="attribute">Accept</span>: */*</div><div class="line"><span class="attribute">Content-Type</span>: application/xml</div><div class="line"><span class="attribute">Accept-Language</span>: zh-cn</div><div class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</div><div class="line"><span class="attribute">Origin</span>: http://resource.domain.com/</div><div class="line"><span class="attribute">Content-Length</span>: 31</div><div class="line"><span class="attribute">Connection</span>: keep-alive</div><div class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (iPhone; CPU iPhone OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H321 Safari/600.1.4</div></pre></td></tr></table></figure>
<h2 id="Chrome中web页面CORS请求">Chrome中web页面CORS请求</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">POST</span> <span class="string">/editor/get_vote_info</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: service.domain.com</div><div class="line"><span class="attribute">Connection</span>: keep-alive</div><div class="line"><span class="attribute">Content-Length</span>: 74</div><div class="line"><span class="attribute">Cache-Control</span>: max-age=0</div><div class="line"><span class="attribute">Origin</span>: http://resource.domain.com</div><div class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.23 Mobile Safari/537.36</div><div class="line"><span class="attribute">Content-Type</span>: text/plain;charset=UTF-8</div><div class="line"><span class="attribute">Accept</span>: */*</div><div class="line"><span class="attribute">Referer</span>: http://resource.domain.com/268441891/268441895/app.html?appId=ed60a4c24aae8026e96402f83e097036edff</div><div class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</div><div class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en;q=0.6,ja;q=0.4,zh-TW;q=0.2</div></pre></td></tr></table></figure>
<h2 id="iOS9中的CORS请求">iOS9中的CORS请求</h2><p>和 Chrome 一致</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Content-<span class="built_in">Type</span>:	<span class="built_in">text</span>/plain;charset=UTF-<span class="number">8</span></div></pre></td></tr></table></figure>
<h2 id="区别:">区别:</h2><p>原来都是Content-type没有设置,导致浏览器给设置了不同的content-type导致的.<br>参考w3中http1.1的关于<a href="https://www.w3.org/Protocols/rfc1341/4_Content-Type.html" target="_blank" rel="external">Content-Type</a>的定义:<br>Content-type的值必须要设置,如果没有设置的情况下会被当做”application/octet-stream”类型来处理,在这个bug中由虽然没有设置xhr的Content-Type但是浏览器设定了这个字段.</p>
<h1 id="解决方法:">解决方法:</h1><h2 id="让服务器对OPTIONS请求返回合适值">让服务器对OPTIONS请求返回合适值</h2><ol>
<li>处理OPTIONS请求</li>
<li>给OPTIONS正确的response(让浏览器知道服务器支持CORS的POST请求).<code>Access-Control-Allow-Methods: GET,POST,OPTIONS</code></li>
<li>返回正确的 <code>Access-Control-Allow-Headers: Content-Type</code></li>
</ol>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</div><div class="line"><span class="string">Server:</span> nginx/<span class="number">1.9</span><span class="number">.0</span></div><div class="line"><span class="string">Date:</span> Sun, <span class="number">12</span> Jun <span class="number">2016</span> <span class="number">01</span>:<span class="number">58</span>:<span class="number">13</span> GMT</div><div class="line">Content-<span class="string">Type:</span> text/html; charset=UTF<span class="number">-8</span></div><div class="line">Content-<span class="string">Length:</span> <span class="number">30</span></div><div class="line"><span class="string">Connection:</span> keep-alive</div><div class="line">Access-Control-Allow-<span class="string">Origin:</span> *</div><div class="line">Access-Control-Allow-<span class="string">Headers:</span> Origin,X-Requested-With,Content-Type,Accept</div><div class="line">Access-Control-Allow-<span class="string">Methods:</span> GET,POST,OPTIONS <span class="comment">//这里要接受OPTIONS </span></div><div class="line">Access-Control-Allow-<span class="string">Credentials:</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
<h2 id="设置XHR的RequestHeader">设置XHR的RequestHeader</h2><p>这里大神的书里也有偏差,道神写的书里记载着跨域的xhr的不能使用setRequestHeader.但实际上是可以的:</p>
<p>由于:</p>
<blockquote>
<p>从Gecko 2.0开始，text/plain, application/x-www-form-urlencoded 和 multipart/form-data 类型的数据都可以直接用于跨站请求，而不需要先发起“预请求”了</p>
</blockquote>
<p>所以可以把请求的类型强制设置为这三种之中的一种,但是也需要后台的接口能正确的处理这三种中的一种才可以选择这个解决方法.</p>
<h3 id="方法一:">方法一:</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">xhr = new XMLHttpRequest();</div><div class="line">xhr.open(<span class="string">"<span class="keyword">POST</span>"</span>, url, true);</div><div class="line">xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'); //模拟form提交的数据</div><div class="line">xhr.send(paramStr);</div></pre></td></tr></table></figure>
<h3 id="方法二:">方法二:</h3><p>如果是使用formData,默认是把<code>Content-Type</code>设置为:<code>multipart/form-data</code>的. 但可以使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="external">Blob</a>作为构造函数指定要生成的对象的<code>Content-Type</code> 但是比起前面一种略麻烦:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> formData = <span class="built_in">new</span> FormData();</div><div class="line">formData.<span class="built_in">append</span>(<span class="string">'items'</span>, <span class="built_in">new</span> Blob([JSON.stringify(&#123;</div><div class="line">    name: <span class="string">"Book"</span>,</div><div class="line">    quantity: <span class="string">"12"</span></div><div class="line">&#125;)], &#123;</div><div class="line">    <span class="keyword">type</span>: <span class="string">"application/x-www-form-urlencoded"</span></div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<h1 id="总结:">总结:</h1><p>如果一开始的时候就去抓包分析,只要发现了OPTIONS请求类型和我设置的不一致,再展开去查找,而不是去胡乱猜想,一定会更快找到这个bug的原因.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/30/installEsxiOnGen8/" itemprop="url">
                  Mac 环境下 Hp Gen8 microServer安装 Esxi Synology DSM
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-30T20:33:03+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/30/installEsxiOnGen8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/30/installEsxiOnGen8/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="结构设计">结构设计</h1><ul>
<li>ESXI安装在TF卡/U盘上(8gb肯定足够用了)</li>
<li>SSD上装虚拟机</li>
<li>raid1直通虚拟机作数据存储</li>
</ul>
<blockquote>
<p>esxi读取是在启动时读取一次的,启动完成后，ESXi就在内存中运行了。<br>所以Esxi直接安装在MicroSD上。安装完毕后把卡拔下来，做一个完整的克隆备份或者直接克隆一个MicroSD实体卡以备不测</p>
</blockquote>
<h1 id="HP_gen8_相关工具">HP gen8 相关工具</h1><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/8170796.jpg" alt=""></p>
<blockquote>
<p>HP Gen8有自己的一套底层的管理系统,这里先讲一个小故事:<br>Gen8是当时在淘宝上买的,结果卖家亲自开车过来送货,同时还在淘宝卖家那里买了内存条,当时就说插上看看有没有问题(卖家车上自带电源逆变器,没有显示器). 结果开机半天了都还没有听到蜂鸣器的声音,于是我们拿着Gen8去路边的打印店借用显示器看下是什么原因.结果打印店的显示器都不方便拆线,卖家就问有没有网线,只要有网线就够了.<br>结果我们就插了一根网线到Gen8的ILO console口.在浏览器上访问gen8的ip地址,用机箱上自带的账号密码就登陆上ILO管理系统.发现确实是卡在了内存自检上.于是卖家就换了一根新的内存条给我.</p>
</blockquote>
<p>这就是服务器和普通PC相比的的神奇之处了吧.即使内存条有问题,Gen8底层的管理系统也可以启动起来,然后我们就可以方便的远程连接到ILO上看到服务器当前的状况.<br>可以查看服务器的各种信息.还可以在web页面上启动.net或者Java的远程桌面.(要在ie或者Safari下面打开ILO才行.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/90646810.jpg" alt=""></p>
<p>ILO的高级功能需要输入一个license-key 可以到淘宝去购买,很便宜.</p>
<h2 id="ILO">ILO</h2><h2 id="ADM">ADM</h2><h1 id="安装_ESXI_6-0_u2">安装 ESXI 6.0 u2</h1><h2 id="准备一个USB键盘">准备一个USB键盘</h2><p>因为mac的键盘和esxi还是ilo的映射不太正确,在安装过程中会出现F11按了不能被识别的情况,这时候就需要使用直接连接在Gen8上面的物理键盘按一下F11了.</p>
<h2 id="下载HPE_Custom_Image_for_ESXi_6-0_U2">下载HPE Custom Image for ESXi 6.0 U2</h2><ul>
<li><a href="https://my.vmware.com/web/vmware/details?downloadGroup=OEM-ESXI60U2-HPE&amp;productId=491" target="_blank" rel="external">https://my.vmware.com/web/vmware/details?downloadGroup=OEM-ESXI60U2-HPE&amp;productId=491</a> </li>
<li>Version: 6.0 U2</li>
<li>Release Date:2016-04-07</li>
</ul>
<p>下载好了以后,在Windows下就是在系统里挂载这个iSO然后像下面一样的勾选.<br>然而Hp的ILO对mac支持不是很好,能运行起来但是看不见选择加载的ISO.所以变通一下:把刚下载的esxi的ISO文件作为光驱挂载在Mac的PD9里的Windows上.(是不是特别绕?)还是直接看图:<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/87630709.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/78457314.jpg" alt=""></p>
<p>然后输入GEN8 dhcp或得到的ip启动ILO.选择virtual device 加载刚才的光驱.</p>
<p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-30/79146767.jpg" alt=""></p>
<p>然后插上Usb键盘. 这时候就可以开机了</p>
<p>然后如果BIOS里的启动顺序是出厂的设置的话,那么等漫长的自检过了以后就会开始读取虚拟DVD里的镜像了.(注意 你的mac最好是使用网线,而且要和ilo在同一局域网内.不然加载会很慢,因为这里加载的iso实际上是在你的mac硬盘上的)</p>
<p>然后就会出现启动选择界面,当然选择install ESXI 然后就会开始加载了</p>
<p>加载好了以后就会要你选择安装的磁盘位置,设置管理员密码,然后就会按F11确认就开始安装了,因为ISO文件都只有300多MB所以安装的速度还是很快的.(这里为了防止装错.我是只插上了U盘其他的设备都没有接.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/83348189.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/31566859.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/41675492.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/78129151.jpg" alt=""></p>
<p>安装好了以后会提示重启.这时候就需要把网线接进Gen8的另外两个网口上了(或者其中之一),然后在管理界面就会提示你去浏览器上打开esxi的ip地址配置虚拟机.<br>接下来的就比较简单了:<br>和普通的VMware配置虚拟机没有什么区别.因为VMware的客户端只有Windows的,所以我就没有安装专业的配置客户端,而是全部都在VMware的web管理页面上操作的.对了,这个时候就需要输入你的VMwarelicense了.<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/6061113.jpg" alt=""></p>
<p>这时候就可以在开机自检的时候按F5去HPSSA(HP smart storage Administrator)中初始化你的磁盘了,如果是单块硬盘就只能加载成raid0才能识别.</p>
<h3 id="RDM">RDM</h3><p>磁盘直通,也就是把完整的一块Raid或者一块SATA 直接映射成为一个VMdk,然后虚拟机可以通过加载这个vmdk硬盘文件,实现passthrough. </p>
<p>在配置好虚拟机以后,在web管理页面或者ilo中按F2进入管理界面,启用SSH<br>然后ssh 上esxi<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ssh</span> <span class="selector-tag">root</span>@<span class="keyword">192</span>.<span class="keyword">168</span>.<span class="keyword">1</span>.<span class="keyword">222</span>(你的<span class="keyword">esxi</span>的<span class="keyword">dhcpIP</span>地址)</div></pre></td></tr></table></figure></p>
<p>然后使用以下的命令获取到你要RDM的磁盘信息</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> ls <span class="regexp">/dev/</span>disks</div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span>L0</div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">1</span></div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">5</span></div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">6</span></div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">7</span></div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">8</span></div><div class="line">mpx.<span class="string">vmhba32:</span><span class="string">C0:</span><span class="string">T0:</span><span class="string">L0:</span><span class="number">9</span></div><div class="line">naa<span class="number">.600508</span>b1001c0f178bbb175b496a3f68</div><div class="line">naa<span class="number">.600508</span><span class="string">b1001c0f178bbb175b496a3f68:</span><span class="number">1</span></div><div class="line">naa<span class="number">.600508</span>b1001c2031e2eb51ae0420a11f</div></pre></td></tr></table></figure>
<p>通过下面的命令获取到volumes下面的SSD系统盘的名称</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ls vmfs/volumes/ -l</div><div class="line">total 1792</div><div class="line">drwxr-xr-t   <span class="number"> 1 </span>root     root         <span class="number"> 2100 </span>Jul<span class="number"> 19 </span>23:57 55a7da09-6a7727f6-d50b-70106f3eb224</div><div class="line">drwxr-xr-x   <span class="number"> 1 </span>root     root            <span class="number"> 8 </span>Jan <span class="number"> 1 </span><span class="number"> 1970 </span>55a834d9-c3bb963e-218c-70106f3eb224</div><div class="line">lrwxr-xr-x   <span class="number"> 1 </span>root     root           <span class="number"> 35 </span>Jul<span class="number"> 20 </span>00:35 SSD-&gt; 55a7da09-6a7727f6-d50b-70106f3eb224</div><div class="line">drwxr-xr-x   <span class="number"> 1 </span>root     root            <span class="number"> 8 </span>Jan <span class="number"> 1 </span><span class="number"> 1970 </span>e052ace5-bc3d44fd-4b45-39d0f75d754e</div><div class="line">drwxr-xr-x   <span class="number"> 1 </span>root     root            <span class="number"> 8 </span>Jan <span class="number"> 1 </span><span class="number"> 1970 </span>f0811cef-d4c5ddf9-1088-94015e0ad7d9</div></pre></td></tr></table></figure>
<p>请自行替换磁盘（naa.xxx）、ssd系统盘（system）、虚拟磁盘文件（*.vmdk）的名称，创建成功后会在ssd系统目录下出现于磁盘容量相同的vmdk文件。然后就可以添加这个vmdk作为现有硬盘到虚拟机使用了.</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vmkfstools -z <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks/</span>naa.<span class="number">600508</span>b1001c94879db735b10944bfc2<span class="regexp">/vmfs/</span>volumes<span class="regexp">/system/</span>raid0.vmdk</div></pre></td></tr></table></figure>
<p>查看vmdk映射内容</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost:/vmfs/volumes/<span class="number">55</span>a7da09-<span class="number">6</span>a7727f6-d50b-<span class="number">70106</span>f3eb224] cat Raid1.vmdk</div><div class="line"><span class="comment"># Disk DescriptorFile</span></div><div class="line"><span class="attr">version=1</span></div><div class="line"><span class="attr">encoding="UTF-8"</span></div><div class="line"><span class="attr">CID=fffffffe</span></div><div class="line"><span class="attr">parentCID=ffffffff</span></div><div class="line"><span class="attr">isNativeSnapshot="no"</span></div><div class="line"><span class="attr">createType="vmfsPassthroughRawDeviceMap"</span></div><div class="line"></div><div class="line"><span class="comment"># Extent description</span></div><div class="line">RW <span class="number">5860467632</span> VMFSRDM <span class="string">"Raid1-rdmp.vmdk"</span></div><div class="line"></div><div class="line"><span class="comment"># The Disk Data Base</span></div><div class="line"><span class="comment">#DDB</span></div><div class="line"></div><div class="line">ddb.<span class="attr">adapterType</span> = <span class="string">"lsilogic"</span></div><div class="line">ddb.geometry.<span class="attr">cylinders</span> = <span class="string">"364797"</span></div><div class="line">ddb.geometry.<span class="attr">heads</span> = <span class="string">"255"</span></div><div class="line">ddb.geometry.<span class="attr">sectors</span> = <span class="string">"63"</span></div><div class="line">ddb.<span class="attr">longContentID</span> = <span class="string">"b1655129dd033737e3ead76ffffffffe"</span></div><div class="line">ddb.<span class="attr">uuid</span> = <span class="string">"60 00 C2 94 d1 90 d9 b1-11 6e 14 90 58 0d 39 0f"</span></div><div class="line">ddb.<span class="attr">virtualHWVersion</span> = <span class="string">"11"</span></div></pre></td></tr></table></figure>
<h3 id="RDM官方文档参考:">RDM官方文档参考:</h3><p>要使用 ESXi/ESX 主机配置本地存储上的 RDM，需要满足以下两个条件：</p>
<ul>
<li><p>候选设备必须支持 SCSI Inquiry 重要产品数据 (VPD) 页面代码 0x83，该代码用于直接寻址和与 RDM 设备通信。有关 SCSI 感知代码的详细信息，请参见 Understanding SCSI Check Conditions in VMkernel logs during rescan operations (1010244)。</p>
</li>
<li><p>候选设备必须导出可使 ESXi/ESX 主机唯一标识用作 RDM 的设备的全局序列号。<br>注意：充当 RDM 的此功能可能在一些本地控制器及其连接的存储上不可用。请联系您的硬件供应商以确认您的控制器是否支持所需条件，并寻求任何技术支持。</p>
</li>
</ul>
<p>如果您有合适的控制器，则可以将本地设备配置为 RDM。必须使用命令行界面 (CLI) 将本地存储设备配置为 RDM，无法通过 vSphere Client 执行此操作。</p>
<p>要将本地设备配置为 RDM 磁盘，请执行以下操作：<br>打开与 ESXi/ESX 主机的 SSH 会话。<br>运行以下命令列出已连接到 ESXi 主机的磁盘：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ls -l <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks</span></div></pre></td></tr></table></figure>
<p>在列表中，标识要配置为 RDM 的本地设备，并复制设备名称。</p>
<p><strong>注意</strong>：设备名称将很可能使用 t10. 前缀，类似于以下名称：<code>t10.F405E46494C4540046F455B64787D285941707D203F45765</code></p>
<p>要将设备配置为 RDM，并将 RDM 指针文件输出到您所选的目标，请运行以下命令：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vmkfstools -z <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks/</span>diskname<span class="regexp">/vmfs/</span>volumes<span class="regexp">/datastorename/</span>vmfolder<span class="regexp">/vmname.vmdk</span></div></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vmkfstools -z <span class="regexp">/vmfs/</span>devices<span class="regexp">/disks/</span>t10.F405E46494C4540046F455B64787D285941707D203F45765 <span class="regexp">/vmfs/</span>volumes<span class="regexp">/Datastore2/</span>localrdm1<span class="regexp">/localrdm1.vmdk</span></div></pre></td></tr></table></figure>
<p>注意：新创建的 RDM 指针文件的大小显示为与其映射到的裸设备相同的大小，它是一个虚拟文件，不占用任何存储空间。</p>
<p>如果已创建 RDM 指针文件，请使用 vSphere Client 将 RDM 连接到虚拟机：</p>
<ol>
<li>右键单击要将 RDM 磁盘添加到的虚拟机。</li>
<li>单击编辑设置。</li>
<li>单击添加…</li>
<li>选择硬盘。</li>
<li>选择使用现有虚拟磁盘。</li>
<li>浏览到步骤 5 中保存 RDM 指针的目录，选择 RDM 指针文件，然后单击下一步。</li>
<li>选择要将磁盘连接到的虚拟 SCSI 控制器，然后单击下一步。</li>
<li>单击完成。</li>
</ol>
<p>现在，虚拟机清单中的新硬盘应显示为映射的裸 LUN。</p>
<p><strong>注意:</strong></p>
<ul>
<li>由于此虚拟机现有已连接的本地磁盘迁移，因此无法使用 vMotion。</li>
<li>如果需要从虚拟机中移除本地 RDM 映射，只需对共享存储 RDM 应用相同步骤。在 vSphere Client 中，右键单击虚拟机，单击编辑设置，选择 RDM 然后单击从磁盘删除。此操作不会删除磁盘中的数据，而仅删除 RDM 映射文件。</li>
</ul>
<h3 id="ESXI磁盘分区(不是必须的)">ESXI磁盘分区(不是必须的)</h3><p>如果你的磁盘之前安装过别的系统导致esxi下无法正确加载 可以参考以下方法 重新分区.</p>
<p>ssh到esxi 上后使用 Fdisk 或者 esxi 提供的分区工具 可以删除原有分区,然后直接在虚拟机中进行格式化</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">[root@localhost:~] fdisk /dev/disks/naa.<span class="number">600508</span>b1001c2031e2eb51ae0420a11f</div><div class="line">Command Action</div><div class="line">a	toggle a bootable flag</div><div class="line">b	edit bsd disklabel</div><div class="line">c	toggle the dos compatibility flag</div><div class="line">d	delete a partition</div><div class="line">l	list known partition types</div><div class="line">n	add a <span class="keyword">new</span> partition</div><div class="line">o	create a <span class="keyword">new</span> empty DOS partition table</div><div class="line">p	print the partition table</div><div class="line">q	quit without saving changes</div><div class="line">s	create a <span class="keyword">new</span> empty Sun disklabel</div><div class="line">t	change a partition<span class="symbol">'s</span> system id</div><div class="line">u	change display/<span class="keyword">entry</span> units</div><div class="line">v	verify the partition table</div><div class="line">w	write table to disk <span class="keyword">and</span> <span class="keyword">exit</span></div><div class="line">x	extra functionality (experts only)</div><div class="line"></div><div class="line">[root@localhost:~] ls /vmfs/devices/disks/</div><div class="line"></div><div class="line">[root@localhost:~] partedUtil getptbl /vmfs/devices/disks/naa.<span class="number">600508</span>b1001c2031e2eb51ae0420a11f</div><div class="line">msdos</div><div class="line"><span class="number">364797</span> <span class="number">255</span> <span class="number">63</span> <span class="number">5860467632</span></div><div class="line"><span class="number">1</span> <span class="number">63</span> <span class="number">4294961684</span> <span class="number">131</span> <span class="number">0</span></div><div class="line">Usage:</div><div class="line"> Get Partitions : <span class="type">get</span> &lt;diskName&gt;</div><div class="line"> Set Partitions : <span class="type">set</span> &lt;diskName&gt; [<span class="string">"partNum startSector endSector type attr"</span>]*</div><div class="line"> Delete Partition : <span class="type">delete</span> &lt;diskName&gt; &lt;partNum&gt;</div><div class="line"> Resize Partition : <span class="type">resize</span> &lt;diskName&gt; &lt;partNum&gt; &lt;start&gt; &lt;<span class="keyword">end</span>&gt;</div><div class="line"> Get Partitions : <span class="type">getptbl</span> &lt;diskName&gt;</div><div class="line"> Set Partitions : <span class="type">setptbl</span> &lt;diskName&gt; &lt;label&gt; [<span class="string">"partNum startSector endSector type/guid attr"</span>]*</div><div class="line"> Fix Partition Table : <span class="type">fix</span> &lt;diskName&gt;</div><div class="line"> Create <span class="keyword">New</span> Label (<span class="keyword">all</span> existing data will be lost): mklabel &lt;diskName&gt; &lt;label&gt;</div><div class="line"> Show commonly used partition <span class="keyword">type</span> <span class="type">guids </span>: showGuids</div><div class="line"> Get usable first <span class="keyword">and</span> last sectors : <span class="type">getUsableSectors</span> &lt;diskName&gt;</div><div class="line"> Fix GPT Table interactively : <span class="type">fixGpt</span> &lt;diskName&gt;</div><div class="line"></div><div class="line">[root@localhost:~] partedUtil delete /vmfs/devices/disks/naa.<span class="number">600508</span>b1001c2031e2eb51ae0420a11f <span class="number">1</span></div><div class="line"></div><div class="line">[root@localhost:~] partedUtil showGuids</div><div class="line"> Partition <span class="keyword">Type</span>       <span class="type">GUID</span></div><div class="line"> vmfs                 AA31E02A400F11DB9590000C2911D1B8</div><div class="line"> vmkDiagnostic        <span class="number">9</span>D27538040AD11DBBF97000C2911D1B8</div><div class="line"> vsan                 <span class="number">381</span>CFCCC728811E092EE000C2911D0B2</div><div class="line"> virsto               <span class="number">77719</span>A0CA4A011E3A47E000C29745A24</div><div class="line"> VMware Reserved      <span class="number">9198</span>EFFC31C011DB8F78000C2911D1B8</div><div class="line"> Basic Data           EBD0A0A2B9E5443387C068B6B72699C7</div><div class="line"> Linux Swap           <span class="number">0657</span>FD6DA4AB43C484E50933C84B4F4F</div><div class="line"> Linux Lvm            E6D6D379F50744C2A23C238F2A3DF928</div><div class="line"> Linux Raid           A19D880F05FC4D3BA006743F0F84911E</div><div class="line"> Efi System           C12A7328F81F11D2BA4B00A0C93EC93B</div><div class="line"> Microsoft Reserved   E3C9E3160B5C4DB8817DF92DF00215AE</div><div class="line"> Unused <span class="keyword">Entry</span>         <span class="number">00000000000000000000000000000000</span></div></pre></td></tr></table></figure>
<h2 id="黑群辉的安装">黑群辉的安装</h2><p>到下面的网址上去下载两个文件:</p>
<blockquote>
<p>xpenology.me/downloads/</p>
</blockquote>
<ul>
<li>第一个是DSM_DS3615xs_5644.pat,这个是群辉的升级文件,一会儿在配置群辉的时候会用上.</li>
<li>第二个是XPEnoboot_DS3615xs_5.2-5644.4.vmdk的启动文件</li>
</ul>
<ol>
<li>先上传vmdk文件到服务器的磁盘上,在虚拟机里加载vmdk文件作为第二块硬盘(注意添加的时候选择现有的硬盘).</li>
<li>选择启动虚拟机</li>
<li>在群辉助手中去配置和升级DSM系统记得选择PAT文件的时候选择我们刚才下载的那个Pat文件.(不想下载群辉助手也可以直接在群辉的ip地址后面加上端口号:5000去访问web管理页面.)<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-5-29/70593634.jpg" alt=""></li>
<li>升级设置完毕以后会要求重启,这时候可能会出现黑裙启动不起来的问题,报missing operating Syetem的错.这时候检查一下虚拟机的硬盘启动顺序.或者直接删除刚才添加的第二块20mb的硬盘,按照步骤一重新添加一次群辉的启动vmdk文件.</li>
</ol>
<h3 id="加载RDM的Raid1作为数据储存">加载RDM的Raid1作为数据储存</h3><p><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/75391528.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/95718109.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/88694438.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/4528211.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/97145984.jpg" alt=""><br>Raid1就没必要检查磁盘奇偶了 因为实在太慢了…..<br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/28774652.jpg" alt=""><br><img src="http://7xnuw0.com1.z0.glb.clouddn.com/16-6-2/19661986.jpg" alt=""></p>
<h1 id="测试">测试</h1><p>上传写入速度 55mb/s 下载速度117Mb/s</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/26/addNativeJavaSciptsInterface/" itemprop="url">
                  JS与Native交互接口定义 Native JavaScipts Interface
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-26T23:05:54+08:00" content="2016-05-26">
              2016-05-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/26/addNativeJavaSciptsInterface/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/26/addNativeJavaSciptsInterface/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="技术需求:">技术需求:</h1><ul>
<li>Native代码调用webview里面的js脚本,获取返回值</li>
<li>webview中的js脚本调用本地的Native代码,获取返回值</li>
<li>Native 调用js并传递参数,获取返回值</li>
<li>Js调用 Native并传递参数,获取返回值</li>
</ul>
<h1 id="相关文档:">相关文档:</h1><h2 id="Android_:">Android :</h2><p><code>addJavascriptInterface(java.lang.Object, java.lang.String)</code></p>
<h3 id="官方文档:">官方文档:</h3><ul>
<li><code>https://developer.android.com/guide/webapps/webview.html#UsingJavaScript</code></li>
<li><code>https://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)</code></li>
</ul>
<h3 id="Android_参考文档:">Android 参考文档:</h3><ul>
<li><code>https://github.com/pedant/safe-java-js-webview-bridge</code></li>
<li><code>http://droidyue.com/blog/2014/09/20/interaction-between-java-and-javascript-in-android/index.html</code></li>
<li><code>http://rensanning.iteye.com/blog/2043049</code></li>
</ul>
<h2 id="iOS:">iOS:</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *returnvalue = [<span class="string">webViewstringByEvaluatingJavaScriptFromString:</span>@<span class="string">"your javascript code string here"</span>];</div></pre></td></tr></table></figure>
<h3 id="官方文档:-1">官方文档:</h3><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/" target="_blank" rel="external">https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/</a></li>
</ul>
<h3 id="iOS_实现参考:">iOS 实现参考:</h3><ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2013/615/" target="_blank" rel="external">https://developer.apple.com/videos/play/wwdc2013/615/</a></li>
<li><a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">https://github.com/marcuswestin/WebViewJavascriptBridge</a></li>
<li><a href="http://dukeland.hk/2013/01/28/adding-JavaScript-interface-to-uiwebview-like-android/" target="_blank" rel="external">http://dukeland.hk/2013/01/28/adding-JavaScript-interface-to-uiwebview-like-android/</a></li>
</ul>
<h1 id="技术实现示例:">技术实现示例:</h1><p>这里以Android 为例: iOS可以使用github上的Bridge库(<code>https://github.com/marcuswestin/WebViewJavascriptBridge</code>),实现类似Android的调用方法.</p>
<h2 id="新建一个_WebView">新建一个 WebView</h2><p>代码参考如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span> </div><div class="line"><span class="tag">&lt;<span class="name">WebView</span>  <span class="attr">xmlns:android</span>=<span class="string">http://schemas.android.com/apk/res/android</span></span></div><div class="line"><span class="attr">android:id</span>=<span class="string">"@+id/webview"</span>     </div><div class="line"><span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span>     </div><div class="line"><span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span></div><div class="line"> /&gt;</div></pre></td></tr></table></figure>
<p>使用 loadUrl()方法在WebView中加载web页面, 参考如下:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">WebView myWebView = (WebView) findViewById(R.id.webview)<span class="comment">; </span></div><div class="line"></div><div class="line">myWebView.loadUrl(<span class="string">"http://www.example.com"</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>记得设置外网权限:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">...</span> &gt;</span>     </div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span>     </div><div class="line">... </div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>所有的设置如上就应该可以使用了</p>
<h2 id="在_WebView_中启用JavaScript">在 WebView 中启用JavaScript</h2><p>JavaScript默认情况下是disable的需要通过设置<code>WebSettings</code>到<code>WebView</code>.<br>可以通过<code>getSettings()</code>获取到WebSettings然后设置<code>setJavaScriptEnabled()</code>.<br>示例如下:</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WebView myWebView = (<span class="name">WebView</span>) findViewById(<span class="name">R</span>.id.webview)<span class="comment">; WebSettings webSettings = myWebView.getSettings(); webSettings.setJavaScriptEnabled(true);</span></div></pre></td></tr></table></figure>
<h2 id="实现_JavaScript_代码_和_Android_代码的接口">实现 JavaScript 代码 和 Android 代码的接口</h2><p>调用<code>webview</code>的<code>addJavascriptInterface()</code>, 传入两个参数:第一个是Java中定义的class对象,第二个是javaScript中的接口对象名.</p>
<h3 id="第一步_在Android中声明被js调用的class">第一步 在Android中声明被js调用的class</h3><p>参考以下代码:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class WebAppInterface &#123;</div><div class="line"><span class="built_in">Context</span> mContext<span class="comment">;      </span></div><div class="line"><span class="comment">/** Instantiate the interface and set the context*/</span>     </div><div class="line">	WebAppInterface(<span class="built_in">Context</span> c) &#123; </div><div class="line">        		mContext = c<span class="comment">;     </span></div><div class="line">	&#125;      </div><div class="line"><span class="comment">/** Show a toast from the web page */</span>     </div><div class="line">	@<span class="keyword">JavascriptInterface </span>    </div><div class="line">	public void <span class="keyword">showToast(String </span>toast) &#123; </div><div class="line">          Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).<span class="keyword">show(); </span>    </div><div class="line"> 	&#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码说明:<code>WebAppInterface</code>这个接口绑定的对象在被js调用时传入<code>Toast</code>参数,调用这个 <code>showToast()</code>方法</p>
<p><strong>注意</strong>: </p>
<pre><code>如果你的 <span class="attr_selector">[targetSdkVersiong]</span> 高于<span class="tag">17</span> (<span class="attribute">https</span>:<span class="comment">//developer.android.com/guide/topics/manifest/uses-sdk-element.html#target), 你必须增加 @JavascriptInterface 注释 到所有你想要Js可以调用的public方法中,如果没有注释那么js在 Android 4.2 或更高的版本中不能调用到安卓的方法.</span>
</code></pre><h3 id="第二步,在webview中定义接口">第二步,在webview中定义接口</h3><p>addJavascriptInterface()定义接口为:<code>hostApp</code>, 把这个对象和webview中的JavaScript进行绑定.</p>
<p>参考代码:</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WebView webView = (<span class="name">WebView</span>) findViewById(<span class="name">R</span>.id.webview)<span class="comment">; webView.addJavascriptInterface(new WebAppInterface(this), "hostApp");</span></div></pre></td></tr></table></figure>
<p>代码说明:<br>为在webview中运行的JavaScript定义好了一个接口:<code>hostApp</code>这样js就可以调用<code>WebAppInterface</code>这个Java的方法. </p>
<h3 id="第三步,js中调用webview中定义的接口:">第三步,js中调用webview中定义的接口:</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Say hello"</span> <span class="attr">onClick</span>=<span class="string">"showAndroidToast('Hello Android!')"</span> /&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="actionscript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showAndroidToast</span><span class="params">(toast)</span> </span>&#123;</div><div class="line">         hostApp.showToast(toast);     </div><div class="line">&#125; </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>JavaScript中不需要做任何声明,直接可以使用webview中提供的<code>hostApp</code>接口.<br>当你点击input按钮时<code>showAndroidToast()</code>function会自动使用<code>hostApp</code>接口 去调用<code>WebAppInterface.showToast()</code>方法.</p>
<h2 id="Java调用JavaScript_:">Java调用JavaScript :</h2><ul>
<li>直接把要运行的js代码作为参数调用<code>loadUrl</code>方法.就可以实现调用,但注意要声明传入的参数是JavaScript.</li>
</ul>
<h3 id="代码实现:">代码实现:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">String</span> call = <span class="string">"javascript:helloWorld(1,2)"</span>;</div><div class="line">WebView.loadUrl(<span class="string">"http://www.hs.com"</span>);  </div><div class="line"></div><div class="line"><span class="comment">//先加载页面后就可以load JavaScript代码.</span></div><div class="line"></div><div class="line">WebView.loadUrl(call);    </div><div class="line">  </div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="actionscript"></span></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span><span class="params">(num1, num2)</span> </span>&#123;</div><div class="line">	   sum =num1+num2;</div><div class="line">       alert(<span class="string">"helloWord!"</span>+sum); </div><div class="line">	<span class="comment">//这里也可以在java中定义一个方法接受js返回的参数.</span></div><div class="line">	<span class="comment">//参考上面的js调用java的代码    </span></div><div class="line">&#125; </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/19/JRE-setup-doc/" itemprop="url">
                  Setup Java Eclipse Tomcat & FreeMarker on Mac
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-19T09:07:51+08:00" content="2016-05-19">
              2016-05-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/19/JRE-setup-doc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/19/JRE-setup-doc/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Install_Homebrew">Install <a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a></h2><ul>
<li>Open Terminal.</li>
<li>If you don’t already have Homebrew installed:<ul>
<li>Run command to install Homebrew.<ul>
<li><code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></li>
</ul>
</li>
</ul>
</li>
<li>Make sure that it is up to date.<ul>
<li><code>brew update</code></li>
</ul>
</li>
<li>Check that there would not be any potential problems in your system.<ul>
<li><code>brew doctor</code></li>
</ul>
</li>
<li>Upgrade Homebrew packages.<ul>
<li><code>brew upgrade</code></li>
</ul>
</li>
</ul>
<h2 id="Install_JAVA_SDK">Install JAVA SDK</h2><p>Check if Java installed</p>
<p><code>java -version</code></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Lyn-Cheung-MBP: Lyn$ <span class="keyword">java </span>-version</div><div class="line"><span class="keyword">java </span>version <span class="string">"1.7.0_79"</span></div><div class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_79-<span class="keyword">b15)</span></div><div class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">24</span>.<span class="number">79</span>-<span class="keyword">b02, </span>mixed mode)</div></pre></td></tr></table></figure>
<p>Java SE Development Kit 8 Downloads</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span>www.oracle.com<span class="regexp">/technetwork/</span>java<span class="regexp">/javase/</span>downloads<span class="regexp">/jdk8-downloads-2133151.html</span></div></pre></td></tr></table></figure>
<p>edit  <code>~/.bash_profile</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cat ~/.bash_profile</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;PATH&#125;</span>:/Development/android-sdk/tools</div><div class="line"><span class="built_in">export</span> JAVA_HOME=$(/usr/libexec/java_home)</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">export</span> path=/usr/<span class="built_in">local</span>/bin:<span class="variable">$path</span></div></pre></td></tr></table></figure>
<p>reload bash_profile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">source</span> ~/.bash_profile</div></pre></td></tr></table></figure>
<h2 id="Eclipse">Eclipse</h2><ul>
<li>Download and install latest version of <em>Eclipse IDE for Java EE developers</em> from <a href="http://www.eclipse.org/downloads/" target="_blank" rel="external">Eclipse Downloads</a></li>
</ul>
<h3 id="Set_Eclipse_to_use_the_previously_installed_version_of_Java">Set Eclipse to use the previously installed version of Java</h3><ul>
<li>If you have multiple versions of Java installed, set the Eclipse to use the version installed earlier in these instructions.</li>
<li><em>Window &gt;&gt; Preferences &gt;&gt; Java &gt;&gt; Installed JREs</em> Add the path to the Java version you installed (e.g. <em>/usr/lib/jvm/java-7-oracle (java-7-oracle)</em> )</li>
</ul>
<h2 id="Installing_Tomcat_8">Installing Tomcat 8</h2><ul>
<li><p><code>brew install tomcat</code>: <a href="http://blog.bolshchikov.net/post/50277857673/installing-tomcat-on-macos-with-homebrew" target="_blank" rel="external">Installing Tomcat on MacOS with homebrew</a></p>
<ul>
<li><code>sudo ln -s /usr/local/Cellar/tomcat/8.0.14/libexec /Library/Tomcat</code></li>
<li><code>sudo chown -R /Library/Tomcat</code></li>
<li><code>sudo chmod +x /Library/Tomcat/bin/*.sh</code></li>
</ul>
</li>
<li><p>In Eclipse:</p>
<ul>
<li><em>Eclipse &gt;&gt; Preferences</em></li>
<li><em>Server &gt;&gt; Runtime Environment</em></li>
<li>Click <em>“Add…”</em></li>
<li>Under <em>“Apache”</em> select <em>“Tomcat v8.0”</em></li>
<li>Click <em>“Next”</em></li>
<li>Click <em>“Browse…”</em></li>
<li>Select the folder where you installed Tomcat (e.g.<em>/usr/local/Cellar/tomcat/8.0.33/libexec</em>)</li>
<li>Click <em>“Finish”</em></li>
</ul>
</li>
</ul>
<h2 id="MySQL">MySQL</h2><ul>
<li>Install MySQL<ul>
<li><code>brew install mysql</code></li>
</ul>
</li>
<li>To have launchd start mysql at login:<ul>
<li><code>ln -sfv /usr/local/opt/mysql/*.plist ~/Library/LaunchAgents</code></li>
</ul>
</li>
<li>Then to load mysql now:<ul>
<li><code>launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</code></li>
</ul>
</li>
<li>Or, if you don’t want/need launchctl, you can just run:<ul>
<li><code>mysql.server start</code></li>
</ul>
</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2016/05/12/react-js-02-router/" itemprop="url">
                  react.js-Notes-02 react-router
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-05-12T20:34:25+08:00" content="2016-05-12">
              2016-05-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/12/react-js-02-router/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/12/react-js-02-router/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="install_react_router_to_your_project">install react router to your project</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> react-router <span class="comment">--save</span></div></pre></td></tr></table></figure>
<h1 id="clean_index-html">clean index.html</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">integrity</span>=<span class="string">"sha384-XYCjB+hFAjSbgf9yKUgbysEjaVLOXhCgATTEBpCqT1R3jvG5LGRAK5ZIyRbH5vpX"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Some page <span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"> <span class="selector-class">.md-scroll-mask</span> &#123; <span class="attribute">position</span>: initial;&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./scripts.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="-/js/scripts-js">./js/scripts.js</h1><p>import Router Route and IndexRoute</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</div><div class="line"><span class="keyword">import</span> &#123; Router, Route, IndexRoute, hashHistory &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> Archives  <span class="keyword">from</span> <span class="string">"./pages/Archives"</span>;</div><div class="line"><span class="keyword">import</span> Featured <span class="keyword">from</span> <span class="string">"./pages/Featured"</span>;</div><div class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"./pages/Layout"</span>;</div><div class="line"><span class="keyword">import</span> Settings <span class="keyword">from</span> <span class="string">"./pages/Settings"</span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">const</span> app = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Router</span>  <span class="attr">history</span>=<span class="string">&#123;hashHistory&#125;</span> &gt;</span></span></div><div class="line">		<span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Layout&#125;</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Featured&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">IndexRoute</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"archives(/:article)"</span>  <span class="attr">name</span>=<span class="string">"archives"</span> <span class="attr">component</span>=<span class="string">&#123;Archives&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"settings"</span>  <span class="attr">name</span>=<span class="string">"settings"</span><span class="attr">component</span>=<span class="string">&#123;Settings&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">Router</span>&gt;</span>,</div><div class="line"> app);</div></pre></td></tr></table></figure>
<h1 id="-/js/pages/">./js/pages/</h1><h2 id="-/js/pages/Layout-js">./js/pages/Layout.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> Nav <span class="keyword">from</span> <span class="string">"../components/layout/Nav"</span>;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">render() &#123;</div><div class="line">		<span class="keyword">const</span>&#123; location &#125; =<span class="keyword">this</span>.props;</div><div class="line">		<span class="keyword">const</span> containerStyle = &#123; </div><div class="line">			<span class="attr">marginTop</span>:  <span class="string">"60px"</span></div><div class="line">		&#125;;</div><div class="line">	</div><div class="line">		<span class="keyword">return</span> (</div><div class="line">			<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">Nav</span> <span class="attr">location</span> =<span class="string">&#123;location&#125;</span> /&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">style</span>=<span class="string">&#123;containerStyle&#125;</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">		          			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-12"</span>&gt;</span></div><div class="line">								<span class="tag">&lt;<span class="name">h1</span>&gt;</span> Hello World <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">								&#123;this.props.children&#125;</div><div class="line">						<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			</div><div class="line">		);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="-/js/pages/Archives-js">./js/pages/Archives.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> Article <span class="keyword">from</span> <span class="string">"../components/Article"</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Archives</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line"></div><div class="line">	render() &#123;</div><div class="line">		<span class="keyword">const</span> &#123; query &#125; = <span class="keyword">this</span>.props.location;</div><div class="line">		<span class="keyword">const</span> &#123; article &#125; = <span class="keyword">this</span>.props.params;</div><div class="line">		<span class="keyword">const</span> &#123; date, filter &#125;  = query;</div><div class="line">		<span class="comment">//console.log(this.props);</span></div><div class="line">		<span class="keyword">const</span> Articles = [</div><div class="line">			<span class="string">"Some Article"</span>,</div><div class="line">			<span class="string">"Some Other Article"</span>,</div><div class="line">			<span class="string">"Yet  Another Article "</span>,</div><div class="line">			<span class="string">"Still More"</span>,</div><div class="line">			<span class="string">"Fake Article"</span>,</div><div class="line">			<span class="string">"Partial Another  "</span>,</div><div class="line">			<span class="string">"Still More"</span>,</div><div class="line">		].map(<span class="function">(<span class="params">title, i</span>) =&gt;</span>  &lt;Article key=&#123;i&#125;  title=&#123;title&#125; /&gt; );</div><div class="line"></div><div class="line">		<span class="keyword">return</span> (</div><div class="line">			<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">h1</span>&gt;</span> Archives <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">p</span>&gt;</span>hello  this  is  archives<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">h4</span>&gt;</span>date: &#123;date&#125;, filter: &#123;filter&#125; <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>&#123;Articles&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="-/js/pages/Featured-js">./js/pages/Featured.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> Article <span class="keyword">from</span> <span class="string">"../components/Article"</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Featured</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line">	render() &#123;</div><div class="line">		<span class="keyword">const</span> Articles = [</div><div class="line">			<span class="string">"Some Article"</span>,</div><div class="line">			<span class="string">"Some Other Article"</span>,</div><div class="line">			<span class="string">"Yet  Another Article "</span>,</div><div class="line">			<span class="string">"Still More"</span>,</div><div class="line">		].map(<span class="function">(<span class="params">title, i</span>) =&gt;</span>  &lt;Article key=&#123;i&#125;  title=&#123;title&#125; /&gt; );</div><div class="line"></div><div class="line">		<span class="keyword">return</span> (</div><div class="line">			<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>&#123;Articles&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="-/js/page/Settings-js">./js/page/Settings.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Settings</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line">	render() &#123;</div><div class="line">		<span class="keyword">return</span> (</div><div class="line">			<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">h1</span>&gt;</span> Settings <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">p</span>&gt;</span>hello  this  is  Settings<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="-/js/components/layout/">./js/components/layout/</h1><h2 id="-/js/components/layout/Nav-js">./js/components/layout/Nav.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</div><div class="line"><span class="keyword">import</span> &#123; IndexLink, Link &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</div><div class="line"> </div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line">	<span class="keyword">constructor</span>()&#123;</div><div class="line">		<span class="keyword">super</span>()</div><div class="line">		<span class="keyword">this</span>.state=&#123;</div><div class="line">			<span class="attr">collapsed</span> : <span class="literal">true</span>,</div><div class="line">		&#125;;</div><div class="line">	&#125;</div><div class="line">	toggleCollapse()&#123;</div><div class="line">		<span class="keyword">const</span> collapsed = !<span class="keyword">this</span>.state.collapsed;</div><div class="line">		<span class="keyword">this</span>.setState(&#123;collapsed&#125;);</div><div class="line">	&#125;</div><div class="line">	render() &#123;</div><div class="line">		<span class="keyword">const</span> &#123; location &#125; = <span class="keyword">this</span>.props;</div><div class="line">		<span class="keyword">const</span> &#123; collapsed &#125; = <span class="keyword">this</span>.state;</div><div class="line">		<span class="keyword">const</span> featuredClass = location.pathname ===<span class="string">"/"</span> ? <span class="string">"active"</span>:<span class="string">""</span>;</div><div class="line">		<span class="keyword">const</span> archivesClass = location.pathname.match(<span class="regexp">/^\/archives/</span>) ? <span class="string">"active"</span>:<span class="string">""</span>;</div><div class="line">		<span class="keyword">const</span> settingsClass =  location.pathname.match(<span class="regexp">/^\/settings/</span>) ? <span class="string">"active"</span>:<span class="string">""</span>;</div><div class="line">		<span class="keyword">const</span> navClass = collapsed ? <span class="string">"collapse"</span> : <span class="string">""</span>;</div><div class="line">		 </div><div class="line">		<span class="keyword">return</span> (</div><div class="line">			   <span class="xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default navbar-fixed-top"</span> <span class="attr">role</span>=<span class="string">"navgation"</span>&gt;</span></span></div><div class="line">			      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">				        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span>        </div><div class="line">				          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">&#123;this.toggleCollapse.bind(this)&#125;</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">				          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">			        	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#123;</span>"<span class="attr">navbar-collapse</span> "+ <span class="attr">navClass</span>&#125; <span class="attr">id</span>=<span class="string">"navbar-main"</span>&gt;</span></div><div class="line">				          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line"></div><div class="line">					            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"&#123;featuredClass&#125;"</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">IndexLink</span> <span class="attr">to</span>=<span class="string">"/"</span>  <span class="attr">onClick</span>=<span class="string">&#123;this.toggleCollapse.bind(this)&#125;</span>&gt;</span> Featured <span class="tag">&lt;/<span class="name">IndexLink</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;/<span class="name">li</span>&gt;</span>   </div><div class="line">					            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"&#123;archivesClass&#125;"</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"archives"</span>  <span class="attr">onClick</span>=<span class="string">&#123;this.toggleCollapse.bind(this)&#125;</span>&gt;</span> Archives <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;/<span class="name">li</span>&gt;</span>   </div><div class="line">					            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"&#123;settingsClass&#125;"</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"settings"</span>  <span class="attr">onClick</span>=<span class="string">&#123;this.toggleCollapse.bind(this)&#125;</span>&gt;</span> Settings <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">					            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">	 </div><div class="line">				          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">			        	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">			      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line">			</div><div class="line">			);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="-/js/components">./js/components</h1><h2 id="-/js/components/Article-js">./js/components/Article.js</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="type">React</span> from <span class="string">"react"</span>;</div><div class="line"></div><div class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</div><div class="line">	render()&#123;</div><div class="line"></div><div class="line">		const  &#123; title &#125;= <span class="keyword">this</span>.props;</div><div class="line"></div><div class="line">	<span class="keyword">return</span>(</div><div class="line">		&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"col-md-4"</span>&gt;</div><div class="line">				&lt;h2&gt;&#123;title&#125;&lt;/h2&gt;</div><div class="line">				&lt;p&gt; <span class="type">Lorem</span> ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod</div><div class="line">					tempor incididunt ut labore et dolore magna aliqua. <span class="type">Ut</span> enim ad minim veniam,</div><div class="line">					quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo</div><div class="line">					consequat. &lt;/p&gt;</div><div class="line">				&lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn btn-default"</span> href=<span class="string">"#"</span>&gt; <span class="type">More</span> <span class="type">Info</span> &lt;/a&gt;</div><div class="line">		&lt;/div&gt;</div><div class="line">		);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
