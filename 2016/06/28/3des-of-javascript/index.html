<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />



  <meta name="description" content="Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes" />




  <meta name="keywords" content="Lyn's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用crypto-js库来实现.
由于还是想要更轻便的实现.于是最终采用了下面的实现方法(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;amp;Unicode),位运算符):
3DES 三重数据加密算法
引用自维基百科:


三重数据加密算法（Triple Data Encryption Algorithm，缩写为TD">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换">
<meta property="og:url" content="http://lyn.s76.org/2016/06/28/3des-of-javascript/index.html">
<meta property="og:site_name" content="Lyn's Blog">
<meta property="og:description" content="最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用crypto-js库来实现.
由于还是想要更轻便的实现.于是最终采用了下面的实现方法(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;amp;Unicode),位运算符):
3DES 三重数据加密算法
引用自维基百科:


三重数据加密算法（Triple Data Encryption Algorithm，缩写为TD">
<meta property="og:updated_time" content="2016-06-28T15:54:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换">
<meta name="twitter:description" content="最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用crypto-js库来实现.
由于还是想要更轻便的实现.于是最终采用了下面的实现方法(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;amp;Unicode),位运算符):
3DES 三重数据加密算法
引用自维基百科:


三重数据加密算法（Triple Data Encryption Algorithm，缩写为TD">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换 | Lyn's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36568696-2', 'auto');
  ga('send', 'pageview');

</script>








  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lyn's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Node.js Angular.js Express.js HTML5 Mongodb Programing Notes</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2016-06-28T20:39:04+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/3des-of-javascript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/3des-of-javascript/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p> 最近在工作中需要在js中使用3des加密函数.如果是在node中可以使用<a href="https://github.com/brix/crypto-js/tree/develop/src" target="_blank" rel="external">crypto-js库</a>来实现.</p>
<p>由于还是想要更轻便的实现.于是最终采用了下面的实现方法<br>(这个过程让我又好好复习了一遍字符,字符编码(ASCII&amp;Unicode),位运算符):</p>
<h1 id="3DES_三重数据加密算法">3DES 三重数据加密算法</h1><ul>
<li>引用自维基百科:</li>
</ul>
<blockquote>
<p>三重数据加密算法（Triple Data Encryption Algorithm，缩写为TDEA，Triple DEA），或称3DES（Triple DES），是一种对称密钥加密块密码，相当于是对每个数据块应用三次数据加密标准（DES）算法。由于计算机运算能力的增强，原版DES密码的密钥长度变得容易被暴力破解；3DES即是设计用来提供一种相对简单的方法，即通过增加DES的密钥长度来避免类似的攻击，而不是设计一种全新的块密码算法。</p>
</blockquote>
<h2 id="算法">算法</h2><p>3DES使用“密钥包”，其包含3个DES密钥，K1，K2和K3，均为56位（除去奇偶校验位）。加密算法为：</p>
<ul>
<li>密文 = EK3(DK2(EK1(平文)))</li>
</ul>
<p>也就是说，使用K1为密钥进行DES加密，再用K2为密钥进行DES“解密”，最后以K3进行DES加密。</p>
<p>而解密则为其反过程：</p>
<ul>
<li>平文 = DK1(EK2(DK3(密文)))<br>即以K3解密，以K2“加密”，最后以K1解密。</li>
</ul>
<p>每次加密操作都只处理64位数据，称为一块。</p>
<p>无论是加密还是解密，中间一步都是前后两步的逆。这种做法提高了使用密钥选项2时的算法强度，并在使用密钥选项3时与DES兼容。</p>
<h2 id="密钥选项">密钥选项</h2><p>标准定义了三种密钥选项：</p>
<ul>
<li>密钥选项1：三个密钥是独立的。</li>
<li>密钥选项2：K1和K2是独立的，而K3=K1</li>
<li>密钥选项3：三个密钥均相等，即K1=K2=K3</li>
<li>密钥选项1的强度最高，拥有3 x 56 = 168个独立的密钥位。</li>
</ul>
<p>密钥选项2的安全性稍低，拥有2 x 56 = 112个独立的密钥位。该选项比简单的应用DES两次的强度较高，即使用K1和K2，因为它可以防御中途相遇攻击。</p>
<p>密钥选项3等同与DES，只有56个密钥位。这个选项提供了与DES的兼容性，因为第1和第2次DES操作相互抵消了。该选项不再为国家标准科技协会（NIST）所建议[6]，亦不为ISO/IEC 18033-3所支持。</p>
<h1 id="3Des加密函数">3Des加密函数</h1><ul>
<li><p>内容采用 PKCS5Padding 方式填充，即长度以8 字节切分，不能被8 整除的末尾部分，根据长度不足8 字节的部分，填充“0x01”—“0x08”，如不足1 字节，<br>则填充1 个“0x01”，如不足2 字节，则填充2 个“0x02”，<br>以此类推，如整除，则填充8 个“0x08”；</p>
</li>
<li><p>参数：  </p>
<ol>
<li>key: 8字节字符串作为普通 DES 算法的密钥,或 24 字节字符串作为 3DES.   </li>
<li>message: 加密或解密的信息字符串.  </li>
<li>encrypt: 布尔值参数用来说明信息是加密还是解密.  </li>
<li>mode: 工作模式1:CBC模式，0:ECB模式(默认). </li>
<li>iv: 加密向量.</li>
<li>padding: 可选项, 8字节的输入向量字符串（在 ECB 模式下不使用）. </li>
</ol>
</li>
<li><p>密钥长度不足 24 字节时，右补ASCII 字符“0”；</p>
</li>
</ul>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line">function des (key, message, encrypt, mode, iv, padding) &#123;  </div><div class="line">  //declaring this locally speeds things up a bit  </div><div class="line">  var spfunction1 = new Array (<span class="number">0x1010400</span>,<span class="number">0,0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0x1010004</span>,<span class="number">0x10404</span>,<span class="number">0</span>x<span class="number">4,0x10000</span>,<span class="number">0</span>x400,<span class="number">0x1010400</span>,<span class="number">0x1010404</span>,<span class="number">0</span>x400,<span class="number">0x1000404</span>,<span class="number">0x1010004</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x<span class="number">4,0x404</span>,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0x10400</span>,<span class="number">0x10400</span>,<span class="number">0x1010000</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x10004</span>,<span class="number">0x1000004</span>,<span class="number">0x1000004</span>,<span class="number">0x10004,0</span>,<span class="number">0</span>x4<span class="number">04,0x10404</span>,<span class="number">0x1000000</span>,<span class="number">0x10000</span>,<span class="number">0x1010404</span>,<span class="number">0</span>x4,<span class="number">0x1010000</span>,<span class="number">0x1010400</span>,<span class="number">0x1000000</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x400,<span class="number">0x1010004</span>,<span class="number">0x10000</span>,<span class="number">0x10400</span>,<span class="number">0x1000004</span>,<span class="number">0</span>x<span class="number">400,0x4</span>,<span class="number">0x1000404</span>,<span class="number">0x10404</span>,<span class="number">0x1010404</span>,<span class="number">0x10004</span>,<span class="number">0x1010000</span>,<span class="number">0x1000404</span>,<span class="number">0x1000004</span>,<span class="number">0</span>x4<span class="number">04,0x10404</span>,<span class="number">0x1010400</span>,<span class="number">0</span>x404,<span class="number">0x1000400</span>,<span class="number">0x1000400</span>,<span class="number">0,0x10004</span>,<span class="number">0x10400,0</span>,<span class="number">0x1010004</span>)<span class="comment">;  </span></div><div class="line">  var spfunction2 = new Array (-<span class="number">0</span>x7fef7fe0,-<span class="number">0</span>x7fff80<span class="number">00,0x8000</span>,<span class="number">0x108020</span>,<span class="number">0x100000</span>,<span class="number">0</span>x20,-<span class="number">0</span>x7fefffe0,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7fffffe0,-<span class="number">0</span>x7fef7fe0,-<span class="number">0</span>x7fef8000,-<span class="number">0x80000000</span>,-<span class="number">0</span>x7fff80<span class="number">00,0x100000</span>,<span class="number">0</span>x20,-<span class="number">0</span>x7fefffe<span class="number">0,0x108000</span>,<span class="number">0x100020</span>,-<span class="number">0</span>x7fff7fe0,<span class="number">0</span>,-<span class="number">0x80000000</span>,<span class="number">0</span>x80<span class="number">00,0x108020</span>,-<span class="number">0</span>x7ff000<span class="number">00,0x100020</span>,-<span class="number">0</span>x7fffffe0,<span class="number">0,0x108000</span>,<span class="number">0</span>x8020,-<span class="number">0</span>x7fef8000,-<span class="number">0</span>x7ff000<span class="number">00,0x8020</span>,<span class="number">0,0x108020</span>,-<span class="number">0</span>x7fefffe<span class="number">0,0x100000</span>,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7ff00000,-<span class="number">0</span>x7fef80<span class="number">00,0x8000</span>,-<span class="number">0</span>x7ff00000,-<span class="number">0</span>x7fff<span class="number">8000,0x20</span>,-<span class="number">0</span>x7fef7fe<span class="number">0,0x108020</span>,<span class="number">0</span>x<span class="number">20,0x8000</span>,-<span class="number">0x80000000</span>,<span class="number">0</span>x8020,-<span class="number">0</span>x7fef80<span class="number">00,0x100000</span>,-<span class="number">0</span>x7fffffe<span class="number">0,0x100020</span>,-<span class="number">0</span>x7fff7fe0,-<span class="number">0</span>x7fffffe<span class="number">0,0x100020</span>,<span class="number">0x108000,0</span>,-<span class="number">0</span>x7fff80<span class="number">00,0x8020</span>,-<span class="number">0x80000000</span>,-<span class="number">0</span>x7fefffe0,-<span class="number">0</span>x7fef7fe<span class="number">0,0x108000</span>)<span class="comment">;  </span></div><div class="line">  var spfunction3 = new Array (<span class="number">0</span>x208,<span class="number">0x8020200</span>,<span class="number">0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000200</span>,<span class="number">0,0x20208</span>,<span class="number">0x8000200</span>,<span class="number">0x20008</span>,<span class="number">0x8000008</span>,<span class="number">0x8000008</span>,<span class="number">0x20000</span>,<span class="number">0x8020208</span>,<span class="number">0x20008</span>,<span class="number">0x8020000</span>,<span class="number">0</span>x208,<span class="number">0x8000000</span>,<span class="number">0</span>x8,<span class="number">0x8020200</span>,<span class="number">0</span>x<span class="number">200,0x20200</span>,<span class="number">0x8020000</span>,<span class="number">0x8020008</span>,<span class="number">0x20208</span>,<span class="number">0x8000208</span>,<span class="number">0x20200</span>,<span class="number">0x20000</span>,<span class="number">0x8000208</span>,<span class="number">0</span>x8,<span class="number">0x8020208</span>,<span class="number">0</span>x200,<span class="number">0x8000000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000000</span>,<span class="number">0x20008</span>,<span class="number">0</span>x<span class="number">208,0x20000</span>,<span class="number">0x8020200</span>,<span class="number">0x8000200</span>,<span class="number">0,0x200</span>,<span class="number">0x20008</span>,<span class="number">0x8020208</span>,<span class="number">0x8000200</span>,<span class="number">0x8000008</span>,<span class="number">0x200,0</span>,<span class="number">0x8020008</span>,<span class="number">0x8000208</span>,<span class="number">0x20000</span>,<span class="number">0x8000000</span>,<span class="number">0x8020208</span>,<span class="number">0</span>x<span class="number">8,0x20208</span>,<span class="number">0x20200</span>,<span class="number">0x8000008</span>,<span class="number">0x8020000</span>,<span class="number">0x8000208</span>,<span class="number">0</span>x208,<span class="number">0x8020000</span>,<span class="number">0x20208</span>,<span class="number">0</span>x8,<span class="number">0x8020008</span>,<span class="number">0x20200</span>)<span class="comment">;  </span></div><div class="line">  var spfunction4 = new Array (<span class="number">0x802001</span>,<span class="number">0</span>x20<span class="number">81,0x2081</span>,<span class="number">0</span>x80,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0x800001</span>,<span class="number">0x2001,0</span>,<span class="number">0x802000</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0</span>x81,<span class="number">0</span>,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0</span>x<span class="number">1,0x2000</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0</span>x80,<span class="number">0x800000</span>,<span class="number">0</span>x20<span class="number">01,0x2080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x<span class="number">1,0x2080</span>,<span class="number">0x800080</span>,<span class="number">0</span>x2000,<span class="number">0x802080</span>,<span class="number">0x802081</span>,<span class="number">0</span>x81,<span class="number">0x800080</span>,<span class="number">0x800001</span>,<span class="number">0x802000</span>,<span class="number">0x802081</span>,<span class="number">0x81,0,0</span>,<span class="number">0x802000</span>,<span class="number">0</span>x2080,<span class="number">0x800080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x1,<span class="number">0x802001</span>,<span class="number">0</span>x20<span class="number">81,0x2081</span>,<span class="number">0</span>x80,<span class="number">0x802081</span>,<span class="number">0x81,0x1</span>,<span class="number">0</span>x2000,<span class="number">0x800001</span>,<span class="number">0</span>x2001,<span class="number">0x802080</span>,<span class="number">0x800081</span>,<span class="number">0</span>x20<span class="number">01,0x2080</span>,<span class="number">0x800000</span>,<span class="number">0x802001</span>,<span class="number">0</span>x80,<span class="number">0x800000</span>,<span class="number">0</span>x2000,<span class="number">0x802080</span>)<span class="comment">;  </span></div><div class="line">  var spfunction5 = new Array (<span class="number">0</span>x<span class="number">100,0x2080100</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x80000</span>,<span class="number">0</span>x100,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x40080100</span>,<span class="number">0x80000</span>,<span class="number">0x2000100</span>,<span class="number">0x40080100</span>,<span class="number">0x42000100</span>,<span class="number">0x42080000</span>,<span class="number">0x80100</span>,<span class="number">0x40000000</span>,<span class="number">0x2000000</span>,<span class="number">0x40080000</span>,<span class="number">0x40080000</span>,<span class="number">0</span>,<span class="number">0x40000100</span>,<span class="number">0x42080100</span>,<span class="number">0x42080100</span>,<span class="number">0x2000100</span>,<span class="number">0x42080000</span>,<span class="number">0x40000100</span>,<span class="number">0</span>,<span class="number">0x42000000</span>,<span class="number">0x2080100</span>,<span class="number">0x2000000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x80000</span>,<span class="number">0x42000100</span>,<span class="number">0</span>x100,<span class="number">0x2000000</span>,<span class="number">0x40000000</span>,<span class="number">0x2080000</span>,<span class="number">0x42000100</span>,<span class="number">0x40080100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000000</span>,<span class="number">0x42080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40080100</span>,<span class="number">0</span>x100,<span class="number">0x2000000</span>,<span class="number">0x42080000</span>,<span class="number">0x42080100</span>,<span class="number">0x80100</span>,<span class="number">0x42000000</span>,<span class="number">0x42080100</span>,<span class="number">0x2080000</span>,<span class="number">0</span>,<span class="number">0x40080000</span>,<span class="number">0x42000000</span>,<span class="number">0x80100</span>,<span class="number">0x2000100</span>,<span class="number">0x40000100</span>,<span class="number">0x80000,0</span>,<span class="number">0x40080000</span>,<span class="number">0x2080100</span>,<span class="number">0x40000100</span>)<span class="comment">;  </span></div><div class="line">  var spfunction6 = new Array (<span class="number">0x20000010</span>,<span class="number">0x20400000</span>,<span class="number">0</span>x4000,<span class="number">0x20404010</span>,<span class="number">0x20400000</span>,<span class="number">0</span>x10,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x404010</span>,<span class="number">0x400000</span>,<span class="number">0x20000010</span>,<span class="number">0x400010</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0x4010,0</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>x4000,<span class="number">0x404000</span>,<span class="number">0x20004010</span>,<span class="number">0</span>x10,<span class="number">0x20400010</span>,<span class="number">0x20400010</span>,<span class="number">0</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>x4010,<span class="number">0x404000</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x20004000</span>,<span class="number">0</span>x10,<span class="number">0x20400010</span>,<span class="number">0x404000</span>,<span class="number">0x20404010</span>,<span class="number">0x400000</span>,<span class="number">0</span>x4010,<span class="number">0x20000010</span>,<span class="number">0x400000</span>,<span class="number">0x20004000</span>,<span class="number">0x20000000</span>,<span class="number">0</span>x4010,<span class="number">0x20000010</span>,<span class="number">0x20404010</span>,<span class="number">0x404000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0x20404000</span>,<span class="number">0</span>,<span class="number">0x20400010</span>,<span class="number">0</span>x<span class="number">10,0x4000</span>,<span class="number">0x20400000</span>,<span class="number">0x404010</span>,<span class="number">0</span>x4000,<span class="number">0x400010</span>,<span class="number">0x20004010</span>,<span class="number">0</span>,<span class="number">0x20404000</span>,<span class="number">0x20000000</span>,<span class="number">0x400010</span>,<span class="number">0x20004010</span>)<span class="comment">;  </span></div><div class="line">  var spfunction7 = new Array (<span class="number">0x200000</span>,<span class="number">0x4200002</span>,<span class="number">0x4000802</span>,<span class="number">0,0x800</span>,<span class="number">0x4000802</span>,<span class="number">0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0x4200802</span>,<span class="number">0x200000,0</span>,<span class="number">0x4000002</span>,<span class="number">0</span>x2,<span class="number">0x4000000</span>,<span class="number">0x4200002</span>,<span class="number">0</span>x802,<span class="number">0x4000800</span>,<span class="number">0x200802</span>,<span class="number">0x200002</span>,<span class="number">0x4000800</span>,<span class="number">0x4000002</span>,<span class="number">0x4200000</span>,<span class="number">0x4200800</span>,<span class="number">0x200002</span>,<span class="number">0x4200000</span>,<span class="number">0</span>x8<span class="number">00,0x802</span>,<span class="number">0x4200802</span>,<span class="number">0x200800</span>,<span class="number">0</span>x2,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x4000000</span>,<span class="number">0x200800</span>,<span class="number">0x200000</span>,<span class="number">0x4000802</span>,<span class="number">0x4000802</span>,<span class="number">0x4200002</span>,<span class="number">0x4200002</span>,<span class="number">0</span>x<span class="number">2,0x200002</span>,<span class="number">0x4000000</span>,<span class="number">0x4000800</span>,<span class="number">0x200000</span>,<span class="number">0x4200800</span>,<span class="number">0</span>x8<span class="number">02,0x200802</span>,<span class="number">0x4200800</span>,<span class="number">0</span>x802,<span class="number">0x4000002</span>,<span class="number">0x4200802</span>,<span class="number">0x4200000</span>,<span class="number">0x200800,0</span>,<span class="number">0</span>x2,<span class="number">0x4200802</span>,<span class="number">0,0x200802</span>,<span class="number">0x4200000</span>,<span class="number">0</span>x800,<span class="number">0x4000002</span>,<span class="number">0x4000800</span>,<span class="number">0</span>x8<span class="number">00,0x200002</span>)<span class="comment">;  </span></div><div class="line">  var spfunction8 = new Array (<span class="number">0x10001040</span>,<span class="number">0</span>x10<span class="number">00,0x40000</span>,<span class="number">0x10041040</span>,<span class="number">0x10000000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>x40,<span class="number">0x10000000</span>,<span class="number">0x40040</span>,<span class="number">0x10040000</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x10041000</span>,<span class="number">0x41040</span>,<span class="number">0</span>x<span class="number">1000,0x40</span>,<span class="number">0x10040000</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0</span>x10<span class="number">40,0x41000</span>,<span class="number">0x40040</span>,<span class="number">0x10040040</span>,<span class="number">0x10041000</span>,<span class="number">0x1040,0</span>,<span class="number">0</span>,<span class="number">0x10040040</span>,<span class="number">0x10000040</span>,<span class="number">0x10001000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x41040</span>,<span class="number">0x40000</span>,<span class="number">0x10041000</span>,<span class="number">0</span>x<span class="number">1000,0x40</span>,<span class="number">0x10040040</span>,<span class="number">0</span>x10<span class="number">00,0x41040</span>,<span class="number">0x10001000</span>,<span class="number">0</span>x40,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10040040</span>,<span class="number">0x10000000</span>,<span class="number">0x40000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x40040</span>,<span class="number">0x10000040</span>,<span class="number">0x10040000</span>,<span class="number">0x10001000</span>,<span class="number">0x10001040</span>,<span class="number">0</span>,<span class="number">0x10041040</span>,<span class="number">0x41000</span>,<span class="number">0x41000</span>,<span class="number">0</span>x10<span class="number">40,0x1040</span>,<span class="number">0x40040</span>,<span class="number">0x10000000</span>,<span class="number">0x10041000</span>)<span class="comment">;  </span></div><div class="line"> </div><div class="line">  //create the <span class="number">16</span> or <span class="number">48</span> subkeys we will need  </div><div class="line">  var keys = des_createKeys (key)<span class="comment">;  </span></div><div class="line">  var m=<span class="number">0</span>, i, j, temp, temp2, right1, right2, left, right, looping<span class="comment">;  </span></div><div class="line">  var cbcleft, cbcleft2, cbcright, cbcright2  </div><div class="line">  var endloop, loopinc<span class="comment">;  </span></div><div class="line">  var len = message.length<span class="comment">;  </span></div><div class="line">  var chunk = <span class="number">0</span><span class="comment">;  </span></div><div class="line">  //set up the loops for single and triple des  </div><div class="line">  var iterations = keys.length == <span class="number">32</span> ? <span class="number">3</span> : <span class="number">9</span><span class="comment">; //single or triple des  </span></div><div class="line">  if (iterations == <span class="number">3</span>) &#123;  </div><div class="line">    looping = encrypt ? new Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>) : new Array (<span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>)<span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  else &#123;  </div><div class="line">    looping = encrypt ? new Array (<span class="number">0</span>, <span class="number">32</span>, <span class="number">2</span>, <span class="number">62</span>, <span class="number">30</span>, -<span class="number">2</span>, <span class="number">64</span>, <span class="number">96</span>, <span class="number">2</span>) : new Array (<span class="number">94</span>, <span class="number">62</span>, -<span class="number">2</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">2</span>, <span class="number">30</span>, -<span class="number">2</span>, -<span class="number">2</span>)<span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  //pad the message depending on the padding parameter  </div><div class="line">  if (padding == <span class="number">2</span>)   </div><div class="line">    message += "        "<span class="comment">; //pad the message with spaces  </span></div><div class="line">  else if (padding == <span class="number">1</span>) &#123;  </div><div class="line">    temp = <span class="number">8</span>-(len%<span class="number">8</span>)<span class="comment">; message += String.fromCharCode (temp,temp,temp,temp,temp,temp,temp,temp);   </span></div><div class="line">      if (temp==<span class="number">8</span>)   </div><div class="line">        len+=<span class="number">8</span><span class="comment">;  </span></div><div class="line">  &#125; //PKCS7 padding 这里其实只是PKCS5 padding, PKCS5规定采用<span class="number">8</span>位补全，而PKCS7则不确定位数  </div><div class="line">  else if (!padding)   </div><div class="line">    message += "\<span class="number">0\0\0\0</span>\<span class="number">0\0\0\0</span>"<span class="comment">; //pad the message out with null bytes  </span></div><div class="line">  </div><div class="line">  //store the result here  </div><div class="line">  result = ""<span class="comment">;  </span></div><div class="line">  tempresult = ""<span class="comment">;  </span></div><div class="line">  </div><div class="line">  if (mode == <span class="number">1</span>) &#123; //CBC mode  </div><div class="line">    cbcleft = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    cbcright = (iv.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (iv.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | iv.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    m=<span class="number">0</span><span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  //loop through each <span class="number">64</span> bit chunk of the message  </div><div class="line">  while (m &lt; len) &#123;  </div><div class="line">    left = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    right = (message.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (message.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | message.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">  </div><div class="line">    //for Cipher Block Chaining mode, xor the message with the previous result  </div><div class="line">    if (mode == <span class="number">1</span>) &#123;if (encrypt) &#123;left ^= cbcleft<span class="comment">; right ^= cbcright;&#125; else &#123;cbcleft2 = cbcleft; cbcright2 = cbcright; cbcleft = left; cbcright = right;&#125;&#125;  </span></div><div class="line">  </div><div class="line">    //first each <span class="number">64</span> but chunk of the message must be permuted according to IP  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0</span>x0000ffff<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 16);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span><span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">  </div><div class="line">    left = ((left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">    right = ((right &lt;&lt; <span class="number">1</span>) | (right &gt;&gt;&gt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">  </div><div class="line">    //do this either <span class="number">1</span> or <span class="number">3</span> times for each chunk of the message  </div><div class="line">    for (j=<span class="number">0</span><span class="comment">; j&lt;iterations; j+=3) &#123;  </span></div><div class="line">      endloop = looping[j+<span class="number">1</span>]<span class="comment">;  </span></div><div class="line">      loopinc = looping[j+<span class="number">2</span>]<span class="comment">;  </span></div><div class="line">      //now go through and perform the encryption or decryption    </div><div class="line">      for (i=looping[j]<span class="comment">; i!=endloop; i+=loopinc) &#123; //for efficiency  </span></div><div class="line">        right1 = right ^ keys[i]<span class="comment">;   </span></div><div class="line">        right2 = ((right &gt;&gt;&gt; <span class="number">4</span>) | (right &lt;&lt; <span class="number">28</span>)) ^ keys[i+<span class="number">1</span>]<span class="comment">;  </span></div><div class="line">        //the result is attained by passing these bytes through the S selection functions  </div><div class="line">        temp = left<span class="comment">;  </span></div><div class="line">        left = right<span class="comment">;  </span></div><div class="line">        right = temp ^ (spfunction2[(right1 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>x3f] | spfunction4[(right1 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction6[(right1 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0</span>x3f] | spfunction8[right1 &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction1[(right2 &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>x3f] | spfunction3[(right2 &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>x3f]  </div><div class="line">              | spfunction5[(right2 &gt;&gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0</span>x3f] | spfunction7[right2 &amp; <span class="number">0</span>x3f])<span class="comment">;  </span></div><div class="line">      &#125;  </div><div class="line">      temp = left<span class="comment">; left = right; right = temp; //unreverse left and right  </span></div><div class="line">    &#125; //for either <span class="number">1</span> or <span class="number">3</span> iterations  </div><div class="line">  </div><div class="line">    //move then each one bit to the right  </div><div class="line">    left = ((left &gt;&gt;&gt; <span class="number">1</span>) | (left &lt;&lt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">    right = ((right &gt;&gt;&gt; <span class="number">1</span>) | (right &lt;&lt; <span class="number">31</span>))<span class="comment">;   </span></div><div class="line">  </div><div class="line">    //now perform IP-<span class="number">1</span>, which is IP in the opposite direction  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">2</span>) ^ left) &amp; <span class="number">0x33333333</span><span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">16</span>) ^ right) &amp; <span class="number">0</span>x0000ffff<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">  </div><div class="line">    //for Cipher Block Chaining mode, xor the message with the previous result  </div><div class="line">    if (mode == <span class="number">1</span>) &#123;if (encrypt) &#123;cbcleft = left<span class="comment">; cbcright = right;&#125; else &#123;left ^= cbcleft2; right ^= cbcright2;&#125;&#125;  </span></div><div class="line">    tempresult += String.fromCharCode ((left&gt;&gt;&gt;<span class="number">24</span>), ((left&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0</span>xff), ((left&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0</span>xff), (left &amp; <span class="number">0</span>xff), (right&gt;&gt;&gt;<span class="number">24</span>), ((right&gt;&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0</span>xff), ((right&gt;&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0</span>xff), (right &amp; <span class="number">0</span>xff))<span class="comment">;  </span></div><div class="line">  </div><div class="line">    chunk += <span class="number">8</span><span class="comment">;  </span></div><div class="line">    if (chunk == <span class="number">512</span>) &#123;result += tempresult<span class="comment">; tempresult = ""; chunk = 0;&#125;  </span></div><div class="line">  &#125; //for every <span class="number">8</span> characters, or <span class="number">64</span> bits in the message  </div><div class="line">  </div><div class="line">  //return the result as an array  </div><div class="line">  return result + tempresult<span class="comment">;  </span></div><div class="line">&#125; //end of des  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">//des_createKeys  </div><div class="line">//this takes as input a <span class="number">64</span> bit key (even though only <span class="number">56</span> bits are used)  </div><div class="line">//as an array of <span class="number">2</span> integers, and returns <span class="number">16</span> <span class="number">48</span> bit keys  </div><div class="line">function des_createKeys (key) &#123;  </div><div class="line">  //declaring this locally speeds things up a bit  </div><div class="line">  pc2bytes0  = new Array (<span class="number">0</span>,<span class="number">0</span>x4,<span class="number">0x20000000</span>,<span class="number">0x20000004</span>,<span class="number">0x10000</span>,<span class="number">0x10004</span>,<span class="number">0x20010000</span>,<span class="number">0x20010004</span>,<span class="number">0x200,0x204</span>,<span class="number">0x20000200</span>,<span class="number">0x20000204</span>,<span class="number">0x10200</span>,<span class="number">0x10204</span>,<span class="number">0x20010200</span>,<span class="number">0x20010204</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes1  = new Array (<span class="number">0</span>,<span class="number">0</span>x<span class="number">1,0x100000</span>,<span class="number">0x100001</span>,<span class="number">0x4000000</span>,<span class="number">0x4000001</span>,<span class="number">0x4100000</span>,<span class="number">0x4100001</span>,<span class="number">0x100,0x101</span>,<span class="number">0x100100</span>,<span class="number">0x100101</span>,<span class="number">0x4000100</span>,<span class="number">0x4000101</span>,<span class="number">0x4100100</span>,<span class="number">0x4100101</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes2  = new Array (<span class="number">0</span>,<span class="number">0</span>x<span class="number">8,0x800</span>,<span class="number">0</span>x808,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>,<span class="number">0</span>,<span class="number">0</span>x<span class="number">8,0x800</span>,<span class="number">0</span>x808,<span class="number">0x1000000</span>,<span class="number">0x1000008</span>,<span class="number">0x1000800</span>,<span class="number">0x1000808</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes3  = new Array (<span class="number">0,0x200000</span>,<span class="number">0x8000000</span>,<span class="number">0x8200000</span>,<span class="number">0</span>x20<span class="number">00,0x202000</span>,<span class="number">0x8002000</span>,<span class="number">0x8202000</span>,<span class="number">0x20000</span>,<span class="number">0x220000</span>,<span class="number">0x8020000</span>,<span class="number">0x8220000</span>,<span class="number">0x22000</span>,<span class="number">0x222000</span>,<span class="number">0x8022000</span>,<span class="number">0x8222000</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes4  = new Array (<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">10,0x40010</span>,<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">10,0x40010</span>,<span class="number">0</span>x10<span class="number">00,0x41000</span>,<span class="number">0</span>x10<span class="number">10,0x41010</span>,<span class="number">0</span>x10<span class="number">00,0x41000</span>,<span class="number">0</span>x10<span class="number">10,0x41010</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes5  = new Array (<span class="number">0,0x400</span>,<span class="number">0</span>x<span class="number">20,0x420</span>,<span class="number">0,0x400</span>,<span class="number">0</span>x<span class="number">20,0x420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>,<span class="number">0x2000000</span>,<span class="number">0x2000400</span>,<span class="number">0x2000020</span>,<span class="number">0x2000420</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes6  = new Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0</span>x2,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0x80000</span>,<span class="number">0x10080000</span>,<span class="number">0</span>x2,<span class="number">0x10000002</span>,<span class="number">0x80002</span>,<span class="number">0x10080002</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes7  = new Array (<span class="number">0,0x10000</span>,<span class="number">0</span>x8<span class="number">00,0x10800</span>,<span class="number">0x20000000</span>,<span class="number">0x20010000</span>,<span class="number">0x20000800</span>,<span class="number">0x20010800</span>,<span class="number">0x20000</span>,<span class="number">0x30000</span>,<span class="number">0x20800</span>,<span class="number">0x30800</span>,<span class="number">0x20020000</span>,<span class="number">0x20030000</span>,<span class="number">0x20020800</span>,<span class="number">0x20030800</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes8  = new Array (<span class="number">0,0x40000</span>,<span class="number">0,0x40000</span>,<span class="number">0</span>x<span class="number">2,0x40002</span>,<span class="number">0</span>x<span class="number">2,0x40002</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000000</span>,<span class="number">0x2040000</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>,<span class="number">0x2000002</span>,<span class="number">0x2040002</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes9  = new Array (<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0</span>x8,<span class="number">0x10000008</span>,<span class="number">0</span>,<span class="number">0x10000000</span>,<span class="number">0</span>x8,<span class="number">0x10000008</span>,<span class="number">0</span>x400,<span class="number">0x10000400</span>,<span class="number">0</span>x408,<span class="number">0x10000408</span>,<span class="number">0</span>x400,<span class="number">0x10000400</span>,<span class="number">0</span>x408,<span class="number">0x10000408</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes10 = new Array (<span class="number">0,0x20,0</span>,<span class="number">0</span>x<span class="number">20,0x100000</span>,<span class="number">0x100020</span>,<span class="number">0x100000</span>,<span class="number">0x100020</span>,<span class="number">0</span>x20<span class="number">00,0x2020</span>,<span class="number">0</span>x20<span class="number">00,0x2020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>,<span class="number">0x102000</span>,<span class="number">0x102020</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes11 = new Array (<span class="number">0</span>,<span class="number">0x1000000</span>,<span class="number">0</span>x<span class="number">200,0x1000200</span>,<span class="number">0x200000</span>,<span class="number">0x1200000</span>,<span class="number">0x200200</span>,<span class="number">0x1200200</span>,<span class="number">0x4000000</span>,<span class="number">0x5000000</span>,<span class="number">0x4000200</span>,<span class="number">0x5000200</span>,<span class="number">0x4200000</span>,<span class="number">0x5200000</span>,<span class="number">0x4200200</span>,<span class="number">0x5200200</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes12 = new Array (<span class="number">0,0x1000</span>,<span class="number">0x8000000</span>,<span class="number">0x8001000</span>,<span class="number">0x80000</span>,<span class="number">0x81000</span>,<span class="number">0x8080000</span>,<span class="number">0x8081000</span>,<span class="number">0</span>x<span class="number">10,0x1010</span>,<span class="number">0x8000010</span>,<span class="number">0x8001010</span>,<span class="number">0x80010</span>,<span class="number">0x81010</span>,<span class="number">0x8080010</span>,<span class="number">0x8081010</span>)<span class="comment">;  </span></div><div class="line">  pc2bytes13 = new Array (<span class="number">0</span>,<span class="number">0x4,0x100</span>,<span class="number">0x104,0</span>,<span class="number">0x4,0x100</span>,<span class="number">0x104,0x1</span>,<span class="number">0x5,0x101</span>,<span class="number">0x105,0x1</span>,<span class="number">0x5,0x101</span>,<span class="number">0</span>x105)<span class="comment">;  </span></div><div class="line">  </div><div class="line">  //how many iterations (<span class="number">1</span> for des, <span class="number">3</span> for triple des)  </div><div class="line">  var iterations = key.length &gt; <span class="number">8</span> ? <span class="number">3</span> : <span class="number">1</span><span class="comment">;   </span></div><div class="line">  //stores the return keys  </div><div class="line">  var keys = new Array (<span class="number">32</span> * iterations)<span class="comment">;  </span></div><div class="line">  //now define the left shifts which need to be done  </div><div class="line">  var shifts = new Array (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)<span class="comment">;  </span></div><div class="line">  //other variables  </div><div class="line">  var lefttemp, righttemp, m=<span class="number">0</span>, n=<span class="number">0</span>, temp<span class="comment">;  </span></div><div class="line">  </div><div class="line">  for (var j=<span class="number">0</span><span class="comment">; j&lt;iterations; j++) &#123; //either 1 or 3 iterations  </span></div><div class="line">    left = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">    right = (key.charCodeAt(m++) &lt;&lt; <span class="number">24</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">16</span>) | (key.charCodeAt(m++) &lt;&lt; <span class="number">8</span>) | key.charCodeAt(m++)<span class="comment">;  </span></div><div class="line">  </div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">4</span>) ^ right) &amp; <span class="number">0</span>x0f0f0f0f<span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 4);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0</span>x0000ffff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; -16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">2</span>) ^ right) &amp; <span class="number">0x33333333</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 2);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; -<span class="number">16</span>) ^ left) &amp; <span class="number">0</span>x0000ffff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; -16);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">    temp = ((right &gt;&gt;&gt; <span class="number">8</span>) ^ left) &amp; <span class="number">0</span>x00ff00ff<span class="comment">; left ^= temp; right ^= (temp &lt;&lt; 8);  </span></div><div class="line">    temp = ((left &gt;&gt;&gt; <span class="number">1</span>) ^ right) &amp; <span class="number">0x55555555</span><span class="comment">; right ^= temp; left ^= (temp &lt;&lt; 1);  </span></div><div class="line">  </div><div class="line">    //the right side needs to be shifted and to get the last four bits of the left side  </div><div class="line">    temp = (left &lt;&lt; <span class="number">8</span>) | ((right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>x<span class="number">000000f0</span>)<span class="comment">;  </span></div><div class="line">    //left needs to be put upside down  </div><div class="line">    left = (right &lt;&lt; <span class="number">24</span>) | ((right &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0</span>xff0000) | ((right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xff00) | ((right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf0)<span class="comment">;  </span></div><div class="line">    right = temp<span class="comment">;  </span></div><div class="line">  </div><div class="line">    //now go through and perform these shifts on the left and right keys  </div><div class="line">    for (var i=<span class="number">0</span><span class="comment">; i &lt; shifts.length; i++) &#123;  </span></div><div class="line">      //shift the keys either one or two bits to the left  </div><div class="line">      if (shifts[i]) &#123;left = (left &lt;&lt; <span class="number">2</span>) | (left &gt;&gt;&gt; <span class="number">26</span>)<span class="comment">; right = (right &lt;&lt; 2) | (right &gt;&gt;&gt; 26);&#125;  </span></div><div class="line">      else &#123;left = (left &lt;&lt; <span class="number">1</span>) | (left &gt;&gt;&gt; <span class="number">27</span>)<span class="comment">; right = (right &lt;&lt; 1) | (right &gt;&gt;&gt; 27);&#125;  </span></div><div class="line">      left &amp;= -<span class="number">0</span>xf<span class="comment">; right &amp;= -0xf;  </span></div><div class="line">  </div><div class="line">      //now apply PC-<span class="number">2</span>, in such a way that E is easier when encrypting or decrypting  </div><div class="line">      //this conversion will look like PC-<span class="number">2</span> except only the last <span class="number">6</span> bits of each byte are used  </div><div class="line">      //rather than <span class="number">48</span> consecutive bits and the order of lines will be according to   </div><div class="line">      //how the S selection functions will be applied: S2, S4, S6, S8, S1, S3, S5, S7  </div><div class="line">      lefttemp = pc2bytes0[left &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes1[(left &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes2[(left &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>xf] | pc2bytes3[(left &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes4[(left &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0</span>xf] | pc2bytes5[(left &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">              | pc2bytes6[(left &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0</span>xf]<span class="comment">;  </span></div><div class="line">      righttemp = pc2bytes7[right &gt;&gt;&gt; <span class="number">28</span>] | pc2bytes8[(right &gt;&gt;&gt; <span class="number">24</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes9[(right &gt;&gt;&gt; <span class="number">20</span>) &amp; <span class="number">0</span>xf] | pc2bytes10[(right &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes11[(right &gt;&gt;&gt; <span class="number">12</span>) &amp; <span class="number">0</span>xf] | pc2bytes12[(right &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0</span>xf]  </div><div class="line">                | pc2bytes13[(right &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0</span>xf]<span class="comment">;  </span></div><div class="line">      temp = ((righttemp &gt;&gt;&gt; <span class="number">16</span>) ^ lefttemp) &amp; <span class="number">0</span>x0000ffff<span class="comment">;   </span></div><div class="line">      keys[n++] = lefttemp ^ temp<span class="comment">; keys[n++] = righttemp ^ (temp &lt;&lt; 16);  </span></div><div class="line">    &#125;  </div><div class="line">  &#125; //for each iterations  </div><div class="line">  //return the keys we've created  </div><div class="line">  return keys<span class="comment">;  </span></div><div class="line">&#125; //end of des_createKeys</div></pre></td></tr></table></figure>
<h1 id="调用3des加密和解密">调用3des加密和解密</h1><p>由于对加密的结果有以下要求:</p>
<ul>
<li>密钥长度不足 24 字节时，应当右补ASCII 字符“0”；</li>
<li>返回结果使用ASCII 形式的十六进制编码表示，采用大写“ABCDEF”，如加密结果为8 字节二进制字符串：0x0123456789ABCDEF，则Authenticator 为16 字节ASCII 字符串：”0123456789ABCDEF” 。</li>
<li>用hex的加密结果作为解密字符串时,函数应该将十六进制的字符串转换为ASCII码的字符串</li>
</ul>
<p>所以又重新封装了des加密函数. 加密出来的结果因为变量类型是字符串所以实际上是ACSII码,所以看起就像乱码一样,需求需要把ASCII码转换成16进制Hex.所以在解密的时候则需要把16进制的hex先转换回ASCII码在进行解密.</p>
<p>参考如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode3des</span>(<span class="params">key, message</span>) </span>&#123;  </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </div><div class="line">            key+=<span class="string">"0"</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">var</span> _temp=des(key, message, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> string2Hex(_temp);</div><div class="line">&#125;  </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode3des</span> (<span class="params">key, message</span>) </span>&#123; </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i&lt;<span class="number">24</span>; i++) &#123;  </div><div class="line">            key+=<span class="string">"0"</span>;  </div><div class="line">    &#125;  </div><div class="line">    message =hex2ASCII(message);</div><div class="line">    <span class="keyword">return</span>  des(key, message, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);  </div><div class="line">&#125; </div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex2ASCII</span>(<span class="params">str</span>) </span>&#123; </div><div class="line">    <span class="keyword">var</span> result = <span class="string">''</span>;</div><div class="line">    <span class="keyword">while</span> (str.length &gt;= <span class="number">2</span>) &#123; </div><div class="line">       result += <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(str.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>));</div><div class="line">        str = str.substring(<span class="number">2</span>, str.length);</div><div class="line">    &#125;</div><div class="line">    message =result;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">string2Hex</span>(<span class="params">s</span>) </span>&#123;  </div><div class="line">  <span class="keyword">var</span> r = <span class="string">""</span>;</div><div class="line">  <span class="keyword">var</span> hexes = <span class="keyword">new</span> <span class="built_in">Array</span> (<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>,<span class="string">"4"</span>,<span class="string">"5"</span>,<span class="string">"6"</span>,<span class="string">"7"</span>,<span class="string">"8"</span>,<span class="string">"9"</span>,<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>,<span class="string">"D"</span>,<span class="string">"E"</span>,<span class="string">"F"</span>);  </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;s.length; i++) &#123;r += hexes [s.charCodeAt(i) &gt;&gt; <span class="number">4</span>] + hexes [s.charCodeAt(i) &amp; <span class="number">0xf</span>];&#125;  </div><div class="line">  <span class="keyword">return</span> r;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里还有一种将Unicode转为hex的方法,但是要注意这里如果转化出来是02 那么它是会当做2写进字符串的,所以要做一下判断,给他补零补齐两位.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function string2Hex (s) &#123;</div><div class="line">    var <span class="built_in">hex</span>, i<span class="comment">;</span></div><div class="line">    var result = <span class="string">""</span><span class="comment">;</span></div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span><span class="comment">; i&lt;s.length; i++) &#123;</span></div><div class="line">        <span class="built_in">hex</span> = s.codePointAt(i).toString(<span class="number">16</span>)<span class="comment">;</span></div><div class="line">        <span class="keyword">if</span>(<span class="built_in">hex</span>.length&lt;<span class="number">2</span>)&#123;</div><div class="line">           <span class="built_in">hex</span>=<span class="string">'0'</span>+<span class="built_in">hex</span><span class="comment">;</span></div><div class="line">        &#125;</div><div class="line">        result += (<span class="built_in">hex</span>).slice(<span class="number">-4</span>)<span class="comment">;</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result.toUpperCase()<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</span>
      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/26/linux-network-cmd/" rel="next" title="Linux网络抓包命令以及dns查询命令">
                <i class="fa fa-chevron-left"></i> Linux网络抓包命令以及dns查询命令
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/02/ubuntu-settings/" rel="prev" title="Securing your Ubuntu Server">
                Securing your Ubuntu Server <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


        </div>

        


        
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/06/28/3des-of-javascript/"
           data-title="JavaScript 中 3DES加密解密&ASCII与Hex16进制互相转换" data-url="http://lyn.s76.org/2016/06/28/3des-of-javascript/">
      </div>
    
  </div>


      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Lyn's Blog" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lyn's Blog</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Lyn's Blog about Node.js  Express.js Angular.js HTML5 Mongodb Programing Notes</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">57</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#3DES_三重数据加密算法"><span class="nav-number">1.</span> <span class="nav-text">3DES 三重数据加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#算法"><span class="nav-number">1.1.</span> <span class="nav-text">算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#密钥选项"><span class="nav-number">1.2.</span> <span class="nav-text">密钥选项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3Des加密函数"><span class="nav-number">2.</span> <span class="nav-text">3Des加密函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#调用3des加密和解密"><span class="nav-number">3.</span> <span class="nav-text">调用3des加密和解密</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyn's Blog</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://hexo.io">Powered by Hexo
  </a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>

</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-lyn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
